(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[567],{90567:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return Z}});var n=t(57437),i=t(54241),l=t(22238),s=t(56798),o=t(22960),a=t(31193),c=t(96537),u=t(34990),d=t(40468),p=t(80511),h=t(87170),g=t.n(h),f=t(97293),b=t(39315),m=t.n(b),x=t(2265),v=t(59589),w=t(4766),A=t(40395),j=t(75683),y=t.n(j);let C=e=>y().createHash("sha1").update(e).digest("base64");var I=t(27692),R=t.n(I);function Z(e){let r=(0,o.Z)(),t=(0,x.useRef)(null),h=(0,x.useRef)(null),b=(0,x.useRef)(null),j=(0,x.useRef)(null),y=(0,x.useRef)(null),I=(0,x.useRef)(0),Z=(0,x.useRef)(!1),S=(0,x.useRef)([]),D=(0,x.useRef)(),k=(0,x.useRef)(null),[E,W]=(0,x.useState)(!1),[G,P]=(0,x.useState)(!1),{slideIndex:B,setSlideIndex:z}=(0,x.useContext)(w.X),L=(0,x.useRef)(e.regenerateThumbnails);(0,x.useEffect)(()=>{if(!0!==Z.current&&null!==b.current){if(Z.current=!0,E||D.current||!window.indexedDB)H();else{let e=window.indexedDB.open("deliberation-thumbnails-by-sid",2);e.onupgradeneeded=e=>{e.target.result.createObjectStore("thumbnails",{keyPath:"sid"}).createIndex("sid","sid",{unique:!0})},e.onsuccess=r=>{t.current=e.result,N()}}}},[e.sid,e.slides,b.current,E]);let N=()=>{if(L.current)D.current=null,H();else{let r=t.current.transaction(["thumbnails"],"readonly").objectStore("thumbnails").get(e.sid);r.onerror=e=>{console.warn("preload thumbnail error",e),H()},r.onsuccess=t=>{var n,i;console.debug("Retrieved thumbnails");let l=C(e.sourcePresentationXml);console.debug("Slides XML hash: ".concat(l)),console.debug("ObjectStore XML hash: ".concat(null===(n=r.result)||void 0===n?void 0:n.hash)),(null===(i=r.result)||void 0===i?void 0:i.hash)===l&&(D.current=r.result),H()}}},H=()=>{var r;(D.current=null!==(r=D.current)&&void 0!==r?r:{sid:e.sid,hash:C(e.sourcePresentationXml),previews:[]},D.current.previews.length>0&&!L)?(console.debug("Restored ".concat(D.current.previews.length," previews from local storage")),W(!0)):(console.debug("No previews in local storage - generating new previews."),console.log("revealDivRef",b.current),h.current=new v.Z(b.current,{embedded:!0,controls:!1,keyboard:!1,touch:!1,overview:!1,help:!1,hideInactiveCursor:!1,showNotes:!1,plugins:[],transitionSpeed:"fast"}),h.current.initialize({progress:!1,autoPlayMedia:!1,scrollActivationWidth:void 0}).then(()=>{console.debug("Reveal ready"),h.current.slide(0),h.current.on("slidetransitionend",J),I.current=h.current.getHorizontalSlides().length,S.current=[...Array(I.current).fill(0).map((e,r)=>r)],O()})),L.current=!1},O=()=>{if(!(S.current.length>0))return!1;{let e=S.current.shift();return console.debug("initialising thumbnail for slide ".concat(e,"...")),setTimeout(()=>{X(e)},100),!0}},X=e=>{console.debug("Triggering generation ".concat(e,"...")),h.current.getIndices().h!==e?(console.debug("Sending slide from ".concat(h.current.getIndices().h," to ").concat(e,"...")),h.current.slide(e)):(console.debug("Slide already in position ".concat(e,".")),setTimeout(()=>{M()},1e3))},J=e=>{console.debug("onSlideTransitionEnd at: ".concat(h.current.getIndices().h)),setTimeout(()=>{M()},1e3)},[T,Q]=(0,x.useState)(),K=e=>{Q({generated:e,total:I.current})},M=()=>{let e=h.current.getIndices().h;console.debug("Capturing thumbnail for slide at index: ".concat(e));let r=h.current.getCurrentSlide();r.style.top="0px",(0,f.YM)(r,{cacheBust:!1,imagePlaceholder:"data:image/gif;base64,R0lGODlhGQAZAPQAAISChKWipcbT7+fr/8bf51KuOdbf93vDc87b9/f3997n/2u2Y9bf/5SSlJzHtcbT9////+/z/1KyOdbj94zHjNbb9/f3/2u6Y9bj/5yenLXP1sbX9wAAAAAAAAAAAAAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+ICAgPD94cGFja2V0IGVuZD0idyI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACwAAAAAGQAZAAAF/2DgWGRpmlkTaIkFvWIkzzSdZY42JS8UBIqJcEicKBSZAGSSIfB8AaHBMBlYB5OpMAlJaAhOyy+LKLsgljKCyn1pMruxATGI9CARxZqZ0fgDKg5yCHZ3EAN7KQ2LjA1JVWeGiGVCV1aAjwOGPZN0dTNijlFzaqWlWlQKA5hRCBuvsLGnWgqsEwgCsLmxurAIE7a4rwLEucW7u78EGmO4x8/QAr8uj87PfhrRCmfV0djRmi/dxA4OC+foF34CE4bjAuUFBRL05zkICj0JCd0a5vQAAx4wZEuAPwoLAgYs18NCBFsEHBxQqPDJCyyAfiw7kJCiBAcE9H0BpiJARI8AQyL2IKCOZIAMFCZ6dLDvRYKYEig4SPHywAWUGu4kAHiAwqIQADs="}).then(r=>{D.current.previews[e]={pngDataUrl:r},O()||Y()}).catch(r=>{console.error("error capturing element",r),D.current.previews[e]={pngDataUrl:"/icons/broken-image-placeholder.png"},O()||Y()}).finally(()=>{K(e)})},Y=()=>{console.debug("Completed preview generation"),console.debug("Storing thumbnails...");let e=t.current.transaction(["thumbnails"],"readwrite").objectStore("thumbnails").put(D.current);e.onerror=e=>{var r;console.warn("Error storing thumbnails",e),null===(r=h.current)||void 0===r||r.destroy(),h.current=null,W(!0),Z.current=!1},e.onsuccess=e=>{var r;console.debug("Stored thumbnails",e),null===(r=h.current)||void 0===r||r.destroy(),h.current=null,W(!0),Z.current=!1}};(0,x.useEffect)(()=>{if(E&&k){var e;null===(e=k.current)||void 0===e||e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}});let U=()=>{P(!0)},F=e=>{"refresh"===e&&(L.current=!0,D.current=null,W(!1))},V=()=>{let r=new(m());D.current.previews.forEach((e,t)=>{r.file("slide-".concat(t,".png"),e.pngDataUrl.split("base64,")[1],{base64:!0})}),r.generateAsync({type:"blob"}).then(function(r){g()(r,"slides-".concat(e.sid,".zip"))})};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.Z,{sx:{display:"block",overflowX:"scroll"},children:(0,n.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"row",gap:1,textWrap:"nowrap",whiteSpace:"nowrap",flexWrap:"nowrap"},children:[E&&D.current.previews.map((e,t)=>(0,n.jsx)(a.Z,{sx:{padding:1,border:B===t?"solid 2px":"solid 1px",borderColor:B===t?r.palette.primary.main:r.palette.divider,borderRadius:1,width:"auto",height:"auto",display:"inline-block"},onClick:()=>z(t),children:(0,n.jsx)("img",{ref:B===t?k:void 0,src:e.pngDataUrl,width:150,height:"auto"},"presentation-preview-image-".concat(t))},"presentation-preview-".concat(t))),E&&(0,n.jsxs)(a.Z,{sx:{padding:0,width:"auto",height:"auto",display:"flex",flexDirection:"column",gap:1},children:[(0,n.jsx)(c.Z,{disabled:!E,variant:"outlined",color:"info",onClick:()=>z(0),startIcon:(0,n.jsx)(l.Z,{}),children:"Back to start"}),(0,n.jsx)(c.Z,{disabled:!E,variant:"outlined",color:"info",onClick:()=>U(),startIcon:(0,n.jsx)(s.Z,{}),children:"Refresh previews"}),(0,n.jsx)(c.Z,{disabled:!E,variant:"outlined",color:"info",onClick:()=>V(),startIcon:(0,n.jsx)(i.Z,{}),children:"Download slides"})]})]})}),(0,n.jsx)(a.Z,{sx:{maxWidth:"100%",overflowX:"scroll",display:"flex",flexDirection:"row",flexWrap:"nowrap",gap:1,m:0,p:0,alignItems:"stretch"},children:!E&&(0,n.jsx)(a.Z,{ref:y,sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:120},children:(0,n.jsxs)(u.Z,{elevation:1,sx:{flexDirection:"row",display:"flex",alignItems:"center",gap:1,p:2},children:[(0,n.jsxs)(a.Z,{sx:{width:"75px",height:"auto",aspectRatio:"".concat(150," / ").concat(120),border:"solid 1px",borderRadius:"0.5rem",overflow:"hidden",borderColor:r.palette.primary.main,position:"relative"},children:[(0,n.jsx)("div",{className:"reveal",ref:b,children:(0,n.jsx)("div",{className:"slides ".concat(R().slideWrapControl),ref:j,children:e.slides})}),(0,n.jsx)(a.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",background:"rgba(255, 255, 255, 0.5)",zIndex:100},children:(0,n.jsx)(d.Z,{size:"1.5rem",value:T?T.generated/T.total*100:0,variant:T?"determinate":"indeterminate"})})]}),(0,n.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",gap:0},children:[(0,n.jsx)(p.Z,{variant:"body1",children:"Please wait"}),(0,n.jsx)(p.Z,{variant:"body2",children:"Generating previews..."})]})]})})}),(0,n.jsx)(A.Z,{title:"Refresh slide previews?",prompt:"This will update all slide previews for this presentation. It could take several minutes.",dismissible:!0,options:[{key:"refresh",text:"Refresh",filled:!0},{key:"cancel",text:"Cancel",filled:!1}],onSelect:e=>F(e),open:G,setOpen:P})]})}},27692:function(e){e.exports={slideWrapControl:"previews_slideWrapControl__IsWaW"}}}]);