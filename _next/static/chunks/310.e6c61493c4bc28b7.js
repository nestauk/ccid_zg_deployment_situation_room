(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[310],{61310:function(e,r,t){"use strict";t.r(r),t.d(r,{PRESENTATION_HEIGHT:function(){return I},default:function(){return E}});var n=t(57437),l=t(22960),i=t(31193),o=t(2265),s=t(59589);t(91683),t(71601);var a=t(83593),c=t(94547),u=t(37471),d=t(5085),v=t(60555),g=t.n(v),h=t(11144),f=t(1973);function p(e){let{api:r,start:t}=(0,o.useContext)(f.E),{session:l}=(0,o.useContext)(h.z),i=(0,o.useContext)(d.rZ),s=e.role===c._b.Controller,v=(0,o.useContext)(u.Z),[p,b]=(0,o.useState)(),[m,x]=(0,o.useState)(-1);(0,o.useEffect)(()=>(a.Z.on(a.M.Request_SlideRefresh,b),()=>{a.Z.off(a.M.Request_SlideRefresh,b)}),[]),(0,o.useEffect)(()=>{void 0!==p&&p.type===a.M.Request_SlideRefresh&&w()},[p]);let w=(0,o.useCallback)(()=>{setTimeout(()=>{var r,t;null===(r=e.revealRef.current)||void 0===r||r.syncSlide(e.revealRef.current.getCurrentSlide()),null===(t=e.revealRef.current)||void 0===t||t.layout()},100)},[]);(0,o.useEffect)(()=>{if(null!==e.revealRef.current&&s)return console.debug("subscribing to reveal state..."),e.revealRef.current.on("slidechanged",A),e.revealRef.current.on("slidetransitionend",w),()=>{var r,t;console.debug("unsubscribing from reveal state..."),null===(r=e.revealRef.current)||void 0===r||r.off("slidechanged",A),null===(t=e.revealRef.current)||void 0===t||t.off("slidetransitionend",w)}},[s,e.revealRef.current,v.state]),(0,o.useEffect)(()=>{null!==e.revealRef.current&&s&&R().then(()=>console.debug("initial reveal state sent"))},[e.revealRef.current]);let A=async e=>{s&&await R()};(0,o.useEffect)(()=>{!s&&null!==e.revealRef.current&&g()(e.revealRef.current.getState().indexh)&&l.liveExperienceState.sequence>m&&(e.revealRef.current.slide(l.liveExperienceState.slideX,l.liveExperienceState.slideY),x(l.liveExperienceState.sequence))},[l.liveExperienceState.sequence,e.revealRef.current]);let R=async()=>{let n=e.revealRef.current.getState();if(!n||void 0===n.indexh){console.debug("State not yet available.",n);return}let o=n.indexh,s={action:"set-slide-position",sessionId:l.id,parameters:{indexh:o}};await t(r.postFacilitatorAction(i.user.access_token,i.sessionToken,s))};return(0,n.jsx)(n.Fragment,{})}var b=t(15785),m=t(34990),x=t(97293),w=t(27692),A=t.n(w),R=t(75683),S=t.n(R);let y=e=>S().createHash("sha1").update(e).digest("base64");function C(e){let{sid:r,slides:t,regenerateThumbnails:a,sourcePresentationXml:c,selectedIndex:u,onSlideSelection:d}=e,v=(0,l.Z)(),g=(0,o.useRef)(null),h=(0,o.useRef)(null),f=(0,o.useRef)(null),p=(0,o.useRef)(null),b=(0,o.useRef)(null),w=(0,o.useRef)(0),R=(0,o.useRef)(!1),S=(0,o.useRef)([]),C=(0,o.useRef)(),j=(0,o.useRef)(null),[I,E]=(0,o.useState)(!1);(0,o.useEffect)(()=>{if(!0!==R.current&&null!==f.current){if(R.current=!0,I||C.current||!window.indexedDB)k();else{let e=window.indexedDB.open("deliberation-thumbnails",2);e.onupgradeneeded=e=>{e.target.result.createObjectStore("thumbnails",{keyPath:"uid"}).createIndex("uid","uid",{unique:!0})},e.onsuccess=r=>{g.current=e.result,Z()}}}},[r,t,f.current]);let Z=()=>{let e=g.current.transaction(["thumbnails"],"readonly").objectStore("thumbnails").get(r);e.onerror=e=>{console.warn("preload thumbnail error",e),k()},e.onsuccess=r=>{var t,n;console.debug("Retrieved thumbnails");let l=y(c);console.debug("Slides XML hash: ".concat(l)),console.debug("ObjectStore XML hash: ".concat(null===(t=e.result)||void 0===t?void 0:t.hash)),(null===(n=e.result)||void 0===n?void 0:n.hash)===l&&(C.current=e.result),k()}},k=()=>{var e;(C.current=null!==(e=C.current)&&void 0!==e?e:{uid:r,hash:y(c),previews:[]},C.current.previews.length>0&&!a)?(console.debug("Restored ".concat(C.current.previews.length," previews from local storage")),E(!0)):(console.debug("No previews in local storage - generating new previews."),console.log("revealDivRef",f.current),h.current=new s.Z(f.current,{embedded:!0,controls:!1,keyboard:!1,touch:!1,overview:!1,help:!1,hideInactiveCursor:!1,showNotes:!1,plugins:[],transitionSpeed:"fast"}),h.current.initialize({progress:!1,autoPlayMedia:!1,scrollActivationWidth:void 0}).then(()=>{console.debug("Reveal ready"),h.current.slide(0),h.current.on("slidetransitionend",D),w.current=h.current.getHorizontalSlides().length,S.current=[...Array(w.current).fill(0).map((e,r)=>r)],N()}))},N=()=>{if(!(S.current.length>0))return!1;{let e=S.current.shift();return console.debug("initialising thumbnail for slide ".concat(e,"...")),setTimeout(()=>{W(e)},100),!0}},W=e=>{console.debug("Triggering generation ".concat(e,"...")),h.current.getIndices().h!==e?(console.debug("Sending slide from ".concat(h.current.getIndices().h," to ").concat(e,"...")),h.current.slide(e)):(console.debug("Slide already in position ".concat(e,".")),setTimeout(()=>{G()},1e3))},D=e=>{console.debug("onSlideTransitionEnd at: ".concat(h.current.getIndices().h)),setTimeout(()=>{G()},1e3)},G=()=>{let e=h.current.getIndices().h;console.debug("Capturing thumbnail for slide at index: ".concat(e));let r=h.current.getCurrentSlide();r.style.top="0px",(0,x.YM)(r,{cacheBust:!1,imagePlaceholder:"data:image/gif;base64,R0lGODlhGQAZAPQAAISChKWipcbT7+fr/8bf51KuOdbf93vDc87b9/f3997n/2u2Y9bf/5SSlJzHtcbT9////+/z/1KyOdbj94zHjNbb9/f3/2u6Y9bj/5yenLXP1sbX9wAAAAAAAAAAAAAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+ICAgPD94cGFja2V0IGVuZD0idyI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACwAAAAAGQAZAAAF/2DgWGRpmlkTaIkFvWIkzzSdZY42JS8UBIqJcEicKBSZAGSSIfB8AaHBMBlYB5OpMAlJaAhOyy+LKLsgljKCyn1pMruxATGI9CARxZqZ0fgDKg5yCHZ3EAN7KQ2LjA1JVWeGiGVCV1aAjwOGPZN0dTNijlFzaqWlWlQKA5hRCBuvsLGnWgqsEwgCsLmxurAIE7a4rwLEucW7u78EGmO4x8/QAr8uj87PfhrRCmfV0djRmi/dxA4OC+foF34CE4bjAuUFBRL05zkICj0JCd0a5vQAAx4wZEuAPwoLAgYs18NCBFsEHBxQqPDJCyyAfiw7kJCiBAcE9H0BpiJARI8AQyL2IKCOZIAMFCZ6dLDvRYKYEig4SPHywAWUGu4kAHiAwqIQADs="}).then(r=>{C.current.previews[e]={pngDataUrl:r},N()||P()}).catch(r=>{console.error("error capturing element",r),C.current.previews[e]={pngDataUrl:"/icons/broken-image-placeholder.png"},N()||P()})},P=()=>{console.debug("Completed preview generation"),console.debug("Storing thumbnails...");let e=g.current.transaction(["thumbnails"],"readwrite").objectStore("thumbnails").put(C.current);e.onerror=e=>{var r;console.warn("Error storing thumbnails",e),null===(r=h.current)||void 0===r||r.destroy(),h.current=null,E(!0),R.current=!1},e.onsuccess=e=>{var r;console.debug("Stored thumbnails",e),null===(r=h.current)||void 0===r||r.destroy(),h.current=null,E(!0),R.current=!1}};return(0,o.useEffect)(()=>{if(I&&j){var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.Z,{sx:{display:"block",overflowX:"scroll"},children:(0,n.jsx)(i.Z,{sx:{display:"flex",flexDirection:"row",gap:1,textWrap:"nowrap",whiteSpace:"nowrap",flexWrap:"nowrap"},children:I&&C.current.previews.map((e,r)=>(0,n.jsx)(i.Z,{sx:{padding:1,border:u===r?"solid 2px":"solid 1px",borderColor:u===r?v.palette.primary.main:v.palette.divider,borderRadius:1,width:"auto",height:"auto",display:"inline-block"},onClick:()=>d(r),children:(0,n.jsx)("img",{ref:u===r?j:void 0,src:e.pngDataUrl,width:150,height:"auto"},"presentation-preview-image-".concat(r))},"presentation-preview-".concat(r)))})}),(0,n.jsx)(i.Z,{sx:{maxWidth:"100%",overflowX:"scroll",display:"flex",flexDirection:"row",flexWrap:"nowrap",gap:1,m:0,p:0,alignItems:"stretch"},children:!I&&(0,n.jsx)(i.Z,{ref:b,sx:{flexGrow:1,display:"block"},children:(0,n.jsx)("div",{style:{textAlign:"center",marginTop:50},children:(0,n.jsx)(m.Z,{elevation:1,sx:{display:"inline-block",p:2},children:(0,n.jsxs)(i.Z,{flexDirection:"row",display:"flex",alignItems:"center",alignSelf:"middle",children:[(0,n.jsx)("div",{style:{width:26,height:26,marginRight:5,border:"solid 3px",borderColor:v.palette.primary.main},children:(0,n.jsx)("div",{className:"reveal",ref:f,children:(0,n.jsx)("div",{className:"slides ".concat(A().slideWrapControl),ref:p,children:t})})}),"Generating previews..."]})})})})})]})}var j=t(30089);let I=400;function E(e){let r=(0,l.Z)(),t=e.role===c._b.Controller,a=e.role===c._b.Controller,u=e.role===c._b.Controller,d=(0,o.useRef)(null),v=(0,o.useRef)(null),[g,h]=(0,o.useState)(0),[f,m]=(0,o.useState)(b.I);(0,o.useEffect)(()=>{if(!d.current&&v.current){var r,n;console.debug("⬆️ Presentation mount...");let l=u&&(null===(r=window)||void 0===r?void 0:r.localStorage.getItem("RevealState-".concat(e.sid)))?JSON.parse(null===(n=window)||void 0===n?void 0:n.localStorage.getItem("RevealState-".concat(e.sid))):null;d.current=new s.Z(v.current,{embedded:e.embedded,controls:t,keyboard:t,touch:t,overview:!1,help:t,hideInactiveCursor:!t,showNotes:!1,plugins:[]}),console.debug("initialising reveal..."),d.current.initialize({controlsTutorial:!1,slideNumber:t?"c/t":void 0,progress:!1,controlsBackArrows:"faded",controlsLayout:"edges",scrollActivationWidth:void 0}).then(()=>{var r,t;console.debug("Reveal: initialised"),l&&d.current.setState(l),d.current.on("slidechanged",r=>{let t=d.current.getState();u&&window.localStorage.setItem("RevealState-".concat(e.sid),JSON.stringify(t)),h(t.indexh)}),h(null!==(t=null===(r=d.current)||void 0===r?void 0:r.getState().indexh)&&void 0!==t?t:0),x()}).catch(e=>console.error(e))}},[]),(0,o.useEffect)(()=>{d.current&&x()},[g,d.current]);let x=()=>{var e,r,t;let n=!!(null===(e=d.current)||void 0===e?void 0:e.getCurrentSlide());m(w(g,null===(r=d.current)||void 0===r?void 0:r.getCurrentSlide(),n?null===(t=d.current)||void 0===t?void 0:t.getSlideNotes():null))},w=(e,r,t)=>{if(!r)return b.I;let n=(0,j.kh)(r.getAttribute("qids")),l=r.getAttribute("secs"),i=null!==l?parseFloat(l):void 0,o=r.getAttribute("activity"),s=null!==o?(0,j.pC)(o):b.S.default,a=r.getAttribute("recording");return console.table({index:e,qids:null==n?void 0:n.join(", "),activity:b.S[s],time_s:i}),{index:e,notes:null!=t?t:"",qids:null!=n?n:[],secs:i,activity:s,recordingId:null!=a?a:void 0}};return(0,o.useEffect)(()=>()=>{d.current&&d.current.isReady()&&(console.debug("⬇️ Presentation unmount..."),d.current.destroy(),d.current=null)},[]),(0,o.useEffect)(()=>{e.onSlideDataChange&&e.onSlideDataChange(f)},[f]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(i.Z,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,n.jsx)(i.Z,{sx:{flexGrow:1,display:"block",m:0,p:0},children:(0,n.jsx)("div",{ref:v,className:"reveal",style:{borderRadius:"0.5rem",border:e.showBorder?"solid 2px":void 0,borderColor:e.showBorder?r.palette.primary.main:void 0},children:(0,n.jsx)("div",{className:"slides",children:e.slides})})}),a&&(0,n.jsx)(C,{slides:e.slides,sourcePresentationXml:e.sourcePresentationXml,selectedIndex:g,sid:e.sid,regenerateThumbnails:e.regenerateThumbnails,onSlideSelection:e=>{console.debug("Thumbnail selected: ".concat(e)),d.current?(d.current.slide(e),h(e)):console.warn("localReveal not yet loaded - unable to switch slides from thumbnail")}})]}),(0,n.jsx)(p,{role:e.role,revealRef:d,sid:e.sid})]})}},27692:function(e){e.exports={slideWrapControl:"previews_slideWrapControl__IsWaW"}}}]);