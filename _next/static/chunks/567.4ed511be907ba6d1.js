(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[567],{90567:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return v}});var t=n(57437),i=n(22960),l=n(31193),o=n(34990),s=n(40468),a=n(80511),c=n(97293),u=n(2265),d=n(59589),h=n(4766),p=n(75683),g=n.n(p);let b=e=>g().createHash("sha1").update(e).digest("base64");var f=n(27692),m=n.n(f);function v(e){let r=(0,i.Z)(),n=(0,u.useRef)(null),p=(0,u.useRef)(null),g=(0,u.useRef)(null),f=(0,u.useRef)(null),v=(0,u.useRef)(null),A=(0,u.useRef)(0),x=(0,u.useRef)(!1),w=(0,u.useRef)([]),y=(0,u.useRef)(),j=(0,u.useRef)(null),[C,I]=(0,u.useState)(!1),{slideIndex:R,setSlideIndex:Z}=(0,u.useContext)(h.X);(0,u.useEffect)(()=>{if(!0!==x.current&&null!==g.current){if(x.current=!0,C||y.current||!window.indexedDB)D();else{let e=window.indexedDB.open("deliberation-thumbnails-by-sid",2);e.onupgradeneeded=e=>{e.target.result.createObjectStore("thumbnails",{keyPath:"sid"}).createIndex("sid","sid",{unique:!0})},e.onsuccess=r=>{n.current=e.result,S()}}}},[e.sid,e.slides,g.current]);let S=()=>{let r=n.current.transaction(["thumbnails"],"readonly").objectStore("thumbnails").get(e.sid);r.onerror=e=>{console.warn("preload thumbnail error",e),D()},r.onsuccess=n=>{var t,i;console.debug("Retrieved thumbnails");let l=b(e.sourcePresentationXml);console.debug("Slides XML hash: ".concat(l)),console.debug("ObjectStore XML hash: ".concat(null===(t=r.result)||void 0===t?void 0:t.hash)),(null===(i=r.result)||void 0===i?void 0:i.hash)===l&&(y.current=r.result),D()}},D=()=>{var r;(y.current=null!==(r=y.current)&&void 0!==r?r:{sid:e.sid,hash:b(e.sourcePresentationXml),previews:[]},y.current.previews.length>0&&!e.regenerateThumbnails)?(console.debug("Restored ".concat(y.current.previews.length," previews from local storage")),I(!0)):(console.debug("No previews in local storage - generating new previews."),console.log("revealDivRef",g.current),p.current=new d.Z(g.current,{embedded:!0,controls:!1,keyboard:!1,touch:!1,overview:!1,help:!1,hideInactiveCursor:!1,showNotes:!1,plugins:[],transitionSpeed:"fast"}),p.current.initialize({progress:!1,autoPlayMedia:!1,scrollActivationWidth:void 0}).then(()=>{console.debug("Reveal ready"),p.current.slide(0),p.current.on("slidetransitionend",G),A.current=p.current.getHorizontalSlides().length,w.current=[...Array(A.current).fill(0).map((e,r)=>r)],W()}))},W=()=>{if(!(w.current.length>0))return!1;{let e=w.current.shift();return console.debug("initialising thumbnail for slide ".concat(e,"...")),setTimeout(()=>{E(e)},100),!0}},E=e=>{console.debug("Triggering generation ".concat(e,"...")),p.current.getIndices().h!==e?(console.debug("Sending slide from ".concat(p.current.getIndices().h," to ").concat(e,"...")),p.current.slide(e)):(console.debug("Slide already in position ".concat(e,".")),setTimeout(()=>{L()},1e3))},G=e=>{console.debug("onSlideTransitionEnd at: ".concat(p.current.getIndices().h)),setTimeout(()=>{L()},1e3)},[P,k]=(0,u.useState)(),B=e=>{k({generated:e,total:A.current})},L=()=>{let e=p.current.getIndices().h;console.debug("Capturing thumbnail for slide at index: ".concat(e));let r=p.current.getCurrentSlide();r.style.top="0px",(0,c.YM)(r,{cacheBust:!1,imagePlaceholder:"data:image/gif;base64,R0lGODlhGQAZAPQAAISChKWipcbT7+fr/8bf51KuOdbf93vDc87b9/f3997n/2u2Y9bf/5SSlJzHtcbT9////+/z/1KyOdbj94zHjNbb9/f3/2u6Y9bj/5yenLXP1sbX9wAAAAAAAAAAAAAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+ICAgPD94cGFja2V0IGVuZD0idyI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACwAAAAAGQAZAAAF/2DgWGRpmlkTaIkFvWIkzzSdZY42JS8UBIqJcEicKBSZAGSSIfB8AaHBMBlYB5OpMAlJaAhOyy+LKLsgljKCyn1pMruxATGI9CARxZqZ0fgDKg5yCHZ3EAN7KQ2LjA1JVWeGiGVCV1aAjwOGPZN0dTNijlFzaqWlWlQKA5hRCBuvsLGnWgqsEwgCsLmxurAIE7a4rwLEucW7u78EGmO4x8/QAr8uj87PfhrRCmfV0djRmi/dxA4OC+foF34CE4bjAuUFBRL05zkICj0JCd0a5vQAAx4wZEuAPwoLAgYs18NCBFsEHBxQqPDJCyyAfiw7kJCiBAcE9H0BpiJARI8AQyL2IKCOZIAMFCZ6dLDvRYKYEig4SPHywAWUGu4kAHiAwqIQADs="}).then(r=>{y.current.previews[e]={pngDataUrl:r},W()||N()}).catch(r=>{console.error("error capturing element",r),y.current.previews[e]={pngDataUrl:"/icons/broken-image-placeholder.png"},W()||N()}).finally(()=>{B(e)})},N=()=>{console.debug("Completed preview generation"),console.debug("Storing thumbnails...");let e=n.current.transaction(["thumbnails"],"readwrite").objectStore("thumbnails").put(y.current);e.onerror=e=>{var r;console.warn("Error storing thumbnails",e),null===(r=p.current)||void 0===r||r.destroy(),p.current=null,I(!0),x.current=!1},e.onsuccess=e=>{var r;console.debug("Stored thumbnails",e),null===(r=p.current)||void 0===r||r.destroy(),p.current=null,I(!0),x.current=!1}};return(0,u.useEffect)(()=>{if(C&&j){var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}}),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{sx:{display:"block",overflowX:"scroll"},children:(0,t.jsx)(l.Z,{sx:{display:"flex",flexDirection:"row",gap:1,textWrap:"nowrap",whiteSpace:"nowrap",flexWrap:"nowrap"},children:C&&y.current.previews.map((e,n)=>(0,t.jsx)(l.Z,{sx:{padding:1,border:R===n?"solid 2px":"solid 1px",borderColor:R===n?r.palette.primary.main:r.palette.divider,borderRadius:1,width:"auto",height:"auto",display:"inline-block"},onClick:()=>Z(n),children:(0,t.jsx)("img",{ref:R===n?j:void 0,src:e.pngDataUrl,width:150,height:"auto"},"presentation-preview-image-".concat(n))},"presentation-preview-".concat(n)))})}),(0,t.jsx)(l.Z,{sx:{maxWidth:"100%",overflowX:"scroll",display:"flex",flexDirection:"row",flexWrap:"nowrap",gap:1,m:0,p:0,alignItems:"stretch"},children:!C&&(0,t.jsx)(l.Z,{ref:v,sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:120},children:(0,t.jsxs)(o.Z,{elevation:1,sx:{flexDirection:"row",display:"flex",alignItems:"center",gap:1,p:2},children:[(0,t.jsxs)(l.Z,{sx:{width:"75px",height:"auto",aspectRatio:"".concat(150," / ").concat(120),border:"solid 1px",borderRadius:"0.5rem",overflow:"hidden",borderColor:r.palette.primary.main,position:"relative"},children:[(0,t.jsx)("div",{className:"reveal",ref:g,children:(0,t.jsx)("div",{className:"slides ".concat(m().slideWrapControl),ref:f,children:e.slides})}),(0,t.jsx)(l.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",background:"rgba(255, 255, 255, 0.5)",zIndex:100},children:(0,t.jsx)(s.Z,{size:"1.5rem",value:P?P.generated/P.total*100:0,variant:P?"determinate":"indeterminate"})})]}),(0,t.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",gap:0},children:[(0,t.jsx)(a.Z,{variant:"body1",children:"Please wait"}),(0,t.jsx)(a.Z,{variant:"body2",children:"Generating previews..."})]})]})})})]})}},27692:function(e){e.exports={slideWrapControl:"previews_slideWrapControl__IsWaW"}}}]);