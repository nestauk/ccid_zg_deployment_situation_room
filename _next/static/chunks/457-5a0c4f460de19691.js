(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{79418:function(e,t,n){"use strict";function i(e){if(null!=e)return parseInt(e)}function r(e){return!0===e||!1===e?e:"true"===e||"false"===e?"true"===e:"t"===e||"f"===e?"t"===e:(1===e||0===e)&&1===e}n.d(t,{LC:function(){return i},gx:function(){return r},zW:function(){return function e(t){if(t instanceof Array)return t.map(function(t){return"object"==typeof t&&(t=e(t)),t});{let n={};for(let i in t)if(t.hasOwnProperty(i)){let r=(i.charAt(0).toLowerCase()+i.slice(1)||i).toString(),s=t[i];(s instanceof Array||null!==s&&s.constructor===Object)&&(s=e(s)),n[r]=s}return n}}}})},30089:function(e,t,n){"use strict";n.d(t,{Cc:function(){return h},H7:function(){return v},av:function(){return f},f_:function(){return m},if:function(){return u},kh:function(){return p},ot:function(){return g},pC:function(){return b},tL:function(){return x},te:function(){return d},yg:function(){return y}});var i=n(6121),r=n(71359),s=n(45080),o=n(15785),a=n(20920),l=n(24132),c=n(2962);let d=(e,t)=>{if(void 0!==e){let i=(0,a.Z)();if(void 0!==e.key&&null!==e.key){var n;return{...e,key:"".concat(t,"-").concat(null!==(n=e.key)&&void 0!==n?n:"undefined","+").concat(i)}}}},u=e=>e?Object.fromEntries(e.split(";").map(e=>e.trim().split(":").map(e=>e.trim()))):{},h=e=>e?Object.fromEntries(e.split(";").map(e=>e.trim().split(":").map(e=>e.trim()))):{},p=e=>{if(null!=e&&0!==e.length)return(0,i.Q)(e,{columns:!1,skip_empty_lines:!0,trim:!0})[0]},x=e=>null==e?void 0:e.map((e,t)=>""===e?" ".repeat(t):e),m=e=>{let t=parseFloat(null!=e?e:"");return isNaN(t)?void 0:t},f=e=>{let t=null==e?void 0:e.toLowerCase(),n=r.Q[t];if(void 0===n)throw console.error("Unknown slider input type: ".concat(e)),"Unknown slider input type: ".concat(e);return n},g=e=>{let t=null==e?void 0:e.toLowerCase(),n=l.rT[t];if(void 0===n)throw console.error("Unknown graph input type: ".concat(e)),"Unknown graph input type: ".concat(e);return n},y=e=>{let t=null==e?void 0:e.toLowerCase(),n=c.J[t];if(void 0===n)throw console.error("Unknown graph orientation: ".concat(e)),"Unknown graph orientation: ".concat(e);return n},v=e=>{let t=null==e?void 0:e.toLowerCase(),n=s.L[t];if(void 0===n)throw console.error("Unknown text input type: ".concat(e)),"Unknown text input type: ".concat(e);return n},b=e=>{let t=null==e?void 0:e.toLowerCase(),n=o.S[t];if(void 0===n)throw console.error("Unknown slide activity: ".concat(e)),"Unknown slide activity: ".concat(e);return n}},8260:function(e,t,n){"use strict";n.d(t,{S9:function(){return c},UJ:function(){return l},ZP:function(){return d},Zp:function(){return a}});var i=n(2265),r=n(11144);let s=(e,t)=>{let{sid:n,pid:i,qid:r}=e;return{id:void 0,created:void 0,questionId:r,participantId:i,jsonValue:void 0,mimeType:void 0,pII:t}},o=e=>{let t={};return e.forEach(e=>{var n;t[e.questionId]=[...null!==(n=t[e.questionId])&&void 0!==n?n:[],e]}),t},a=(e,t,n)=>{var i;return null!==(i=l(e,t))&&void 0!==i?i:s(t,null!=n&&n)},l=(e,t)=>null==e?void 0:e.find(e=>e.questionId===t.qid&&e.participantId===t.pid),c=e=>(null==e?void 0:e.jsonValue)!==void 0;function d(e){var t;let n=(0,i.useContext)(r.z),[s,a]=(0,i.useState)(null!==(t=n.session.answers)&&void 0!==t?t:[]),[l,c]=(0,i.useState)(o(n.session.answers));return(0,i.useEffect)(()=>{a(void 0!==e?n.session.answers.filter(t=>t.questionId===e):[]),c(o(n.session.answers))},[n.session.answers]),{answers:s,allAnswers:l}}},11144:function(e,t,n){"use strict";n.d(t,{Z:function(){return h},z:function(){return u}});var i=n(57437),r=n(2265),s=n(37570),o=n(5085),a=n(94547),l=n(75511),c=n(79418),d=n(1973);let u=(0,r.createContext)({});function h(e){let t=(0,r.useContext)(s.H),[n,h]=(0,r.useState)(t.session),[p,x]=(0,r.useState)(t.graphic),{api:m,start:f}=(0,r.useContext)(d.E),g=(0,r.useContext)(o.rZ),y=async()=>{console.debug("Refresh session...");try{g.role===a._b.Controller?h(await f(m.getDeliberationSessionAdmin(t.sid,g.user.access_token,"live-session-refresh"))):h(await f(m.getDeliberationSession(t.sid,"live-session-refresh")))}catch(e){console.error("Error fetching session data.",e)}},[v,b]=(0,r.useState)();(0,r.useEffect)(()=>(l.Z.on(l.z.WSS_Distribute_Message,b),l.Z.on(l.z.WSS_Update_ConnectionState,b),()=>{l.Z.off(l.z.WSS_Distribute_Message,b),l.Z.off(l.z.WSS_Update_ConnectionState,b)}),[]),(0,r.useEffect)(()=>{if(void 0!==v)switch(v.type){case l.z.WSS_Update_ConnectionState:w(v.data);break;case l.z.WSS_Distribute_Message:j(v.data)}},[v]);let w=e=>{console.debug("Connection state detected: ".concat(a.um[e])),e===a.um.Joined&&y()},j=e=>{if("send"===e.action&&"session-update"===e.type){var t;let i=(0,c.zW)(e.data.session);h({...i,joinCode:null!==(t=i.joinCode)&&void 0!==t?t:n.joinCode})}if("send"===e.action&&"answer-summary-update"===e.type){let t=e.data.questionId,i=(0,c.zW)(e.data.answers);h({...n,answers:[...n.answers.filter(e=>e.questionId!==t),...i]})}};return(0,i.jsx)(u.Provider,{value:{session:n,graphic:p},children:e.children})}},37471:function(e,t,n){"use strict";n.d(t,{C:function(){return x},Z:function(){return h}});var i=n(57437),r=n(2265),s=n(5085),o=n(94547),a=n(75511),l=n(70972),c=n(79044);let d={debug:!1,connectionTimeout:3e3,maxReconnectionDelay:1e4,minReconnectionDelay:100,reconnectionDelayGrowFactor:1.3,maxRetries:1/0},u=(e,t,n)=>({deviceId:e.deviceId,sessionId:n,sessionToken:e.sessionToken,role:e.role,deviceName:void 0,participantName:t.participantName}),h=(0,r.createContext)({}),p=[o.um.Online,o.um.Connecting,o.um.Connected,o.um.Joining];function x(e){var t;let n=null!==(t=e.endpoint)&&void 0!==t?t:"wss://uw4rr0lqvg.execute-api.eu-west-2.amazonaws.com/prod";if(!n)throw"No endpoint found for Zeitgeist WSS";let x=(0,r.useContext)(s.rZ),m=(0,r.useContext)(c.K),f=(0,r.useRef)(null),[g,y]=(0,r.useState)(o.um.Offline),[v,b]=(0,r.useState)(!1),[w,j]=(0,r.useState)(!1),[k,S]=(0,r.useState)(),Z=(0,r.useCallback)(e=>{try{return f.current.send(JSON.stringify(e)),!0}catch(e){return console.error(e),!1}},[f]),[C,D]=(0,r.useState)({state:g,isError:w,joinedOnce:v,sendMessage:Z});(0,r.useEffect)(()=>{if(void 0===window||void 0===window.navigator)throw"Window undefined.";window.addEventListener("online",()=>{g===o.um.Offline&&y(o.um.Online)}),window.addEventListener("offline",()=>{y(o.um.Offline)}),y(window.navigator.onLine?o.um.Online:o.um.Offline)},[]),(0,r.useEffect)(()=>{S(u(x,m,e.sid))},[x.deviceId,e.sid,x.sessionToken,x.role,m.participantName]),(0,r.useEffect)(()=>{D({state:g,isError:w,joinedOnce:v,sendMessage:Z})},[f,g,w,v,Z]),(0,r.useEffect)(()=>{switch(console.debug("WSS state change",o.um[g]),a.Z.emit({type:a.z.WSS_Update_ConnectionState,data:g}),g){case o.um.Offline:try{var e;null===(e=f.current)||void 0===e||e.close()}catch(e){console.warn(e)}break;case o.um.Online:I(),y(o.um.Connecting);break;case o.um.Connecting:E();break;case o.um.Connected:y(o.um.Joining);break;case o.um.Joining:q();break;case o.um.Joined:b(!0);break;case o.um.Error:E()}j(g===o.um.Error)},[g]);let E=()=>{setTimeout(()=>{[l.Z.CLOSING,l.Z.CLOSED].includes(f.current.readyState)&&(console.debug("Recreating socket..."),I())},1e3)},I=()=>{if(null!==f.current){try{f.current.close()}catch(e){console.warn(e)}f.current.onopen=null,f.current.onclose=null,f.current.onerror=null,f.current.onmessage=null,f.current=null}f.current=P()},P=()=>{let e=new l.Z(n,[],d);return e.onopen=e=>{console.debug("WSS open",e),y(o.um.Connected)},e.onclose=e=>{console.warn("WSS close",e),y(o.um.Disconnected)},e.onerror=e=>{console.error("WSS error",e),y(o.um.Error)},e.onmessage=async e=>{await A(e)},e},q=()=>{var e,t;console.debug("Joining session...");let n={action:"join",deviceId:k.deviceId,sessionId:k.sessionId,sessionToken:k.sessionToken,deviceName:null!==(e=k.deviceName)&&void 0!==e?e:null,participantName:null!==(t=k.participantName)&&void 0!==t?t:null,role:k.role};f.current.send(JSON.stringify(n))},A=e=>{if(null==e?void 0:e.data){let t=JSON.parse(e.data);t&&("send"===t.action&&"remote-log"===t.type&&_(t),"send"===t.action&&"join-confirmation"===t.type&&T(t),a.Z.emit({type:a.z.WSS_Distribute_Message,data:t}))}},_=e=>{switch(e.data.severity){case"debug":console.debug("Remote debug log",e.data.message);break;case"info":console.info("Remote info log",e.data.message);break;case"warn":console.warn("Remote warn log",e.data.message);break;case"error":console.error("Remote error log",e.data.message);break;default:console.log("Remote log",e.data.message)}},T=e=>{console.debug("Join confirmation"),y(o.um.Joined)};return(0,i.jsxs)(i.Fragment,{children:[w&&!v&&e.error,!w&&!v&&p.includes(g)&&e.loading,v&&(0,i.jsx)(h.Provider,{value:C,children:e.children})]})}},67506:function(e,t,n){"use strict";n.d(t,{G:function(){return d},Z:function(){return u}});var i,r,s=n(57437),o=n(2265),a=n(80237),l=n(75511),c=n(1973);let d=(0,o.createContext)({});function u(e){var t;let{api:n,start:i}=(0,o.useContext)(c.E),[u,h]=(0,o.useState)(0),[p,x]=(0,o.useState)(),[m,f]=(0,o.useState)(null!==(t=e.checks)&&void 0!==t?t:3);(0,o.useEffect)(()=>{switch(console.debug("ZgServerTimeProvider state",r[u]),u){case 0:l.Z.emit({type:l.z.Content_Progress_Update,data:{overall:{completed:0,total:m},bars:{}}}),h(1);break;case 1:g().then(e=>{x(e),h(3)}).catch(e=>{console.error(e),h(2)})}},[u]);let g=async()=>{switch(e.mode){case"server-date-lib":return v();case"zg-server-time":return y();default:throw Error("Unsupported time sync mode")}},y=async()=>{let e;console.debug("zg-server-time warmup",await i(n.getServerTime()));let t=Number.MAX_SAFE_INTEGER,r=0;for(let s=0;s<m;s++){let o=Date.now(),a=await i(n.getServerTime()),c=Date.now();console.debug("zg-server-time response",a);let d=c-o,u=(o+c)/2,h=a.timestamp-u;d<t&&(t=d,r=h,e=a),l.Z.emit({type:l.z.Content_Progress_Update,data:{overall:{completed:s+1,total:m},bars:{}}}),await new Promise(e=>setTimeout(e,1e3))}let s={offset:r,rtt:t,source:e,toServerTime:e=>e+r,fromServerTime:e=>e-r};return console.debug("zg-server-time result",s),s},v=async()=>{let e;console.warn("ServerDateLib is only accurate to the second.");for(let t=0;t<m;t++){await new Promise(e=>setTimeout(e,1e3));let n=await (0,a.a)();(void 0===e||Math.abs(n.uncertainty)<Math.abs(e.uncertainty))&&(e=n),l.Z.emit({type:l.z.Content_Progress_Update,data:{overall:{completed:t+1,total:m},bars:{}}})}let t={offset:e.offset,source:e,rtt:e.uncertainty,toServerTime:t=>t+e.offset,fromServerTime:t=>t-e.offset};return console.debug("server-date result",e),t};return(0,s.jsxs)(s.Fragment,{children:[(0===u||1===u)&&e.loading,2===u&&e.error,3===u&&(0,s.jsx)(d.Provider,{value:p,children:e.children})]})}(i=r||(r={}))[i.Init=0]="Init",i[i.Synchronising=1]="Synchronising",i[i.Error=2]="Error",i[i.Complete=3]="Complete"},53622:function(e,t,n){"use strict";n.d(t,{Z:function(){return o},p:function(){return s}});var i=n(57437),r=n(2265);let s=(0,r.createContext)({});function o(e){let[t,n]=(0,r.useState)({});return(0,i.jsx)(s.Provider,{value:t,children:e.children})}},70883:function(e,t,n){"use strict";n.d(t,{Z:function(){return c},l:function(){return l}});var i=n(57437),r=n(2265),s=n(75511),o=n(5085),a=n(37471);let l=(0,r.createContext)({});function c(e){let t=(0,r.useContext)(o.rZ),[n,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(n.find(e=>e.deviceId===t.deviceId)),h=(0,r.useContext)(a.Z);(0,r.useEffect)(()=>{h.sendMessage({action:"request",type:"subscription-update",sessionId:e.sid})},[]);let[p,x]=(0,r.useState)();(0,r.useEffect)(()=>(s.Z.on(s.z.WSS_Distribute_Message,x),()=>{s.Z.off(s.z.WSS_Distribute_Message,x)}),[]),(0,r.useEffect)(()=>{void 0!==p&&p.type===s.z.WSS_Distribute_Message&&m(p.data)},[p]);let m=e=>{if("send"===e.action&&"subscription-update"===e.type){var t;c(null!==(t=e.data.subscriptions)&&void 0!==t?t:[])}};return(0,r.useEffect)(()=>{u(n.find(e=>e.deviceId===t.deviceId))},[n,t]),(0,i.jsx)(l.Provider,{value:{subscriptions:n,thisUser:d},children:e.children})}},4766:function(e,t,n){"use strict";n.d(t,{X:function(){return o},Z:function(){return a}});var i=n(57437),r=n(2265),s=n(15785);let o=(0,r.createContext)({});function a(e){let[t,n]=(0,r.useState)(s.I);return(0,i.jsx)(o.Provider,{value:{data:t,setData:n},children:e.children})}},93191:function(e,t,n){"use strict";n.d(t,{N:function(){return c},Z:function(){return d}});var i=n(57437),r=n(2265),s=n(4766),o=n(5085),a=n(57818),l=n(67074);let c=(0,r.createContext)({});function d(e){let t=(0,r.useContext)(l.F),d=(0,r.useContext)(s.X),u=(0,r.useContext)(o.rZ),h=e=>{d.setData(e)},[p,x]=(0,r.useState)(void 0);return(0,r.useEffect)(()=>{let r=(0,a.default)(()=>Promise.all([n.e(885),n.e(518),n.e(218),n.e(287),n.e(310)]).then(n.bind(n,61310)),{loadableGenerated:{webpack:()=>[61310]},ssr:!1});x((0,i.jsx)(r,{sid:t.sid,role:u.role,slides:t.slides,sourcePresentationXml:t.sourceXml.join("\n"),embedded:!0,onSlideDataChange:h,showBorder:!1,regenerateThumbnails:e.refresh}))},[]),(0,i.jsx)(i.Fragment,{children:!!p&&(0,i.jsx)(c.Provider,{value:{presentation:p},children:e.children})})}},5085:function(e,t,n){"use strict";n.d(t,{ZP:function(){return h},rZ:function(){return u}});var i,r,s=n(57437),o=n(2265),a=n(94547),l=n(20920),c=n(67022),d=n(1973);(i=r||(r={}))[i.Init=0]="Init",i[i.Authenticating=1]="Authenticating",i[i.AuthError=2]="AuthError",i[i.AuthNotRequired=3]="AuthNotRequired",i[i.Authenticated=4]="Authenticated",i[i.ExchangingJoinCode=5]="ExchangingJoinCode",i[i.JoinCodeError=6]="JoinCodeError",i[i.JoinCodeAccepted=7]="JoinCodeAccepted",i[i.Ready=8]="Ready";let u=(0,o.createContext)({});function h(e){var t;let[n,i]=(0,o.useState)((null===(t=window)||void 0===t?void 0:t.localStorage.getItem("DeviceId"))||(0,l.Z)());(0,o.useEffect)(()=>{window&&window.localStorage.setItem("DeviceId",n)},[n]);let[h,p]=(0,o.useState)(0),[x,m]=(0,o.useState)(void 0),[f,g]=(0,o.useState)(e.role),[y,v]=(0,o.useState)(),[b,w]=(0,o.useState)(!1),[j,k]=(0,o.useState)(!1),[S,Z]=(0,o.useState)({deviceId:n,role:f,state:h,user:x,sessionToken:y,noUserWarning:j});(0,o.useEffect)(()=>{Z({...S,state:h})},[h]),(0,o.useEffect)(()=>{Z({...S,user:x})},[x]),(0,o.useEffect)(()=>{Z({...S,role:f})},[f]),(0,o.useEffect)(()=>{Z({...S,sessionToken:y})},[y]),(0,o.useEffect)(()=>{Z({...S,noUserWarning:j})},[j]);let C=(0,c.aC)(),{api:D,start:E}=(0,o.useContext)(d.E);return(0,o.useEffect)(()=>C.events.addAccessTokenExpiring(async()=>{console.debug("Access token renewal with auth.signinSilent()...");let e=await C.signinSilent();console.debug("User renewal: ".concat(e?"found":"not found")),m(e)}),[C.events,C.signinSilent]),(0,o.useEffect)(()=>{switch(console.debug("User state",r[h]),h){case 0:switch(f){case a._b.Controller:p(1);break;case a._b.Client:p(3),m(null);break;default:throw"Unsupported role: ".concat(a._b[f])}break;case 1:C.signinSilent().then(e=>{null!==e?(console.info("User found",e.profile.email),m(e),p(4)):(console.debug("Not authenticated"),m(void 0),p(2))}).catch(e=>{console.error(e),m(void 0),p(2)});break;case 2:case 6:break;case 4:case 3:p(5);break;case 5:let t={deviceId:n,role:f,joinCode:e.joinCode,sessionId:e.sid};E(D.exchangeJoinCodeForSessionToken(t)).then(e=>{v(e.sessionToken),p(7)}).catch(e=>{console.error(e),p(6)});break;case 7:p(8)}w(!![2,6].find(e=>e===h))},[h]),(0,o.useEffect)(()=>{k(null===x),null===x&&8===h&&console.warn("No user found through Auth. The session can continue, but the facilitator may not be able to take additional actions.")},[x]),(0,s.jsxs)(s.Fragment,{children:[b&&e.error,8!==h&&!b&&e.loading,8===h&&!b&&(0,s.jsx)(u.Provider,{value:S,children:e.children})]})}},67074:function(e,t,n){"use strict";n.d(t,{F:function(){return t_},Z:function(){return tT}});var i,r,s,o,a,l,c,d,u,h,p=n(57437),x=n(2265),m=n(5085),f=n(22599),g=n.n(f);class y{async init(){if(this.initialised)return;this.storageAvailable=void 0!==window&&void 0!==window.navigator&&void 0!==window.navigator.storage,this.persistAvailable=this.storageAvailable&&void 0!==window.navigator.storage.persist,this.mayPersist=this.storageAvailable&&void 0!==window.navigator.storage.persist&&await window.navigator.storage.persist(),this.retrieveAvailable=this.storageAvailable&&void 0!==window.navigator.storage.getDirectory,this.estimateAvailable=this.storageAvailable&&void 0!==window.navigator.storage.estimate;let e=[["Workshop dir",this.workshopDir],["Storage Available",this.storageAvailable],["Persist Available",this.persistAvailable],["Retrieve available",this.retrieveAvailable],["Estimate available",this.estimateAvailable],["May Persist",this.mayPersist]];if(this.estimateAvailable){let t=await navigator.storage.estimate();e.push(["Quota",t.quota]),e.push(["Usage",t.usage])}else e.push(["Quota","N/K"]),e.push(["Usage","N/K"]);console.table(e),this.initialised=!0}async getAsUrl(e,t){if(!this.initialised)throw"Not initialised";if(e.startsWith("blob:"))return console.debug("getAsUrl","blob: url requested - passing back the same url."),e;let n=await this.getAsEntry(e,t);try{return URL.createObjectURL(n.content)}catch(t){return console.warn("getAsUrl","Unable to create blob URL for: ".concat(e),t),n.sourceUrl}}async getAsEntry(e,t){if(!this.initialised)throw"Not initialised";if(e.startsWith("blob:")){let n=e.substring(5);return await this.getAsEntry(n,t)}let n=this.forceFetch?null:await this.getCacheData(e);if(this.forceFetch&&console.debug("getAsEntry","cache skip for: ".concat(e)),null!==n&&(void 0===n.content||0===n.content.size)&&(n=null),console.debug("getAsEntry","Cache ".concat(null===n?"miss for":"hit for",": ").concat(e)),null===n){try{n=await this.fetchContent({key:e},t)}catch(t){throw console.error("getAsEntry","Unable to fetch data for: ".concat(e),t),t}try{void 0!==n.content&&n.content.size>0?(console.debug("getAsEntry","Cacheing ".concat(n.content.size," bytes of data for: ").concat(e),n),await this.storeCacheData(n)):(void 0===n.content&&console.warn("getAsEntry","Content for ".concat(e," is undefined.")),void 0!==n.content&&0===n.content.size&&console.warn("getAsEntry","Content for ".concat(e," has 0 bytes.")))}catch(t){console.warn("getAsEntry","Unable to cache the data for: ".concat(e),t)}}return n}async storeCacheData(e){if(this.persistAvailable){var t;let n=e.key.split("/").slice(-1)[0],i=new Date;e.created=null!==(t=e.created)&&void 0!==t?t:i,e.updated=i;let r=await window.navigator.storage.getDirectory(),s=await r.getDirectoryHandle("workshops",{create:!0}),o=await s.getDirectoryHandle(this.workshopDir,{create:!0}),a=await o.getDirectoryHandle("content",{create:!0}),l=await a.getFileHandle(n,{create:!0}),c=await l.createWritable();try{await c.write(e.content)}catch(e){throw console.warn("storeCacheData","error writing to cache",e),e}finally{await c.close(),console.debug("storeCacheData","content stored",e.key)}}}async getCacheData(e){if(!this.retrieveAvailable)return null;try{let t=e.split("/").slice(-1)[0],n=await window.navigator.storage.getDirectory(),i=await n.getDirectoryHandle("workshops",{create:!0}),r=await i.getDirectoryHandle(this.workshopDir,{create:!0}),s=await r.getDirectoryHandle("content",{create:!0}),o=await s.getFileHandle(t),a=await o.getFile();return{key:e,content:a}}catch(e){return console.warn("getCacheData - error encountered, this is a cache miss",e),null}}async fetchContent(e,t){return(await this.fetchContents([e],t))[0]}async fetchContents(e,t){let n=await this.getAccessUrls(e.map(e=>this.fixKeyForS3(e.key))),i=e.map(e=>({key:e.key,url:n.objectKeysToAccessUrls[this.fixKeyForS3(e.key)]}));console.debug("fetchContents","Fetched keysToUrls",i);let r=i.map(e=>this.download(e,t));console.debug("fetchContents","Fetching ".concat(r.length," content items..."));let s=await Promise.all(r);return console.debug("fetchContents","fetch contents complete",s),s}async download(e,t){let n=0;do{try{var i;let n=await fetch(e.url);if(null===n.body)throw"No content found in response for: ".concat(e.key,", at: ").concat(e.url);let r=n.headers.get("Content-Length");if(null===r)throw"Content-Length not found in response for: ".concat(e.key,", at: ").concat(e.url);let s=null!==(i=n.headers.get("Content-Type"))&&void 0!==i?i:void 0;if(void 0===s)throw"Content-Type not found in response for: ".concat(e.key,", at: ").concat(e.url);console.debug("download","".concat(e.key," content-type: ").concat(s));let o=n.body.getReader(),a=Number.parseInt(r);void 0!==t&&t(e.key,0,a);let l=[],c=0;for(;;){let{done:n,value:i}=await o.read();if(n)break;l.push(i),c+=i.length,void 0!==t&&t(e.key,c,a)}let d=new Uint8Array(c),u=0;for(let e of l)d.set(e,u),u+=e.length;return{content:new Blob(l,{type:s}),sourceUrl:e.url,key:e.key}}catch(t){console.warn("download","Error fetching: ".concat(e.key,", attempt: ").concat(n),t),await new Promise(e=>setTimeout(e,1e3))}n++}while(n<3);throw"Failed to fetch: ".concat(e.key)}async getAccessUrls(e){let t={objectKeys:e.filter(e=>this.isKeyForS3(e))},n=e.filter(e=>!this.isKeyForS3(e));console.debug("getAccessUrls","requests to s3 for:",t);let i=await this.start(this.api.postWorkshopContentAccessRequest(this.session.id,this.sessionToken,t));return n.forEach(e=>i.objectKeysToAccessUrls[e]=e),i}fixKeyForS3(e){if(this.isKeyForS3(e)){e=g().trim(e,"/");let t="workshops/".concat(this.workshopDir,"/");e.startsWith(t)||(e="".concat(t).concat(e))}return e}isKeyForS3(e){return!e.startsWith("https://")&&!e.startsWith("http://")}constructor(e,t,n,i,r,s){this.api=e,this.start=t,this.session=n,this.sessionToken=i;let o=r.split("/").slice(-2)[0];this.workshopDir=o,this.forceFetch=s,this.initialised=!1,this.storageAvailable=!1,this.persistAvailable=!1,this.mayPersist=!1,this.retrieveAvailable=!1,this.estimateAvailable=!1}}let v=["src","graphic","videoUri","posterUri","sideBackgroundImage","mainBackgroundImage","data-background-image"],b=["style","sideStyle","mainStyle"];class w{getAsSectionTags(e,t){let n=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("section"),i=[];console.debug("Module ".concat(t," contains ").concat(n.length," sections."));for(let e=0;e<n.length;e++){let r=n.item(e);r&&r.setAttribute("key","module-".concat(t,"-section-").concat(e));let s=new XMLSerializer().serializeToString(r);i.push(s)}return g().join(i,"\n")}reset(){this.progressData={overall:{completed:0,total:0},bars:{}},this.sendUpdate()}updateProgress(e,t,n){this.progressData.bars[e]={completed:t,total:n},this.progressData.overall.completed=g().sum(Object.entries(this.progressData.bars).map(e=>e[1].completed)),this.progressData.overall.total=g().sum(Object.entries(this.progressData.bars).map(e=>e[1].total)),this.sendUpdate()}sendUpdate(){var e;null===(e=this.onUpdate)||void 0===e||e.call(this,{overall:this.progressData.overall,bars:{}})}findAllReplacements(e,t){void 0===e&&(e=this.dom.documentElement),t=this.appendNodeReplacements(e,t);for(let n=0;n<e.childNodes.length;n++)t=this.findAllReplacements(e.childNodes[n],t);return t}appendNodeReplacements(e,t){let n=[...t];if(e.nodeType===Node.ELEMENT_NODE){for(let t of v)if(e.hasAttribute(t)){let i=e.getAttribute(t);if(void 0===n.find(e=>e.key===i)){let e=async()=>{try{return await this.zcs.getAsUrl(i,(e,t,n)=>{this.updateProgress(e,t,n)})}catch(e){throw console.error("Error fetching ".concat(t,": ").concat(i),e),e}},r={key:i,getUrlPromise:e,targets:[],attempts:0};n.push(r)}n.find(e=>e.key===i).targets.push({element:e,attribute:t})}for(let t of b)if(e.hasAttribute(t)){let i=e.getAttribute(t);if(i.includes("url(")){let r=i.match(/url\(([^)]+)\)/)[1];if(r=g().trim(r,"\"' ()"),void 0===n.find(e=>e.key===r)){let e=async()=>{try{return await this.zcs.getAsUrl(r,(e,t,n)=>{this.updateProgress(e,t,n)})}catch(e){throw console.error("Error fetching ".concat(t,": ").concat(r),e),e}},i={key:r,getUrlPromise:e,targets:[],attempts:0};n.push(i)}n.find(e=>e.key===r).targets.push({element:e,attribute:t})}}}return n}async replaceAllReplacements(e){do{let t=e.filter(e=>this.shouldTryAgain(e)),n=await Promise.all(t.map(e=>this.replace(e)));if(n.some(e=>!e.succeeded)){let e=n.filter(e=>!1===e.succeeded);console.warn("".concat(e.length," failed replacements"),e),await new Promise(e=>setTimeout(e,1e3))}}while(e.some(e=>this.shouldTryAgain(e)));if(e.some(e=>!1===e.succeeded)){let t=e.filter(e=>!1===e.succeeded);console.error("".concat(t.length," replacements failed"),t)}return new XMLSerializer().serializeToString(this.dom)}async replace(e){try{e.attempts++;let t=await e.getUrlPromise();for(let n of e.targets){let i=n.element.getAttribute(n.attribute),r=null==i?void 0:i.replace(e.key,t);n.element.setAttribute(n.attribute,r)}e.succeeded=!0}catch(t){console.warn("Error fetching ".concat(e.key),t),e.succeeded=!1,e.error=t}finally{return e}}shouldTryAgain(e){return!0!==e.succeeded&&e.attempts<3}constructor(e,t,n){this.source=e,this.zcs=t,this.onUpdate=n,this.progressData={overall:{completed:0,total:0},bars:{}},this.dom=new DOMParser().parseFromString(e,"text/xml"),this.reset()}}var j=n(75511),k=n(53463),S=n(71359),Z=n(79418),C=n(45080),D=n(96537),E=n(31193),I=n(80511),P=n(94547);let q={gbr:{key:"postcode",label:"Postcode (first half)",mode:"text",layout:"column",textPlaceholder:"What is the first half of your postcode?",textValidationRegex:"^[a-zA-Z]{1,2}[0-9][0-9a-zA-Z]?$",textCapitalisation:!0,textValidationMessage:"Please enter a valid UK postcode",groups:[]}},A={key:"gender",label:"Gender",mode:"select",layout:"column",groups:[{label:"Gender",choices:[{display:"Female",key:"f"},{display:"Male",key:"m"},{display:"Non-binary",key:"nb"},{display:"I would rather not say",key:"prefer-not-to-say"}]}]},_={key:"age",label:"Age range",mode:"select",layout:"grid",layoutProps:{columns:2},groups:[{label:"Age",choices:[{display:"14 - 17",key:"14-17"},{display:"18 - 25",key:"18-25"},{display:"26 - 35",key:"26-35"},{display:"36 - 45",key:"36-45"},{display:"46 - 55",key:"46-55"},{display:"56 - 65",key:"56-65"},{display:"66 - 75",key:"66-75"},{display:"76+",key:"76+"},{display:"I would rather not say",key:"prefer-not-to-say"}]}]},T={key:"ethnicity",label:"Ethnicity",mode:"select",layout:"row",groups:[{label:"Asian or Asian British",choices:[{display:"Indian",key:"Indian"},{display:"Pakistani",key:"Pakistani"},{display:"Bangladeshi",key:"Bangladeshi"},{display:"Chinese",key:"Chinese"},{display:"Any other Asian background",key:"Any other Asian background"}]},{label:"Black, Black British, Caribbean or African",choices:[{display:"Caribbean",key:"Caribbean"},{display:"African",key:"African"},{display:"Any other Black, Black British, or Caribbean background",key:"Any other Black, Black British, or Caribbean background"}]},{label:"Mixed or multiple ethnic groups",choices:[{display:"White and Black Caribbean",key:"White and Black Caribbean"},{display:"White and Black African",key:"White and Black African"},{display:"White and Asian",key:"White and Asian"},{display:"Any other Mixed or multiple ethnic background",key:"Any other Mixed or multiple ethnic background"}]},{label:"White",choices:[{display:"English, Welsh, Scottish, Northern Irish or British",key:"English, Welsh, Scottish, Northern Irish or British"},{display:"Irish",key:"Irish"},{display:"Gypsy or Irish Traveller",key:"Gypsy or Irish Traveller"},{display:"Roma",key:"Roma"},{display:"Any other White background",key:"Any other White background"}]},{label:"Other ethnic group",choices:[{display:"Arab",key:"Arab"},{display:"Any other ethnic group",key:"Any other ethnic group"}]},{label:"Unavailable",choices:[{display:"I would rather not say",key:"prefer-not-to-say"}]}]};var R=n(48620),F=n(58433);function B(e){let t=e.demographic.groups.length>1;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[(0,p.jsx)(D.Z,{color:"buttonStandard",variant:"text",onClick:()=>e.onBack(),children:(0,p.jsx)("img",{src:"/icons/arrow-left.svg",alt:"Back"})}),(0,p.jsx)(I.Z,{variant:"slideSubHeading",align:"left",children:e.demographic.label})]}),(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch",gap:4,mb:4},children:e.demographic.groups.map(n=>(0,p.jsxs)(E.Z,{display:"flex",flexDirection:"column",alignContent:"start",children:[t&&(0,p.jsx)(I.Z,{variant:"demographicGroupHeading",align:"left",sx:{mb:.8},children:n.label}),("row"===e.layout||"column"===e.layout)&&(0,p.jsx)(E.Z,{display:"flex",flexDirection:e.layout,gap:1,flexWrap:"row"===e.layout?"wrap":void 0,alignItems:"column"===e.layout?"start":void 0,children:n.choices.map(t=>{var i;return(0,p.jsx)(D.Z,{variant:"contained",color:(null===(i=e.currentSelection)||void 0===i?void 0:i.key)===t.key?"buttonStandard":"buttonQuiet",onClick:()=>{e.onSelection(t)},children:(0,p.jsx)(I.Z,{variant:"submitButton",children:t.display})},"".concat(e.demographic.label,"-section-").concat(n.label,"-value-").concat(t.key))})}),"grid"===e.layout&&(0,p.jsx)(F.ZP,{container:!0,sx:{width:e.layoutProps.columns<3?"66%":"100%"},rowGap:1,children:n.choices.map(t=>{var i;return(0,p.jsx)(F.ZP,{item:!0,xs:12/e.layoutProps.columns,sx:{px:1},children:(0,p.jsx)(D.Z,{variant:"contained",fullWidth:!0,color:(null===(i=e.currentSelection)||void 0===i?void 0:i.key)===t.key?"buttonStandard":"buttonQuiet",onClick:()=>{e.onSelection(t)},children:(0,p.jsx)(I.Z,{variant:"submitButton",sx:{py:1},children:t.display})})},"".concat(e.demographic.label,"-section-").concat(n.label,"-value-").concat(t.key))})})]},"".concat(e.demographic.label,"-section-").concat(n.label)))})]})}function U(e){return(0,p.jsxs)(E.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,p.jsx)(E.Z,{sx:{display:"block",flexGrow:1,overflowY:"auto",overflowX:"hidden"},children:e.children}),(e.startBar||e.endBar)&&(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,p.jsx)(E.Z,{children:e.startBar}),e.endBar&&(0,p.jsx)(E.Z,{children:e.endBar})]})]})}var N=n(42555);function W(e){var t,n,i;return(0,p.jsx)(N.Z,{type:"submit",variant:null!==(t=e.variant)&&void 0!==t?t:"contained",size:e.size,color:null!==(n=e.color)&&void 0!==n?n:"buttonStandard",onClick:()=>{e.onClick(e.btnKey)},loading:e.busy,disabled:e.disabled||e.busy,children:(0,p.jsx)(I.Z,{variant:"submitButton",children:null!==(i=e.btnText)&&void 0!==i?i:"Submit"})})}var V=n(66858);function M(e){var t,n,i;let r=()=>{var t;return null!==(t=e.skipOption)&&void 0!==t?t:{key:"prefer-not-to-say",display:"I would rather not say"}},[s,o]=(0,x.useState)((null===(t=e.currentSelection)||void 0===t?void 0:t.key)!==r().key&&null!==(i=null===(n=e.currentSelection)||void 0===n?void 0:n.display)&&void 0!==i?i:""),[a,l]=(0,x.useState)(""),[c,d]=(0,x.useState)(!1),[u,h]=(0,x.useState)(!0),[m,f]=(0,x.useState)(!1),g=t=>{var n,i;return(f(!0),e.demographic.textMaxLength&&t.length>e.demographic.textMaxLength)?(l(null!==(n=e.demographic.textValidationMessage)&&void 0!==n?n:"Maximum length: ".concat(e.demographic.textMaxLength," characters")),d(!0),h(!1),!1):e.demographic.textValidationRegex&&!new RegExp(e.demographic.textValidationRegex).test(t)?(o(t),l(null!==(i=e.demographic.textValidationMessage)&&void 0!==i?i:"Please enter a valid value for ".concat(e.demographic.label,".")),d(!0),h(!1),!1):(o(t),l(""),d(!1),h(!0),!0)};return(0,x.useEffect)(()=>{m&&h(!c)},[m,c]),(0,p.jsx)(U,{endBar:(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",gap:1},children:[e.skipPermitted&&(0,p.jsx)(W,{btnKey:"skip",btnText:"I would rather not say",variant:"outlined",onClick:t=>{e.onSelection(r())}}),(0,p.jsx)(W,{btnKey:"submit",btnText:"Submit",variant:"contained",disabled:!u,onClick:t=>{g(s)&&e.onSelection({key:s,display:s})}})]}),children:(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[(0,p.jsx)(D.Z,{color:"buttonStandard",variant:"text",onClick:()=>e.onBack(),children:(0,p.jsx)("img",{src:"/icons/arrow-left.svg",alt:"Back"})}),(0,p.jsx)(I.Z,{variant:"slideSubHeading",align:"left",children:e.demographic.label})]}),(0,p.jsx)(V.Z,{label:e.demographic.textPlaceholder,variant:"outlined",defaultValue:s,onChange:e=>{let t=e.target.value.trim();m?g(t):o(t)},helperText:a,error:c,autoComplete:"off",color:"buttonStandard",inputProps:{style:{textTransform:e.demographic.textCapitalisation?"uppercase":void 0}},InputProps:{sx:{background:"white",fontSize:"2rem"}},InputLabelProps:{sx:{fontSize:"2rem","&.MuiOutlinedInput-notchedOutline":{fontSize:"2rem"}}}})]})})}var z=n(8260);function O(e){var t,n,i,r;let s;let{answers:o}=(0,z.ZP)(e.qids.qid),[a,l]=(0,x.useState)((0,z.Zp)(o,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[c,d]=(0,x.useState)(!1),[u,h]=(0,x.useState)(!1),[m,f]=(0,x.useState)((s=[],(null===(n=e.showGender)||void 0===n||n)&&s.push(A),(null===(i=e.showAge)||void 0===i||i)&&s.push(_),(null===(r=e.showEthnicity)||void 0===r||r)&&s.push(T),void 0!==e.showPostcode&&s.push(q[e.showPostcode]),[...s,...e.customDemographics])),[y,v]=(0,x.useState)(),[b,w]=(0,x.useState)({});(0,x.useEffect)(()=>{let e={};(null==a?void 0:a.jsonValue)&&a.jsonValue.answers.forEach(t=>{e[t.key]={key:t.optionKey,display:t.stringValue}}),w(e)},[a]),(0,x.useEffect)(()=>{let t=g().every(m,e=>b.hasOwnProperty(e.key));h(e.role===P._b.Client&&t)},[b]);let j=async()=>{if(e.role!==P._b.Client)console.warn("Only participants can submit answers");else{let t={...a,jsonValue:{answers:Object.entries(b).map(e=>({key:e[0],optionKey:e[1].key,stringValue:e[1].display}))}};d(!0),e.onAnswer(t).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)l(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{d(!1)})}},k=!1===e.opaqueInputBox?void 0:{background:"white"},S=e=>{var t;return(0,p.jsx)(D.Z,{color:"buttonStandard",variant:"outlined",sx:{alignSelf:"stretch",py:0,...e.inputBoxSx},onClick:()=>e.onClick(),children:(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:0},children:[void 0!==e.display&&(0,p.jsx)(I.Z,{variant:"selectTiny",children:e.label}),(0,p.jsx)(I.Z,{variant:"selectLarge",component:"div",children:null!==(t=e.display)&&void 0!==t?t:e.label})]}),(0,p.jsx)("img",{src:"/icons/select-down.svg"})]})})};return(0,p.jsxs)(p.Fragment,{children:[void 0===y&&(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(U,{endBar:(0,p.jsx)(W,{btnKey:"submit",btnText:"Submit",onClick:()=>{j()},disabled:!u,busy:c}),children:(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,p.jsx)(E.Z,{sx:{mb:4,mx:8},children:e.question&&(0,p.jsx)(R.Z,{content:e.question})}),m.map(e=>(0,p.jsx)(S,{label:e.label,display:b.hasOwnProperty(e.key)?b[e.key].display:void 0,onClick:()=>{v(e)},inputBoxSx:k},"overview-demographic-".concat(e.key)))]})})}),void 0!==y&&"select"===y.mode&&(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(B,{demographic:y,currentSelection:b[y.key],onBack:()=>{v(void 0)},onSelection:e=>{w({...b,[y.key]:e}),v(void 0)},layout:y.layout,layoutProps:y.layoutProps})}),void 0!==y&&"text"===y.mode&&(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(M,{demographic:y,skipPermitted:!0,currentSelection:b[y.key],onBack:()=>{v(void 0)},onSelection:e=>{w({...b,[y.key]:e}),v(void 0)}})})]})}function L(e){return(0,p.jsx)("img",{className:"stretch",style:{width:"100%",height:"100%",...e.style},src:e.src})}function G(e){let[t,n]=(0,x.useState)(e.sideSx),[i,r]=(0,x.useState)(e.mainSx);return(0,x.useEffect)(()=>{void 0!==e.sideBackgroundImage&&n({backgroundImage:"url(".concat(e.sideBackgroundImage,")"),...e.sideSx}),void 0!==e.mainBackgroundImage&&r({backgroundImage:"url(".concat(e.mainBackgroundImage,")"),...e.mainSx})},[]),(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"row"},children:[(0,p.jsx)(E.Z,{sx:{width:"35%",display:"block",...e.sideSx},children:e.side}),(0,p.jsx)(E.Z,{sx:{px:2,alignSelf:"stretch",display:"block",overflowY:"auto",width:"60%",...e.mainSx},children:e.main})]})})}function K(e){let{answers:t}=(0,z.ZP)(e.qids.qid),n=()=>(0,z.UJ)(t,e.qids),[i,r]=(0,x.useState)(n()),[s,o]=(0,x.useState)((0,z.S9)(i)?1:0);return(0,x.useEffect)(()=>{r(n())},[t]),(0,x.useEffect)(()=>{o((0,z.S9)(i)?1:0)},[i]),(0,x.useEffect)(()=>{j.Z.emit({type:j.z.Request_SlideRefresh})},[s]),(0,p.jsxs)(p.Fragment,{children:[0===s&&e.input,1===s&&e.completion]})}function H(e){var t;let{content:n,sx:i}=e;return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",...i},children:[(0,p.jsx)(I.Z,{variant:"slideHeading",children:null!==(t=n.message)&&void 0!==t?t:"Thanks!"}),n.factoid&&(0,p.jsx)(I.Z,{variant:"slideBody",sx:{mt:8},children:n.factoid})]})})}function J(e){let{sx:t,children:n}=e;return(0,p.jsx)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",overflowY:"auto",overflowX:"hidden",display:"block",...t},children:n})}function Y(e){let t={...e.sx,color:e.color};return(0,p.jsx)(I.Z,{variant:e.variant,component:"div",sx:t,align:e.align,children:e.children})}(i=l||(l={}))[i.Input=0]="Input",i[i.Completion=1]="Completion";var Q=n(30089);function X(e){let t={backgroundImage:"url('".concat(e.src,"')")};return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"block",...t,...e.sx},children:e.children})})}function $(e){return(0,p.jsx)("img",{src:e.src,style:e.style})}var ee=n(22960);function et(e){let{answers:t}=(0,z.ZP)(e.qids.qid),n=(0,ee.Z)();return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",overflowX:"hidden",overflowY:"auto"},children:[e.question&&(0,p.jsx)(R.Z,{content:e.question}),(0,p.jsx)(E.Z,{display:"flex",flexDirection:"column",alignItems:"center",children:t.map((t,i)=>{var r;return(0,p.jsx)(p.Fragment,{children:null===(r=t.jsonValue)||void 0===r?void 0:r.answers.map(t=>(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(E.Z,{sx:{mb:4,px:2,mx:8},className:"shadow",style:{background:"white",border:"solid 2px",borderColor:i%2==0?n.palette.primary.main:n.palette.secondary.main,borderRadius:12,transform:"rotate(".concat(i%2==0?1.5:-1.5,"deg)")},children:(0,p.jsx)(I.Z,{variant:"slideBody",children:t.stringValue})},"speech-bubble-".concat(e.qids.qid,"-").concat(t.key))}))})})})]})})}function en(e){let{sx:t,children:n}=e;return(0,p.jsx)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",...t},children:(0,p.jsx)(E.Z,{alignSelf:"center",display:"inline-block",textAlign:"center",children:n})})}var ei=n(49752);function er(e){let t=(0,ee.Z)(),n=90-90/e.sourceOptions.filter(e=>!e.isAlt).length;return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,p.jsx)(E.Z,{sx:{mb:4,mx:8},children:e.question&&(0,p.jsx)(R.Z,{content:e.question})}),(0,p.jsx)(E.Z,{display:"flex",flexDirection:"row",justifyContent:"center",sx:{gap:1,width:"".concat(n,"%")},children:e.displayOptions.filter(e=>!e.isAlt).map((n,i)=>{let r=e.currentlySelectedKeys.find(e=>e===n.key);return(0,p.jsxs)(E.Z,{sx:{borderRadius:4,px:1,flexGrow:1,flexBasis:0},style:{minHeight:200,border:"solid 4px",background:r?t.palette.optionButtonSelected.main:t.palette.optionButtonUnselected.main,borderColor:r?t.palette.optionButtonSelectedBorder.main:"transparent",cursor:"pointer"},display:"flex",flexDirection:"column",justifyContent:"center",onClick:()=>e.onSelectionClick(n.key),children:[!!n.graphic&&(0,p.jsx)("img",{src:n.graphic,style:{alignSelf:"center",width:"40%"},alt:"".concat(n.display)}),(0,p.jsx)(I.Z,{variant:"yesNoUnsureButton",sx:{textWrap:"pretty"},children:n.display})]},"option-".concat(n.key,"-").concat(e.qid))})}),(0,p.jsx)(E.Z,{display:"flex",flexDirection:"column",alignItems:"center",sx:{mt:2},children:e.sourceOptions.filter(e=>e.isAlt).map((n,i)=>{let r=e.currentlySelectedKeys.find(e=>e===n.key);return(0,p.jsx)(E.Z,{sx:{p:2,borderRadius:4},style:{background:r?t.palette.optionButtonSelected.main:"transparent",border:"solid 4px transparent",borderColor:r?t.palette.optionButtonSelectedBorder.main:"transparent",cursor:"pointer"},onClick:()=>e.onSelectionClick(n.key),display:"flex",flexDirection:"column",justifyContent:"center",children:(0,p.jsx)(I.Z,{variant:"yesNoUnsureButton",style:{borderBottom:"solid 1px black"},children:n.display})},"option-".concat(n.key,"-").concat(e.qid))})}),e.showSubmit&&(0,p.jsx)(E.Z,{display:"flex",flexDirection:"row",justifyContent:"center",sx:{mt:4},children:(0,p.jsx)(ei.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}var es=n(33351);function eo(e){let t=e.layoutParams.length>0?parseInt(e.layoutParams[0]):6,n=(0,ee.Z)();return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(es.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,p.jsx)(es.Z,{sx:{mb:4,mx:8},children:e.question&&(0,p.jsx)(R.Z,{content:e.question})}),(0,p.jsx)(F.ZP,{container:!0,spacing:1,children:e.displayOptions.map((i,r)=>{let s=e.currentlySelectedKeys.find(e=>e===i.key);return(0,p.jsx)(F.ZP,{item:!0,xs:t,display:"flex",flexDirection:"column",alignContent:"stretch",children:(0,p.jsx)(D.Z,{variant:"contained",style:{display:"flex",flexDirection:"column",justifyContent:"center",border:"solid 4px",background:s?n.palette.optionButtonSelected.main:n.palette.optionButtonUnselected.main,borderColor:s?n.palette.optionButtonSelectedBorder.main:"transparent",color:"black"},onClick:()=>e.onSelectionClick(i.key),children:(0,p.jsx)(I.Z,{variant:"submitButton",children:i.display})})},"answer-".concat(e.qid,"-").concat(i.key))})}),e.showSubmit&&(0,p.jsx)(es.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end",sx:{mt:4},children:(0,p.jsx)(ei.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}function ea(e){let t=(0,ee.Z)();return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(es.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,p.jsx)(es.Z,{sx:{mb:4,mx:8},children:e.question&&(0,p.jsx)(R.Z,{content:e.question})}),(0,p.jsx)(es.Z,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",gap:1},children:e.displayOptions.map((n,i)=>{let r=e.currentlySelectedKeys.find(e=>e===n.key);return(0,p.jsx)(D.Z,{variant:"contained",style:{display:"flex",flexDirection:"column",justifyContent:"center",border:"solid 4px",background:r?t.palette.optionButtonSelected.main:t.palette.optionButtonUnselected.main,borderColor:r?t.palette.optionButtonSelectedBorder.main:"transparent",color:"black"},onClick:()=>e.onSelectionClick(n.key),children:(0,p.jsx)(I.Z,{variant:"submitButton",children:n.display})},"answer-".concat(e.qid,"-").concat(n.key))})}),e.showSubmit&&(0,p.jsx)(es.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end",sx:{mt:4},children:(0,p.jsx)(ei.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}let el=(e,t)=>t.filter(t=>!!e.find(e=>e===t.key)),ec=e=>[...e].sort(()=>Math.random()-.5);function ed(e){var t;let[n,i]=(0,x.useState)(e.shuffle?ec(e.options):e.options),{answers:r}=(0,z.ZP)(e.qids.qid),[s,o]=(0,x.useState)((0,z.Zp)(r,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[a,l]=(0,x.useState)([]);(0,x.useEffect)(()=>{var t,n;l(el(null!==(n=null===(t=s.jsonValue)||void 0===t?void 0:t.answers.filter(e=>!0===e.booleanValue).map(e=>e.key))&&void 0!==n?n:[],e.options))},[s]);let[c,d]=(0,x.useState)(!1),u=e.role===P._b.Client,h=()=>a.length>=e.minSelections&&a.length<=e.maxSelections,m=async()=>{if(h())try{d(!0);var t={...s,jsonValue:{answers:a.map(t=>({key:t.key,booleanValue:!0,numericValue:1,index:e.options.findIndex(e=>e.key===t.key)}))}},n=await e.onAnswer(t);if(console.debug("Answer submitted ".concat(n?"ok":"error")),console.debug("Received answer response",n),n)o(n);else throw"No response received"}catch(e){console.error("Error submitting answer",e)}finally{d(!1)}},f=t=>{console.debug("Selection clicked: "+t);let n=e.options.find(e=>e.key===t);if(void 0===n)throw"Cannot identify this option from props.options";if(a.find(e=>e.key===t))l(a.filter(e=>e.key!==t));else if(a.length>=e.maxSelections){let e=a.find(e=>e.key!==t);l([...a.filter(t=>t!==e),n])}else l([...a,n])},g=()=>({onSubmit:m,onSelectionClick:f,qid:e.qids.qid,question:e.question,sourceOptions:e.options,displayOptions:n,busy:c,showSubmit:u,enableSubmit:h(),minSelections:e.minSelections,maxSelections:e.maxSelections,currentlySelectedKeys:a.map(e=>e.key),layoutParams:e.layoutParams}),[y,v]=(0,x.useState)(g());return(0,x.useEffect)(()=>{v(g())},[c,a]),(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:(0,p.jsxs)(E.Z,{sx:{flexGrow:1,display:"block"},children:["yes-no-unsure"===e.layout&&(0,p.jsx)(er,{...y}),"button-grid"===e.layout&&(0,p.jsx)(eo,{...y}),"buttons-inline"===e.layout&&(0,p.jsx)(ea,{...y})]})})})}function eu(e){let t=(0,ee.Z)(),n=void 0===e.chartBackground||e.chartBackground;return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1,overflowY:"hidden"},children:[e.title&&(0,p.jsx)(Y,{variant:"summaryTitle",sx:{p:0,px:1},align:"left",children:e.title}),e.prompt&&(0,p.jsx)(Y,{variant:"summaryPrompt",sx:{p:0,px:1},align:"left",children:e.prompt}),(0,p.jsx)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",gap:1,alignItems:"stretch",overflowY:"hidden"},children:e.children.map((e,i)=>(0,p.jsx)(E.Z,{sx:{background:n?t.palette.summaryChartBackground.main:void 0,borderRadius:n?4:void 0,flexGrow:1,flexBasis:0,p:2,display:"block",overflow:"auto"},children:e},"summary-slide-child-".concat(i)))})]})})}var eh=n(40468),ep=n(67506),ex=n(11144),em=n(1973);function ef(e){let{api:t,start:n}=(0,x.useContext)(em.E),{session:i}=(0,x.useContext)(ex.z),r=(0,x.useContext)(ep.G),s=(0,x.useContext)(m.rZ),[o,a]=(0,x.useState)(0),l={videoId:e.videoId,modeChange:P.tB.NotStarted,modeChangePosition_s:0,modeChangeServerTime_ms:Date.now()},[c,d]=(0,x.useState)(l),[u,h]=(0,x.useState)(-1),[f,g]=(0,x.useState)(),[y,v]=(0,x.useState)(0),[b,w]=(0,x.useState)(!1),j=(0,x.useRef)(null),k=function(e){let[t,n]=(0,x.useState)(!1),i=(0,x.useMemo)(()=>new IntersectionObserver(e=>{let[t]=e;return n(t.isIntersecting)}),[e]);return(0,x.useEffect)(()=>(i.observe(e.current),()=>i.disconnect()),[]),t}(j);(0,x.useEffect)(()=>{if(i.liveExperienceState.sequence>u){var t;h(i.liveExperienceState.sequence);let n=null===(t=i.liveExperienceState.videoSync)||void 0===t?void 0:t.find(t=>t.videoId===e.videoId);void 0!==n&&d(n)}},[i.liveExperienceState.sequence]),(0,x.useEffect)(()=>{if(k)switch(o){case 0:I().then(()=>a(1)).catch(e=>{console.error(e),a(2)});break;case 1:S().then(()=>a(3)).catch(e=>{console.error(e),a(2)})}else Z(),a(1)},[o,k]);let S=async()=>{if(null===j.current)throw Error("Player not ready");j.current.setAttribute("src",e.videoUri),j.current.load()},Z=async()=>{j.current&&(j.current.removeAttribute("src"),j.current.load())},C=(0,x.useCallback)(()=>{if(document.hidden)s.role!==P._b.Controller||null===j.current||j.current.paused||R();else try{switch(c.modeChange){case P.tB.Paused:case P.tB.Ended:_(c);break;case P.tB.Playing:q(c)}}catch(e){console.warn("Error syncing video",e)}},[c,e.videoId,s.role]);(0,x.useEffect)(()=>{document.addEventListener("visibilitychange",()=>C())},[]);let I=async()=>{if(null===j.current)throw Error("Player not ready");j.current.addEventListener("play",()=>{v(1)}),j.current.addEventListener("pause",()=>{v(0)}),j.current.addEventListener("ended",()=>{v(0)})};(0,x.useEffect)(()=>{if(null!==j.current&&3===o&&c.videoId===e.videoId){console.debug("video sync received",c);try{switch(c.modeChange){case P.tB.Paused:case P.tB.Ended:_(c);break;case P.tB.Playing:q(c)}}catch(e){console.warn("Error syncing video",e)}}},[c,o,j.current]);let q=async e=>{if(console.debug("Play state..."),null===j.current)return;let t=r.fromServerTime(e.modeChangeServerTime_ms),n=Date.now();if(t<=n){let i=n-t;console.debug("State change was ".concat(i,"ms in the past...")),A(e.modeChangePosition_s+i/1e3)}if(t>n){void 0!==f&&clearTimeout(f);let i=t-n;console.debug("State change ".concat(i,"ms in the future...")),i<0&&console.warn("State change projected into the past with a negative delay.");let r=setTimeout(()=>{g(void 0),A(e.modeChangePosition_s)},i);g(r)}},A=async t=>{if(console.debug("Playing video",e.videoId,t),null===j.current){console.warn("Cannot play - no player reference available.");return}if(j.current.currentTime=t,j.current.paused)try{j.current.muted=!0,console.debug("Starting player from paused. Ready state is: ".concat(j.current.readyState));let e=Date.now();await j.current.play();let n=Date.now()-e;console.debug("Play start duration: ".concat(n,"ms"));let i=t+n/1e3;i<0&&console.warn("Post play correction: negative position."),i>j.current.duration&&console.warn("Post play correction: position exceeds duration."),i>0&&j.current.duration>i&&(console.debug("Post play correction: local position out by ".concat(j.current.currentTime-i,"ms")),j.current.currentTime=i)}catch(e){console.error("Cannot play video",e)}finally{j.current.muted=!e.audio}},_=e=>{null===j.current||(j.current.currentTime=e.modeChangePosition_s,j.current.paused||j.current.pause())},T=async(o,a)=>{if(null===j.current)return!1;try{w(!0);let l=j.current.currentTime,c={videoId:e.videoId,modeChange:o,modeChangePosition_s:l,modeChangeServerTime_ms:r.toServerTime(null!=a?a:Date.now())},d={action:"set-video-sync",sessionId:i.id,parameters:c};return await n(t.postFacilitatorAction(s.user.access_token,s.sessionToken,d,!1)),!0}catch(e){return console.error(e),!1}finally{w(!1)}},R=async()=>{if(null===j.current)return;let e=j.current.paused?P.tB.Playing:P.tB.Paused,t=e===P.tB.Playing?Date.now()+2e3:void 0;await T(e,t)?console.debug("Video sync send ok"):console.error("Video sync send failed")},F=async()=>{if(null===j.current)return;let e=j.current.currentTime-15;e<0&&(e=0),j.current.currentTime=e,await T(P.tB.Paused)?console.debug("Video sync send ok"):console.error("Video sync send failed")},B=async()=>{if(null===j.current)return;let e=j.current.currentTime+15;e>j.current.duration&&(e=j.current.duration),j.current.currentTime=e,await T(P.tB.Paused)?console.debug("Video sync send ok"):console.error("Video sync send failed")},U=async()=>{null!==j.current&&(j.current.currentTime=0,await T(P.tB.Paused)?console.debug("Video sync send ok"):console.error("Video sync send failed"))};return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[2!==o&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("video",{ref:j,poster:e.posterUri,preload:"auto",loop:!1,autoPlay:!1,controls:!1,muted:!0,crossOrigin:"anonymous",style:{flexGrow:1},playsInline:!0,"webkit-playsinline":"true"}),e.controls&&null!==j.current&&(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{display:"flex",flexDirection:"row",alignSelf:"stretch",justifyContent:"center",sx:{gap:2,mt:1},children:[(0,p.jsx)(D.Z,{variant:"outlined",disabled:b,onClick:U,children:"Restart"}),(0,p.jsx)(D.Z,{variant:"outlined",disabled:b,onClick:F,children:"-15s"}),void 0!==f&&(0,p.jsx)(eh.Z,{variant:"indeterminate"}),(0,p.jsx)(D.Z,{variant:0===y?"contained":"outlined",disabled:b,onClick:R,children:"play/pause"}),(0,p.jsx)(D.Z,{variant:"outlined",disabled:b,onClick:B,children:"+15s"})]})})]}),2===o&&(0,p.jsx)("p",{children:"Failed to initialise video."})]})})}(r=c||(c={}))[r.Init=0]="Init",r[r.Loading=1]="Loading",r[r.InitError=2]="InitError",r[r.Ready=3]="Ready",(s=d||(d={}))[s.Paused=0]="Paused",s[s.Playing=1]="Playing";var eg=n(14874),ey=n(40772);function ev(e){let{allAnswers:t}=(0,z.ZP)(),n=()=>{for(let n of e.qids)if(!(0,z.S9)((0,z.UJ)(t[n.qid],n)))return e.qids.indexOf(n)},[i,r]=(0,x.useState)(n());(0,x.useEffect)(()=>{let e=n();i!==e&&r(e)},[t]);let s=(0,eg.Z)(),o=[.2,.25],[a]=(0,ey.u)({duration:500});return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{ref:a,className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"stretch",p:2,gap:2,boxSizing:"border-box"},children:[void 0!==i&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(R.Z,{content:e.question}),(0,p.jsx)(E.Z,{sx:{flexGrow:1,boxSizing:"border-box",overflowY:"auto",overflowX:"hidden",display:"block"},children:e.inputs[i]},"input-sequence-element-".concat(e.qids[i].qid))]}),void 0===i&&(0,p.jsx)(E.Z,{sx:{flexGrow:1,display:"block"},children:e.completion}),void 0!==i&&e.showProgress&&(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:g().range(0,e.inputs.length).map((t,n)=>(0,p.jsx)(E.Z,{sx:{background:t===i?s.palette.progressBlipSelected.main:s.palette.progressBlipUnselected.main,width:"".concat(o[t===i?1:0],"em"),height:"".concat(o[t===i?1:0],"em"),borderRadius:"".concat(o[t===i?1:0]/2,"em")}},"sequence-blip-".concat(t,"-").concat(e.qids[t].qid)))})]})})}var eb=n(34990),ew=n(60335);(o=u||(u={}))[o.Yes=0]="Yes",o[o.No=1]="No",o[o.Unsure=2]="Unsure";let ej=e=>0===e?1:1===e?-1:0,ek=e=>1===e?0:-1===e?1:2;function eS(e){var t;let{answers:n}=(0,z.ZP)(e.qids.qid),[i,r]=(0,x.useState)((0,z.Zp)(n,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[s,o]=(0,x.useState)(i),[a,l]=(0,x.useState)(!1),c=e.role===P._b.Client;(0,x.useEffect)(()=>{o({...i})},[i]);let d=async e=>{if(c&&!a){let t={...s,jsonValue:{answers:[{key:"vote",stringValue:u[e],numericValue:ej(e)}]}};await h(t)}},h=async t=>{try{l(!0);let n=await e.onAnswer(t);if(null!==n)r(n);else throw"Failed to submit answer"}catch(e){console.error(e)}finally{l(!1)}},m=(0,eg.Z)();return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[(0,p.jsx)(R.Z,{content:e.question}),(0,p.jsxs)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,p.jsxs)(eb.Z,{elevation:0,sx:{p:4,mb:2,width:"60%",height:"70%",alignSelf:"center",minHeight:200,borderRadius:4,background:m.palette.promptPanelBackground.main,display:"flex",flexDirection:"row",alignContent:"center",justifyContent:"stretch"},children:[(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,p.jsx)("div",{style:{position:"absolute",width:"15%",height:"20%",padding:0,margin:0},children:(0,p.jsx)(ew.Z,{sx:{position:"relative",left:"-100%",top:0,width:"100%",height:"100%",m:0,p:0},onClick:()=>d(1),disabled:!c||a,style:{opacity:c&&!a?1:.5},children:(0,p.jsx)("img",{src:"/icons/updown/cross.svg"})})})}),(0,p.jsx)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center",p:2},children:(0,p.jsx)(I.Z,{variant:"upDownQuestion",sx:{textAlign:"center",alignSelf:"center"},children:e.assertion})}),(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,p.jsx)("div",{style:{position:"absolute",width:"15%",height:"20%",padding:0,margin:0},children:(0,p.jsx)(ew.Z,{sx:{position:"relative",right:0,top:0,width:"100%",height:"100%",m:0,p:0},style:{opacity:c&&!a?1:.5},onClick:()=>d(0),disabled:!c||a,children:(0,p.jsx)("img",{src:"/icons/updown/check.svg"})})})})]}),(0,p.jsx)(E.Z,{sx:{p:2,borderRadius:4,cursor:"pointer",opacity:c&&!a?1:.5,alignSelf:"center"},onClick:()=>d(2),display:"flex",flexDirection:"column",justifyContent:"center",children:(0,p.jsx)(I.Z,{variant:"submitButton",style:{borderBottom:"solid 1px black"},children:"Unsure"})})]})]})})}function eZ(e){let t=(0,ee.Z)();return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:(0,p.jsxs)(F.ZP,{container:!0,flexGrow:1,children:[(0,p.jsx)(F.ZP,{item:!0,xs:12,sx:{pb:1},children:(0,p.jsxs)(E.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,p.jsx)("img",{src:"/icons/updown/qmark.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,p.jsx)(Y,{variant:"upDownCategory",children:"These statements split the room..."})]}),e.mostDivisive.map((e,n)=>(0,p.jsx)(Y,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDivided.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})}),(0,p.jsx)(F.ZP,{item:!0,xs:6,sx:{pr:1},children:(0,p.jsxs)(E.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,p.jsx)("img",{src:"/icons/updown/check.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,p.jsx)(Y,{variant:"upDownCategory",children:"Most people agreed with..."})]}),e.mostlySupported.map((e,n)=>(0,p.jsx)(Y,{variant:"upDownQuestion",sx:{background:t.palette.backgroundAgree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})}),(0,p.jsx)(F.ZP,{item:!0,xs:6,sx:{p:0},children:(0,p.jsxs)(E.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,p.jsx)("img",{src:"/icons/updown/cross.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,p.jsx)(Y,{variant:"upDownCategory",children:"Most people disagreed with..."})]}),e.mostlyOpposed.map((e,n)=>(0,p.jsx)(Y,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDisagree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})})]})})})}function eC(e){let t=(0,ee.Z)();return(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,p.jsxs)(E.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,p.jsx)("img",{src:"/icons/updown/qmark.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,p.jsx)(Y,{variant:"upDownCategory",children:"These statements split the room..."})]}),e.mostDivisive.map((e,n)=>(0,p.jsx)(Y,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDivided.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]}),(0,p.jsxs)(E.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,p.jsx)("img",{src:"/icons/updown/check.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,p.jsx)(Y,{variant:"upDownCategory",children:"Most people agreed with..."})]}),e.mostlySupported.map((e,n)=>(0,p.jsx)(Y,{variant:"upDownQuestion",sx:{background:t.palette.backgroundAgree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]}),(0,p.jsxs)(E.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,p.jsx)("img",{src:"/icons/updown/cross.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,p.jsx)(Y,{variant:"upDownCategory",children:"Most people disagreed with..."})]}),e.mostlyOpposed.map((e,n)=>(0,p.jsx)(Y,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDisagree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})]})}function eD(e){let{allAnswers:t}=(0,z.ZP)(),[n,i]=(0,x.useState)([]),[r,s]=(0,x.useState)([]),[o,a]=(0,x.useState)([]),[l,c]=(0,x.useState)([]);return(0,x.useEffect)(()=>{let n=[],r=[],o=[],l=[];Object.entries(t).forEach(t=>{let[i,s]=t;if(void 0!==Object.keys(e.questions).find(e=>e===i)){let t=s.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&ek(e.jsonValue.answers[0].numericValue)===u.Yes}).length,a=s.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&ek(e.jsonValue.answers[0].numericValue)===u.No}).length,c=s.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&ek(e.jsonValue.answers[0].numericValue)===u.Unsure}).length,d=e.questions[i].assertion,h={qid:i,assertion:d,yes:t,no:a,unsure:c},p=t+a;p>0?t>=2*p/3?n=[...n,h]:a>=2*p/3?r=[...r,h]:o=[...o,h]:l=[...l,h]}}),s(n),a(r),i(o),c(l)},[t,e.questions]),(0,p.jsxs)(p.Fragment,{children:["tshape"===e.layout&&(0,p.jsx)(eZ,{mostDivisive:n,mostlySupported:r,mostlyOpposed:o,unanswered:l}),"column"===e.layout&&(0,p.jsx)(eC,{mostDivisive:n,mostlySupported:r,mostlyOpposed:o,unanswered:l})]})}var eE=n(26049),eI=n(45231);function eP(e){let t=(0,x.useContext)(m.rZ),{answers:n}=(0,z.ZP)(e.qids.qid),i=()=>{var t;return(0,z.Zp)(n,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)},[r,s]=(0,x.useState)(i()),[o,a]=(0,x.useState)(i()),[l,c]=(0,x.useState)(!1),[d,u]=(0,x.useState)(!1),[h,f]=(0,x.useState)(e.points),[y,v]=(0,x.useState)(e.options.map(e=>({min:0,max:e.max}))),[b,w]=(0,x.useState)(e.options.map(()=>0)),j=(e,t)=>{w(b.map((n,i)=>i===t?e:n))};(0,x.useEffect)(()=>{let n=e.points-g().sum(b);f(n);for(let t=0;t<e.options.length;t++)v(y.map((e,t)=>({min:0,max:b[t]+n})));let i={answers:[]};for(let t=0;t<e.options.length;t++)i.answers.push({key:e.options[t].key,description:e.options[t].title,numericValue:b[t]});a({...o,jsonValue:i}),u(0===n&&t.role!==P._b.Controller)},[b]);let k=async()=>{c(!0),e.onAnswer(o).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)s(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{c(!1)})},S=(e,t)=>g().range(e,t+1,1).map((e,t)=>({value:e,label:"".concat(e)})),Z=(0,ee.Z)();return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"row",gap:1,mb:2},children:e.question&&(0,p.jsx)(R.Z,{content:e.question})}),(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"column",gap:1,flexGrow:1,overflowX:"hidden",overflowY:"auto",px:1},children:e.options.map((e,n)=>(0,p.jsxs)(E.Z,{sx:{background:"#f0f0f0",p:2,borderRadius:4,display:"flex",flexDirection:"row",alignItems:"stretch",gap:2},children:[e.graphic&&(0,p.jsx)(E.Z,{sx:{width:"20%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url(".concat(e.graphic,")"),borderRadius:2}}),(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"column",gap:1,width:"80%"},children:[(0,p.jsx)(I.Z,{variant:"pointsAllocationCategoryTitle",align:"left",children:e.title}),(0,p.jsx)(I.Z,{variant:"pointsAllocationCategoryDescription",align:"left",children:e.description}),(0,p.jsx)(E.Z,{sx:{px:2},children:(0,p.jsx)(eE.Z,{onCommit:e=>{j(e,n)},color:"secondary",sliderDefault:b[n],marks:S(e.min,e.max),slots:{markLabel:eI.A},min:e.min,max:e.max,step:1,sliderMode:"multi",acceptableRange:{min:y[n].min,max:y[n].max},disabled:t.role===P._b.Controller})})]})]},"points-allocation-option-".concat(n)))}),(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"end",gap:1,mx:1},children:[(0,p.jsxs)(I.Z,{variant:"pointsAllocationCategoryTitle",align:"left",color:Z.palette.secondary.main,children:[h," points remaining"]}),(0,p.jsx)(ei.Z,{enabled:d,inline:!0,busy:l,onSubmit:()=>k()})]})]})})}function eq(e){let{answers:t}=(0,z.ZP)(e.qids.qid),n=()=>{var n;return(0,z.Zp)(t,e.qids,null===(n=e.question)||void 0===n?void 0:n.pii)},[i,r]=(0,x.useState)(n()),[s,o]=(0,x.useState)(n()),[a,l]=(0,x.useState)(!1),[c,d]=(0,x.useState)(e.role===P._b.Client),[u,h]=(0,x.useState)({});(0,x.useEffect)(()=>{let t={...u};e.options.forEach(n=>{var r,s,o;t[n.key]=null!==(o=null===(s=i.jsonValue)||void 0===s?void 0:null===(r=s.answers.find(e=>e.key===n.key))||void 0===r?void 0:r.numericValue)&&void 0!==o?o:Math.floor((e.min+e.max)/2)}),h(t),o({...i,jsonValue:{answers:e.options.map(n=>{var i,r;return{key:n.key,numericValue:null!==(i=t[n.key])&&void 0!==i?i:Math.floor((e.min+e.max)/2),description:n.description,index:null!==(r=t[n.key])&&void 0!==r?r:Math.floor((e.min+e.max)/2)}})}})},[i]);let m=t=>u.hasOwnProperty(t)?u[t]:Math.floor((e.min+e.max)/2),f=(t,n)=>{var i,r,a;let l=null!==(r=s.jsonValue)&&void 0!==r?r:{answers:[]};l.answers=l.answers.filter(e=>e.key!==t),l.answers.push({key:t,numericValue:n,description:null!==(a=null===(i=e.options.find(e=>e.key===t))||void 0===i?void 0:i.description)&&void 0!==a?a:"".concat(n),index:n}),o({...s,jsonValue:l})},g=async()=>{e.role!==P._b.Controller&&(l(!0),e.onAnswer(s).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)r(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{l(!1)}))};return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1,px:8},children:[(0,p.jsxs)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1,overflowX:"hidden",overflowY:"auto",justifyContent:"center",px:0},children:[(0,p.jsx)(E.Z,{sx:{mb:8},children:e.question&&(0,p.jsx)(R.Z,{content:e.question})}),(0,p.jsxs)(F.ZP,{container:!0,sx:{alignItems:"center"},children:[(0,p.jsx)(F.ZP,{item:!0,xs:3}),(0,p.jsx)(F.ZP,{item:!0,xs:9,style:{textAlign:"left"},sx:{pr:3},children:e.labels.map((t,n)=>{let i=e.max-e.min,r=t.at-e.min,s=t.at===e.min,o=t.at===e.max;return(0,p.jsx)(E.Z,{style:{position:"relative",left:"".concat(r/i*100,"%")},children:(0,p.jsx)(E.Z,{style:{position:"absolute",transform:s?"translate(0, -0.5em)":o?"translate(-100%, -0.5em)":"translate(-50%, -0.5em)",maxWidth:"".concat(100/e.labels.length,"%")},children:(0,p.jsx)(I.Z,{variant:"body1",component:"div",sx:{fontWeight:"bold"},children:t.text})})},"".concat(e.qids.qid,"-label-").concat(n,"-at-").concat(t.at))})}),e.options.map((t,n)=>(0,p.jsxs)(x.Fragment,{children:[(0,p.jsxs)(F.ZP,{item:!0,xs:3,children:[(0,p.jsx)(I.Z,{variant:"body1",align:"left",component:"div",sx:{pr:6},children:t.title}),e.showDescriptions&&!1]}),(0,p.jsx)(F.ZP,{item:!0,xs:9,sx:{pr:3},children:(0,p.jsx)(eE.Z,{onCommit:e=>{f(t.key,e)},color:"secondary",sliderDefault:m(t.key),marks:!0,min:e.min,max:e.max,step:1,sliderMode:"multi",sx:{mt:1}})})]},"".concat(e.qids.qid,"-option-").concat(t.key)))]})]}),e.role===P._b.Client&&(0,p.jsx)(E.Z,{children:(0,p.jsx)(ei.Z,{onSubmit:g,text:"Submit",busy:a,enabled:c,inline:!1,alignment:"right"})})]})})}var eA=n(73391);let e_=(e,t)=>{if(!e||0===e.length)return[];let n=new Map;return e.forEach(e=>{var t;null===(t=e.jsonValue)||void 0===t||t.answers.forEach(e=>{var t;let i=e.key,r=null!==(t=e.numericValue)&&void 0!==t?t:0;n.has(i)||n.set(i,0),n.set(i,n.get(i)+r)})}),Array.from(n.entries()).sort((e,t)=>e[1]-t[1]).reverse().slice(0,t).map(e=>({key:e[0],count:e[1]}))},eT=(e,t)=>e&&0!==e.length?t&&0!==t.length?e.map(n=>{let i=t.find(e=>e.key===n.key);if(!i){console.warn("No description found for option: ".concat(n.key),e,t);return}return{key:n.key,title:i.title,description:i.description,graphic:i.graphic,count:n.count}}).filter(e=>!!e).map(e=>e):(console.warn("No described options available"),[]):[];function eR(e){let{answers:t}=(0,z.ZP)(e.qids.qid),[n,i]=(0,x.useState)([]),[r,s]=(0,x.useState)([]);(0,x.useEffect)(()=>{i(e_(t,e.displayCount))},[t]),(0,x.useEffect)(()=>{s(eT(n,e.options))},[n]);let o=(0,ee.Z)();return(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[e.question&&(0,p.jsx)(R.Z,{content:e.question}),(0,p.jsx)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",alignItems:"stretch",justifyContent:"stretch",gap:1},children:r.map((t,n)=>(0,p.jsxs)(E.Z,{sx:{flexGrow:1,flexBasis:0,p:2,borderRadius:2,background:o.palette.summaryChartBackground.main,display:"flex",flexDirection:"column",gap:1,mt:2*n},children:[(0,p.jsx)(I.Z,{variant:"topOptionsOptionRank",align:"left",children:(0,eA.q)(n+1)}),(0,p.jsxs)(I.Z,{variant:"topOptionsOptionPoints",align:"left",children:["Total points: ",t.count]}),(0,p.jsx)(E.Z,{sx:{width:"10%",height:0,border:"4px solid black",borderRadius:"4px",mt:1,mb:3}}),(0,p.jsx)(I.Z,{variant:"topOptionsOptionTitle",align:"left",children:t.title}),void 0!==t.graphic&&(0,p.jsx)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"end"},children:(0,p.jsx)(E.Z,{sx:{maxHeight:"20vh",height:"20vh",backgroundImage:"url(".concat(t.graphic,")"),backgroundSize:"cover",backgroundPosition:"center",borderRadius:2}})},"".concat(e.qids.qid,"-top-option-").concat(n,"-graphic-").concat(t.key))]},"".concat(e.qids.qid,"-top-option-").concat(n,"-description-").concat(t.key)))})]})}function eF(e){var t;let n=(0,x.useContext)(m.rZ),{answers:i}=(0,z.ZP)(e.qids.qid),[r,s]=(0,x.useState)((0,z.Zp)(i,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[o,a]=(0,x.useState)(r),[l,c]=(0,x.useState)(n.role!==P._b.Controller),[d,u]=(0,x.useState)(!1);(0,x.useEffect)(()=>{a(r)},[r]);let h=t=>{if(!l)return;u(!0);let n={...o,jsonValue:{answers:[{key:t,booleanValue:!0}]}};e.onAnswer(n).then(e=>{if(e)s(e);else throw"No response from submission"}).catch(e=>{console.error(e)}).finally(()=>{u(!1)})};return(0,p.jsxs)(p.Fragment,{children:[e.question&&(0,p.jsx)(R.Z,{content:e.question}),(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"row",gap:1,justifyContent:e.align},children:e.options.map((t,n)=>{var i;return(0,p.jsx)(D.Z,{variant:(null!==(i=t.variant)&&void 0!==i?i:0===n)?"contained":"outlined",color:t.colour,onClick:()=>h(t.key),disabled:!l||d,children:t.text},"ack-".concat(e.qids.qid,"-option-").concat(t.key))})})]})}var eB=n(84479),eU=n(11020);let eN=(e,t,n)=>{if(void 0===e.jsonValue||0===e.jsonValue.answers.length)return eV(t,n);let i=[];return e.jsonValue.answers.forEach(e=>{let n=t.find(t=>t.key===e.key);n&&(i[e.index]=n)}),i},eW=(e,t)=>{let n={answers:[]};return t.forEach((e,t)=>{n.answers.push({key:e.key,index:t,numericValue:t,description:e.title})}),{...e,jsonValue:n}},eV=(e,t)=>t?[...e].sort(()=>Math.random()-.5):e.sort((e,t)=>e.startingIndex-t.startingIndex);function eM(e){var t;let n=(0,x.useContext)(m.rZ),{answers:i}=(0,z.ZP)(e.qids.qid),[r,s]=(0,x.useState)((0,z.Zp)(i,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[o,a]=(0,x.useState)(n.role!==P._b.Controller),[l,c]=(0,x.useState)(!1),[d,u]=(0,x.useState)(eV(e.options,e.shuffle));(0,x.useEffect)(()=>{u(eN(r,e.options,e.shuffle))},[r]);let h=e=>{let t=d.findIndex(t=>t.key===e.key);if(t>0){let n=[...d];n.splice(t,1),n.splice(t-1,0,e),u(n)}},f=e=>{let t=d.findIndex(t=>t.key===e.key);if(t<d.length-1){let n=[...d];n.splice(t,1),n.splice(t+1,0,e),u(n)}},g=async()=>{if(n.role===P._b.Client&&o){c(!0);let t=eW(r,d);e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)u(eN(t,e.options,e.shuffle));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{c(!1)})}else console.warn("Only participants can submit answers")},y=(0,ee.Z)(),[v]=(0,ey.u)({duration:500});return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(U,{endBar:(0,p.jsx)(W,{btnKey:"submit",onClick:e=>{g()},disabled:!o,busy:l,variant:"contained",color:"buttonStandard",btnText:"Submit"}),children:[e.question&&(0,p.jsx)(E.Z,{sx:{mb:2},children:(0,p.jsx)(R.Z,{content:e.question})}),(0,p.jsx)(E.Z,{ref:v,sx:{display:"flex",flexDirection:"column"},children:d.map((t,n)=>(0,p.jsxs)(E.Z,{sx:{border:"solid 1px black",borderRadius:2,p:1.5,display:"flex",flexDirection:"row",gap:1,alignContent:"center",alignItems:"center",background:"white",mb:1,boxSizing:"border-box"},children:[(0,p.jsxs)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pr:2},children:[t.title&&(0,p.jsx)(I.Z,{variant:"rankedListItemTitle",align:"left",children:t.title}),t.description&&(0,p.jsx)(I.Z,{variant:"rankedListItemDescription",align:"left",children:t.description})]}),(0,p.jsx)(E.Z,{onClick:()=>{h(t)},sx:{display:"flex",flexDirection:"column",background:y.palette.updinkBackground.main,color:y.palette.updinkText.main,p:.5,borderRadius:2,cursor:0===n?void 0:"pointer",opacity:0===n?0:1},children:(0,p.jsx)(eB.Z,{sx:{fontSize:"2rem"}})}),(0,p.jsx)(E.Z,{onClick:()=>{f(t)},sx:{display:"flex",flexDirection:"column",background:y.palette.downdinkBackground.main,color:y.palette.downdinkText.main,p:.5,borderRadius:2,cursor:n===d.length-1?void 0:"pointer",opacity:n===d.length-1?0:1},children:(0,p.jsx)(eU.Z,{sx:{fontSize:"2rem"}})})]},"ranked-list-".concat(e.qids.qid,"-option-").concat(t.key)))})]})})}var ez=n(2962);let eO=e=>{let t=parseInt(e.replace("#",""),16);return[t>>16&255,t>>8&255,255&t]},eL=(e,t,n,i)=>{let r=eO(n),s=eO(i),o=Math.round(r[0]+(s[0]-r[0])*e/t),a=Math.round(r[1]+(s[1]-r[1])*e/t),l=Math.round(r[2]+(s[2]-r[2])*e/t);return"rgb(".concat(o,",").concat(a,",").concat(l,")")},eG=e=>{let t={};return e.forEach(e=>{var n;null===(n=e.jsonValue)||void 0===n||n.answers.forEach(e=>{var n;let i=e.key,r=null!==(n=e.numericValue)&&void 0!==n?n:0;t.hasOwnProperty(i)||(t[i]=0),t[i]+=r})}),t},eK=(e,t)=>Object.entries(eG(e)).map(e=>{var n,i,r;return{key:e[0],title:null!==(r=null===(n=t.find(t=>t.key===e[0]))||void 0===n?void 0:n.title)&&void 0!==r?r:"",description:null===(i=t.find(t=>t.key===e[0]))||void 0===i?void 0:i.description,value:e[1]}});function eH(e){var t;let{answers:n}=(0,z.ZP)(e.qids.qid),[i,r]=(0,x.useState)([]),[s,o]=(0,x.useState)([]),[a,l]=(0,x.useState)([]),c=null!==(t=e.mode)&&void 0!==t?t:"normal";(0,x.useEffect)(()=>{r(null!=n?n:[])},[n]),(0,x.useEffect)(()=>{o(eK(i,e.options))},[i]),(0,x.useEffect)(()=>{let t=s.sort((e,t)=>e.value-t.value);"normal"===c&&(t=t.reverse()),l([...t.map((t,n)=>{var i,r;return{backgroundColor:eL(n,s.length,null!==(i=e.startColour)&&void 0!==i?i:d,null!==(r=e.endColour)&&void 0!==r?r:u),textColor:"#000000",option:t}})])},[s]);let d=(0,ee.Z)().palette.secondary.main,u="#FFFFFF";return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",flexDirection:"column",display:"flex",gap:1},children:[e.question&&(0,p.jsx)(R.Z,{content:e.question}),(0,p.jsx)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1,justifyContent:"start"},children:a.map((t,n)=>(0,p.jsx)(E.Z,{sx:{backgroundColor:t.backgroundColor,color:t.textColor,borderRadius:2,display:"flex",flexDirection:"column",p:2},children:(0,p.jsxs)(I.Z,{variant:"orderedListItemTitle",align:"left",children:[n+1,". ",t.option.title]})},"ordered-display-".concat(e.qids.qid,"-option-").concat(t.option.key,"-").concat(n)))})]})})}function eJ(e){let t=(0,ee.Z)(),n=1===e.headings.filter(e=>e.expanded).length;return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[e.question&&(0,p.jsx)(R.Z,{content:e.question,forceAlign:"left"}),e.headings.map((i,r)=>(0,p.jsxs)(E.Z,{sx:{flexGrow:i.expanded?1:void 0,flexBasis:i.expanded?0:void 0,display:"flex",flexDirection:"row",gap:2,p:2,alignItems:"stretch",backgroundColor:t.palette.summaryChartBackground.main,borderRadius:4},children:[i.expanded&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(E.Z,{sx:{display:"inline-block",borderRadius:2,flexGrow:0,flexShrink:0,flexBasis:n?"50%":"20%",backgroundImage:"url(".concat(i.graphic,")"),backgroundSize:"cover",backgroundPosition:"center",mr:2}}),(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"column",gap:2,alignSelf:"center"},children:[(0,p.jsx)(I.Z,{variant:"sectionHeadingTitle",align:"left",children:i.title}),i.description&&(0,p.jsx)(I.Z,{variant:"sectionHeadingDescription",align:"left",children:i.description})]})]}),!i.expanded&&(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(I.Z,{variant:"sectionHeadingTitleQuiet",align:"left",children:i.title})})]},"section-heading-".concat(e.uid,"-").concat(r)))]})})}var eY=n(20920);function eQ(e){return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"column",gap:2,...e.sx},children:e.children})})}var eX=n(44908),e$=n(65786),e0=n(19309);function e1(e){var t;let n=(0,x.useContext)(m.rZ),{answers:i}=(0,z.ZP)(e.qids.qid),[r,s]=(0,x.useState)((0,z.Zp)(i,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[o,a]=(0,x.useState)(!1),[l,c]=(0,x.useState)(!1),[d,u]=(0,x.useState)(!1);(0,x.useEffect)(()=>{var e,t,n;a(null!==(n=null===(t=r.jsonValue)||void 0===t?void 0:null===(e=t.answers.find(e=>"consent"===e.key))||void 0===e?void 0:e.booleanValue)&&void 0!==n&&n)},[r]),(0,x.useEffect)(()=>{c(o&&n.role===P._b.Client)},[o]);let h=t=>{if(!l){console.warn("Only participants can submit answers");return}u(!0);let n={...r,jsonValue:{answers:[{key:"consent",booleanValue:o},{key:"consentText",stringValue:e.consentText}]}};e.onAnswer(n).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),null!==e)s(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{u(!1)})};return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(U,{startBar:(0,p.jsx)(()=>(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(eX.Z,{control:(0,p.jsx)(e$.Z,{checked:o,onChange:(e,t)=>a(t)}),label:(0,p.jsx)("span",{style:{fontWeight:"bold",fontSize:"1.25rem"},children:e.consentText})})}),{}),endBar:(0,p.jsx)(()=>(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(W,{btnKey:"submit",btnText:"Submit",onClick:h,disabled:!l,busy:d})}),{}),children:[e.question&&(0,p.jsx)(R.Z,{content:e.question,forceAlign:"left",sx:{fontWeight:"bold"}}),e.content.map((t,n)=>(0,p.jsx)(I.Z,{variant:"consentBody",align:"left",dangerouslySetInnerHTML:{__html:(0,e0.Z)(t)}},"".concat(e.qids.qid,"-consent-body-").concat(n)))]})})}let e2=e=>({replace:(t,n)=>e5(t,e)}),e5=(e,t)=>{if(e instanceof k.W_&&e.attribs){var n;let i;switch(e.tagName.toLowerCase()){case"sidebarlayout":i=tw(e,t);break;case"fullpagescrollinglayout":i=tj(e,t);break;case"fullpagecentredlayout":i=tk(e,t);break;case"columnlayout":i=tS(e,t);break;case"slidebackgroundimage":i=tZ(e,t);break;case"imageslide":i=ty(e,t);break;case"videoslide":i=e9(e,t);break;case"summaryslidelayout":i=e8(e,t);break;case"sectionheading":i=tD(e,t);break;case"slidetext":i=tE(e,t);break;case"slideimage":case"img":i=tI(e,t);break;case"inputorcompletion":i=tv(e,t);break;case"inputsequence":i=tb(e,t);break;case"sliderinput":i=te(e,t);break;case"textinput":i=tr(e,t);break;case"demographicinput":i=tl(e,t);break;case"updownvoteinput":i=tc(e,t);break;case"closedchoiceinput":i=td(e,t);break;case"pointsallocationinput":i=tu(e,t);break;case"multisliderinput":i=th(e,t);break;case"acknowledgementinput":i=tp(e,t);break;case"rankedlistinput":i=tx(e,t);break;case"consentinput":i=tm(e,t);break;case"completion":i=tC(e,t);break;case"speechbubbles":i=ti(e,t);break;case"selectiongraph":i=tt(e,t);break;case"updownvoteresults":i=tn(e,t);break;case"topoptions":i=tf(e,t);break;case"orderedlist":i=tg(e,t);break;default:return e}return null!==(n=(0,Q.te)(i,t.keyPrefix))&&void 0!==n?n:i}},e4=(e,t)=>{let n=e.children.map((e,n)=>e2(t).replace(e,n)).filter(e=>null!=e&&!1!==e).map(e=>e instanceof k.W_?(0,k.du)([e],e2(t)):e);return x.Children.toArray(n)},e3=(e,t)=>{let n=[];for(let i of e.children.filter(e=>e instanceof k.W_).map(e=>e))void 0!==i.attribs.qid?n.push(e7(t,i)):n=[...n,...e3(i,t)];return n},e7=(e,t)=>{let n=t.attribs.qid;if(void 0===n)throw console.error("Question id not found for element",t),"Question id not found for element";return{sid:e.sessionId,pid:e.deviceId,qid:n}},e6=e=>{var t,n;let i=e.attribs.instruction,r=null!==(n=null!==(t=e.attribs.question)&&void 0!==t?t:e.attribs.statement)&&void 0!==n?n:e.attribs.prompt,s=e.attribs.explanation,o=(0,Z.gx)(e.attribs.pii);return i||r||s||void 0!==o?{instruction:i,question:r,explanation:s,pii:o}:void 0},e9=(e,t)=>{console.debug("Enriching VideoSlide tag as VideoSlide...",e);let n=e.attribs.id,i=e.attribs.videouri,r=e.attribs.posteruri,s=t.role===P._b.Controller,o=t.role===P._b.Controller||t.remoteMedia;return(0,p.jsx)(ef,{videoId:n,role:t.role,controls:s,audio:o,videoUri:i,posterUri:r})},e8=(e,t)=>{console.debug("Enriching SummarySlideLayout tag as SummarySlideLayout...",e);let n=e.attribs.title,i=e.attribs.prompt,r=void 0!==e.attribs.chartbackground?(0,Z.gx)(e.attribs.chartbackground):void 0,s=e4(e,t);return(0,p.jsx)(eu,{title:n,prompt:i,chartBackground:r,children:s})},te=(e,t)=>{var n;console.debug("Enriching SliderInput tag as SliderInput...",e);let i=e7(t,e),r=e6(e),s=(0,Q.av)(e.attribs.type),o=s===S.Q.categorical?(0,Q.kh)(e.attribs.marks):void 0,a=s!==S.Q.categorical?null===(n=(0,Q.kh)(e.attribs.range))||void 0===n?void 0:n.map(e=>(0,Q.f_)(e.trim())):void 0,l=s!==S.Q.categorical?(0,Q.f_)(e.attribs.step):void 0;return(0,p.jsx)(S.Z,{qids:i,role:t.role,type:s,marks:o,numericRange:a,numericStep:l,question:r,onAnswer:t.onAnswer})},tt=(e,t)=>{var n;console.debug("Enriching SelectionGraph tag as AnswerGraphMuiChart...",e);let i=e7(t,e),r=e6(e),s=(0,Q.yg)(e.attribs.orientation),o=(0,Q.ot)(e.attribs.type),a=null===(n=(0,Q.kh)(e.attribs.range))||void 0===n?void 0:n.map(e=>g().toNumber(e.trim())),l=(0,Q.tL)((0,Q.kh)(e.attribs.categories));if(i&&void 0!==o)return(0,p.jsx)(ez.Z,{role:t.role,qids:i,question:r,inputType:o,orientation:s,categories:l,range:a?{lo:a[0],hi:a[1],step:a[2]}:void 0});throw console.error("SelectionGraph without qIds, type, or range",e.attribs),"SelectionGraph without qIds, type, or range"},tn=(e,t)=>{console.debug("Enriching UpDownVoteResults tag as UpDownVoteResults...",e);let n=e.attribs.layout,i={};for(let t of e.children)if(t instanceof k.W_&&"result"===t.tagName){let e=t.attribs.qid,n=t.attribs.assertion;void 0!==e&&(i[e]={assertion:n})}return(0,p.jsx)(eD,{questions:i,layout:n})},ti=(e,t)=>{console.debug("Enriching SpeechBubbles tag as SpeechBubbles (with children)...",e);let n=e7(t,e),i=e6(e);return(0,p.jsx)(et,{qids:n,question:i})},tr=(e,t)=>{var n;let i;console.debug("Enriching TextInput tag as TextInput...",e);let r=e7(t,e),s=e6(e),o=(0,Q.H7)(e.attribs.type),a=e.attribs.label,l=e.attribs.help,c=e.attribs.submittext,d=e.attribs.skiptext,u=g().parseInt(e.attribs.mincheckboxes),h=(0,Z.gx)(null!==(n=e.attribs.textrequired)&&void 0!==n?n:"true"),x=[];for(let t of e.childNodes)if(t instanceof k.W_&&"information"===t.tagName&&(i={heading:t.attribs.heading,body:t.children}),t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.text,i=(0,Z.gx)(t.attribs.required);x.push({key:e,text:n,initial:!1,required:i,checked:!1})}if(void 0===s||void 0===s.pii)throw"pii not defined for TextInput";return(0,p.jsx)(C.Z,{qids:r,role:t.role,type:o,label:a,help:l,textRequired:h,minCheckboxes:u,information:i,onAnswer:t.onAnswer,checkboxes:x,question:s,submitText:c,skipText:d})},ts=e=>{let t=[];for(let n of e)if(n instanceof k.W_&&"demographicinputtype"===n.tagName){let e=n.attribs.key,i=n.attribs.label,r=n.attribs.layout,s=n.attribs.mode,o=n.attribs.textplaceholder,a=n.attribs.textvalidationregex,l=(0,Z.LC)(n.attribs.columns);if(e&&i&&s){let c=to(n.children);t.push({key:e,label:i,layout:r,layoutProps:void 0!==l?{columns:l}:void 0,groups:c,mode:s,textPlaceholder:o,textValidationRegex:a})}else throw console.warn("DemographicInputType without key, label, layout, or mode",n),"DemographicInput child without key, label, layout, or mode"}return t},to=e=>{let t=[];for(let n of e)if(n instanceof k.W_&&"demographicgroup"===n.tagName){let e=n.attribs.label;if(e){let i=ta(n.children);t.push({label:e,choices:i})}else throw console.warn("DemographicGroup without label",n),"DemographicGroup without label"}return t},ta=e=>{let t=[];for(let n of e)if(n instanceof k.W_&&"demographic"===n.tagName){let e=n.attribs.display,i=n.attribs.value;if(e&&i)t.push({display:e,key:i});else throw console.warn("Demographic without display or value",n),"Demographic without display or value"}return t},tl=(e,t)=>{console.debug("Enriching DemographicInput tag as DemographicInput...",e);let n=e7(t,e),i=e6(e),r=(0,Z.gx)(e.attribs.showage),s=(0,Z.gx)(e.attribs.showgender),o=(0,Z.gx)(e.attribs.showethnicity),a=e.attribs.showpostcode,l=ts(e.children);return(0,p.jsx)(O,{role:t.role,qids:n,onAnswer:t.onAnswer,question:i,showAge:r,showGender:s,showEthnicity:o,showPostcode:a,customDemographics:l})},tc=(e,t)=>{console.debug("Enriching UpDownVoteInput tag as UpDownVoteInput...",e);let n=e7(t,e),i=e6(e),r=e.attribs.assertion;return(0,p.jsx)(eS,{qids:n,role:t.role,question:i,assertion:r,onAnswer:t.onAnswer})},td=(e,t)=>{console.debug("Enriching ClosedChoiceInput tag as ClosedChoiceInput...",e);let n=e7(t,e),i=e6(e),r=parseInt(e.attribs.minselections),s=parseInt(e.attribs.maxselections),o=e.attribs.layout,a=e.attribs.layoutparams,l=a?(0,Q.kh)(a):[],c=[],d=(0,Z.gx)(e.attribs.shuffle);for(let t of e.children)if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.value,n=t.attribs.display,i=t.attribs.graphic,r=(0,Z.gx)(t.attribs.isalt);e&&n&&c.push({key:e,display:n,graphic:i,isAlt:r})}return(0,p.jsx)(ed,{qids:n,role:t.role,question:i,options:c,shuffle:d,onAnswer:t.onAnswer,layout:o,layoutParams:l,minSelections:r,maxSelections:s,contentStore:t.contentStore})},tu=(e,t)=>{console.debug("Enriching PointsAllocationInput tag as PointsAllocationInput...",e);let n=e7(t,e),i=e6(e),r=parseInt(e.attribs.points),s=[];for(let t of e.children)if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.title,n=t.attribs.description,i=t.attribs.key,r=parseInt(t.attribs.min),o=parseInt(t.attribs.max),a=t.attribs.graphic;if(e&&n&&i&&void 0!==r&&void 0!==o)s.push({title:e,description:n,key:i,min:r,max:o,graphic:a});else throw"PointsAllocationInput Option without title, description, key, min, or max"}return(0,p.jsx)(eP,{qids:n,question:i,points:r,options:s,onAnswer:t.onAnswer})},th=(e,t)=>{console.debug("Enriching MultiSliderInput tag as MultiSliderInput...",e);let n=e7(t,e),i=e6(e),r=parseInt(e.attribs.min),s=parseInt(e.attribs.max),o=[],a=[],l=(0,Z.gx)(e.attribs.showdescriptions);for(let t of e.children)if(t instanceof k.W_&&"label"===t.tagName){let e=parseFloat(t.attribs.at),n=t.attribs.text;void 0!==e&&n&&o.push({at:e,text:n})}else if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;e&&n&&a.push({key:e,title:n,description:i})}return(0,p.jsx)(eq,{qids:n,question:i,min:r,max:s,labels:o,options:a,showDescriptions:l,role:t.role,onAnswer:t.onAnswer})},tp=(e,t)=>{console.debug("Enriching AcknowledgementInput tag as AcknowledgementInput...",e);let n=e7(t,e),i=e6(e),r=e.attribs.align,s=[];for(let t of e.children)if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.text,n=t.attribs.key,i=t.attribs.variant,r=t.attribs.colour;e&&n&&s.push({text:e,key:n,variant:i,colour:r})}return(0,p.jsx)(eF,{qids:n,question:i,options:s,align:r,onAnswer:t.onAnswer})},tx=(e,t)=>{console.debug("Enriching RankedListInput tag as RankedListInput...",e);let n=e7(t,e),i=e6(e),r=[],s=(0,Z.gx)(e.attribs.shuffle),o=0;for(let t of e.children)if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;n&&r.push({key:e,title:n,description:i,startingIndex:o++})}return(0,p.jsx)(eM,{qids:n,question:i,options:r,shuffle:s,onAnswer:t.onAnswer})},tm=(e,t)=>{console.debug("Enriching ConsentInput tag as ConsentInput...",e);let n=e7(t,e),i=e6(e),r=e.attribs.consenttext;return(0,p.jsx)(e1,{qids:n,question:i,consentText:r,onAnswer:t.onAnswer,content:e.children})},tf=(e,t)=>{console.debug("Enriching TopOptions tag as TopOptionsSummary...",e);let n=e7(t,e),i=e6(e),r=parseInt(e.attribs.count),s=[];for(let t of e.children)if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description,r=t.attribs.graphic;e&&n&&i&&s.push({key:e,title:n,description:i,graphic:r})}return(0,p.jsx)(eR,{qids:n,question:i,options:s,displayCount:r})},tg=(e,t)=>{console.debug("Enriching OrderedList tag as OrderedListDisplay...",e);let n=e7(t,e),i=e6(e),r=e.attribs.startcolour,s=e.attribs.endcolour,o=e.attribs.mode,a=[];for(let t of e.children)if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;if(e&&n)a.push({key:e,title:n,description:i});else throw console.warn("OrderedList option without key or title",t),"OrderedList option without key or title"}return(0,p.jsx)(eH,{qids:n,question:i,options:a,role:t.role,startColour:r,endColour:s,mode:o})},ty=(e,t)=>{console.debug("Enriching ImageSlide tag as ImageSlide...",e);let n=e.attribs.src,i=(0,Q.Cc)(e.attribs.style);return(0,p.jsx)(L,{style:i,src:n})},tv=(e,t)=>{let n=e4(e,t);console.debug("Enriching InputOrCompletion tag as InputOrCompletion (with children)...",n);let i=e7(t,e);return(0,p.jsx)(K,{qids:i,input:n[0],completion:n[1]})},tb=(e,t)=>{let n=e4(e,t);console.debug("Enriching InputSequence tag as InputSequence (with children)...",n);let i=[];for(let e=0;e<n.length-1;e++)i.push(n[e]);let r=n[n.length-1],s=e6(e),o=(0,Z.gx)(e.attribs.showprogress),a=e3(e,t);return(0,p.jsx)(ev,{question:s,showProgress:o,qids:a,inputs:i,completion:r,role:t.role})},tw=(e,t)=>{console.debug("Enriching SideBarLayout tag as SideBarLayout (with children)...",e);let n=e4(e,t),i=(0,Q.if)(e.attribs.sidestyle),r=(0,Q.if)(e.attribs.mainstyle),s=e.attribs.sidebackgroundimage,o=e.attribs.mainbackgroundimage;return(0,p.jsx)(G,{side:n[0],sideSx:i,main:n[1],mainSx:r,sideBackgroundImage:s,mainBackgroundImage:o,contentStore:t.contentStore})},tj=(e,t)=>{console.debug("Enriching FullPageScrollingLayout tag as FullPageScrollingLayout (with children)...",e);let n=(0,Q.if)(e.attribs.sx),i=e4(e,t);return(0,p.jsx)(J,{sx:n,children:i})},tk=(e,t)=>{console.debug("Enriching FullPageCentredLayout tag as FullPageCentredLayout (with children)...",e);let n=(0,Q.if)(e.attribs.sx),i=e4(e,t);return(0,p.jsx)(en,{sx:n,children:i})},tS=(e,t)=>{console.debug("Enriching ColumnLayout tag as ColumnLayout (with children)...",e);let n=(0,Q.if)(e.attribs.sx),i=e4(e,t);return(0,p.jsx)(eQ,{sx:n,children:i})},tZ=(e,t)=>{console.debug("Enriching SlideBackgroundImage tag as SlideBackgroundImage (with children)...",e);let n=e4(e,t),i=e.attribs.src,r=(0,Q.if)(e.attribs.sx);return(0,p.jsx)(X,{src:i,sx:r,children:n})},tC=(e,t)=>{console.debug("Enriching Completion tag as CompletionDisplay (with children)...",e);let n=e.attribs.message,i=e.attribs.factoid,r=(0,Q.if)(e.attribs.sx);return(0,p.jsx)(H,{content:{message:n,factoid:i},sx:r})},tD=(e,t)=>{console.debug("Enriching SectionHeading tag as SectionHeading...",e);let n=(0,eY.Z)(),i=e6(e),r=[];for(let t of e.children)if(t instanceof k.W_&&"heading"===t.tagName){let e=t.attribs.title,n=t.attribs.description,i=t.attribs.graphic,s=(0,Z.gx)(t.attribs.expanded);if(e)r.push({title:e,description:n,graphic:i,expanded:s});else throw console.warn("SectionHeading without title",t),"SectionHeading without title"}return(0,p.jsx)(eJ,{question:i,headings:r,uid:n})},tE=(e,t)=>{console.debug("Enriching SlideText tag as SlideText (with children)...",e);let n=e4(e,t),i=(0,Q.if)(e.attribs.sx),r=e.attribs.color,s=e.attribs.align,o=e.attribs.variant;return(0,p.jsx)(Y,{variant:o,sx:i,color:r,align:s,children:n})},tI=(e,t)=>{console.debug("Enriching ImageSlide tag as ImageSlide...",e);let n=e.attribs.src,i=(0,Q.Cc)(e.attribs.style);return(0,p.jsx)($,{src:n,style:i})};(a=h||(h={}))[a.Init=0]="Init",a[a.RetrievingRawSlides=1]="RetrievingRawSlides",a[a.RawSlidesError=2]="RawSlidesError",a[a.EnrichingSlides=3]="EnrichingSlides",a[a.EnrichmentError=4]="EnrichmentError",a[a.InflatingSlides=5]="InflatingSlides",a[a.InflationError=6]="InflationError",a[a.Ready=7]="Ready";let tP=[0,1],tq=[2,4,6],tA=[3,5],t_=(0,x.createContext)({});function tT(e){let{api:t,start:n}=(0,x.useContext)(em.E),{session:i}=(0,x.useContext)(ex.z),r=(0,x.useContext)(m.rZ),[s,o]=(0,x.useState)(0),[a,l]=(0,x.useState)([]),[c,d]=(0,x.useState)([]),[u,f]=(0,x.useState)(void 0),[g,v]=(0,x.useState)(!0),[b,S]=(0,x.useState)(!1),[Z,C]=(0,x.useState)(!1);(0,x.useEffect)(()=>{switch(console.debug("Static content state",h[s]),s){case 0:o(1);break;case 1:D().then(e=>{l(e),o(3)}).catch(e=>{console.error(e),o(2)});break;case 3:I().then(e=>{d(e),o(5)}).catch(e=>{console.error(e),o(4)});break;case 5:q().then(e=>{f(e),o(7)}).catch(e=>{console.error(e),o(6)})}v(void 0!==tP.find(e=>e===s)),S(void 0!==tA.find(e=>e===s)),C(void 0!==tq.find(e=>e===s))},[s]);let D=async()=>{let e=[];for(let s of i.sessionPresentationUris||[]){if(!s)throw"Presentation link empty in session data.";let o=new y(t,n,i,r.sessionToken,s,!0);await o.init();let a=s.split("/").pop(),l=await o.getAsEntry(a,void 0),c=await l.content.text();if(!c)throw"No content found in presentation file.";e.push(c)}return e},E=e=>{j.Z.emit({type:j.z.Content_Progress_Update,data:e})},I=async()=>{let s=[];for(let o=0;o<a.length;o++){let l=i.sessionPresentationUris[o],c=a[o];if(!l)throw"Presentation link empty in session data.";let d=new y(t,n,i,r.sessionToken,l,e.refresh);await d.init();let u=new w(c,d,E),h=u.findAllReplacements(void 0,[]);console.debug("".concat(h.length," unique resources to replace"),h);let p=await u.replaceAllReplacements(h),x=u.getAsSectionTags(p,o);if(!x)throw"No sections found in presentation.";s.push(x)}return s},q=async()=>{let s=[];for(let o=0;o<c.length;o++){let a=i.sessionPresentationUris[o],l=c[o];if(!a)throw"Presentation link empty in session data.";if(!l)throw"No content found in presentation xml.";let d=new y(t,n,i,r.sessionToken,a,e.refresh);await d.init();let u={sessionId:i.id,deviceId:r.deviceId,role:r.role,remoteMedia:i.remoteConfiguration!==P.VS.InPerson,remoteCall:i.remoteConfiguration===P.VS.RemoteWithVideoCall,keyPrefix:"module-".concat(o),contentStore:d,onAnswer:A},h=(0,k.ZP)(l,e2(u)),p=(h instanceof Array?h:[h]).map((e,t)=>(0,Q.te)(e,"module-".concat(o))).filter(e=>void 0!==e);s.push(...p)}return s},A=async i=>await n(t.postDeliberationAnswer(e.sid,i,r.sessionToken));return(0,p.jsxs)(p.Fragment,{children:[g&&e.initialising,b&&e.loading,Z&&e.error,7===s&&(0,p.jsx)(t_.Provider,{value:{sid:e.sid,presentationXml:c,sourceXml:a,slides:u},children:e.children})]})}},37570:function(e,t,n){"use strict";n.d(t,{H:function(){return x},Z:function(){return m}});var i,r,s=n(57437),o=n(2265),a=n(5085),l=n(20909),c=n(94547),d=n(1973);(i=r||(r={}))[i.Init=0]="Init",i[i.RetrievingSession=1]="RetrievingSession",i[i.RetrievingGraphic=2]="RetrievingGraphic",i[i.SessionError=3]="SessionError",i[i.Ready=4]="Ready";let u=[3],h=[0],p=[1,2],x=(0,o.createContext)({});function m(e){let{api:t,start:n}=(0,o.useContext)(d.E),i=(0,o.useContext)(a.rZ),[m,f]=(0,o.useState)(0),[g,y]=(0,o.useState)(),[v,b]=(0,o.useState)(),[w,j]=(0,o.useState)(!0),[k,S]=(0,o.useState)(!1),[Z,C]=(0,o.useState)(!1);(0,o.useEffect)(()=>{switch(console.debug("Static data state",r[m]),m){case 0:f(1);break;case 1:D().then(e=>{y(e),f(2)}).catch(e=>{console.error(e),f(3)});break;case 2:E().then(e=>{b(e),f(4)}).catch(e=>{console.error(e),f(3)})}S(void 0!==p.find(e=>e===m)),C(void 0!==u.find(e=>e===m)),j(void 0!==h.find(e=>e===m))},[m]);let D=async()=>i.role===c._b.Controller?await n(t.getDeliberationSessionAdmin(e.sid,i.user.access_token,void 0)):await n(t.getDeliberationSession(e.sid,void 0)),E=async()=>{let e={workshopDirectory:(0,l.X)(g.sessionPresentationUris[0])};return await n(t.postPublicContentAccessRequest(g.id,e))};return(0,s.jsxs)(s.Fragment,{children:[w&&e.initialising,k&&e.loading,Z&&e.error,4===m&&(0,s.jsx)(x.Provider,{value:{sid:g.id,session:g,graphic:v},children:e.children})]})}},75511:function(e,t,n){"use strict";n.d(t,{z:function(){return r}});var i,r,s=n(37836),o=n.n(s);(i=r||(r={})).Request_SlideRefresh="REQUEST_SLIDE_REFRESH",i.WSS_Update_ConnectionState="WSS_UPDATE_CONNECTION_STATE",i.WSS_Distribute_Message="WSS_DISTRIBUTE_MESSAGE",i.Content_Progress_Update="CONTENT_PROGRESS_UPDATE";let a=new(o()),l={on:(e,t)=>a.on(e,t),once:(e,t)=>a.once(e,t),off:(e,t)=>a.off(e,t),emit:e=>a.emit(e.type,e)};Object.freeze(l),t.Z=l},64463:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var i=n(57437),r=n(44228),s=n(42748),o=n(11656),a=n(47905),l=n(86917),c=n(14595),d=n(31193),u=n(60335),h=n(21395),p=n(24072),x=n(76396);function m(e){let t=t=>{e.onVideoPreferenceChange(e.videoEnabled,t)},n=t=>{e.onAudioPreferenceChange(e.audioEnabled,t)},m=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(o.Z,{children:(0,i.jsx)(a.Z,{inset:!0,children:(0,i.jsx)("b",{children:"Video camera inputs"})})},"video-heading"),e.videoDevices.map(n=>{var s;let c=(null===(s=e.videoDevice)||void 0===s?void 0:s.deviceId)===(null==n?void 0:n.deviceId);return(0,i.jsxs)(o.Z,{onClick:()=>t(n),children:[c&&(0,i.jsx)(l.Z,{children:(0,i.jsx)(r.Z,{})}),(0,i.jsx)(a.Z,{inset:!c,children:n.label})]},"menu-item-select-".concat(n.deviceId))})]}),(0,i.jsx)(c.Z,{}),(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(o.Z,{children:(0,i.jsx)(a.Z,{inset:!0,children:(0,i.jsx)("b",{children:"Microphone inputs"})})},"audio-heading"),e.audioDevices.map(t=>{var s;let c=(null===(s=e.audioDevice)||void 0===s?void 0:s.deviceId)===(null==t?void 0:t.deviceId);return(0,i.jsxs)(o.Z,{onClick:()=>n(t),children:[c&&(0,i.jsx)(l.Z,{children:(0,i.jsx)(r.Z,{})}),(0,i.jsx)(a.Z,{inset:!c,children:t.label})]},"menu-item-select-".concat(t.deviceId))})]})]});return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Z,{display:"flex",flexDirection:e.direction,justifyContent:"center",children:[(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":e.audioEnabled?"mute microphone":"enable microphone",onClick:()=>{e.onAudioPreferenceChange(!e.audioEnabled,e.audioDevice)},children:(0,i.jsx)("img",{src:e.audioEnabled?"/icons/av/mic-enabled.svg":"/icons/av/mic-disabled.svg"})}),(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":e.videoEnabled?"disable camera":"enable camera",onClick:()=>{e.onVideoPreferenceChange(!e.videoEnabled,e.videoDevice)},children:(0,i.jsx)("img",{src:e.videoEnabled?"/icons/av/cam-enabled.svg":"/icons/av/cam-disabled.svg"})}),(0,i.jsx)(p.ZP,{variant:"popover",popupId:"audio-popup",children:t=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":"settings",...(0,x.vW)(t),children:(0,i.jsx)("img",{src:"/icons/av/cog-enabled.svg"})}),(0,i.jsx)(h.Z,{...(0,x.wK)(t),children:(0,i.jsx)(m,{})})]})})]})})}},31164:function(e,t,n){"use strict";n.d(t,{Z:function(){return v}});var i,r,s=n(57437),o=n(2265),a=n(94547),l=n(8963),c=n(6722),d=n(11707),u=n(31193),h=n(96537),p=n(40468);n(84075);var x=e=>{let{tileId:t}=(0,c.tt7)(),{tiles:n}=(0,c.akC)(),{tileId:i}=(0,c.EJc)(),{isVideoEnabled:r}=(0,c.Onx)(),o="featured"===e.layout&&!!t||!!i,a=n.length+(i?1:0),l=a>1&&r?a+1:a;return(0,s.jsxs)(c.P2B,{size:l,layout:o?"featured":null,style:e.gridStyle,children:[(0,s.jsx)(c.Fxf,{css:"grid-area: ft;"}),"featured"===e.layout?(0,s.jsx)(c.mXs,{}):(0,s.jsx)(c.P$F,{}),(0,s.jsx)(c.OuP,{nameplate:"Me",css:l>1?"\n  height: 100%;\n  width: 100%;\n":"\n  display: flex;\n  position: absolute;\n  bottom: 1rem;\n  right: 1rem;\n  width: 20vw;\n  max-height: 30vh;\n  height: auto;\n\n  video {\n    position: static;\n  }\n"}),0===a&&e.noRemoteVideoView]})},m=n(70883),f=n(1973);(i=r||(r={}))[i.Init=0]="Init",i[i.FetchingAttendeeData=1]="FetchingAttendeeData",i[i.AttendeeDataRetrieved=2]="AttendeeDataRetrieved",i[i.AttendeeDataError=3]="AttendeeDataError",i[i.MeetingConnecting=4]="MeetingConnecting",i[i.MeetingConnected=5]="MeetingConnected",i[i.MeetingStarting=6]="MeetingStarting",i[i.MeetingStarted=7]="MeetingStarted",i[i.MeetingLeft=8]="MeetingLeft",i[i.MeetingUnavailable=9]="MeetingUnavailable",i[i.ChimeError=10]="ChimeError",i[i.ConnectedOnAnotherDevice=11]="ConnectedOnAnotherDevice";let g={unexpected:!1,anotherDevice:!1,unavailable:!1,left:!1},y={deviceLabels:c.C$T.AudioAndVideo};function v(e){let[t,n]=(0,o.useState)(0),[i,v]=(0,o.useState)(),[b,w]=(0,o.useState)(),[j,k]=(0,o.useState)(),[S,Z]=(0,o.useState)(g),C=(0,c.fjl)();(0,c.tt7)();let{tileId:D,isVideoEnabled:E,hasReachedVideoLimit:I,toggleVideo:P}=(0,c.Onx)(),q=(0,c.HI)(),A=(0,c.ULf)(),_=(0,c.QvM)(),{api:T,start:R}=(0,o.useContext)(f.E),F=(0,o.useContext)(m.l),[B,U]=(0,o.useState)(F.subscriptions);(0,o.useEffect)(()=>{U(F.subscriptions)},[F]),(0,o.useEffect)(()=>{var t,n;console.debug("initial call prefrerences",e.initialCallPreferences),(null===(t=e.initialCallPreferences)||void 0===t?void 0:t.videoDevice)!==void 0&&C.startVideoInputDevice(e.initialCallPreferences.videoDevice.deviceId),(null===(n=e.initialCallPreferences)||void 0===n?void 0:n.audioDevice)!==void 0&&C.startAudioInputDevice(e.initialCallPreferences.audioDevice.deviceId)},[]);let N=(0,o.useMemo)(()=>async(e,t)=>{void 0===t&&console.warn("Undefined pid passed from chime.");var n,i=B.find(e=>e.deviceId===t);return void 0===i&&console.warn("No subscription found for pid: ".concat(t),B),{name:null!==(n=null==i?void 0:i.participantName)&&void 0!==n?n:"Unknown"}},[B]);(0,o.useEffect)(()=>{C.getAttendee=N,C.updateDeviceLists()},[B]),(0,o.useEffect)(()=>(C.subscribeToMeetingStatus(W),()=>{console.log("Unmounting ZeitgeistMeeting..."),C.getAttendee=void 0,C.leave(),C.unsubscribeFromMeetingStatus(W)}),[]);let W=e=>{console.debug("Meeting status change detected: ".concat(c.ytK[e])),k(e)},V=e.role===a._b.Controller||e.facilitationState===a._y.Open;(0,o.useEffect)(()=>{console.debug("Facilitation state changed to: ".concat(a._y[e.facilitationState])),V&&0!==t&&1!==t&&n(1),V||(console.debug("disconnecting..."),w(null))},[e.facilitationState]),(0,o.useEffect)(()=>{switch(console.debug("ZeitgeistMeeting view state: ".concat(r[t])),t){case 0:V&&n(1);break;case 1:Z(g),M().then(e=>{(null==e?void 0:e.chimeMeetingId)!==(null==i?void 0:i.chimeMeetingId)&&v(e),e?n(2):n(3)}).catch(e=>{console.error(e)});break;case 2:Z(g),n(4);break;case 3:case 10:Z({...g,unexpected:!0});break;case 4:Z(g);let s=z();(null==b?void 0:b.meetingId)!==s.meetingId||j!==c.ytK.Succeeded?w(s):n(5);break;case 5:Z(g),n(6);break;case 6:Z(g),O();break;case 7:Z(g);break;case 9:e.role===a._b.Controller?(Z(g),n(1)):Z({...g,unavailable:!0});break;case 8:Z({...g,left:!0});break;case 11:Z({...g,anotherDevice:!0})}},[t,e.facilitationState]);let M=async()=>{var t;let n=await R(T.retrieveMeetingAttendeeData(e.sid,e.sessionToken,e.participantId,null!==(t=e.participantName)&&void 0!==t?t:"unknown",e.accessToken));return console.debug("Retrieved attendee data",n),n},z=()=>new l.MeetingSessionConfiguration({MeetingId:i.chimeMeetingId,MediaPlacement:{AudioHostUrl:i.audioHostUrl,SignalingUrl:i.signalingUrl,TurnControlUrl:i.turnControlUrl,AudioFallbackUrl:i.audioFallbackUrl,EventIngestionUrl:i.eventIngestionUrl,ScreenDataUrl:i.screenDataUrl,ScreenViewingUrl:i.screenViewingUrl}},{ExternalUserId:i.chimeAttendeeExternalId,AttendeeId:i.chimeAttendeeId,JoinToken:i.chimeJoinToken});(0,o.useEffect)(()=>{console.debug("Config change"),null!=b?C.join(b,y).then(()=>{n(5)}):C.leave()},[b]),(0,o.useEffect)(()=>{switch(console.debug("Acting on meeting status: ".concat(void 0!==j?c.ytK[j]:"undefined")),j){case c.ytK.Loading:break;case c.ytK.Succeeded:n(7);break;case c.ytK.Reconnecting:n(4);break;case c.ytK.Left:n(8);break;case c.ytK.Failed:n(10);break;case c.ytK.Ended:n(9);break;case c.ytK.TerminalFailure:n(10);break;case c.ytK.JoinedFromAnotherDevice:n(11)}},[j]);let O=async()=>{console.debug("Starting the meeting from state: ".concat(void 0!==j?c.ytK[j]:"undefined"));try{await C.start(),n(7)}catch(e){console.error(e),n(10)}},L=async()=>{try{if(void 0!==A.selectedDevice&&_.isBackgroundBlurSupported){let e=await _.createBackgroundBlurDevice(A.selectedDevice);await C.startVideoInputDevice(e)}else console.warn("No video input device found to enable Background Blur.")}catch(e){console.error("Failed to enable Background Blur",e)}};return(0,o.useEffect)(()=>{j===c.ytK.Succeeded&&(console.debug("Configuring meeting with initial prefererences",e.initialCallPreferences),e.initialCallPreferences?(e.initialCallPreferences.videoEnabled!==E&&P(),e.initialCallPreferences.audioEnabled===q.muted&&q.toggleMute(),e.initialCallPreferences.blurBackground&&L()):E||P())},[j]),e.role,a._b.Controller,e.role,a._b.Client,(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",...e.sx},children:[S.unexpected&&(0,s.jsx)("p",{children:"An unexpected error prevented us from connecting you to the video call. Please refresh the page."}),S.anotherDevice&&(0,s.jsx)("p",{children:"You are already connected in another tab. Please close any other browser tabs connected to this workshop."}),S.unavailable&&(0,s.jsx)("p",{children:"The video call is not available at this time. Please try again later."}),S.left&&(0,s.jsx)("p",{children:"You have left the video call."}),11===t&&(0,s.jsx)(h.Z,{variant:"outlined",onClick:()=>n(1),children:"Try again"}),3===t&&(0,s.jsx)(h.Z,{variant:"outlined",onClick:()=>n(1),children:"Try again"}),9===t&&(0,s.jsx)(h.Z,{variant:"outlined",onClick:()=>n(1),children:"Try again"}),8===t&&(0,s.jsx)(h.Z,{variant:"outlined",onClick:()=>n(1),children:"Rejoin"}),10===t&&(0,s.jsx)(h.Z,{variant:"outlined",onClick:()=>n(4),children:"Try again"}),0>[7,8,9,10,11].indexOf(t)&&(0,s.jsx)(u.Z,{display:"flex",flexGrow:1,justifyContent:"center",alignItems:"center",children:(0,s.jsx)(p.Z,{})}),j===c.ytK.Succeeded&&(0,s.jsx)(d.f6,{theme:c.Wbj,children:(0,s.jsx)(u.Z,{sx:{width:"100%",height:"100%",flexGrow:1,display:"flex",flexDirection:"row"},children:(0,s.jsx)(x,{layout:"standard",noRemoteVideoView:(0,s.jsx)(s.Fragment,{}),gridStyle:{gap:"0.5rem"}})})})]})})}},79044:function(e,t,n){"use strict";n.d(t,{K:function(){return g},Z:function(){return y}});var i,r,s=n(57437),o=n(2265),a=n(24314),l=n(31193),c=n(80511),d=n(66858),u=n(49752);function h(e){let[t,n]=(0,o.useState)(""),[i,r]=(0,o.useState)(!1),a=i&&0===t.trim().length,h=!a&&t.trim().length>0,p=()=>{h&&e.submitName(t)};return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(l.Z,{children:[(0,s.jsx)(c.Z,{variant:"h4",children:"How should we refer to you?"}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),p()},children:[(0,s.jsx)(d.Z,{sx:{mb:4,input:{background:"white"}},fullWidth:!0,style:{flexGrow:1},label:"Please enter your name...",variant:"outlined",value:t,autoComplete:"off",autoFocus:!0,helperText:"Your name is purely for use within the session. It will not be saved or stored.",onChange:e=>{n(e.target.value),r(!0)},error:a,color:"buttonStandard"}),(0,s.jsx)(u.Z,{inline:!1,alignment:"left",busy:!1,enabled:h,onSubmit:p,text:"Continue"})]})]})})}var p=n(34360),x=n(43655),m=n(43312),f=n(11144);(i=r||(r={}))[i.InputName=0]="InputName",i[i.Ready=1]="Ready";let g=(0,o.createContext)({});function y(e){let{session:t,graphic:n}=(0,o.useContext)(f.z),[i,r]=(0,o.useState)(0),[l,c]=(0,o.useState)(),d=(0,o.useMemo)(()=>(0,s.jsx)(p.Z,{url:n.posterUrl}),[n.posterUrl]),u=(0,o.useCallback)(e=>{c(e),r(1)},[c,r]);return(0,s.jsxs)(s.Fragment,{children:[1!==i&&(0,s.jsx)(x.Z,{heading:(0,s.jsx)(m.Z,{session:t,layout:"heading",welcome:!0}),main:(0,s.jsx)(s.Fragment,{children:0===i&&(0,s.jsx)(a.Z,{left:(0,s.jsx)(h,{submitName:u}),right:d})})}),1===i&&(0,s.jsx)(g.Provider,{value:{participantName:l},children:e.children})]})}},68276:function(e,t,n){"use strict";n.d(t,{u:function(){return k},Z:function(){return S}});var i,r,s=n(57437),o=n(2265),a=n(94547),l=n(31193),c=n(96537),d=n(6820),u=n.n(d),h=n(64463);let p={videoEnabled:!0,audioEnabled:!0,videoDevice:void 0,audioDevice:void 0,blurBackground:!1};function x(e){let[t,n]=o.useState([]),[i,r]=o.useState([]),[a,d]=o.useState(void 0),[p,x]=o.useState(void 0),[m,f]=o.useState(!0),[g,y]=o.useState(!0);(0,o.useEffect)(()=>{void 0!==navigator&&navigator.mediaDevices.enumerateDevices().then(e=>{n(v(e)),r(b(e))})},[]),(0,o.useEffect)(()=>{e.onPreferences({videoEnabled:m,audioEnabled:g,videoDevice:a,audioDevice:p,blurBackground:!1})},[m,g,a,p]);let v=e=>e.filter(e=>{let{kind:t}=e;return"videoinput"===t}),b=e=>e.filter(e=>{let{kind:t}=e;return"audioinput"===t}),w={maxWidth:"100%",maxHeight:"100%",width:"auto"},j={height:320,facingMode:a?void 0:"user",deviceId:null==a?void 0:a.deviceId};return(0,s.jsxs)(l.Z,{display:"flex",flexDirection:"column",flexGrow:1,children:[(0,s.jsx)(()=>(0,s.jsx)(l.Z,{sx:{borderRadius:2,p:1,mb:2,background:"#d9d9d9",display:"flex",flexDirection:"column",alignItems:"center",justifyItems:"stretch"},children:(0,s.jsx)("div",{style:{...w},children:m&&(0,s.jsx)(u(),{mirrored:!0,style:w,videoConstraints:j})})}),{}),(0,s.jsx)(()=>(0,s.jsxs)(l.Z,{display:"flex",flexDirection:"row",justifyContent:"center",gap:2,children:[(0,s.jsx)(h.Z,{direction:"row",videoEnabled:m,audioEnabled:g,videoDevices:t,audioDevices:i,videoDevice:a,audioDevice:p,onVideoPreferenceChange:async(e,t)=>{f(e),d(t)},onAudioPreferenceChange:async(e,t)=>{y(e),x(t)},busy:!1}),e.showJoin&&(0,s.jsx)(c.Z,{variant:"contained",size:"large",sx:{alignSelf:"center"},onClick:e.onJoin,children:"JOIN"}),e.showLeave&&(0,s.jsx)(c.Z,{variant:"outlined",size:"large",sx:{alignSelf:"center"},onClick:e.onLeave,children:"LEAVE"})]}),{})]})}var m=n(27270),f=n(5085),g=n(24314),y=n(34360),v=n(43655),b=n(43312),w=n(79044),j=n(11144);(i=r||(r={}))[i.Init=0]="Init",i[i.PreviewMedia=1]="PreviewMedia",i[i.NoPreview=2]="NoPreview";let k=(0,o.createContext)({});function S(e){let{session:t,graphic:n}=(0,o.useContext)(j.z),i=(0,o.useContext)(w.K),c=(0,o.useContext)(f.rZ),[d,u]=(0,o.useState)(0),[h,S]=(0,o.useState)(!1),[Z,C]=(0,o.useState)(p),[D,E]=(0,o.useState)(!1);(0,o.useEffect)(()=>{switch(console.debug("Media preview state",r[d]),d){case 0:u(t.remoteConfiguration===a.VS.RemoteWithVideoCall?1:2);break;case 2:S(!0)}},[d]),(0,o.useEffect)(()=>{E((2===d||1===d)&&(t.facilitationState===a._y.Open||c.role===a._b.Controller)&&h)},[h,d,t.facilitationState]);let I=t.facilitationState===a._y.Ready,P=t.facilitationState===a._y.Closed,q=(0,o.useMemo)(()=>(0,s.jsx)(y.Z,{url:n.posterUrl}),[n.posterUrl]);return(0,s.jsxs)(s.Fragment,{children:[!D&&(0,s.jsxs)(s.Fragment,{children:[1===d&&(0,s.jsx)(v.Z,{heading:(0,s.jsx)(b.Z,{session:t,layout:"heading",welcome:!0}),main:(0,s.jsx)(g.Z,{left:(0,s.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[!h&&c.role!==a._b.Controller&&(0,s.jsxs)(m.Z,{severity:"info",children:["Please check your settings and press the ",(0,s.jsx)("b",{children:"join"})," button when ready."]}),h&&(0,s.jsx)(m.Z,{severity:"success",children:"Please wait for the workshop to open."}),!I&&!P&&(0,s.jsx)(m.Z,{severity:"success",children:"The workshop has started."}),c.role!==a._b.Controller&&I&&!P&&(0,s.jsx)(m.Z,{severity:"info",children:"The workshop will begin soon..."}),c.role===a._b.Controller&&(0,s.jsx)(m.Z,{severity:"info",children:"You are the facilitator. The session will begin once you open it."}),P&&(0,s.jsx)(m.Z,{severity:"warning",children:"The workshop has closed."}),!P&&(0,s.jsx)(x,{name:i.participantName,session:t,showJoin:!h,showLeave:h,onJoin:()=>{S(!0)},onLeave:()=>{S(!1)},onPreferences:C})]}),right:q})}),2===d&&(0,s.jsx)(v.Z,{heading:(0,s.jsx)(b.Z,{session:t,layout:"heading",welcome:!0}),main:(0,s.jsx)(g.Z,{left:(0,s.jsxs)(s.Fragment,{children:[I&&(0,s.jsx)(m.Z,{severity:"success",children:"Please wait, the session will begin soon..."}),P&&(0,s.jsx)(m.Z,{severity:"info",children:"The session has ended. Thank you for participating!"})]}),right:q})})]}),D&&(0,s.jsx)(k.Provider,{value:{call:Z},children:e.children})]})}},43312:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(57437),r=n(31193),s=n(80511),o=n(96537);function a(e){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.Z,{sx:{mb:2},children:[e.welcome&&(0,i.jsx)(s.Z,{variant:"body1",children:"WELCOME TO"}),(0,i.jsx)(s.Z,{variant:"h3",component:"h2",children:e.session.sessionName})]}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column"===e.layout?"column":"row"},gap:2,children:[(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"column"===e.layout?"start":"center",gap:1},children:[(0,i.jsx)("img",{src:"/icons/session-date.svg"}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column"===e.layout?"column":"row",alignItems:"column"===e.layout?"flex-start":"center",gap:1},children:[(0,i.jsx)(s.Z,{variant:"body2",children:"DATE"}),(0,i.jsx)(s.Z,{variant:"body1",style:{fontWeight:"bold"},children:new Date(e.session.sessionStartTime).toDateString()})]})]}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"column"===e.layout?"start":"center",gap:1},children:[(0,i.jsx)("img",{src:"/icons/session-time.svg"}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column"===e.layout?"column":"row",alignItems:"column"===e.layout?"flex-start":"center",gap:1},children:[(0,i.jsx)(s.Z,{variant:"body2",children:"TIME"}),(0,i.jsx)(s.Z,{variant:"body1",style:{fontWeight:"bold"},children:new Date(e.session.sessionStartTime).toLocaleTimeString()})]})]})]}),void 0!==e.onAdvance&&(0,i.jsx)(o.Z,{variant:"contained",color:"primary",onClick:e.onAdvance,sx:{alignSelf:"start"},children:"Next"})]})}},34360:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(57437),r=n(31193),s=n(48474),o=n(2265);function a(e){var t;let[n,a]=(0,s.q_)(()=>({opacity:0}));return(0,o.useEffect)(()=>{void 0!==e.url&&a.start({to:{opacity:1},config:{duration:2e3}})},[e.url]),(0,i.jsx)(r.Z,{justifySelf:"stretch",flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",sx:{borderRadius:2},children:(0,i.jsx)(s.q.img,{src:e.url,alt:null!==(t=e.alt)&&void 0!==t?t:"Session graphic",style:{minWidth:"100%",minHeight:"100%",flexShrink:0,...e.style,...n}})})}},88620:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var i=n(57437),r=n(75511),s=n(22960),o=n(31193),a=n(34990),l=n(80511),c=n(99128),d=n(2265);function u(e){var t;let[n,u]=(0,d.useState)(),[h,p]=(0,d.useState)({overall:{completed:0,total:100},bars:{}});(0,d.useEffect)(()=>(r.Z.on(r.z.Content_Progress_Update,u),()=>{r.Z.off(r.z.Content_Progress_Update,u)}),[]),(0,d.useEffect)(()=>{void 0!==n&&n.type===r.z.Content_Progress_Update&&p(n.data)},[n]);let x=(0,s.Z)();return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(o.Z,{sx:{alignSelf:"center",display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100%",width:"60%",maxWidth:"480px"},children:(0,i.jsxs)(a.Z,{elevation:1,sx:{p:2,flexGrow:1,textAlign:"start"},children:[(0,i.jsx)(l.Z,{component:"h2",variant:"h5",sx:{mb:2},style:{textAlign:"center"},children:e.title}),(0,i.jsx)(l.Z,{variant:"body1",children:(0,i.jsx)("span",{style:{color:e.isError?x.palette.error.main:"inherit"},children:null!==(t=e.message)&&void 0!==t?t:"Unknown error."})}),e.children&&(0,i.jsx)(o.Z,{sx:{my:1},children:e.children}),e.isBusy&&!e.showProgress&&(0,i.jsx)(c.Z,{sx:{mt:2}}),e.isBusy&&e.showProgress&&(0,i.jsx)(c.Z,{sx:{mt:2},value:h.overall.total>0?100*h.overall.completed/h.overall.total:void 0,variant:h.overall.total>0?"determinate":"indeterminate"}),e.isBusy&&e.showProgress&&Object.keys(h.bars).map((e,t)=>(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(c.Z,{color:"secondary",sx:{mt:1},value:h.bars[e].total>0?100*h.bars[e].completed/h.bars[e].total:0,variant:"determinate"},"loading-progress-bar-".concat(t,"-").concat(e))}))]})})})}},43655:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(57437),r=n(31193),s=n(97340);function o(e){return(0,i.jsxs)(r.Z,{display:"flex",flexDirection:"column",flexGrow:1,children:[(0,i.jsx)(r.Z,{display:"flex",flexDirection:"column",sx:{p:2},children:e.heading}),(0,i.jsx)(r.Z,{display:"flex",flexDirection:"column",flexGrow:1,children:(0,i.jsx)(s.Z,{sx:{flexGrow:1,m:1},children:e.main})})]})}},24314:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(57437),r=n(58433),s=n(31193);function o(e){let{left:t,right:n}=e;return(0,i.jsxs)(r.ZP,{container:!0,flexGrow:1,rowGap:1,children:[(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,flexGrow:1,display:"flex",flexDirection:"column",children:(0,i.jsx)(s.Z,{display:"flex",flexDirection:"column",gap:1,sx:{overflowY:"auto",flexGrow:{xs:void 0,md:1}},children:t})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,flexGrow:1,display:"flex",flexDirection:"column",children:(0,i.jsx)(s.Z,{display:"flex",flexDirection:"column",gap:1,sx:{pl:{xs:void 0,md:2},overflowY:"auto",flexGrow:{xs:void 0,md:1}},children:n})})]})}},98641:function(e,t,n){"use strict";n.d(t,{Z:function(){return ea}});var i,r,s,o,a,l,c=n(57437),d=n(2265),u=n(37570);function h(){let{session:e}=(0,d.useContext)(u.H);return(0,d.useEffect)(()=>{document.title=e.sessionName},[]),(0,c.jsx)(c.Fragment,{})}function p(){let e=[/defaultProps/,/of chart should be greater than 0/,/It will be ignored./,/If you accidentally passed it from a parent component, remove it from the DOM element./,/Form submission canceled because the form is not connected/,/Violation/,/Enriching/,/Added non-passive event/,/Form submission canceled/,/\[Violation\]/];return(0,d.useEffect)(()=>{let t=console.error,n=console.warn,i=console.debug;return console.error=function(){for(var n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];"string"==typeof i[0]&&e.some(e=>e.test(i[0]))||t(...i)},console.warn=function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];"string"==typeof i[0]&&e.some(e=>e.test(i[0]))||n(...i)},console.debug=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];"string"==typeof n[0]&&e.some(e=>e.test(n[0]))||i(...n)},()=>{console.error=t,console.warn=n,console.debug=i}},[]),(0,c.jsx)(c.Fragment,{})}var x=n(99128),m=n(27270),f=n(80511),g=n(96537),y=n(69540),v=n(61570),b=n(87913),w=n(8487),j=n(86514),k=n(80438),S=n(67630),Z=n(10745),C=n(44330),D=n(24309),E=n(63858);let I={checking_wake_lock:!1,checking_permissions:!1,explain_request:!1,get_request:!1,get_success:!1,get_fail_system:!1,get_fail_user:!1,get_fail_could_not_start:!1,get_fail_unknown_error:!1};function P(e){let[t,n]=(0,d.useState)({av:!1}),[i,r]=(0,d.useState)(I),[s,a]=(0,d.useState)(!1),[l,u]=(0,d.useState)(0);(0,d.useEffect)(()=>{switch(console.debug("state",o[l]),l){case 0:u(1);break;case 1:r({...I,checking_wake_lock:!0}),a(!0),P().then(()=>{u(2)});break;case 2:r({...I,checking_permissions:!0}),a(!0),h().then(e=>{e?(r({...I,get_success:!0}),u(4)):u(3)});break;case 3:r({...I,explain_request:!0}),a(!1);break;case 4:r({...I,get_request:!0}),a(!1),p().then(e=>{if(!0===e||!1===e)n({av:e}),r({...I,get_success:e,get_fail_unknown_error:!e});else{let{type:t,name:i,message:s}=e;n({av:!1}),console.error("Permission denied: ".concat(i,", ").concat(s)),r({...I,get_success:!1,get_fail_system:t===y.wS.SystemPermissionDenied,get_fail_user:t===y.wS.UserPermissionDenied,get_fail_could_not_start:t===y.wS.CouldNotStartVideoSource,get_fail_unknown_error:null==t||t===y.wS.Generic})}u(5)});break;case 5:a(!1),t.av&&e.onDone(!0)}},[l]),(0,d.useEffect)(()=>{console.info("Media permissions",t)},[t]);let h=async()=>{if(void 0===navigator)return console.warn("Navigator required to check permissions"),!1;try{let e=await navigator.permissions.query({name:"camera"});return"granted"===e.state}catch(e){return console.error("Error checking camera permissions",e),!1}},p=async()=>{try{let e=await (0,y.TD)();if(void 0!==e)return e;throw{type:y.wS.Generic,name:"Unknown",message:"Unknown error"}}catch(e){if(void 0!==e)return e;return{type:y.wS.Generic,name:"Unknown",message:"Unknown error"}}},P=async()=>{void 0!==navigator?void 0!==navigator.permissions?(console.debug("Checking screen wake-lock permission..."),console.info("screen-wake-lock permission",(await navigator.permissions.query({name:"screen-wake-lock"})).state)):console.warn("navigator.permissions is undefined"):console.warn("navigator is undefined")};return(0,c.jsxs)(c.Fragment,{children:[s&&(0,c.jsx)(x.Z,{}),i.checking_permissions&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",children:"We need permission to keep your screen on while you're in the workshop."}),(0,c.jsx)(f.Z,{variant:"h4",component:"h2",children:"Checking for permission"}),(0,c.jsx)(f.Z,{variant:"body1",children:"Please wait while we check for permission to keep your screen on while you're in the workshop..."})]}),i.checking_permissions&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",children:"We need your permission to use your camera and microphone to participate in this workshop."}),(0,c.jsx)(f.Z,{variant:"h4",component:"h2",children:"Checking for permission"}),(0,c.jsx)(f.Z,{variant:"body1",children:"Please wait while we check for permission to use your camera and microphone..."})]}),i.explain_request&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",children:"We need your permission to use your camera and microphone to participate in this workshop."}),(0,c.jsx)(f.Z,{variant:"h4",component:"h2",children:"Permission to join the video call"}),(0,c.jsx)(f.Z,{variant:"body1",children:"If prompted by your browser, please grant access to your camera and microphone."}),(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:()=>{u(4)},children:"Grant permission"})]}),i.get_request&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",children:"We need your permission to use your camera and microphone to participate in this session."}),(0,c.jsx)(f.Z,{variant:"h4",component:"h2",children:"Permission to join the video call"}),(0,c.jsx)(f.Z,{variant:"body1",children:"If prompted by your browser, please grant access to your camera and microphone."})]}),i.get_success&&(0,c.jsx)(m.Z,{severity:"success",children:"Your camera and microphone are ready to go!"}),i.get_fail_system&&(0,c.jsx)(m.Z,{severity:"error",children:"Your browser has denied access to your camera and microphone. Please check your browser settings and reload the page."}),i.get_fail_user&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"warning",children:"You have denied access to your camera and/or microphone."}),(0,c.jsxs)(f.Z,{variant:"h4",component:"h2",children:["What to do next on ",E.KC]}),E.i7&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(v.Z,{fontSize:"inherit"}),children:"If you see a crossed video camera icon at the end of your address bar, click it to change permissions."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(b.Z,{fontSize:"inherit"}),children:"If you don't see a camera icon, click the info icon at the beginning of the address bar for the page settings."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(w.Z,{fontSize:"inherit"}),children:"Grant permission to access camera and microphone from there."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(j.Z,{fontSize:"inherit"}),children:"When done, reload the page."})]}),E.vU&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(v.Z,{fontSize:"inherit"}),children:"If you see a crossed video camera or microphone icon at the start of your address bar, click it to change permissions."}),(0,c.jsxs)(m.Z,{severity:"info",icon:(0,c.jsx)(k.Z,{fontSize:"inherit"}),children:["If you don't see those icons, choose ",(0,c.jsx)("b",{children:"Tools"})," > ",(0,c.jsx)("b",{children:"Page Info"})," from the menu."]}),(0,c.jsxs)(m.Z,{severity:"info",icon:(0,c.jsx)(w.Z,{fontSize:"inherit"}),children:["Grant permission to access camera and microphone from the ",(0,c.jsx)("b",{children:"Permissions"})," tab."]}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(j.Z,{fontSize:"inherit"}),children:"When done, reload the page."}),(0,c.jsx)("img",{src:"/instructions/permissions-dialog-ff.png",style:{width:"80%",alignSelf:"center"}})]}),E.G6&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(m.Z,{severity:"info",icon:(0,c.jsx)(k.Z,{fontSize:"inherit"}),children:["Choose ",(0,c.jsx)("b",{children:"Safari"})," > ",(0,c.jsx)("b",{children:"Settings"})," from the menu, then click ",(0,c.jsx)("b",{children:"Websites"}),"."]}),(0,c.jsxs)(m.Z,{severity:"info",icon:(0,c.jsx)(S.Z,{fontSize:"inherit"}),children:["Choose the Camera settings, and set this site to ",(0,c.jsx)("b",{children:"Allow"}),"."]}),(0,c.jsxs)(m.Z,{severity:"info",icon:(0,c.jsx)(Z.Z,{fontSize:"inherit"}),children:["Choose the Microphone settings, and set this site to ",(0,c.jsx)("b",{children:"Allow"}),"."]}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(C.Z,{fontSize:"inherit"}),children:"When done, reload the page."}),(0,c.jsx)("img",{src:"/instructions/permissions-dialog-sf.png",style:{width:"80%",alignSelf:"center"}})]}),E.un&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(k.Z,{fontSize:"inherit"}),children:"Select Settings and more... and select Settings."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(w.Z,{fontSize:"inherit"}),children:"Select Cookies and Site Permissions on the left side."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(j.Z,{fontSize:"inherit"}),children:"Under Site Permissions, select Camera or Microphone."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(C.Z,{fontSize:"inherit"}),children:"Grant permissions there"}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(D.Z,{fontSize:"inherit"}),children:"When done, reload this page."})]}),!E.i7&&!E.vU&&!E.G6&&!E.un&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(m.Z,{severity:"warning",children:["We don't have instructions for ",E.KC,"."]}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(k.Z,{fontSize:"inherit"}),children:"Please grant camera and microphone permissions for this page."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(w.Z,{fontSize:"inherit"}),children:"When done, reload the page."})]})]}),i.get_fail_could_not_start&&(0,c.jsx)(m.Z,{severity:"warning",children:"Your camera and microphone are in use by another application. Please close the other application, refresh this page, and try again."}),i.get_fail_unknown_error&&(0,c.jsx)(m.Z,{severity:"error",children:"An unexpected error has prevented us from checking your camera and microphone. Please reload the page to try again."})]})}(i=o||(o={}))[i.Init=0]="Init",i[i.CheckingWakeLock=1]="CheckingWakeLock",i[i.CheckingPermission=2]="CheckingPermission",i[i.ExplainRequestPermissions=3]="ExplainRequestPermissions",i[i.GetPermission=4]="GetPermission",i[i.Result=5]="Result";var q=n(24314),A=n(34360),_=n(43655),T=n(43312),R=n(31193);function F(e){let[t,n]=(0,d.useState)(0),i=()=>void 0!==window&&void 0!==window.navigator&&void 0!==window.navigator.storage;(0,d.useEffect)(()=>{switch(t){case 0:i()||e.onDone(!1);break;case 1:r().then(t=>{console.debug("storage granted: ".concat(t)),e.onDone(t)})}},[t]);let r=async()=>i()&&void 0!==window.navigator.storage.persist&&await window.navigator.storage.persist();return(0,c.jsxs)(c.Fragment,{children:[0===t&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{variant:"h4",component:"h2",children:"Permission to store workshop content"}),(0,c.jsx)(f.Z,{variant:"body1",children:"We need your permission to store workshop content on this device. This helps save time and data if you reload the page, or restart your device."}),(0,c.jsx)(f.Z,{variant:"body1",children:"It's ok if you'd rather not grant that permission."}),(0,c.jsxs)(R.Z,{sx:{display:"flex",flexDirection:"row",gap:1},children:[(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:()=>{n(1)},children:"Grant permission"}),(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"outlined",color:"primary",onClick:()=>{e.onDone(!1)},children:"No thanks"})]})]}),1===t&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{variant:"h4",component:"h2",children:"Permission to store workshop content"}),(0,c.jsx)(f.Z,{variant:"body1",children:"If you see a prompt from your browser, please grant permission to store data on your device."}),(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"outlined",color:"primary",onClick:()=>e.onDone(!1),children:"Skip"})]})]})}(r=a||(a={}))[r.Describe=0]="Describe",r[r.Request=1]="Request";var B=n(5085),U=n(94547),N=n(22960);function W(e){let t=(0,N.Z)(),n=(0,d.useContext)(B.rZ),[i,r]=(0,d.useState)([]);return(0,d.useEffect)(()=>{let t=["We'll ask you for a name, so we know how to refer to you during the workshop."];e.session.remoteConfiguration===U.VS.RemoteWithVideoCall&&t.push("We'll ask for permission to use your camera and microphone, for the video call."),t.push("We'll ask for permission to keep workshop content on your device. (This is optional.)"),t.push("We'll fetch the workshop content for today, so it's ready for when we start."),r(t)},[]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{variant:"h4",children:"Thank you for joining us"}),e.session.facilitationState===U._y.Closed&&n.role===U._b.Client&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{variant:"h5",children:"Workshop closed"}),(0,c.jsx)(f.Z,{variant:"body1",children:"This workshop has ended. If you believe you're seeing this message in error, please contact your facilitator for more information."}),(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"outlined",color:"buttonStandard",onClick:e.onComplete,children:"Continue"})]}),e.session.facilitationState===U._y.Closed&&n.role===U._b.Controller&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{variant:"h5",children:"Workshop closed"}),(0,c.jsx)(f.Z,{variant:"body1",children:"This workshop has been closed. As a facilitator, you may enter the workshop and open it again."}),(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:e.onComplete,children:"Continue"})]}),e.session.facilitationState!==U._y.Closed&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{variant:"h5",children:"Today's session"}),(0,c.jsx)(R.Z,{sx:{border:"solid 2px",borderColor:t.palette.buttonQuiet.main,background:t.palette.buttonQuiet.main,p:2,borderRadius:2},children:(0,c.jsx)(f.Z,{variant:"body1",children:(0,c.jsx)("span",{dangerouslySetInnerHTML:{__html:e.session.sessionDescription}})})}),(0,c.jsx)(f.Z,{variant:"h5",children:"Let's get started"}),(0,c.jsxs)(f.Z,{variant:"body1",component:"div",children:["In order to connect you to the workshop, we'll need a few things:",(0,c.jsx)("ul",{children:i.map((e,t)=>(0,c.jsx)("li",{children:e},"welcome-list-item-".concat(t)))})]}),(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:e.onComplete,children:"Continue"})]})]})}var V=n(60335),M=n(69779);function z(e){let t=(0,d.useContext)(B.rZ),n=(0,d.useMemo)(()=>{var t;return(null===(t=e.elementRef)||void 0===t?void 0:t.current)||document.documentElement},[e.elementRef]),[i,r]=(0,d.useState)(),s=async()=>{try{!1!==document.fullscreenEnabled?n.requestFullscreen?await n.requestFullscreen({navigationUI:"hide"}):n.webkitRequestFullscreen?await n.webkitRequestFullscreen():n.webkitEnterFullscreen?await n.webkitEnterFullscreen():n.mozRequestFullScreen?await n.mozRequestFullScreen():n.msRequestFullscreen?await n.msRequestFullscreen():console.warn("No request full screen variants found"):console.warn("Fullscreen not enabled")}catch(e){console.error("Error entering fullscreen",e)}},o=async()=>{try{let e=document;document.fullscreenElement?await document.exitFullscreen():e.webkitFullscreenElement?await e.webkitExitFullscreen():e.mozFullScreenElement?await e.mozCancelFullScreen():e.msFullscreenElement?await e.msExitFullscreen():console.warn("No exit full screen variants found")}catch(e){console.error("Error exiting fullscreen",e)}};(0,d.useEffect)(()=>{document.onfullscreenchange=e=>{document.fullscreenEnabled,r(null!==document.fullscreenElement)}},[]),(0,d.useEffect)(()=>{t.role===U._b.Client&&void 0!==n&&(e.goFullScreen&&!i&&s(),!e.goFullScreen&&i&&o())},[e.goFullScreen,n]);let a=(0,N.Z)();return(0,c.jsx)(c.Fragment,{children:t.role===U._b.Client&&!i&&(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(R.Z,{sx:{position:"absolute",top:"1.5rem",right:"1.5rem",zIndex:10},children:(0,c.jsx)(V.Z,{"aria-label":"full screen",onClick:()=>s(),sx:{border:"2px solid",borderColor:a.palette.promptPanelBackground.main,background:a.palette.slideSectionBackground.main},children:(0,c.jsx)(M.Z,{})})})})})}var O=n(11144);(s=l||(l={}))[s.Welcome=0]="Welcome",s[s.ObtainVideoPermissions=1]="ObtainVideoPermissions",s[s.ObtainStoragePermissions=2]="ObtainStoragePermissions",s[s.Ready=3]="Ready";let L=(0,d.createContext)({});function G(e){let{session:t,graphic:n}=(0,d.useContext)(O.z),[i,r]=(0,d.useState)(0),[s,o]=(0,d.useState)(),[a,l]=(0,d.useState)(),[u,h]=(0,d.useState)(),p=(0,d.useMemo)(()=>(0,c.jsx)(A.Z,{url:n.posterUrl}),[n.posterUrl]),x=(0,d.useCallback)(()=>{r(1),y(!0)},[r]),m=(0,d.useCallback)(e=>{l(e),r(2)},[l,r]),f=(0,d.useCallback)(e=>{h(e),r(3)},[h,r]);(0,d.useEffect)(()=>{1===i&&t.remoteConfiguration!==U.VS.RemoteWithVideoCall&&(l(!1),r(2))},[i]);let[g,y]=(0,d.useState)(!1);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(z,{goFullScreen:g}),3!==i&&(0,c.jsx)(_.Z,{heading:(0,c.jsx)(T.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsxs)(c.Fragment,{children:[0===i&&(0,c.jsx)(q.Z,{left:(0,c.jsx)(W,{session:t,onComplete:x}),right:(0,c.jsx)(A.Z,{url:n.posterUrl})}),1===i&&(0,c.jsx)(q.Z,{left:(0,c.jsx)(P,{onDone:m}),right:p}),2===i&&(0,c.jsx)(q.Z,{left:(0,c.jsx)(F,{onDone:f}),right:p})]})}),3===i&&(0,c.jsx)(L.Provider,{value:{videoPermissionsGranted:a,storagePermissionsGranted:u},children:e.children})]})}var K=n(68276),H=n(67506),J=n(88620),Y=n(67074);function Q(e){let{session:t,graphic:n}=(0,d.useContext)(O.z),i=(0,d.useMemo)(()=>(0,c.jsx)(A.Z,{url:n.posterUrl}),[n.posterUrl]);return(0,c.jsx)(H.Z,{mode:"zg-server-time",loading:(0,c.jsx)(_.Z,{heading:(0,c.jsx)(T.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsx)(q.Z,{left:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!0,title:"Synchronising...",message:"Please wait while we synchronise clocks."}),right:i})}),error:(0,c.jsx)(J.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Synchronising...",message:"We were unable to synchronise clocks with the server."}),children:(0,c.jsx)(Y.Z,{sid:e.sid,refresh:e.refresh,initialising:(0,c.jsx)(_.Z,{heading:(0,c.jsx)(T.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsx)(q.Z,{left:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Preparing...",message:"Please wait while we prepare to download the workshop content."}),right:i})}),loading:(0,c.jsx)(_.Z,{heading:(0,c.jsx)(T.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsx)(q.Z,{left:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!0,title:"Downloading content...",message:"Please wait while we download the workshop content."}),right:i})}),error:(0,c.jsx)(J.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Content error",message:"We were unable to retrieve content for this workshop."}),children:e.children})})}var X=n(37471),$=n(4766),ee=n(70883),et=n(93191);function en(e){let{session:t,graphic:n}=(0,d.useContext)(O.z),i=(0,d.useMemo)(()=>(0,c.jsx)(A.Z,{url:n.posterUrl}),[n.posterUrl]);return(0,c.jsx)(X.C,{sid:e.sid,loading:(0,c.jsx)(_.Z,{heading:(0,c.jsx)(T.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsx)(q.Z,{left:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Connecting to live session...",message:"Please wait while we connect you to the workshop."}),right:i})}),error:(0,c.jsx)(J.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Connecting to live session...",message:"We were unable to connect you to the live session."}),children:(0,c.jsx)($.Z,{children:(0,c.jsx)(et.Z,{keepAwake:!0,refresh:e.refresh,children:(0,c.jsx)(ee.Z,{sid:e.sid,children:e.children})})})})}function ei(e){return(0,c.jsx)(B.ZP,{role:e.role,sid:e.sid,joinCode:e.joinCode,loading:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Checking permissions...",message:"Please wait while we confirm your access to the workshop."}),error:(0,c.jsx)(J.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Checking permissions...",message:"We were unable to confirm access to this workshop."}),children:(0,c.jsx)(u.Z,{sid:e.sid,initialising:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Preparing...",message:"Please wait while we prepare to retrieve the workshop."}),loading:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Retrieving workshop data...",message:"Please wait while we retrieve information about the workshop."}),error:(0,c.jsx)(J.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Content error",message:"We were unable to retrieve this workshop."}),children:e.children})})}var er=n(79044);function es(e){let{keepAwake:t}=e,[n,i]=(0,d.useState)(),[r,s]=(0,d.useState)();return(0,d.useEffect)(()=>{if(void 0===n&&void 0!==window.navigator){var e;i(null===(e=window.navigator)||void 0===e?void 0:e.wakeLock)}},[]),(0,d.useEffect)(()=>{console.debug("Wake lock: ".concat(void 0===n?"unavailable":"available",", keepAwake: ").concat(t));try{void 0===n||(t&&void 0===r&&n.request("screen").then(e=>{console.debug("Wake lock sentinel acquired"),s(e)}).catch(e=>{console.error("Wake lock exception",e)}),t||(void 0!==r&&console.debug("Releasing wake lock sentinel..."),null==r||r.release().then(()=>{console.debug("Wake lock sentinel released."),s(void 0)})))}catch(e){console.warn("Unable to request screen lock",e)}return()=>{void 0!==r&&console.debug("Relesaing wake lock sentinel..."),null==r||r.release().then(()=>{console.debug("Wake lock sentinel released."),s(void 0)})}},[n,t]),(0,c.jsx)(c.Fragment,{})}var eo=n(1973);function ea(e){return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(eo.Z,{children:[(0,c.jsx)(p,{}),(0,c.jsx)(ei,{sid:e.sid,role:e.role,joinCode:e.joinCode,children:(0,c.jsxs)(O.Z,{children:[(0,c.jsx)(h,{}),(0,c.jsx)(G,{sid:e.sid,refresh:e.refresh,children:(0,c.jsx)(Q,{sid:e.sid,refresh:e.refresh,children:(0,c.jsx)(er.Z,{children:(0,c.jsx)(en,{sid:e.sid,refresh:e.refresh,children:(0,c.jsxs)(K.Z,{children:[(0,c.jsx)(es,{keepAwake:!0}),e.children]})})})})})]})})]})})}},15785:function(e,t,n){"use strict";var i,r;n.d(t,{I:function(){return s},S:function(){return i}}),(r=i||(i={}))[r.default=0]="default",r[r.deliberation=1]="deliberation";let s={activity:0,recordingId:void 0,index:0,notes:"",qids:[],secs:void 0}},53771:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var i=n(57437),r=n(22960),s=n(31193),o=n(40468),a=n(2057),l=n(2265),c=n(1973);function d(){let{runningTasks:e,waitingTasks:t,failedTasks:n}=(0,l.useContext)(c.E),d=(0,r.Z)(),u={[a.l.Waiting]:d.palette.taskWaiting.main,[a.l.Ready]:d.palette.taskReady.main,[a.l.Running]:d.palette.taskRunning.main,[a.l.Success]:d.palette.taskSuccess.main,[a.l.Failed]:d.palette.taskFailed.main,[a.l.Cancelled]:d.palette.taskCancelled.main},h=e=>{let{task:t}=e,n=t.initProps.indicator,r=!1;switch(t.state){case a.l.Waiting:n+=" (retry)",r=!0;break;case a.l.Ready:case a.l.Running:n+="...",r=!0}return(0,i.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"row",gap:1,alignItems:"center",borderRadius:1,backgroundColor:"white",border:1,borderColor:u[t.state],borderBottom:4,borderBottomColor:u[t.state],opacity:.75,py:1,px:2},children:[r&&(0,i.jsx)(o.Z,{size:"1rem"}),n]})};return(0,l.useEffect)(()=>{console.debug("Running tasks: ".concat(e.length))},[e]),(0,l.useEffect)(()=>{console.debug("Waiting tasks: ".concat(t.length))},[t]),(0,i.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.filter(e=>void 0!==e.initProps.indicator).map(e=>(0,i.jsx)(h,{task:e},"task-vis-".concat(e.id,"-").concat(a.l[e.state]))),t.filter(e=>void 0!==e.initProps.indicator).map(e=>(0,i.jsx)(h,{task:e},"task-vis-".concat(e.id,"-").concat(a.l[e.state])))]})}},28801:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var i=n(57437),r=n(2265),s=n(94547),o=n(70883),a=n(27270),l=n(37471);let c=[s.um.Error,s.um.Disconnected,s.um.Disconnecting,s.um.Offline],d=[s.um.Online,s.um.Connecting,s.um.Connected,s.um.Joining];function u(){let e=(0,r.useContext)(o.l),t=(0,r.useContext)(l.Z),[n,u]=(0,r.useState)(e.thisUser),[h,p]=(0,r.useState)(t.state),[x,m]=(0,r.useState)(c.includes(h)),[f,g]=(0,r.useState)(d.includes(h)),[y,v]=(0,r.useState)("TODO"),[b,w]=(0,r.useState)(0);return(0,r.useEffect)(()=>{u(e.thisUser)},[e]),(0,r.useEffect)(()=>{console.debug("Connection warning, state: ".concat(s.um[t.state])),p(t.state)},[t.state,n]),(0,r.useEffect)(()=>{let e=c.includes(h),t=d.includes(h);e&&v("Disconnected from the workshop server."),t&&v("Please wait, connecting to the workshop server..."),m(e),g(t)},[h]),(0,r.useEffect)(()=>{w(x||f?1:0)},[x,f]),(0,i.jsx)(a.Z,{variant:"filled",severity:x?"warning":"info",sx:{opacity:b},children:y})}},97340:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(57437),r=n(31193),s=n(80511);function o(e){return(0,i.jsxs)(r.Z,{sx:{maxHeight:"100%",maxWidth:"100%",display:"flex",flexDirection:"column",background:"white",borderRadius:2,p:2,...e.sx},children:[(e.title||e.tools)&&(0,i.jsxs)(r.Z,{display:"flex",flexDirection:"row",justifyContent:"space-between",sx:{mb:1},children:[e.title&&(0,i.jsx)(s.Z,{variant:"h6",children:e.title}),e.tools]}),(0,i.jsx)(r.Z,{sx:{height:"100%",maxHeight:"100%",display:"block",overflowY:"hidden"},children:(0,i.jsx)(r.Z,{sx:{width:"100%",maxWwidth:"100%",height:"100%",maxHeight:"100%",overflowY:e.scrolling?"auto":"hidden"},children:e.children})})]})}},49752:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(57437),r=n(80511),s=n(31193),o=n(42555);function a(e){let t=()=>{var t,n;return(0,i.jsx)(o.Z,{variant:null!==(t=e.variant)&&void 0!==t?t:"contained",type:"submit",size:!0===e.large?"large":"medium",color:"buttonStandard",onClick:e.onSubmit,loading:e.busy,disabled:!e.enabled||e.busy,children:(0,i.jsx)(r.Z,{variant:"submitButton",children:null!==(n=e.text)&&void 0!==n?n:"Submit"})})},n="left"===e.alignment?"flex-start":"right"===e.alignment?"flex-end":"stretch";return(0,i.jsxs)(i.Fragment,{children:[e.inline&&(0,i.jsx)(t,{}),!e.inline&&(0,i.jsx)(s.Z,{sx:e.sx,display:"flex",flexDirection:"row",justifyContent:n,children:(0,i.jsx)(t,{})})]})}},71359:function(e,t,n){"use strict";n.d(t,{Q:function(){return r},Z:function(){return f}});var i,r,s=n(57437),o=n(2265),a=n(31193),l=n(49752),c=n(22599),d=n.n(c),u=n(48620),h=n(94547),p=n(26049),x=n(45231),m=n(8260);function f(e){var t;let{answers:n}=(0,m.ZP)(e.qids.qid),i=()=>{var t;return(0,m.Zp)(n,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)},[c,f]=(0,o.useState)(i()),[g,y]=(0,o.useState)(i()),[v,b]=(0,o.useState)(!1),[w,j]=(0,o.useState)(e.role===h._b.Client),k=t=>{var n,i;return{answers:[{key:"".concat(t),index:t,description:null!==(i=null===(n=e.marks)||void 0===n?void 0:n[t])&&void 0!==i?i:"".concat(t),numericValue:1}]}};(0,o.useEffect)(()=>{var e;y({...c,jsonValue:null!==(e=c.jsonValue)&&void 0!==e?e:k(Math.floor((Z()+C())/2))})},[c]);let S=async()=>{e.role===h._b.Client?(b(!0),e.onAnswer(g).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)f(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{b(!1)})):console.warn("Only participants can submit answers")},Z=()=>{switch(e.type){case 2:return 0;case 0:case 1:return e.numericRange?e.numericRange[0]:0;default:throw"Unsupported SliderInputType ".concat(r[e.type])}},C=()=>{switch(e.type){case 2:return e.marks.length-1;case 0:case 1:return e.numericRange?e.numericRange[1]:10;default:throw"Unsupported SliderInputType ".concat(r[e.type])}},D=()=>{var t,n;switch(e.type){case 2:return 1;case 0:return null!==(t=e.numericStep)&&void 0!==t?t:.01;case 1:return null!==(n=e.numericStep)&&void 0!==n?n:1;default:throw"Unsupported SliderInputType ".concat(r[e.type])}},E=e.marks?100-100/e.marks.length:void 0,I=E?"".concat(E,"%"):void 0;return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(a.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,s.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,alignItems:"center",justifyContent:"center",px:4},children:[(0,s.jsx)(a.Z,{sx:{mb:8},children:e.question&&(0,s.jsx)(u.Z,{content:e.question})}),(0,s.jsx)(a.Z,{sx:{width:null!=I?I:"95%"},children:(0,s.jsx)(p.Z,{onCommit:e=>{y({...g,jsonValue:k(e)})},color:"secondary",sliderDefault:g.jsonValue?d().toNumber(g.jsonValue.answers[0].index):Math.floor((Z()+C())/2),marks:null!==(t=(()=>{switch(e.type){case 2:return e.marks.map((e,t)=>({value:t,label:e}));case 0:return;case 1:return d().range(e.numericRange[0],e.numericRange[1]+1,D()).map((e,t)=>({value:e,label:"".concat(e)}))}})())&&void 0!==t&&t,slots:{markLabel:x.A},min:Z(),max:C(),step:D(),sliderMode:"solo"})})]}),e.role===h._b.Client&&(0,s.jsx)(a.Z,{sx:{mt:8,mr:8},children:(0,s.jsx)(l.Z,{onSubmit:S,text:"Submit",busy:v,enabled:w,inline:!1,alignment:"right"})})]})})}(i=r||(r={}))[i.continuous=0]="continuous",i[i.discrete=1]="discrete",i[i.categorical=2]="categorical"},26049:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(57437),r=n(48024),s=n(43298),o=n(2265);function a(e){var t;let[n,a]=(0,o.useState)(null!==(t=e.sliderDefault)&&void 0!==t?t:0),[l,c]=(0,o.useState)("solo"===e.sliderMode?1:.5),d=(0,o.useMemo)(()=>(0,r.ZP)(s.ZP)({color:"secondary",height:"".concat(.8*l,"em"),"& .MuiSlider-thumb":{height:"".concat(1.6*l,"em"),width:"".concat(1.6*l,"em"),backgroundColor:"secondary",boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset","&::before":{display:"none"}},"& .MuiSlider-rail":{borderRadius:"".concat(.4*l,"em"),boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset"},"& .MuiSlider-track":{borderRadius:"".concat(.4*l,"em"),boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset"},"& .MuiSlider-markLabel":{fontSize:"".concat(1*l,"rem"),marginTop:"".concat(2.5*l,"em")}}),[l]);return(0,i.jsx)(d,{...e,value:n,onChange:(e,t)=>{a(t)},onChangeCommitted:(t,n)=>{let i=n;e.acceptableRange&&i>e.acceptableRange.max&&(i=e.acceptableRange.max),e.acceptableRange&&i<e.acceptableRange.min&&(i=e.acceptableRange.min),a(i),e.onCommit(i)}})}},45231:function(e,t,n){"use strict";n.d(t,{A:function(){return o}});var i=n(57437),r=n(43298),s=n(80511);let o=e=>{let t=e["data-index"],n=e.ownerState.marks[t],o=e.ownerState.marks.length,a={...e.style,width:"".concat(100/o,"%"),wordWrap:"normal",whiteSpace:"wrap"};return(0,i.jsx)(r.J$,{...e,style:a,children:(0,i.jsx)(s.Z,{variant:"sliderMark",style:{display:"block",wordWrap:"normal",whiteSpace:"wrap"},children:n.label})})}},45080:function(e,t,n){"use strict";n.d(t,{L:function(){return r},Z:function(){return A}});var i,r,s=n(57437),o=n(2265),a=n(48620),l=n(22960),c=n(31193),d=n(66858),u=n(44908),h=n(65786),p=n(96537),x=n(69065),m=n(66124),f=n(60335),g=n(80511),y=n(49752),v=n(94547),b=n(73391),w=n(60320);let j=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,k=(e,t,n)=>{let i=[],s=null!=t?t:"";switch(e){case r.text:let o=n?s.length>0?null:"Please enter an answer":null;null!==o&&i.push(o);break;case r.email:let a=j.test(s.trim()),l=n?s.trim().length>0&&a?null:"Please enter a valid email address.":0===s.trim().length||a?null:"Please enter a valid email address.";null!==l&&i.push(l);break;default:throw"Unsupported TextInputType"}return i},S=(e,t)=>{if(console.debug("Validating checkboxes",e),void 0===e)return["Checkbox data undefined."];let n=e.filter(e=>e.checked).length,i=e.map((e,t)=>e.required&&!e.checked?"The ".concat((0,b.q)(t+1)," checkbox is required."):null).filter(e=>null!==e).map(e=>e),r=[];return n<t&&r.push("Please select at least ".concat(t," ").concat(1===t?"checkbox":"checkboxes",".")),[...i,...r]},Z=()=>(0,s.jsx)(w.Z,{children:(0,s.jsx)("svg",{focusable:"false","aria-hidden":"true","data-testid":"CheckBoxBlankIcon",children:(0,s.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5",fill:"white"})})});var C=n(49428),D=n(7630),E=n(19309),I=n(8260);(i=r||(r={}))[i.text=0]="text",i[i.email=1]="email";let P=(e,t)=>({...e,jsonValue:{answers:[{key:"text",stringValue:t.answer},...t.checks.map(e=>({key:e.key,stringValue:e.text,booleanValue:e.checked}))]}}),q=(e,t)=>{var n,i;return{answer:null===(i=e.jsonValue)||void 0===i?void 0:null===(n=i.answers.find(e=>"text"===e.key))||void 0===n?void 0:n.stringValue,checks:t.map(t=>{var n,i,r;return{key:t.key,text:t.text,initial:t.initial,checked:null!==(r=null===(i=e.jsonValue)||void 0===i?void 0:null===(n=i.answers.find(e=>e.key===t.key))||void 0===n?void 0:n.booleanValue)&&void 0!==r?r:t.initial,required:t.required}})}};function A(e){let{answers:t}=(0,I.ZP)(e.qids.qid),[n,i]=(0,o.useState)((0,I.Zp)(t,e.qids,e.question.pii)),[r,b]=(0,o.useState)({answer:void 0,checks:[]}),[w,j]=(0,o.useState)(!1),[A,_]=(0,o.useState)(!0),[T,R]=(0,o.useState)(e.role===v._b.Client),[F,B]=(0,o.useState)(!1),[U,N]=(0,o.useState)(!1),[W,V]=(0,o.useState)([]),[M,z]=(0,o.useState)(),[O,L]=(0,o.useState)(!1),G=()=>{L(!1)};(0,o.useEffect)(()=>{b(q(n,e.checkboxes))},[n]);let K=()=>{var t,n;let i=[...S(r.checks,e.minCheckboxes),...k(e.type,r.answer,e.textRequired)],s=(null!==(n=null===(t=r.answer)||void 0===t?void 0:t.length)&&void 0!==n?n:0)>0;return _(!U||0===i.length&&(s||!e.textRequired)),V(i),0===i.length};(0,o.useEffect)(()=>{U&&K()},[r]);let H=async()=>{if(e.role===v._b.Client&&A){if(N(!0),K()){let t=P(n,r);console.debug("Submitting TextInput",t),j(!0),e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)b(q(t,e.checkboxes));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{j(!1)})}}else console.warn("Only participants can submit answers")},J=async()=>{let t=P(n,{...r,answer:void 0,checks:[]});j(!0),e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)b(q(t,e.checkboxes));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{j(!1)})},Y=(e,t)=>{let n={...r,checks:[...r.checks]};n.checks.find(t=>t.key===e).checked=t,b(n)};return(0,o.useEffect)(()=>{z(W.join(" ")),B(W.length>0)},[W]),(0,l.Z)(),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(c.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.question&&(0,s.jsx)(c.Z,{sx:{mb:4},children:(0,s.jsx)(a.Z,{content:e.question})}),(0,s.jsx)(d.Z,{label:e.label,variant:"outlined",defaultValue:r.answer,helperText:M,type:1===e.type?"email":"text",onChange:e=>{b({...r,answer:e.target.value})},error:F,color:"buttonStandard",autoComplete:"off",InputProps:{sx:{background:"white",fontSize:"2rem"}},InputLabelProps:{sx:{fontSize:"2rem","&.MuiOutlinedInput-notchedOutline":{fontSize:"2rem"}}},sx:{mb:2}}),r.checks.map((t,n)=>(0,s.jsx)(c.Z,{display:"flex",flexDirection:"row",children:(0,s.jsx)(u.Z,{control:(0,s.jsx)(h.Z,{checked:t.checked,onChange:(e,n)=>Y(t.key,n),icon:e.forceCheckboxesWhite?(0,s.jsx)(Z,{}):void 0}),label:t.text})},"checkbox-".concat(e.qids.qid,"-").concat(n,"-").concat(t.key))),e.information&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Z,{variant:"text",fullWidth:!1,color:"buttonStandard",sx:{textDecoration:"underline",alignSelf:"start",mt:2},startIcon:(0,s.jsx)(C.Z,{}),onClick:()=>L(!0),children:e.information.heading}),(0,s.jsx)(x.Z,{fullWidth:!0,maxWidth:"md",open:O,onClose:G,children:(0,s.jsxs)(m.Z,{children:[(0,s.jsx)(c.Z,{style:{position:"absolute",top:0,right:0},children:(0,s.jsx)(f.Z,{"aria-label":"close",onClick:G,children:(0,s.jsx)(D.Z,{})})}),(0,s.jsx)(c.Z,{sx:{p:2},display:"flex",flexDirection:"column",children:e.information.body.map((t,n)=>(0,s.jsx)(g.Z,{variant:"slideInfoText",align:"left",dangerouslySetInnerHTML:{__html:(0,E.Z)(t)}},"".concat(e.qids.qid,"-info-body-").concat(n)))})]})})]}),(0,s.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"row",gap:1,justifyContent:"end",alignItems:"end"},children:[e.skipText&&(0,s.jsx)(y.Z,{inline:!0,busy:w,onSubmit:J,large:!0,variant:"outlined",text:e.skipText,enabled:!0}),(0,s.jsx)(y.Z,{inline:!0,busy:w,onSubmit:H,large:!0,text:e.submitText,enabled:!U||A})]})]})})}},48620:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(57437),r=n(31193),s=n(80511);function o(e){var t,n,o,a,l,c;return(0,i.jsx)(i.Fragment,{children:((null===(t=e.content)||void 0===t?void 0:t.explanation)||(null===(n=e.content)||void 0===n?void 0:n.instruction)||(null===(o=e.content)||void 0===o?void 0:o.question))&&(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch"},children:[e.content.instruction&&(0,i.jsx)(s.Z,{variant:"questionInstruction",align:null!==(a=e.forceAlign)&&void 0!==a?a:"center",component:"div",sx:{alignSelf:"stretch",...e.sx},children:e.content.instruction}),e.content.question&&(0,i.jsx)(s.Z,{variant:"questionPrompt",align:null!==(l=e.forceAlign)&&void 0!==l?l:"center",component:"div",sx:{alignSelf:"stretch",...e.sx},children:e.content.question}),e.content.explanation&&(0,i.jsx)(s.Z,{variant:"questionExplanation",align:null!==(c=e.forceAlign)&&void 0!==c?c:"center",component:"div",sx:{alignSelf:"stretch",...e.sx},children:e.content.explanation})]})})}},2962:function(e,t,n){"use strict";n.d(t,{J:function(){return r},Z:function(){return v}});var i,r,s=n(57437),o=n(2265),a=n(22960),l=n(24132),c=n(48620),d=n(41506),u=n(28651),h=n(43152),p=n(22599),x=n.n(p),m=n(75511),f=n(35231),g=n(97294),y=n(8260);function v(e){let{answers:t}=(0,y.ZP)(e.qids.qid),[n,i]=(0,o.useState)();(0,o.useEffect)(()=>{switch(e.inputType){case l.rT.categorical:i((0,l.dx)(t,e.categories,e.range));break;case l.rT.numerical:i((0,l.B8)((0,l.tJ)(t,e.range)));break;default:throw"Unsupported GraphInputType"}setTimeout(()=>{m.Z.emit({type:m.z.Request_SlideRefresh})},1e3)},[t]);let r={scaleType:"linear",tickInterval:x().range(0,1e3,1),tickLabelInterval:e=>(0,p.isInteger)(e),valueFormatter:e=>"".concat(e.toFixed(0)),disableLine:!0,disableTicks:!1},v={scaleType:"band",dataKey:"category",disableLine:!1,disableTicks:!1},b=(0,a.Z)();return(0,s.jsxs)(s.Fragment,{children:[e.question&&(0,s.jsx)(c.Z,{content:e.question}),(0,s.jsx)(f.h,{width:"100%",height:"100%",minWidth:50,minHeight:50,children:(0,s.jsx)(d.v,{layout:1===e.orientation?"vertical":"horizontal",margin:{left:150},grid:{horizontal:1===e.orientation,vertical:0===e.orientation},dataset:n,barLabel:"value",sx:{[".".concat(u.Is.root)]:{},".MuiBarElement-series-votes_id":{fill:b.palette.secondary.main},".MuiBarLabel-series-votes_id":{fill:"white",fontWeight:"bolder"},["& .".concat(h.k.line)]:{strokeDasharray:"5 3",strokeWidth:1},[".".concat(g.x.tickContainer)]:{textWrap:"wrap"},[".".concat(g.x.tickLabel)]:{fontSize:"1rem !important"}},slotProps:{bar:{rx:4,ry:4}},xAxis:[1===e.orientation?v:r],yAxis:[1===e.orientation?r:v],series:[{dataKey:"votes",label:void 0,id:"votes_id",valueFormatter:e=>null===e?"No data":1===e?"1 vote":"".concat(e.toFixed(0)," votes")}]})})]})}(i=r||(r={}))[i.horizontal=0]="horizontal",i[i.vertical=1]="vertical"},24132:function(e,t,n){"use strict";n.d(t,{B8:function(){return f},dx:function(){return u},rT:function(){return o},tJ:function(){return h}});var i,r,s,o,a=n(22599),l=n.n(a);(i=s||(s={}))[i.bar=0]="bar",(r=o||(o={}))[r.categorical=0]="categorical",r[r.numerical=1]="numerical";let c=e=>{var t,n;return l().range(e.lo,e.hi+(null!==(t=e.step)&&void 0!==t?t:1),null!==(n=e.step)&&void 0!==n?n:1)},d=e=>e.replace(/\\n/g,"\n"),u=(e,t,n)=>p(e,t,n).map((t,n)=>({category:d(t),votes:x(e,n)})),h=(e,t)=>c(t).map(t=>({value:t,votes:m(e,t)})),p=(e,t,n)=>{let i=void 0!==t?t:void 0!==n?c(n).map(e=>"".concat(e)):void 0;if(void 0===i)throw"Cannot determine categories";return i.filter(e=>void 0!==e).map(e=>e)},x=(e,t)=>l().sum(e.map(e=>{var n;return l().sum(null===(n=e.jsonValue)||void 0===n?void 0:n.answers.filter(e=>e.index===t).map(e=>{var t;return null!==(t=e.numericValue)&&void 0!==t?t:0}))})),m=(e,t)=>x(e,t),f=e=>e.map(e=>({category:"".concat(e.value),votes:e.votes}))},78364:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var i=n(57437),r=n(2265),s=n(4766),o=n(77412),a=n(5085),l=n(94547),c=n(11144);function d(){let e=(0,r.useContext)(a.rZ),{session:t}=(0,r.useContext)(c.z),n=(0,r.useContext)(s.X),[d]=(0,o.Z)("/sounds/00-ding.mp3",{volume:.5});return(0,r.useEffect)(()=>{(e.role===l._b.Controller||t.remoteConfiguration!==l.VS.InPerson)&&d()},[e.role,t.remoteConfiguration,n.data.index]),(0,i.jsx)(i.Fragment,{})}},73391:function(e,t,n){"use strict";n.d(t,{q:function(){return i}});let i=e=>{let t=e%10,n=e%100;return 1===t&&11!==n?e+"st":2===t&&12!==n?e+"nd":3===t&&13!==n?e+"rd":e+"th"}},20909:function(e,t,n){"use strict";n.d(t,{X:function(){return i}});let i=e=>e.split("/").at(-2)},84075:function(){}}]);