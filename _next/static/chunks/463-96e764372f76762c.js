"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[463],{79418:function(e,t,n){function i(e){if(null!=e)return parseInt(e)}function r(e){return!0===e||!1===e?e:"true"===e||"false"===e?"true"===e:"t"===e||"f"===e?"t"===e:(1===e||0===e)&&1===e}n.d(t,{LC:function(){return i},gx:function(){return r},zW:function(){return function e(t){if(t instanceof Array)return t.map(function(t){return"object"==typeof t&&(t=e(t)),t});{let n={};for(let i in t)if(t.hasOwnProperty(i)){let r=(i.charAt(0).toLowerCase()+i.slice(1)||i).toString(),o=t[i];(o instanceof Array||null!==o&&o.constructor===Object)&&(o=e(o)),n[r]=o}return n}}}})},30089:function(e,t,n){n.d(t,{Cc:function(){return h},H7:function(){return v},av:function(){return f},f_:function(){return m},if:function(){return u},kh:function(){return p},ot:function(){return g},pC:function(){return b},tL:function(){return x},te:function(){return d},yg:function(){return y}});var i=n(6121),r=n(71359),o=n(45080),s=n(15785),a=n(20920),l=n(24132),c=n(2962);let d=(e,t)=>{if(void 0!==e){let i=(0,a.Z)();if(void 0!==e.key&&null!==e.key){var n;return{...e,key:"".concat(t,"-").concat(null!==(n=e.key)&&void 0!==n?n:"undefined","+").concat(i)}}}},u=e=>e?Object.fromEntries(e.split(";").map(e=>e.trim().split(":").map(e=>e.trim()))):{},h=e=>e?Object.fromEntries(e.split(";").map(e=>e.trim().split(":").map(e=>e.trim()))):{},p=e=>{if(null!=e&&0!==e.length)return(0,i.Q)(e,{columns:!1,skip_empty_lines:!0,trim:!0})[0]},x=e=>null==e?void 0:e.map((e,t)=>""===e?" ".repeat(t):e),m=e=>{let t=parseFloat(null!=e?e:"");return isNaN(t)?void 0:t},f=e=>{let t=null==e?void 0:e.toLowerCase(),n=r.Q[t];if(void 0===n)throw console.error("Unknown slider input type: ".concat(e)),"Unknown slider input type: ".concat(e);return n},g=e=>{let t=null==e?void 0:e.toLowerCase(),n=l.rT[t];if(void 0===n)throw console.error("Unknown graph input type: ".concat(e)),"Unknown graph input type: ".concat(e);return n},y=e=>{let t=null==e?void 0:e.toLowerCase(),n=c.J[t];if(void 0===n)throw console.error("Unknown graph orientation: ".concat(e)),"Unknown graph orientation: ".concat(e);return n},v=e=>{let t=null==e?void 0:e.toLowerCase(),n=o.L[t];if(void 0===n)throw console.error("Unknown text input type: ".concat(e)),"Unknown text input type: ".concat(e);return n},b=e=>{let t=null==e?void 0:e.toLowerCase(),n=s.S[t];if(void 0===n)throw console.error("Unknown slide activity: ".concat(e)),"Unknown slide activity: ".concat(e);return n}},8260:function(e,t,n){n.d(t,{S9:function(){return c},UJ:function(){return l},ZP:function(){return d},Zp:function(){return a}});var i=n(2265),r=n(11144);let o=(e,t)=>{let{sid:n,pid:i,qid:r}=e;return{id:void 0,created:void 0,questionId:r,participantId:i,jsonValue:void 0,mimeType:void 0,pII:t}},s=e=>{let t={};return e.forEach(e=>{var n;t[e.questionId]=[...null!==(n=t[e.questionId])&&void 0!==n?n:[],e]}),t},a=(e,t,n)=>{var i;return null!==(i=l(e,t))&&void 0!==i?i:o(t,null!=n&&n)},l=(e,t)=>null==e?void 0:e.find(e=>e.questionId===t.qid&&e.participantId===t.pid),c=e=>(null==e?void 0:e.jsonValue)!==void 0;function d(e){var t;let n=(0,i.useContext)(r.z),[o,a]=(0,i.useState)(null!==(t=n.session.answers)&&void 0!==t?t:[]),[l,c]=(0,i.useState)(s(n.session.answers));return(0,i.useEffect)(()=>{a(void 0!==e?n.session.answers.filter(t=>t.questionId===e):[]),c(s(n.session.answers))},[n.session.answers]),{answers:o,allAnswers:l}}},11144:function(e,t,n){n.d(t,{Z:function(){return h},z:function(){return u}});var i=n(57437),r=n(2265),o=n(37570),s=n(5085),a=n(94547),l=n(83593),c=n(79418),d=n(1973);let u=(0,r.createContext)({});function h(e){let t=(0,r.useContext)(o.H),[n,h]=(0,r.useState)(t.session),[p,x]=(0,r.useState)(t.graphic),{api:m,start:f}=(0,r.useContext)(d.E),g=(0,r.useContext)(s.rZ),y=async()=>{console.debug("Refresh session...");try{g.role===a._b.Controller?h(await f(m.getDeliberationSessionAdmin(t.sid,g.user.access_token,"live-session-refresh"))):h(await f(m.getDeliberationSession(t.sid,"live-session-refresh")))}catch(e){console.error("Error fetching session data.",e)}},[v,b]=(0,r.useState)();(0,r.useEffect)(()=>(l.Z.on(l.M.WSS_Distribute_Message,b),l.Z.on(l.M.WSS_Update_ConnectionState,b),()=>{l.Z.off(l.M.WSS_Distribute_Message,b),l.Z.off(l.M.WSS_Update_ConnectionState,b)}),[]),(0,r.useEffect)(()=>{if(void 0!==v)switch(v.type){case l.M.WSS_Update_ConnectionState:w(v.data);break;case l.M.WSS_Distribute_Message:j(v.data)}},[v]);let w=e=>{console.debug("Connection state detected: ".concat(a.um[e])),e===a.um.Joined&&y()},j=e=>{if("send"===e.action&&"session-update"===e.type){var t;let i=(0,c.zW)(e.data.session);h({...i,joinCode:null!==(t=i.joinCode)&&void 0!==t?t:n.joinCode})}if("send"===e.action&&"answer-summary-update"===e.type){let t=e.data.questionId,i=(0,c.zW)(e.data.answers);h({...n,answers:[...n.answers.filter(e=>e.questionId!==t),...i]})}};return(0,i.jsx)(u.Provider,{value:{session:n,graphic:p},children:e.children})}},37471:function(e,t,n){n.d(t,{C:function(){return x},Z:function(){return h}});var i=n(57437),r=n(2265),o=n(5085),s=n(94547),a=n(83593),l=n(70972),c=n(79044);let d={debug:!1,connectionTimeout:3e3,maxReconnectionDelay:1e4,minReconnectionDelay:100,reconnectionDelayGrowFactor:1.3,maxRetries:1/0},u=(e,t,n)=>({deviceId:e.deviceId,sessionId:n,sessionToken:e.sessionToken,role:e.role,deviceName:void 0,participantName:t.participantName}),h=(0,r.createContext)({}),p=[s.um.Online,s.um.Connecting,s.um.Connected,s.um.Joining];function x(e){var t;let n=null!==(t=e.endpoint)&&void 0!==t?t:"wss://uw4rr0lqvg.execute-api.eu-west-2.amazonaws.com/prod";if(!n)throw"No endpoint found for Zeitgeist WSS";let x=(0,r.useContext)(o.rZ),m=(0,r.useContext)(c.K),f=(0,r.useRef)(null),[g,y]=(0,r.useState)(s.um.Offline),[v,b]=(0,r.useState)(!1),[w,j]=(0,r.useState)(!1),[k,Z]=(0,r.useState)(),S=(0,r.useCallback)(e=>{try{return f.current.send(JSON.stringify(e)),!0}catch(e){return console.error(e),!1}},[f]),[C,I]=(0,r.useState)({state:g,isError:w,joinedOnce:v,sendMessage:S});(0,r.useEffect)(()=>{if(void 0===window||void 0===window.navigator)throw"Window undefined.";window.addEventListener("online",()=>{g===s.um.Offline&&y(s.um.Online)}),window.addEventListener("offline",()=>{y(s.um.Offline)}),y(window.navigator.onLine?s.um.Online:s.um.Offline)},[]),(0,r.useEffect)(()=>{Z(u(x,m,e.sid))},[x.deviceId,e.sid,x.sessionToken,x.role,m.participantName]),(0,r.useEffect)(()=>{I({state:g,isError:w,joinedOnce:v,sendMessage:S})},[f,g,w,v,S]),(0,r.useEffect)(()=>{switch(console.debug("WSS state change",s.um[g]),a.Z.emit({type:a.M.WSS_Update_ConnectionState,data:g}),g){case s.um.Offline:try{var e;null===(e=f.current)||void 0===e||e.close()}catch(e){console.warn(e)}break;case s.um.Online:D(),y(s.um.Connecting);break;case s.um.Connecting:E();break;case s.um.Connected:y(s.um.Joining);break;case s.um.Joining:q();break;case s.um.Joined:b(!0);break;case s.um.Error:E()}j(g===s.um.Error)},[g]);let E=()=>{setTimeout(()=>{[l.Z.CLOSING,l.Z.CLOSED].includes(f.current.readyState)&&(console.debug("Recreating socket..."),D())},1e3)},D=()=>{if(null!==f.current){try{f.current.close()}catch(e){console.warn(e)}f.current.onopen=null,f.current.onclose=null,f.current.onerror=null,f.current.onmessage=null,f.current=null}f.current=P()},P=()=>{let e=new l.Z(n,[],d);return e.onopen=e=>{console.debug("WSS open",e),y(s.um.Connected)},e.onclose=e=>{console.warn("WSS close",e),y(s.um.Disconnected)},e.onerror=e=>{console.error("WSS error",e),y(s.um.Error)},e.onmessage=async e=>{await A(e)},e},q=()=>{var e,t;console.debug("Joining session...");let n={action:"join",deviceId:k.deviceId,sessionId:k.sessionId,sessionToken:k.sessionToken,deviceName:null!==(e=k.deviceName)&&void 0!==e?e:null,participantName:null!==(t=k.participantName)&&void 0!==t?t:null,role:k.role};f.current.send(JSON.stringify(n))},A=e=>{if(null==e?void 0:e.data){let t=JSON.parse(e.data);t&&("send"===t.action&&"remote-log"===t.type&&_(t),"send"===t.action&&"join-confirmation"===t.type&&R(t),a.Z.emit({type:a.M.WSS_Distribute_Message,data:t}))}},_=e=>{switch(e.data.severity){case"debug":console.debug("Remote debug log",e.data.message);break;case"info":console.info("Remote info log",e.data.message);break;case"warn":console.warn("Remote warn log",e.data.message);break;case"error":console.error("Remote error log",e.data.message);break;default:console.log("Remote log",e.data.message)}},R=e=>{console.debug("Join confirmation"),y(s.um.Joined)};return(0,i.jsxs)(i.Fragment,{children:[w&&!v&&e.error,!w&&!v&&p.includes(g)&&e.loading,v&&(0,i.jsx)(h.Provider,{value:C,children:e.children})]})}},67506:function(e,t,n){n.d(t,{G:function(){return d},Z:function(){return u}});var i,r,o=n(57437),s=n(2265),a=n(80237),l=n(83593),c=n(1973);let d=(0,s.createContext)({});function u(e){var t;let{api:n,start:i}=(0,s.useContext)(c.E),[u,h]=(0,s.useState)(0),[p,x]=(0,s.useState)(),[m,f]=(0,s.useState)(null!==(t=e.checks)&&void 0!==t?t:3);(0,s.useEffect)(()=>{switch(console.debug("ZgServerTimeProvider state",r[u]),u){case 0:l.Z.emit({type:l.M.Content_Progress_Update,data:{overall:{completed:0,total:m},bars:{}}}),h(1);break;case 1:g().then(e=>{x(e),h(3)}).catch(e=>{console.error(e),h(2)})}},[u]);let g=async()=>{switch(e.mode){case"server-date-lib":return v();case"zg-server-time":return y();default:throw Error("Unsupported time sync mode")}},y=async()=>{let e;console.debug("zg-server-time warmup",await i(n.getServerTime()));let t=Number.MAX_SAFE_INTEGER,r=0;for(let o=0;o<m;o++){let s=Date.now(),a=await i(n.getServerTime()),c=Date.now();console.debug("zg-server-time response",a);let d=c-s,u=(s+c)/2,h=a.timestamp-u;d<t&&(t=d,r=h,e=a),l.Z.emit({type:l.M.Content_Progress_Update,data:{overall:{completed:o+1,total:m},bars:{}}}),await new Promise(e=>setTimeout(e,1e3))}let o={offset:r,rtt:t,source:e,toServerTime:e=>e+r,fromServerTime:e=>e-r};return console.debug("zg-server-time result",o),o},v=async()=>{let e;console.warn("ServerDateLib is only accurate to the second.");for(let t=0;t<m;t++){await new Promise(e=>setTimeout(e,1e3));let n=await (0,a.a)();(void 0===e||Math.abs(n.uncertainty)<Math.abs(e.uncertainty))&&(e=n),l.Z.emit({type:l.M.Content_Progress_Update,data:{overall:{completed:t+1,total:m},bars:{}}})}let t={offset:e.offset,source:e,rtt:e.uncertainty,toServerTime:t=>t+e.offset,fromServerTime:t=>t-e.offset};return console.debug("server-date result",e),t};return(0,o.jsxs)(o.Fragment,{children:[(0===u||1===u)&&e.loading,2===u&&e.error,3===u&&(0,o.jsx)(d.Provider,{value:p,children:e.children})]})}(i=r||(r={}))[i.Init=0]="Init",i[i.Synchronising=1]="Synchronising",i[i.Error=2]="Error",i[i.Complete=3]="Complete"},53622:function(e,t,n){n.d(t,{Z:function(){return s},p:function(){return o}});var i=n(57437),r=n(2265);let o=(0,r.createContext)({});function s(e){let[t,n]=(0,r.useState)({});return(0,i.jsx)(o.Provider,{value:t,children:e.children})}},70883:function(e,t,n){n.d(t,{Z:function(){return c},l:function(){return l}});var i=n(57437),r=n(2265),o=n(83593),s=n(5085),a=n(37471);let l=(0,r.createContext)({});function c(e){let t=(0,r.useContext)(s.rZ),[n,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(n.find(e=>e.deviceId===t.deviceId)),h=(0,r.useContext)(a.Z);(0,r.useEffect)(()=>{h.sendMessage({action:"request",type:"subscription-update",sessionId:e.sid})},[]);let[p,x]=(0,r.useState)();(0,r.useEffect)(()=>(o.Z.on(o.M.WSS_Distribute_Message,x),()=>{o.Z.off(o.M.WSS_Distribute_Message,x)}),[]),(0,r.useEffect)(()=>{void 0!==p&&p.type===o.M.WSS_Distribute_Message&&m(p.data)},[p]);let m=e=>{if("send"===e.action&&"subscription-update"===e.type){var t;c(null!==(t=e.data.subscriptions)&&void 0!==t?t:[])}};return(0,r.useEffect)(()=>{u(n.find(e=>e.deviceId===t.deviceId))},[n,t]),(0,i.jsx)(l.Provider,{value:{subscriptions:n,thisUser:d},children:e.children})}},4766:function(e,t,n){n.d(t,{X:function(){return s},Z:function(){return a}});var i=n(57437),r=n(2265),o=n(15785);let s=(0,r.createContext)({});function a(e){let[t,n]=(0,r.useState)(o.I);return(0,i.jsx)(s.Provider,{value:{data:t,setData:n},children:e.children})}},93191:function(e,t,n){n.d(t,{N:function(){return c},Z:function(){return d}});var i=n(57437),r=n(2265),o=n(4766),s=n(5085),a=n(57818),l=n(64675);let c=(0,r.createContext)({});function d(e){let t=(0,r.useContext)(l.F),d=(0,r.useContext)(o.X),u=(0,r.useContext)(s.rZ),h=e=>{d.setData(e)},[p,x]=(0,r.useState)(void 0);return(0,r.useEffect)(()=>{let r=(0,a.default)(()=>Promise.all([n.e(885),n.e(518),n.e(218),n.e(287),n.e(310)]).then(n.bind(n,61310)),{loadableGenerated:{webpack:()=>[61310]},ssr:!1});x((0,i.jsx)(r,{sid:t.sid,role:u.role,slides:t.slides,sourcePresentationXml:t.sourceXml.join("\n"),embedded:!0,onSlideDataChange:h,showBorder:!1,regenerateThumbnails:e.refresh}))},[]),(0,i.jsx)(i.Fragment,{children:!!p&&(0,i.jsx)(c.Provider,{value:{presentation:p},children:e.children})})}},5085:function(e,t,n){n.d(t,{ZP:function(){return h},rZ:function(){return u}});var i,r,o=n(57437),s=n(2265),a=n(94547),l=n(20920),c=n(67022),d=n(1973);(i=r||(r={}))[i.Init=0]="Init",i[i.Authenticating=1]="Authenticating",i[i.AuthError=2]="AuthError",i[i.AuthNotRequired=3]="AuthNotRequired",i[i.Authenticated=4]="Authenticated",i[i.ExchangingJoinCode=5]="ExchangingJoinCode",i[i.JoinCodeError=6]="JoinCodeError",i[i.JoinCodeAccepted=7]="JoinCodeAccepted",i[i.Ready=8]="Ready";let u=(0,s.createContext)({});function h(e){var t;let[n,i]=(0,s.useState)((null===(t=window)||void 0===t?void 0:t.localStorage.getItem("DeviceId"))||(0,l.Z)());(0,s.useEffect)(()=>{window&&window.localStorage.setItem("DeviceId",n)},[n]);let[h,p]=(0,s.useState)(0),[x,m]=(0,s.useState)(void 0),[f,g]=(0,s.useState)(e.role),[y,v]=(0,s.useState)(),[b,w]=(0,s.useState)(!1),[j,k]=(0,s.useState)(!1),[Z,S]=(0,s.useState)({deviceId:n,role:f,state:h,user:x,sessionToken:y,noUserWarning:j});(0,s.useEffect)(()=>{S({...Z,state:h})},[h]),(0,s.useEffect)(()=>{S({...Z,user:x})},[x]),(0,s.useEffect)(()=>{S({...Z,role:f})},[f]),(0,s.useEffect)(()=>{S({...Z,sessionToken:y})},[y]),(0,s.useEffect)(()=>{S({...Z,noUserWarning:j})},[j]);let C=(0,c.aC)(),{api:I,start:E}=(0,s.useContext)(d.E);return(0,s.useEffect)(()=>C.events.addAccessTokenExpiring(async()=>{console.debug("Access token renewal with auth.signinSilent()...");let e=await C.signinSilent();console.debug("User renewal: ".concat(e?"found":"not found")),m(e)}),[C.events,C.signinSilent]),(0,s.useEffect)(()=>{switch(console.debug("User state",r[h]),h){case 0:switch(f){case a._b.Controller:p(1);break;case a._b.Client:p(3),m(null);break;default:throw"Unsupported role: ".concat(a._b[f])}break;case 1:C.signinSilent().then(e=>{null!==e?(console.info("User found",e.profile.email),m(e),p(4)):(console.debug("Not authenticated"),m(void 0),p(2))}).catch(e=>{console.error(e),m(void 0),p(2)});break;case 2:case 6:break;case 4:case 3:p(5);break;case 5:let t={deviceId:n,role:f,joinCode:e.joinCode,sessionId:e.sid};E(I.exchangeJoinCodeForSessionToken(t)).then(e=>{v(e.sessionToken),p(7)}).catch(e=>{console.error(e),p(6)});break;case 7:p(8)}w(!![2,6].find(e=>e===h))},[h]),(0,s.useEffect)(()=>{k(null===x),null===x&&8===h&&console.warn("No user found through Auth. The session can continue, but the facilitator may not be able to take additional actions.")},[x]),(0,o.jsxs)(o.Fragment,{children:[b&&e.error,8!==h&&!b&&e.loading,8===h&&!b&&(0,o.jsx)(u.Provider,{value:Z,children:e.children})]})}},64675:function(e,t,n){n.d(t,{F:function(){return tA},Z:function(){return t_}});var i,r,o,s,a,l,c,d,u,h,p=n(57437),x=n(2265),m=n(5085),f=n(22599),g=n.n(f);class y{async init(){if(this.initialised)return;this.storageAvailable=void 0!==window&&void 0!==window.navigator&&void 0!==window.navigator.storage,this.persistAvailable=this.storageAvailable&&void 0!==window.navigator.storage.persist,this.mayPersist=this.storageAvailable&&void 0!==window.navigator.storage.persist&&await window.navigator.storage.persist(),this.retrieveAvailable=this.storageAvailable&&void 0!==window.navigator.storage.getDirectory,this.estimateAvailable=this.storageAvailable&&void 0!==window.navigator.storage.estimate;let e=[["Workshop dir",this.workshopDir],["Storage Available",this.storageAvailable],["Persist Available",this.persistAvailable],["Retrieve available",this.retrieveAvailable],["Estimate available",this.estimateAvailable],["May Persist",this.mayPersist]];if(this.estimateAvailable){let t=await navigator.storage.estimate();e.push(["Quota",t.quota]),e.push(["Usage",t.usage])}else e.push(["Quota","N/K"]),e.push(["Usage","N/K"]);console.table(e),this.initialised=!0}async getAsUrl(e,t){if(!this.initialised)throw"Not initialised";if(e.startsWith("blob:"))return console.debug("getAsUrl","blob: url requested - passing back the same url."),e;let n=await this.getAsEntry(e,t);try{return URL.createObjectURL(n.content)}catch(t){return console.warn("getAsUrl","Unable to create blob URL for: ".concat(e),t),n.sourceUrl}}async getAsEntry(e,t){if(!this.initialised)throw"Not initialised";if(e.startsWith("blob:")){let n=e.substring(5);return await this.getAsEntry(n,t)}let n=this.forceFetch?null:await this.getCacheData(e);if(this.forceFetch&&console.debug("getAsEntry","cache skip for: ".concat(e)),null!==n&&(void 0===n.content||0===n.content.size)&&(n=null),console.debug("getAsEntry","Cache ".concat(null===n?"miss for":"hit for",": ").concat(e)),null===n){try{n=await this.fetchContent({key:e},t)}catch(t){throw console.error("getAsEntry","Unable to fetch data for: ".concat(e),t),t}try{void 0!==n.content&&n.content.size>0?(console.debug("getAsEntry","Cacheing ".concat(n.content.size," bytes of data for: ").concat(e),n),await this.storeCacheData(n)):(void 0===n.content&&console.warn("getAsEntry","Content for ".concat(e," is undefined.")),void 0!==n.content&&0===n.content.size&&console.warn("getAsEntry","Content for ".concat(e," has 0 bytes.")))}catch(t){console.warn("getAsEntry","Unable to cache the data for: ".concat(e),t)}}return n}async storeCacheData(e){if(this.persistAvailable){var t;let n=e.key.split("/").slice(-1)[0],i=new Date;e.created=null!==(t=e.created)&&void 0!==t?t:i,e.updated=i;let r=await window.navigator.storage.getDirectory(),o=await r.getDirectoryHandle("workshops",{create:!0}),s=await o.getDirectoryHandle(this.workshopDir,{create:!0}),a=await s.getDirectoryHandle("content",{create:!0}),l=await a.getFileHandle(n,{create:!0}),c=await l.createWritable();try{await c.write(e.content)}catch(e){throw console.warn("storeCacheData","error writing to cache",e),e}finally{await c.close(),console.debug("storeCacheData","content stored",e.key)}}}async getCacheData(e){if(!this.retrieveAvailable)return null;try{let t=e.split("/").slice(-1)[0],n=await window.navigator.storage.getDirectory(),i=await n.getDirectoryHandle("workshops",{create:!0}),r=await i.getDirectoryHandle(this.workshopDir,{create:!0}),o=await r.getDirectoryHandle("content",{create:!0}),s=await o.getFileHandle(t),a=await s.getFile();return{key:e,content:a}}catch(e){return console.warn("getCacheData - error encountered, this is a cache miss",e),null}}async fetchContent(e,t){return(await this.fetchContents([e],t))[0]}async fetchContents(e,t){let n=await this.getAccessUrls(e.map(e=>this.fixKeyForS3(e.key))),i=e.map(e=>({key:e.key,url:n.objectKeysToAccessUrls[this.fixKeyForS3(e.key)]}));console.debug("fetchContents","Fetched keysToUrls",i);let r=i.map(e=>this.download(e,t));console.debug("fetchContents","Fetching ".concat(r.length," content items..."));let o=await Promise.all(r);return console.debug("fetchContents","fetch contents complete",o),o}async download(e,t){let n=0;do{try{var i;let n=await fetch(e.url);if(null===n.body)throw"No content found in response for: ".concat(e.key,", at: ").concat(e.url);let r=n.headers.get("Content-Length");if(null===r)throw"Content-Length not found in response for: ".concat(e.key,", at: ").concat(e.url);let o=null!==(i=n.headers.get("Content-Type"))&&void 0!==i?i:void 0;if(void 0===o)throw"Content-Type not found in response for: ".concat(e.key,", at: ").concat(e.url);console.debug("download","".concat(e.key," content-type: ").concat(o));let s=n.body.getReader(),a=Number.parseInt(r);void 0!==t&&t(e.key,0,a);let l=[],c=0;for(;;){let{done:n,value:i}=await s.read();if(n)break;l.push(i),c+=i.length,void 0!==t&&t(e.key,c,a)}let d=new Uint8Array(c),u=0;for(let e of l)d.set(e,u),u+=e.length;return{content:new Blob(l,{type:o}),sourceUrl:e.url,key:e.key}}catch(t){console.warn("download","Error fetching: ".concat(e.key,", attempt: ").concat(n),t),await new Promise(e=>setTimeout(e,1e3))}n++}while(n<3);throw"Failed to fetch: ".concat(e.key)}async getAccessUrls(e){let t={objectKeys:e.filter(e=>this.isKeyForS3(e))},n=e.filter(e=>!this.isKeyForS3(e));console.debug("getAccessUrls","requests to s3 for:",t);let i=await this.start(this.api.postWorkshopContentAccessRequest(this.session.id,this.sessionToken,t));return n.forEach(e=>i.objectKeysToAccessUrls[e]=e),i}fixKeyForS3(e){if(this.isKeyForS3(e)){e=g().trim(e,"/");let t="workshops/".concat(this.workshopDir,"/");e.startsWith(t)||(e="".concat(t).concat(e))}return e}isKeyForS3(e){return!e.startsWith("https://")&&!e.startsWith("http://")}constructor(e,t,n,i,r,o){this.api=e,this.start=t,this.session=n,this.sessionToken=i;let s=r.split("/").slice(-2)[0];this.workshopDir=s,this.forceFetch=o,this.initialised=!1,this.storageAvailable=!1,this.persistAvailable=!1,this.mayPersist=!1,this.retrieveAvailable=!1,this.estimateAvailable=!1}}let v=["src","graphic","videoUri","posterUri","sideBackgroundImage","mainBackgroundImage","data-background-image"],b=["style","sideStyle","mainStyle"];class w{getAsSectionTags(e,t){let n=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("section"),i=[];console.debug("Module ".concat(t," contains ").concat(n.length," sections."));for(let e=0;e<n.length;e++){let r=n.item(e);r&&r.setAttribute("key","module-".concat(t,"-section-").concat(e));let o=new XMLSerializer().serializeToString(r);i.push(o)}return g().join(i,"\n")}reset(){this.progressData={overall:{completed:0,total:0},bars:{}},this.sendUpdate()}updateProgress(e,t,n){this.progressData.bars[e]={completed:t,total:n},this.progressData.overall.completed=g().sum(Object.entries(this.progressData.bars).map(e=>e[1].completed)),this.progressData.overall.total=g().sum(Object.entries(this.progressData.bars).map(e=>e[1].total)),this.sendUpdate()}sendUpdate(){var e;null===(e=this.onUpdate)||void 0===e||e.call(this,{overall:this.progressData.overall,bars:{}})}findAllReplacements(e,t){void 0===e&&(e=this.dom.documentElement),t=this.appendNodeReplacements(e,t);for(let n=0;n<e.childNodes.length;n++)t=this.findAllReplacements(e.childNodes[n],t);return t}appendNodeReplacements(e,t){let n=[...t];if(e.nodeType===Node.ELEMENT_NODE){for(let t of v)if(e.hasAttribute(t)){let i=e.getAttribute(t);if(void 0===n.find(e=>e.key===i)){let e=async()=>{try{return await this.zcs.getAsUrl(i,(e,t,n)=>{this.updateProgress(e,t,n)})}catch(e){throw console.error("Error fetching ".concat(t,": ").concat(i),e),e}},r={key:i,getUrlPromise:e,targets:[],attempts:0};n.push(r)}n.find(e=>e.key===i).targets.push({element:e,attribute:t})}for(let t of b)if(e.hasAttribute(t)){let i=e.getAttribute(t);if(i.includes("url(")){let r=i.match(/url\(([^)]+)\)/)[1];if(r=g().trim(r,"\"' ()"),void 0===n.find(e=>e.key===r)){let e=async()=>{try{return await this.zcs.getAsUrl(r,(e,t,n)=>{this.updateProgress(e,t,n)})}catch(e){throw console.error("Error fetching ".concat(t,": ").concat(r),e),e}},i={key:r,getUrlPromise:e,targets:[],attempts:0};n.push(i)}n.find(e=>e.key===r).targets.push({element:e,attribute:t})}}}return n}async replaceAllReplacements(e){do{let t=e.filter(e=>this.shouldTryAgain(e)),n=await Promise.all(t.map(e=>this.replace(e)));if(n.some(e=>!e.succeeded)){let e=n.filter(e=>!1===e.succeeded);console.warn("".concat(e.length," failed replacements"),e),await new Promise(e=>setTimeout(e,1e3))}}while(e.some(e=>this.shouldTryAgain(e)));if(e.some(e=>!1===e.succeeded)){let t=e.filter(e=>!1===e.succeeded);console.error("".concat(t.length," replacements failed"),t)}return new XMLSerializer().serializeToString(this.dom)}async replace(e){try{e.attempts++;let t=await e.getUrlPromise();for(let n of e.targets){let i=n.element.getAttribute(n.attribute),r=null==i?void 0:i.replace(e.key,t);n.element.setAttribute(n.attribute,r)}e.succeeded=!0}catch(t){console.warn("Error fetching ".concat(e.key),t),e.succeeded=!1,e.error=t}finally{return e}}shouldTryAgain(e){return!0!==e.succeeded&&e.attempts<3}constructor(e,t,n){this.source=e,this.zcs=t,this.onUpdate=n,this.progressData={overall:{completed:0,total:0},bars:{}},this.dom=new DOMParser().parseFromString(e,"text/xml"),this.reset()}}var j=n(83593),k=n(53463),Z=n(71359),S=n(79418),C=n(45080),I=n(96537),E=n(31193),D=n(80511),P=n(94547);let q={gbr:{key:"postcode",label:"Postcode (first half)",mode:"text",layout:"column",textPlaceholder:"What is the first half of your postcode?",textValidationRegex:"^[a-zA-Z]{1,2}[0-9][0-9a-zA-Z]?$",textCapitalisation:!0,textValidationMessage:"Please enter a valid UK postcode",groups:[]}},A={key:"gender",label:"Gender",mode:"select",layout:"column",groups:[{label:"Gender",choices:[{display:"Female",key:"f"},{display:"Male",key:"m"},{display:"Non-binary",key:"nb"},{display:"I would rather not say",key:"prefer-not-to-say"}]}]},_={key:"age",label:"Age range",mode:"select",layout:"grid",layoutProps:{columns:2},groups:[{label:"Age",choices:[{display:"14 - 17",key:"14-17"},{display:"18 - 25",key:"18-25"},{display:"26 - 35",key:"26-35"},{display:"36 - 45",key:"36-45"},{display:"46 - 55",key:"46-55"},{display:"56 - 65",key:"56-65"},{display:"66 - 75",key:"66-75"},{display:"76+",key:"76+"},{display:"I would rather not say",key:"prefer-not-to-say"}]}]},R={key:"ethnicity",label:"Ethnicity",mode:"select",layout:"row",groups:[{label:"Asian or Asian British",choices:[{display:"Indian",key:"Indian"},{display:"Pakistani",key:"Pakistani"},{display:"Bangladeshi",key:"Bangladeshi"},{display:"Chinese",key:"Chinese"},{display:"Any other Asian background",key:"Any other Asian background"}]},{label:"Black, Black British, Caribbean or African",choices:[{display:"Caribbean",key:"Caribbean"},{display:"African",key:"African"},{display:"Any other Black, Black British, or Caribbean background",key:"Any other Black, Black British, or Caribbean background"}]},{label:"Mixed or multiple ethnic groups",choices:[{display:"White and Black Caribbean",key:"White and Black Caribbean"},{display:"White and Black African",key:"White and Black African"},{display:"White and Asian",key:"White and Asian"},{display:"Any other Mixed or multiple ethnic background",key:"Any other Mixed or multiple ethnic background"}]},{label:"White",choices:[{display:"English, Welsh, Scottish, Northern Irish or British",key:"English, Welsh, Scottish, Northern Irish or British"},{display:"Irish",key:"Irish"},{display:"Gypsy or Irish Traveller",key:"Gypsy or Irish Traveller"},{display:"Roma",key:"Roma"},{display:"Any other White background",key:"Any other White background"}]},{label:"Other ethnic group",choices:[{display:"Arab",key:"Arab"},{display:"Any other ethnic group",key:"Any other ethnic group"}]},{label:"Unavailable",choices:[{display:"I would rather not say",key:"prefer-not-to-say"}]}]};var F=n(48620),T=n(58433);function B(e){let t=e.demographic.groups.length>1;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[(0,p.jsx)(I.Z,{color:"buttonStandard",variant:"text",onClick:()=>e.onBack(),children:(0,p.jsx)("img",{src:"/icons/arrow-left.svg",alt:"Back"})}),(0,p.jsx)(D.Z,{variant:"slideSubHeading",align:"left",children:e.demographic.label})]}),(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch",gap:4,mb:4},children:e.demographic.groups.map(n=>(0,p.jsxs)(E.Z,{display:"flex",flexDirection:"column",alignContent:"start",children:[t&&(0,p.jsx)(D.Z,{variant:"demographicGroupHeading",align:"left",sx:{mb:.8},children:n.label}),("row"===e.layout||"column"===e.layout)&&(0,p.jsx)(E.Z,{display:"flex",flexDirection:e.layout,gap:1,flexWrap:"row"===e.layout?"wrap":void 0,alignItems:"column"===e.layout?"start":void 0,children:n.choices.map(t=>{var i;return(0,p.jsx)(I.Z,{variant:"contained",color:(null===(i=e.currentSelection)||void 0===i?void 0:i.key)===t.key?"buttonStandard":"buttonQuiet",onClick:()=>{e.onSelection(t)},children:(0,p.jsx)(D.Z,{variant:"submitButton",children:t.display})},"".concat(e.demographic.label,"-section-").concat(n.label,"-value-").concat(t.key))})}),"grid"===e.layout&&(0,p.jsx)(T.ZP,{container:!0,sx:{width:e.layoutProps.columns<3?"66%":"100%"},rowGap:1,children:n.choices.map(t=>{var i;return(0,p.jsx)(T.ZP,{item:!0,xs:12/e.layoutProps.columns,sx:{px:1},children:(0,p.jsx)(I.Z,{variant:"contained",fullWidth:!0,color:(null===(i=e.currentSelection)||void 0===i?void 0:i.key)===t.key?"buttonStandard":"buttonQuiet",onClick:()=>{e.onSelection(t)},children:(0,p.jsx)(D.Z,{variant:"submitButton",sx:{py:1},children:t.display})})},"".concat(e.demographic.label,"-section-").concat(n.label,"-value-").concat(t.key))})})]},"".concat(e.demographic.label,"-section-").concat(n.label)))})]})}function W(e){return(0,p.jsxs)(E.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,p.jsx)(E.Z,{sx:{display:"block",flexGrow:1,overflowY:"auto",overflowX:"hidden"},children:e.children}),(e.startBar||e.endBar)&&(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,p.jsx)(E.Z,{children:e.startBar}),e.endBar&&(0,p.jsx)(E.Z,{children:e.endBar})]})]})}var N=n(9646),U=n(66858);function M(e){var t,n,i;let r=()=>{var t;return null!==(t=e.skipOption)&&void 0!==t?t:{key:"prefer-not-to-say",display:"I would rather not say"}},[o,s]=(0,x.useState)((null===(t=e.currentSelection)||void 0===t?void 0:t.key)!==r().key&&null!==(i=null===(n=e.currentSelection)||void 0===n?void 0:n.display)&&void 0!==i?i:""),[a,l]=(0,x.useState)(""),[c,d]=(0,x.useState)(!1),[u,h]=(0,x.useState)(!0),[m,f]=(0,x.useState)(!1),g=t=>{var n,i;return(f(!0),e.demographic.textMaxLength&&t.length>e.demographic.textMaxLength)?(l(null!==(n=e.demographic.textValidationMessage)&&void 0!==n?n:"Maximum length: ".concat(e.demographic.textMaxLength," characters")),d(!0),h(!1),!1):e.demographic.textValidationRegex&&!new RegExp(e.demographic.textValidationRegex).test(t)?(s(t),l(null!==(i=e.demographic.textValidationMessage)&&void 0!==i?i:"Please enter a valid value for ".concat(e.demographic.label,".")),d(!0),h(!1),!1):(s(t),l(""),d(!1),h(!0),!0)};return(0,x.useEffect)(()=>{m&&h(!c)},[m,c]),(0,p.jsx)(W,{endBar:(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",gap:1},children:[e.skipPermitted&&(0,p.jsx)(N.Z,{btnKey:"skip",btnText:"I would rather not say",variant:"outlined",onClick:t=>{e.onSelection(r())}}),(0,p.jsx)(N.Z,{btnKey:"submit",btnText:"Submit",variant:"contained",disabled:!u,onClick:t=>{g(o)&&e.onSelection({key:o,display:o})}})]}),children:(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[(0,p.jsx)(I.Z,{color:"buttonStandard",variant:"text",onClick:()=>e.onBack(),children:(0,p.jsx)("img",{src:"/icons/arrow-left.svg",alt:"Back"})}),(0,p.jsx)(D.Z,{variant:"slideSubHeading",align:"left",children:e.demographic.label})]}),(0,p.jsx)(U.Z,{label:e.demographic.textPlaceholder,variant:"outlined",defaultValue:o,onChange:e=>{let t=e.target.value.trim();m?g(t):s(t)},helperText:a,error:c,autoComplete:"off",color:"buttonStandard",inputProps:{style:{textTransform:e.demographic.textCapitalisation?"uppercase":void 0}},InputProps:{sx:{background:"white",fontSize:"2rem"}},InputLabelProps:{sx:{fontSize:"2rem","&.MuiOutlinedInput-notchedOutline":{fontSize:"2rem"}}}})]})})}var V=n(8260);function O(e){var t,n,i,r;let o;let{answers:s}=(0,V.ZP)(e.qids.qid),[a,l]=(0,x.useState)((0,V.Zp)(s,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[c,d]=(0,x.useState)(!1),[u,h]=(0,x.useState)(!1),[m,f]=(0,x.useState)((o=[],(null===(n=e.showGender)||void 0===n||n)&&o.push(A),(null===(i=e.showAge)||void 0===i||i)&&o.push(_),(null===(r=e.showEthnicity)||void 0===r||r)&&o.push(R),void 0!==e.showPostcode&&o.push(q[e.showPostcode]),[...o,...e.customDemographics])),[y,v]=(0,x.useState)(),[b,w]=(0,x.useState)({});(0,x.useEffect)(()=>{let e={};(null==a?void 0:a.jsonValue)&&a.jsonValue.answers.forEach(t=>{e[t.key]={key:t.optionKey,display:t.stringValue}}),w(e)},[a]),(0,x.useEffect)(()=>{let t=g().every(m,e=>b.hasOwnProperty(e.key));h(e.role===P._b.Client&&t)},[b]);let j=async()=>{if(e.role!==P._b.Client)console.warn("Only participants can submit answers");else{let t={...a,jsonValue:{answers:Object.entries(b).map(e=>({key:e[0],optionKey:e[1].key,stringValue:e[1].display}))}};d(!0),e.onAnswer(t).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)l(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{d(!1)})}},k=!1===e.opaqueInputBox?void 0:{background:"white"},Z=e=>{var t;return(0,p.jsx)(I.Z,{color:"buttonStandard",variant:"outlined",sx:{alignSelf:"stretch",py:0,...e.inputBoxSx},onClick:()=>e.onClick(),children:(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:0},children:[void 0!==e.display&&(0,p.jsx)(D.Z,{variant:"selectTiny",children:e.label}),(0,p.jsx)(D.Z,{variant:"selectLarge",component:"div",children:null!==(t=e.display)&&void 0!==t?t:e.label})]}),(0,p.jsx)("img",{src:"/icons/select-down.svg"})]})})};return(0,p.jsxs)(p.Fragment,{children:[void 0===y&&(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(W,{endBar:(0,p.jsx)(N.Z,{btnKey:"submit",btnText:"Submit",onClick:()=>{j()},disabled:!u,busy:c}),children:(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,p.jsx)(E.Z,{sx:{mb:4,mx:8},children:e.question&&(0,p.jsx)(F.Z,{content:e.question})}),m.map(e=>(0,p.jsx)(Z,{label:e.label,display:b.hasOwnProperty(e.key)?b[e.key].display:void 0,onClick:()=>{v(e)},inputBoxSx:k},"overview-demographic-".concat(e.key)))]})})}),void 0!==y&&"select"===y.mode&&(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(B,{demographic:y,currentSelection:b[y.key],onBack:()=>{v(void 0)},onSelection:e=>{w({...b,[y.key]:e}),v(void 0)},layout:y.layout,layoutProps:y.layoutProps})}),void 0!==y&&"text"===y.mode&&(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(M,{demographic:y,skipPermitted:!0,currentSelection:b[y.key],onBack:()=>{v(void 0)},onSelection:e=>{w({...b,[y.key]:e}),v(void 0)}})})]})}function L(e){return(0,p.jsx)("img",{className:"stretch",style:{width:"100%",height:"100%",...e.style},src:e.src})}function z(e){let[t,n]=(0,x.useState)(e.sideSx),[i,r]=(0,x.useState)(e.mainSx);return(0,x.useEffect)(()=>{void 0!==e.sideBackgroundImage&&n({backgroundImage:"url(".concat(e.sideBackgroundImage,")"),...e.sideSx}),void 0!==e.mainBackgroundImage&&r({backgroundImage:"url(".concat(e.mainBackgroundImage,")"),...e.mainSx})},[]),(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"row"},children:[(0,p.jsx)(E.Z,{sx:{width:"35%",display:"block",...e.sideSx},children:e.side}),(0,p.jsx)(E.Z,{sx:{px:2,alignSelf:"stretch",display:"block",overflowY:"auto",width:"60%",...e.mainSx},children:e.main})]})})}function G(e){let{answers:t}=(0,V.ZP)(e.qids.qid),n=()=>(0,V.UJ)(t,e.qids),[i,r]=(0,x.useState)(n()),[o,s]=(0,x.useState)((0,V.S9)(i)?1:0);return(0,x.useEffect)(()=>{r(n())},[t]),(0,x.useEffect)(()=>{s((0,V.S9)(i)?1:0)},[i]),(0,x.useEffect)(()=>{j.Z.emit({type:j.M.Request_SlideRefresh})},[o]),(0,p.jsxs)(p.Fragment,{children:[0===o&&e.input,1===o&&e.completion]})}function H(e){var t;let{content:n,sx:i}=e;return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",...i},children:[(0,p.jsx)(D.Z,{variant:"slideHeading",children:null!==(t=n.message)&&void 0!==t?t:"Thanks!"}),n.factoid&&(0,p.jsx)(D.Z,{variant:"slideBody",sx:{mt:8},children:n.factoid})]})})}function K(e){let{sx:t,children:n}=e;return(0,p.jsx)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",overflowY:"auto",overflowX:"hidden",display:"block",...t},children:n})}function J(e){let t={...e.sx,color:e.color};return(0,p.jsx)(D.Z,{variant:e.variant,component:"div",sx:t,align:e.align,children:e.children})}(i=l||(l={}))[i.Input=0]="Input",i[i.Completion=1]="Completion";var Y=n(30089);function Q(e){let t={backgroundImage:"url('".concat(e.src,"')")};return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"block",...t,...e.sx},children:e.children})})}function X(e){return(0,p.jsx)("img",{src:e.src,style:e.style,alt:e.alt})}var $=n(22960);function ee(e){let{answers:t}=(0,V.ZP)(e.qids.qid),n=(0,$.Z)();return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",overflowX:"hidden",overflowY:"auto"},children:[e.question&&(0,p.jsx)(F.Z,{content:e.question}),(0,p.jsx)(E.Z,{display:"flex",flexDirection:"column",alignItems:"center",children:t.map((t,i)=>{var r;return(0,p.jsx)(p.Fragment,{children:null===(r=t.jsonValue)||void 0===r?void 0:r.answers.map(t=>(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(E.Z,{sx:{mb:4,px:2,mx:8},className:"shadow",style:{background:"white",border:"solid 2px",borderColor:i%2==0?n.palette.primary.main:n.palette.secondary.main,borderRadius:12,transform:"rotate(".concat(i%2==0?1.5:-1.5,"deg)")},children:(0,p.jsx)(D.Z,{variant:"slideBody",children:t.stringValue})},"speech-bubble-".concat(e.qids.qid,"-").concat(t.key))}))})})})]})})}function et(e){let{sx:t,children:n}=e;return(0,p.jsx)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",...t},children:(0,p.jsx)(E.Z,{alignSelf:"center",display:"inline-block",textAlign:"center",children:n})})}var en=n(49752);function ei(e){let t=(0,$.Z)(),n=90-90/e.sourceOptions.filter(e=>!e.isAlt).length;return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,p.jsx)(E.Z,{sx:{mb:4,mx:8},children:e.question&&(0,p.jsx)(F.Z,{content:e.question})}),(0,p.jsx)(E.Z,{display:"flex",flexDirection:"row",justifyContent:"center",sx:{gap:1,width:"".concat(n,"%")},children:e.displayOptions.filter(e=>!e.isAlt).map((n,i)=>{let r=e.currentlySelectedKeys.find(e=>e===n.key);return(0,p.jsxs)(E.Z,{sx:{borderRadius:4,px:1,flexGrow:1,flexBasis:0},style:{minHeight:200,border:"solid 4px",background:r?t.palette.optionButtonSelected.main:t.palette.optionButtonUnselected.main,borderColor:r?t.palette.optionButtonSelectedBorder.main:"transparent",cursor:"pointer"},display:"flex",flexDirection:"column",justifyContent:"center",onClick:()=>e.onSelectionClick(n.key),children:[!!n.graphic&&(0,p.jsx)("img",{src:n.graphic,style:{alignSelf:"center",width:"40%"},alt:"".concat(n.display)}),(0,p.jsx)(D.Z,{variant:"yesNoUnsureButton",sx:{textWrap:"pretty"},children:n.display})]},"option-".concat(n.key,"-").concat(e.qid))})}),(0,p.jsx)(E.Z,{display:"flex",flexDirection:"column",alignItems:"center",sx:{mt:2},children:e.sourceOptions.filter(e=>e.isAlt).map((n,i)=>{let r=e.currentlySelectedKeys.find(e=>e===n.key);return(0,p.jsx)(E.Z,{sx:{p:2,borderRadius:4},style:{background:r?t.palette.optionButtonSelected.main:"transparent",border:"solid 4px transparent",borderColor:r?t.palette.optionButtonSelectedBorder.main:"transparent",cursor:"pointer"},onClick:()=>e.onSelectionClick(n.key),display:"flex",flexDirection:"column",justifyContent:"center",children:(0,p.jsx)(D.Z,{variant:"yesNoUnsureButton",style:{borderBottom:"solid 1px black"},children:n.display})},"option-".concat(n.key,"-").concat(e.qid))})}),e.showSubmit&&(0,p.jsx)(E.Z,{display:"flex",flexDirection:"row",justifyContent:"center",sx:{mt:4},children:(0,p.jsx)(en.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}var er=n(33351);function eo(e){let t=e.layoutParams.length>0?parseInt(e.layoutParams[0]):6,n=(0,$.Z)();return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(er.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,p.jsx)(er.Z,{sx:{mb:4,mx:8},children:e.question&&(0,p.jsx)(F.Z,{content:e.question})}),(0,p.jsx)(T.ZP,{container:!0,spacing:1,children:e.displayOptions.map((i,r)=>{let o=e.currentlySelectedKeys.find(e=>e===i.key);return(0,p.jsx)(T.ZP,{item:!0,xs:t,display:"flex",flexDirection:"column",alignContent:"stretch",children:(0,p.jsx)(I.Z,{variant:"contained",style:{display:"flex",flexDirection:"column",justifyContent:"center",border:"solid 4px",background:o?n.palette.optionButtonSelected.main:n.palette.optionButtonUnselected.main,borderColor:o?n.palette.optionButtonSelectedBorder.main:"transparent",color:"black"},onClick:()=>e.onSelectionClick(i.key),children:(0,p.jsx)(D.Z,{variant:"submitButton",children:i.display})})},"answer-".concat(e.qid,"-").concat(i.key))})}),e.showSubmit&&(0,p.jsx)(er.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end",sx:{mt:4},children:(0,p.jsx)(en.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}function es(e){let t=(0,$.Z)();return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(er.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,p.jsx)(er.Z,{sx:{mb:4,mx:8},children:e.question&&(0,p.jsx)(F.Z,{content:e.question})}),(0,p.jsx)(er.Z,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",gap:1},children:e.displayOptions.map((n,i)=>{let r=e.currentlySelectedKeys.find(e=>e===n.key);return(0,p.jsx)(I.Z,{variant:"contained",style:{display:"flex",flexDirection:"column",justifyContent:"center",border:"solid 4px",background:r?t.palette.optionButtonSelected.main:t.palette.optionButtonUnselected.main,borderColor:r?t.palette.optionButtonSelectedBorder.main:"transparent",color:"black"},onClick:()=>e.onSelectionClick(n.key),children:(0,p.jsx)(D.Z,{variant:"submitButton",children:n.display})},"answer-".concat(e.qid,"-").concat(n.key))})}),e.showSubmit&&(0,p.jsx)(er.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end",sx:{mt:4},children:(0,p.jsx)(en.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}let ea=(e,t)=>t.filter(t=>!!e.find(e=>e===t.key)),el=e=>[...e].sort(()=>Math.random()-.5);function ec(e){var t;let[n,i]=(0,x.useState)(e.shuffle?el(e.options):e.options),{answers:r}=(0,V.ZP)(e.qids.qid),[o,s]=(0,x.useState)((0,V.Zp)(r,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[a,l]=(0,x.useState)([]);(0,x.useEffect)(()=>{var t,n;l(ea(null!==(n=null===(t=o.jsonValue)||void 0===t?void 0:t.answers.filter(e=>!0===e.booleanValue).map(e=>e.key))&&void 0!==n?n:[],e.options))},[o]);let[c,d]=(0,x.useState)(!1),u=e.role===P._b.Client,h=()=>a.length>=e.minSelections&&a.length<=e.maxSelections,m=async()=>{if(h())try{d(!0);var t={...o,jsonValue:{answers:a.map(t=>({key:t.key,booleanValue:!0,numericValue:1,index:e.options.findIndex(e=>e.key===t.key)}))}},n=await e.onAnswer(t);if(console.debug("Answer submitted ".concat(n?"ok":"error")),console.debug("Received answer response",n),n)s(n);else throw"No response received"}catch(e){console.error("Error submitting answer",e)}finally{d(!1)}},f=t=>{console.debug("Selection clicked: "+t);let n=e.options.find(e=>e.key===t);if(void 0===n)throw"Cannot identify this option from props.options";if(a.find(e=>e.key===t))l(a.filter(e=>e.key!==t));else if(a.length>=e.maxSelections){let e=a.find(e=>e.key!==t);l([...a.filter(t=>t!==e),n])}else l([...a,n])},g=()=>({onSubmit:m,onSelectionClick:f,qid:e.qids.qid,question:e.question,sourceOptions:e.options,displayOptions:n,busy:c,showSubmit:u,enableSubmit:h(),minSelections:e.minSelections,maxSelections:e.maxSelections,currentlySelectedKeys:a.map(e=>e.key),layoutParams:e.layoutParams}),[y,v]=(0,x.useState)(g());return(0,x.useEffect)(()=>{v(g())},[c,a]),(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:(0,p.jsxs)(E.Z,{sx:{flexGrow:1,display:"block"},children:["yes-no-unsure"===e.layout&&(0,p.jsx)(ei,{...y}),"button-grid"===e.layout&&(0,p.jsx)(eo,{...y}),"buttons-inline"===e.layout&&(0,p.jsx)(es,{...y})]})})})}function ed(e){let t=(0,$.Z)(),n=void 0===e.chartBackground||e.chartBackground;return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1,overflowY:"hidden"},children:[e.title&&(0,p.jsx)(J,{variant:"summaryTitle",sx:{p:0,px:1},align:"left",children:e.title}),e.prompt&&(0,p.jsx)(J,{variant:"summaryPrompt",sx:{p:0,px:1},align:"left",children:e.prompt}),(0,p.jsx)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",gap:1,alignItems:"stretch",overflowY:"hidden"},children:e.children.map((e,i)=>(0,p.jsx)(E.Z,{sx:{background:n?t.palette.summaryChartBackground.main:void 0,borderRadius:n?4:void 0,flexGrow:1,flexBasis:0,p:2,display:"block",overflow:"auto"},children:e},"summary-slide-child-".concat(i)))})]})})}var eu=n(40468),eh=n(67506),ep=n(11144),ex=n(1973);function em(e){let{api:t,start:n}=(0,x.useContext)(ex.E),{session:i}=(0,x.useContext)(ep.z),r=(0,x.useContext)(eh.G),o=(0,x.useContext)(m.rZ),[s,a]=(0,x.useState)(0),l={videoId:e.videoId,modeChange:P.tB.NotStarted,modeChangePosition_s:0,modeChangeServerTime_ms:Date.now()},[c,d]=(0,x.useState)(l),[u,h]=(0,x.useState)(-1),[f,g]=(0,x.useState)(),[y,v]=(0,x.useState)(0),[b,w]=(0,x.useState)(!1),[k,Z]=(0,x.useState)(!1),S=(0,x.useRef)(null),C=function(e){let[t,n]=(0,x.useState)(!1),i=(0,x.useMemo)(()=>new IntersectionObserver(e=>{let[t]=e;return n(t.isIntersecting)}),[]);return(0,x.useEffect)(()=>(i.observe(e.current),()=>{i.disconnect()}),[i,e]),t}(S);(0,x.useEffect)(()=>{if(i.liveExperienceState.sequence>u){var t;h(i.liveExperienceState.sequence);let n=null===(t=i.liveExperienceState.videoSync)||void 0===t?void 0:t.find(t=>t.videoId===e.videoId);void 0!==n&&d(n)}},[i.liveExperienceState.sequence]),(0,x.useEffect)(()=>{if(C)switch(console.debug("onScreen",e.videoId),s){case 0:D().then(()=>a(1)).catch(e=>{console.error(e),a(2)});break;case 4:case 1:q().then(()=>a(3)).catch(e=>{console.error(e),a(2)})}else 3===s&&(A(),a(4))},[s,C]);let D=async()=>{if(null===S.current)throw console.warn("playerRef not ready"),Error("Player not ready");console.debug("Initialising video player"),S.current.addEventListener("play",e=>{v(1)}),S.current.addEventListener("pause",e=>{v(0)}),S.current.addEventListener("ended",e=>{v(0)})};(0,x.useEffect)(()=>{w(1===y)},[y]);let q=async()=>{if(null===S.current)throw Error("Player not ready");S.current.setAttribute("src",e.videoUri),S.current.load(),w(!1)},A=async()=>{S.current&&(S.current.removeAttribute("src"),S.current.load(),w(!1))},_=(0,x.useCallback)(()=>{if(document.hidden)o.role!==P._b.Controller||null===S.current||S.current.paused||W();else try{switch(c.modeChange){case P.tB.Paused:case P.tB.Ended:T(c);break;case P.tB.Playing:R(c)}}catch(e){console.warn("Error syncing video",e)}},[c,e.videoId,o.role]);(0,x.useEffect)(()=>{let t={type:j.M.Media_Playback_Update,data:{videoId:e.videoId,isPlaying:b}};console.debug("MEDIA",t.data),j.Z.emit(t)},[b]),(0,x.useEffect)(()=>{document.addEventListener("visibilitychange",()=>_())},[]),(0,x.useEffect)(()=>{if(null!==S.current&&3===s&&c.videoId===e.videoId){console.debug("video sync received",c);try{switch(c.modeChange){case P.tB.Paused:case P.tB.Ended:T(c);break;case P.tB.Playing:R(c)}}catch(e){console.warn("Error syncing video",e)}}},[c,s,S]);let R=async e=>{if(console.debug("Play state..."),null===S.current)return;let t=r.fromServerTime(e.modeChangeServerTime_ms),n=Date.now();if(t<=n){let i=n-t;console.debug("State change was ".concat(i,"ms in the past...")),F(e.modeChangePosition_s+i/1e3)}if(t>n){void 0!==f&&clearTimeout(f);let i=t-n;console.debug("State change ".concat(i,"ms in the future...")),i<0&&console.warn("State change projected into the past with a negative delay.");let r=setTimeout(()=>{g(void 0),F(e.modeChangePosition_s)},i);g(r)}w(!0)},F=async t=>{if(console.debug("Playing video",e.videoId,t),null===S.current){console.warn("Cannot play - no player reference available.");return}if(S.current.currentTime=t,S.current.paused)try{S.current.muted=!0,console.debug("Starting player from paused. Ready state is: ".concat(S.current.readyState));let e=Date.now();await S.current.play();let n=Date.now()-e;console.debug("Play start duration: ".concat(n,"ms"));let i=t+n/1e3;i<0&&console.warn("Post play correction: negative position."),i>S.current.duration&&console.warn("Post play correction: position exceeds duration."),i>0&&S.current.duration>i&&(console.debug("Post play correction: local position out by ".concat(S.current.currentTime-i,"ms")),S.current.currentTime=i)}catch(e){console.error("Cannot play video",e)}finally{S.current.muted=!e.audio}},T=e=>{null!==S.current&&(S.current.currentTime=e.modeChangePosition_s,S.current.paused||S.current.pause(),w(!1))},B=async(s,a)=>{if(null===S.current)return!1;try{Z(!0);let l=S.current.currentTime,c={videoId:e.videoId,modeChange:s,modeChangePosition_s:l,modeChangeServerTime_ms:r.toServerTime(null!=a?a:Date.now())},d={action:"set-video-sync",sessionId:i.id,parameters:c};return await n(t.postFacilitatorAction(o.user.access_token,o.sessionToken,d,!1)),!0}catch(e){return console.error(e),!1}finally{Z(!1)}},W=async()=>{if(null===S.current)return;let e=S.current.paused?P.tB.Playing:P.tB.Paused,t=e===P.tB.Playing?Date.now()+2e3:void 0;await B(e,t)?console.debug("Video sync send ok"):console.error("Video sync send failed")},N=async()=>{if(null===S.current)return;let e=S.current.currentTime-15;e<0&&(e=0),S.current.currentTime=e,await B(P.tB.Paused)?console.debug("Video sync send ok"):console.error("Video sync send failed")},U=async()=>{if(null===S.current)return;let e=S.current.currentTime+15;e>S.current.duration&&(e=S.current.duration),S.current.currentTime=e,await B(P.tB.Paused)?console.debug("Video sync send ok"):console.error("Video sync send failed")},M=async()=>{null!==S.current&&(S.current.currentTime=0,await B(P.tB.Paused)?console.debug("Video sync send ok"):console.error("Video sync send failed"))};return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[2!==s&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("video",{ref:S,poster:e.posterUri,preload:"auto",loop:!1,autoPlay:!1,controls:!1,muted:!0,crossOrigin:"anonymous",style:{flexGrow:1},playsInline:!0,"webkit-playsinline":"true"}),e.controls&&null!==S.current&&(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{display:"flex",flexDirection:"row",alignSelf:"stretch",justifyContent:"center",sx:{gap:2,mt:1},children:[(0,p.jsx)(I.Z,{variant:"outlined",disabled:k,onClick:M,children:"Restart"}),(0,p.jsx)(I.Z,{variant:"outlined",disabled:k,onClick:N,children:"-15s"}),void 0!==f&&(0,p.jsx)(eu.Z,{variant:"indeterminate"}),(0,p.jsx)(I.Z,{variant:0===y?"contained":"outlined",disabled:k,onClick:W,children:"play/pause"}),(0,p.jsx)(I.Z,{variant:"outlined",disabled:k,onClick:U,children:"+15s"})]})})]}),2===s&&(0,p.jsx)("p",{children:"Failed to initialise video."})]})})}(r=c||(c={}))[r.Init=0]="Init",r[r.Loading=1]="Loading",r[r.InitError=2]="InitError",r[r.Ready=3]="Ready",r[r.Unloaded=4]="Unloaded",(o=d||(d={}))[o.Paused=0]="Paused",o[o.Playing=1]="Playing";var ef=n(14874),eg=n(40772);function ey(e){let{allAnswers:t}=(0,V.ZP)(),n=()=>{for(let n of e.qids)if(!(0,V.S9)((0,V.UJ)(t[n.qid],n)))return e.qids.indexOf(n)},[i,r]=(0,x.useState)(n());(0,x.useEffect)(()=>{let e=n();i!==e&&r(e)},[t]);let o=(0,ef.Z)(),s=[.2,.25],[a]=(0,eg.u)({duration:500});return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{ref:a,className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"stretch",p:2,gap:2,boxSizing:"border-box"},children:[void 0!==i&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(F.Z,{content:e.question}),(0,p.jsx)(E.Z,{sx:{flexGrow:1,boxSizing:"border-box",overflowY:"auto",overflowX:"hidden",display:"block"},children:e.inputs[i]},"input-sequence-element-".concat(e.qids[i].qid))]}),void 0===i&&(0,p.jsx)(E.Z,{sx:{flexGrow:1,display:"block"},children:e.completion}),void 0!==i&&e.showProgress&&(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:g().range(0,e.inputs.length).map((t,n)=>(0,p.jsx)(E.Z,{sx:{background:t===i?o.palette.progressBlipSelected.main:o.palette.progressBlipUnselected.main,width:"".concat(s[t===i?1:0],"em"),height:"".concat(s[t===i?1:0],"em"),borderRadius:"".concat(s[t===i?1:0]/2,"em")}},"sequence-blip-".concat(t,"-").concat(e.qids[t].qid)))})]})})}var ev=n(34990),eb=n(60335);(s=u||(u={}))[s.Yes=0]="Yes",s[s.No=1]="No",s[s.Unsure=2]="Unsure";let ew=e=>0===e?1:1===e?-1:0,ej=e=>1===e?0:-1===e?1:2;function ek(e){var t;let{answers:n}=(0,V.ZP)(e.qids.qid),[i,r]=(0,x.useState)((0,V.Zp)(n,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[o,s]=(0,x.useState)(i),[a,l]=(0,x.useState)(!1),c=e.role===P._b.Client;(0,x.useEffect)(()=>{s({...i})},[i]);let d=async e=>{if(c&&!a){let t={...o,jsonValue:{answers:[{key:"vote",stringValue:u[e],numericValue:ew(e)}]}};await h(t)}},h=async t=>{try{l(!0);let n=await e.onAnswer(t);if(null!==n)r(n);else throw"Failed to submit answer"}catch(e){console.error(e)}finally{l(!1)}},m=(0,ef.Z)();return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[(0,p.jsx)(F.Z,{content:e.question}),(0,p.jsxs)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,p.jsxs)(ev.Z,{elevation:0,sx:{p:4,mb:2,width:"60%",height:"70%",alignSelf:"center",minHeight:200,borderRadius:4,background:m.palette.promptPanelBackground.main,display:"flex",flexDirection:"row",alignContent:"center",justifyContent:"stretch"},children:[(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,p.jsx)("div",{style:{position:"absolute",width:"15%",height:"20%",padding:0,margin:0},children:(0,p.jsx)(eb.Z,{sx:{position:"relative",left:"-100%",top:0,width:"100%",height:"100%",m:0,p:0},onClick:()=>d(1),disabled:!c||a,style:{opacity:c&&!a?1:.5},children:(0,p.jsx)("img",{src:"/icons/updown/cross.svg"})})})}),(0,p.jsx)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center",p:2},children:(0,p.jsx)(D.Z,{variant:"upDownQuestion",sx:{textAlign:"center",alignSelf:"center"},children:e.assertion})}),(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,p.jsx)("div",{style:{position:"absolute",width:"15%",height:"20%",padding:0,margin:0},children:(0,p.jsx)(eb.Z,{sx:{position:"relative",right:0,top:0,width:"100%",height:"100%",m:0,p:0},style:{opacity:c&&!a?1:.5},onClick:()=>d(0),disabled:!c||a,children:(0,p.jsx)("img",{src:"/icons/updown/check.svg"})})})})]}),(0,p.jsx)(E.Z,{sx:{p:2,borderRadius:4,cursor:"pointer",opacity:c&&!a?1:.5,alignSelf:"center"},onClick:()=>d(2),display:"flex",flexDirection:"column",justifyContent:"center",children:(0,p.jsx)(D.Z,{variant:"submitButton",style:{borderBottom:"solid 1px black"},children:"Unsure"})})]})]})})}function eZ(e){let t=(0,$.Z)();return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:(0,p.jsxs)(T.ZP,{container:!0,flexGrow:1,children:[(0,p.jsx)(T.ZP,{item:!0,xs:12,sx:{pb:1},children:(0,p.jsxs)(E.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,p.jsx)("img",{src:"/icons/updown/qmark.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,p.jsx)(J,{variant:"upDownCategory",children:"These statements split the room..."})]}),e.mostDivisive.map((e,n)=>(0,p.jsx)(J,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDivided.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})}),(0,p.jsx)(T.ZP,{item:!0,xs:6,sx:{pr:1},children:(0,p.jsxs)(E.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,p.jsx)("img",{src:"/icons/updown/check.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,p.jsx)(J,{variant:"upDownCategory",children:"Most people agreed with..."})]}),e.mostlySupported.map((e,n)=>(0,p.jsx)(J,{variant:"upDownQuestion",sx:{background:t.palette.backgroundAgree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})}),(0,p.jsx)(T.ZP,{item:!0,xs:6,sx:{p:0},children:(0,p.jsxs)(E.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,p.jsx)("img",{src:"/icons/updown/cross.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,p.jsx)(J,{variant:"upDownCategory",children:"Most people disagreed with..."})]}),e.mostlyOpposed.map((e,n)=>(0,p.jsx)(J,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDisagree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})})]})})})}function eS(e){let t=(0,$.Z)();return(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,p.jsxs)(E.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,p.jsx)("img",{src:"/icons/updown/qmark.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,p.jsx)(J,{variant:"upDownCategory",children:"These statements split the room..."})]}),e.mostDivisive.map((e,n)=>(0,p.jsx)(J,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDivided.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]}),(0,p.jsxs)(E.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,p.jsx)("img",{src:"/icons/updown/check.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,p.jsx)(J,{variant:"upDownCategory",children:"Most people agreed with..."})]}),e.mostlySupported.map((e,n)=>(0,p.jsx)(J,{variant:"upDownQuestion",sx:{background:t.palette.backgroundAgree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]}),(0,p.jsxs)(E.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2},children:[(0,p.jsx)("img",{src:"/icons/updown/cross.svg",alt:"Disagree icon",style:{width:"1em",height:"1em"}}),(0,p.jsx)(J,{variant:"upDownCategory",children:"Most people disagreed with..."})]}),e.mostlyOpposed.map((e,n)=>(0,p.jsx)(J,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDisagree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})]})}function eC(e){let{allAnswers:t}=(0,V.ZP)(),[n,i]=(0,x.useState)([]),[r,o]=(0,x.useState)([]),[s,a]=(0,x.useState)([]),[l,c]=(0,x.useState)([]);return(0,x.useEffect)(()=>{let n=[],r=[],s=[],l=[];Object.entries(t).forEach(t=>{let[i,o]=t;if(void 0!==Object.keys(e.questions).find(e=>e===i)){let t=o.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&ej(e.jsonValue.answers[0].numericValue)===u.Yes}).length,a=o.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&ej(e.jsonValue.answers[0].numericValue)===u.No}).length,c=o.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&ej(e.jsonValue.answers[0].numericValue)===u.Unsure}).length,d=e.questions[i].assertion,h={qid:i,assertion:d,yes:t,no:a,unsure:c},p=t+a;p>0?t>=2*p/3?n=[...n,h]:a>=2*p/3?r=[...r,h]:s=[...s,h]:l=[...l,h]}}),o(n),a(r),i(s),c(l)},[t,e.questions]),(0,p.jsxs)(p.Fragment,{children:["tshape"===e.layout&&(0,p.jsx)(eZ,{mostDivisive:n,mostlySupported:r,mostlyOpposed:s,unanswered:l}),"column"===e.layout&&(0,p.jsx)(eS,{mostDivisive:n,mostlySupported:r,mostlyOpposed:s,unanswered:l})]})}var eI=n(26049),eE=n(45231);function eD(e){let t=(0,x.useContext)(m.rZ),{answers:n}=(0,V.ZP)(e.qids.qid),i=()=>{var t;return(0,V.Zp)(n,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)},[r,o]=(0,x.useState)(i()),[s,a]=(0,x.useState)(i()),[l,c]=(0,x.useState)(!1),[d,u]=(0,x.useState)(!1),[h,f]=(0,x.useState)(e.points),[y,v]=(0,x.useState)(e.options.map(e=>({min:0,max:e.max}))),[b,w]=(0,x.useState)(e.options.map(()=>0)),j=(e,t)=>{w(b.map((n,i)=>i===t?e:n))};(0,x.useEffect)(()=>{let n=e.points-g().sum(b);f(n);for(let t=0;t<e.options.length;t++)v(y.map((e,t)=>({min:0,max:b[t]+n})));let i={answers:[]};for(let t=0;t<e.options.length;t++)i.answers.push({key:e.options[t].key,description:e.options[t].title,numericValue:b[t]});a({...s,jsonValue:i}),u(0===n&&t.role!==P._b.Controller)},[b]);let k=async()=>{c(!0),e.onAnswer(s).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)o(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{c(!1)})},Z=(e,t)=>g().range(e,t+1,1).map((e,t)=>({value:e,label:"".concat(e)})),S=(0,$.Z)();return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"row",gap:1,mb:2},children:e.question&&(0,p.jsx)(F.Z,{content:e.question})}),(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"column",gap:1,flexGrow:1,overflowX:"hidden",overflowY:"auto",px:1},children:e.options.map((e,n)=>(0,p.jsxs)(E.Z,{sx:{background:"#f0f0f0",p:2,borderRadius:4,display:"flex",flexDirection:"row",alignItems:"stretch",gap:2},children:[e.graphic&&(0,p.jsx)(E.Z,{sx:{width:"20%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url(".concat(e.graphic,")"),borderRadius:2}}),(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"column",gap:1,width:"80%"},children:[(0,p.jsx)(D.Z,{variant:"pointsAllocationCategoryTitle",align:"left",children:e.title}),(0,p.jsx)(D.Z,{variant:"pointsAllocationCategoryDescription",align:"left",children:e.description}),(0,p.jsx)(E.Z,{sx:{px:2},children:(0,p.jsx)(eI.Z,{onCommit:e=>{j(e,n)},color:"secondary",sliderDefault:b[n],marks:Z(e.min,e.max),slots:{markLabel:eE.A},min:e.min,max:e.max,step:1,sliderMode:"multi",acceptableRange:{min:y[n].min,max:y[n].max},disabled:t.role===P._b.Controller})})]})]},"points-allocation-option-".concat(n)))}),(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"end",gap:1,mx:1},children:[(0,p.jsxs)(D.Z,{variant:"pointsAllocationCategoryTitle",align:"left",color:S.palette.secondary.main,children:[h," points remaining"]}),(0,p.jsx)(en.Z,{enabled:d,inline:!0,busy:l,onSubmit:()=>k()})]})]})})}function eP(e){let{answers:t}=(0,V.ZP)(e.qids.qid),n=()=>{var n;return(0,V.Zp)(t,e.qids,null===(n=e.question)||void 0===n?void 0:n.pii)},[i,r]=(0,x.useState)(n()),[o,s]=(0,x.useState)(n()),[a,l]=(0,x.useState)(!1),[c,d]=(0,x.useState)(e.role===P._b.Client),[u,h]=(0,x.useState)({});(0,x.useEffect)(()=>{let t={...u};e.options.forEach(n=>{var r,o,s;t[n.key]=null!==(s=null===(o=i.jsonValue)||void 0===o?void 0:null===(r=o.answers.find(e=>e.key===n.key))||void 0===r?void 0:r.numericValue)&&void 0!==s?s:Math.floor((e.min+e.max)/2)}),h(t),s({...i,jsonValue:{answers:e.options.map(n=>{var i,r;return{key:n.key,numericValue:null!==(i=t[n.key])&&void 0!==i?i:Math.floor((e.min+e.max)/2),description:n.description,index:null!==(r=t[n.key])&&void 0!==r?r:Math.floor((e.min+e.max)/2)}})}})},[i]);let m=t=>u.hasOwnProperty(t)?u[t]:Math.floor((e.min+e.max)/2),f=(t,n)=>{var i,r,a;let l=null!==(r=o.jsonValue)&&void 0!==r?r:{answers:[]};l.answers=l.answers.filter(e=>e.key!==t),l.answers.push({key:t,numericValue:n,description:null!==(a=null===(i=e.options.find(e=>e.key===t))||void 0===i?void 0:i.description)&&void 0!==a?a:"".concat(n),index:n}),s({...o,jsonValue:l})},g=async()=>{e.role!==P._b.Controller&&(l(!0),e.onAnswer(o).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)r(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{l(!1)}))};return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1,px:8},children:[(0,p.jsxs)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1,overflowX:"hidden",overflowY:"auto",justifyContent:"center",px:0},children:[(0,p.jsx)(E.Z,{sx:{mb:8},children:e.question&&(0,p.jsx)(F.Z,{content:e.question})}),(0,p.jsxs)(T.ZP,{container:!0,sx:{alignItems:"center"},children:[(0,p.jsx)(T.ZP,{item:!0,xs:3}),(0,p.jsx)(T.ZP,{item:!0,xs:9,style:{textAlign:"left"},sx:{pr:3},children:e.labels.map((t,n)=>{let i=e.max-e.min,r=t.at-e.min,o=t.at===e.min,s=t.at===e.max;return(0,p.jsx)(E.Z,{style:{position:"relative",left:"".concat(r/i*100,"%")},children:(0,p.jsx)(E.Z,{style:{position:"absolute",transform:o?"translate(0, -0.5em)":s?"translate(-100%, -0.5em)":"translate(-50%, -0.5em)",maxWidth:"".concat(100/e.labels.length,"%")},children:(0,p.jsx)(D.Z,{variant:"body1",component:"div",sx:{fontWeight:"bold"},children:t.text})})},"".concat(e.qids.qid,"-label-").concat(n,"-at-").concat(t.at))})}),e.options.map((t,n)=>(0,p.jsxs)(x.Fragment,{children:[(0,p.jsxs)(T.ZP,{item:!0,xs:3,children:[(0,p.jsx)(D.Z,{variant:"body1",align:"left",component:"div",sx:{pr:6},children:t.title}),e.showDescriptions&&!1]}),(0,p.jsx)(T.ZP,{item:!0,xs:9,sx:{pr:3},children:(0,p.jsx)(eI.Z,{onCommit:e=>{f(t.key,e)},color:"secondary",sliderDefault:m(t.key),marks:!0,min:e.min,max:e.max,step:1,sliderMode:"multi",sx:{mt:1}})})]},"".concat(e.qids.qid,"-option-").concat(t.key)))]})]}),e.role===P._b.Client&&(0,p.jsx)(E.Z,{children:(0,p.jsx)(en.Z,{onSubmit:g,text:"Submit",busy:a,enabled:c,inline:!1,alignment:"right"})})]})})}var eq=n(73391);let eA=(e,t)=>{if(!e||0===e.length)return[];let n=new Map;return e.forEach(e=>{var t;null===(t=e.jsonValue)||void 0===t||t.answers.forEach(e=>{var t;let i=e.key,r=null!==(t=e.numericValue)&&void 0!==t?t:0;n.has(i)||n.set(i,0),n.set(i,n.get(i)+r)})}),Array.from(n.entries()).sort((e,t)=>e[1]-t[1]).reverse().slice(0,t).map(e=>({key:e[0],count:e[1]}))},e_=(e,t)=>e&&0!==e.length?t&&0!==t.length?e.map(n=>{let i=t.find(e=>e.key===n.key);if(!i){console.warn("No description found for option: ".concat(n.key),e,t);return}return{key:n.key,title:i.title,description:i.description,graphic:i.graphic,count:n.count}}).filter(e=>!!e).map(e=>e):(console.warn("No described options available"),[]):[];function eR(e){let{answers:t}=(0,V.ZP)(e.qids.qid),[n,i]=(0,x.useState)([]),[r,o]=(0,x.useState)([]);(0,x.useEffect)(()=>{i(eA(t,e.displayCount))},[t,e.displayCount]),(0,x.useEffect)(()=>{o(e_(n,e.options))},[n,e.options]);let s=(0,$.Z)();return(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[e.question&&(0,p.jsx)(F.Z,{content:e.question}),(0,p.jsx)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",alignItems:"stretch",justifyContent:"stretch",gap:1},children:r.map((t,n)=>(0,p.jsxs)(E.Z,{sx:{flexGrow:1,flexBasis:0,p:2,borderRadius:2,background:s.palette.summaryChartBackground.main,display:"flex",flexDirection:"column",gap:1,mt:2*n},children:[(0,p.jsx)(D.Z,{variant:"topOptionsOptionRank",align:"left",children:(0,eq.q)(n+1)}),(0,p.jsxs)(D.Z,{variant:"topOptionsOptionPoints",align:"left",children:["Total points: ",t.count]}),(0,p.jsx)(E.Z,{sx:{width:"10%",height:0,border:"4px solid black",borderRadius:"4px",mt:1,mb:3}}),(0,p.jsx)(D.Z,{variant:"topOptionsOptionTitle",align:"left",children:t.title}),void 0!==t.graphic&&(0,p.jsx)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"end"},children:(0,p.jsx)(E.Z,{sx:{maxHeight:"20vh",height:"20vh",backgroundImage:"url(".concat(t.graphic,")"),backgroundSize:"cover",backgroundPosition:"center",borderRadius:2}})},"".concat(e.qids.qid,"-top-option-").concat(n,"-graphic-").concat(t.key))]},"".concat(e.qids.qid,"-top-option-").concat(n,"-description-").concat(t.key)))})]})}function eF(e){var t;let n=(0,x.useContext)(m.rZ),{answers:i}=(0,V.ZP)(e.qids.qid),[r,o]=(0,x.useState)((0,V.Zp)(i,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[s,a]=(0,x.useState)(r),[l,c]=(0,x.useState)(n.role!==P._b.Controller),[d,u]=(0,x.useState)(!1);(0,x.useEffect)(()=>{a(r)},[r]);let h=t=>{if(!l)return;u(!0);let n={...s,jsonValue:{answers:[{key:t,booleanValue:!0}]}};e.onAnswer(n).then(e=>{if(e)o(e);else throw"No response from submission"}).catch(e=>{console.error(e)}).finally(()=>{u(!1)})};return(0,p.jsxs)(p.Fragment,{children:[e.question&&(0,p.jsx)(F.Z,{content:e.question}),(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"row",gap:1,justifyContent:e.align},children:e.options.map((t,n)=>{var i;return(0,p.jsx)(I.Z,{variant:(null!==(i=t.variant)&&void 0!==i?i:0===n)?"contained":"outlined",color:t.colour,onClick:()=>h(t.key),disabled:!l||d,children:t.text},"ack-".concat(e.qids.qid,"-option-").concat(t.key))})})]})}var eT=n(84479),eB=n(11020);let eW=(e,t,n)=>{if(void 0===e.jsonValue||0===e.jsonValue.answers.length)return eU(t,n);let i=[];return e.jsonValue.answers.forEach(e=>{let n=t.find(t=>t.key===e.key);n&&(i[e.index]=n)}),i},eN=(e,t)=>{let n={answers:[]};return t.forEach((e,t)=>{n.answers.push({key:e.key,index:t,numericValue:t,description:e.title})}),{...e,jsonValue:n}},eU=(e,t)=>t?[...e].sort(()=>Math.random()-.5):e.sort((e,t)=>e.startingIndex-t.startingIndex);function eM(e){var t;let n=(0,x.useContext)(m.rZ),{answers:i}=(0,V.ZP)(e.qids.qid),[r,o]=(0,x.useState)((0,V.Zp)(i,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[s,a]=(0,x.useState)(n.role!==P._b.Controller),[l,c]=(0,x.useState)(!1),[d,u]=(0,x.useState)(eU(e.options,e.shuffle));(0,x.useEffect)(()=>{u(eW(r,e.options,e.shuffle))},[r]);let h=e=>{let t=d.findIndex(t=>t.key===e.key);if(t>0){let n=[...d];n.splice(t,1),n.splice(t-1,0,e),u(n)}},f=e=>{let t=d.findIndex(t=>t.key===e.key);if(t<d.length-1){let n=[...d];n.splice(t,1),n.splice(t+1,0,e),u(n)}},g=async()=>{if(n.role===P._b.Client&&s){c(!0);let t=eN(r,d);e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)u(eW(t,e.options,e.shuffle));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{c(!1)})}else console.warn("Only participants can submit answers")},y=(0,$.Z)(),[v]=(0,eg.u)({duration:500});return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(W,{endBar:(0,p.jsx)(N.Z,{btnKey:"submit",onClick:e=>{g()},disabled:!s,busy:l,variant:"contained",color:"buttonStandard",btnText:"Submit"}),children:[e.question&&(0,p.jsx)(E.Z,{sx:{mb:2},children:(0,p.jsx)(F.Z,{content:e.question})}),(0,p.jsx)(E.Z,{ref:v,sx:{display:"flex",flexDirection:"column"},children:d.map((t,n)=>(0,p.jsxs)(E.Z,{sx:{border:"solid 1px black",borderRadius:2,p:1.5,display:"flex",flexDirection:"row",gap:1,alignContent:"center",alignItems:"center",background:"white",mb:1,boxSizing:"border-box"},children:[(0,p.jsxs)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pr:2},children:[t.title&&(0,p.jsx)(D.Z,{variant:"rankedListItemTitle",align:"left",children:t.title}),t.description&&(0,p.jsx)(D.Z,{variant:"rankedListItemDescription",align:"left",children:t.description})]}),(0,p.jsx)(E.Z,{onClick:()=>{h(t)},sx:{display:"flex",flexDirection:"column",background:y.palette.updinkBackground.main,color:y.palette.updinkText.main,p:.5,borderRadius:2,cursor:0===n?void 0:"pointer",opacity:0===n?0:1},children:(0,p.jsx)(eT.Z,{sx:{fontSize:"2rem"}})}),(0,p.jsx)(E.Z,{onClick:()=>{f(t)},sx:{display:"flex",flexDirection:"column",background:y.palette.downdinkBackground.main,color:y.palette.downdinkText.main,p:.5,borderRadius:2,cursor:n===d.length-1?void 0:"pointer",opacity:n===d.length-1?0:1},children:(0,p.jsx)(eB.Z,{sx:{fontSize:"2rem"}})})]},"ranked-list-".concat(e.qids.qid,"-option-").concat(t.key)))})]})})}var eV=n(2962);let eO=e=>{let t=parseInt(e.replace("#",""),16);return[t>>16&255,t>>8&255,255&t]},eL=(e,t,n,i)=>{let r=eO(n),o=eO(i),s=Math.round(r[0]+(o[0]-r[0])*e/t),a=Math.round(r[1]+(o[1]-r[1])*e/t),l=Math.round(r[2]+(o[2]-r[2])*e/t);return"rgb(".concat(s,",").concat(a,",").concat(l,")")},ez=e=>{let t={};return e.forEach(e=>{var n;null===(n=e.jsonValue)||void 0===n||n.answers.forEach(e=>{var n;let i=e.key,r=null!==(n=e.numericValue)&&void 0!==n?n:0;t.hasOwnProperty(i)||(t[i]=0),t[i]+=r})}),t},eG=(e,t)=>Object.entries(ez(e)).map(e=>{var n,i,r;return{key:e[0],title:null!==(r=null===(n=t.find(t=>t.key===e[0]))||void 0===n?void 0:n.title)&&void 0!==r?r:"",description:null===(i=t.find(t=>t.key===e[0]))||void 0===i?void 0:i.description,value:e[1]}});function eH(e){let{answers:t}=(0,V.ZP)(e.qids.qid),[n,i]=(0,x.useState)([]),[r,o]=(0,x.useState)([]),[s,a]=(0,x.useState)([]),l=(0,$.Z)();return(0,x.useEffect)(()=>{i(null!=t?t:[])},[t]),(0,x.useEffect)(()=>{o(eG(n,e.options))},[n,e.options]),(0,x.useEffect)(()=>{var t;let n=l.palette.secondary.main,i=null!==(t=e.mode)&&void 0!==t?t:"normal",o=r.sort((e,t)=>e.value-t.value);"normal"===i&&(o=o.reverse()),a([...o.map((t,i)=>{var o,s;return{backgroundColor:eL(i,r.length,null!==(o=e.startColour)&&void 0!==o?o:n,null!==(s=e.endColour)&&void 0!==s?s:"#FFFFFF"),textColor:"#000000",option:t}})])},[r,e.startColour,e.endColour,l.palette.secondary.main,e.mode]),(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",flexDirection:"column",display:"flex",gap:1},children:[e.question&&(0,p.jsx)(F.Z,{content:e.question}),(0,p.jsx)(E.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1,justifyContent:"start"},children:s.map((t,n)=>(0,p.jsx)(E.Z,{sx:{backgroundColor:t.backgroundColor,color:t.textColor,borderRadius:2,display:"flex",flexDirection:"column",p:2},children:(0,p.jsxs)(D.Z,{variant:"orderedListItemTitle",align:"left",children:[n+1,". ",t.option.title]})},"ordered-display-".concat(e.qids.qid,"-option-").concat(t.option.key,"-").concat(n)))})]})})}function eK(e){let t=(0,$.Z)(),n=1===e.headings.filter(e=>e.expanded).length;return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(E.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[e.question&&(0,p.jsx)(F.Z,{content:e.question,forceAlign:"left"}),e.headings.map((i,r)=>(0,p.jsxs)(E.Z,{sx:{flexGrow:i.expanded?1:void 0,flexBasis:i.expanded?0:void 0,display:"flex",flexDirection:"row",gap:2,p:2,alignItems:"stretch",backgroundColor:t.palette.summaryChartBackground.main,borderRadius:4},children:[i.expanded&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(E.Z,{sx:{display:"inline-block",borderRadius:2,flexGrow:0,flexShrink:0,flexBasis:n?"50%":"20%",backgroundImage:"url(".concat(i.graphic,")"),backgroundSize:"cover",backgroundPosition:"center",mr:2}}),(0,p.jsxs)(E.Z,{sx:{display:"flex",flexDirection:"column",gap:2,alignSelf:"center"},children:[(0,p.jsx)(D.Z,{variant:"sectionHeadingTitle",align:"left",children:i.title}),i.description&&(0,p.jsx)(D.Z,{variant:"sectionHeadingDescription",align:"left",children:i.description})]})]}),!i.expanded&&(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(D.Z,{variant:"sectionHeadingTitleQuiet",align:"left",children:i.title})})]},"section-heading-".concat(e.uid,"-").concat(r)))]})})}var eJ=n(20920);function eY(e){return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(E.Z,{sx:{display:"flex",flexDirection:"column",gap:2,...e.sx},children:e.children})})}var eQ=n(44908),eX=n(65786),e$=n(19309);function e0(e){var t;let n=(0,x.useContext)(m.rZ),{answers:i}=(0,V.ZP)(e.qids.qid),[r,o]=(0,x.useState)((0,V.Zp)(i,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[s,a]=(0,x.useState)(!1),[l,c]=(0,x.useState)(!1),[d,u]=(0,x.useState)(!1);(0,x.useEffect)(()=>{var e,t,n;a(null!==(n=null===(t=r.jsonValue)||void 0===t?void 0:null===(e=t.answers.find(e=>"consent"===e.key))||void 0===e?void 0:e.booleanValue)&&void 0!==n&&n)},[r]),(0,x.useEffect)(()=>{c(s&&n.role===P._b.Client)},[s]);let h=t=>{if(!l){console.warn("Only participants can submit answers");return}u(!0);let n={...r,jsonValue:{answers:[{key:"consent",booleanValue:s},{key:"consentText",stringValue:e.consentText}]}};e.onAnswer(n).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),null!==e)o(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{u(!1)})};return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(W,{startBar:(0,p.jsx)(()=>(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(eQ.Z,{control:(0,p.jsx)(eX.Z,{checked:s,onChange:(e,t)=>a(t)}),label:(0,p.jsx)("span",{style:{fontWeight:"bold",fontSize:"1.25rem"},children:e.consentText})})}),{}),endBar:(0,p.jsx)(()=>(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(N.Z,{btnKey:"submit",btnText:"Submit",onClick:h,disabled:!l,busy:d})}),{}),children:[e.question&&(0,p.jsx)(F.Z,{content:e.question,forceAlign:"left",sx:{fontWeight:"bold"}}),e.content.map((t,n)=>(0,p.jsx)(D.Z,{variant:"consentBody",align:"left",dangerouslySetInnerHTML:{__html:(0,e$.Z)(t)}},"".concat(e.qids.qid,"-consent-body-").concat(n)))]})})}let e1=e=>({replace:(t,n)=>e2(t,e)}),e2=(e,t)=>{if(e instanceof k.W_&&e.attribs){var n;let i;switch(e.tagName.toLowerCase()){case"sidebarlayout":i=tb(e,t);break;case"fullpagescrollinglayout":i=tw(e,t);break;case"fullpagecentredlayout":i=tj(e,t);break;case"columnlayout":i=tk(e,t);break;case"slidebackgroundimage":i=tZ(e,t);break;case"imageslide":i=tg(e,t);break;case"videoslide":i=e6(e,t);break;case"summaryslidelayout":i=e9(e,t);break;case"sectionheading":i=tC(e,t);break;case"slidetext":i=tI(e,t);break;case"slideimage":case"img":i=tE(e,t);break;case"inputorcompletion":i=ty(e,t);break;case"inputsequence":i=tv(e,t);break;case"sliderinput":i=e8(e,t);break;case"textinput":i=ti(e,t);break;case"demographicinput":i=ta(e,t);break;case"updownvoteinput":i=tl(e,t);break;case"closedchoiceinput":i=tc(e,t);break;case"pointsallocationinput":i=td(e,t);break;case"multisliderinput":i=tu(e,t);break;case"acknowledgementinput":i=th(e,t);break;case"rankedlistinput":i=tp(e,t);break;case"consentinput":i=tx(e,t);break;case"completion":i=tS(e,t);break;case"speechbubbles":i=tn(e,t);break;case"selectiongraph":i=te(e,t);break;case"updownvoteresults":i=tt(e,t);break;case"topoptions":i=tm(e,t);break;case"orderedlist":i=tf(e,t);break;default:return e}return null!==(n=(0,Y.te)(i,t.keyPrefix))&&void 0!==n?n:i}},e5=(e,t)=>{let n=e.children.map((e,n)=>e1(t).replace(e,n)).filter(e=>null!=e&&!1!==e).map(e=>e instanceof k.W_?(0,k.du)([e],e1(t)):e);return x.Children.toArray(n)},e3=(e,t)=>{let n=[];for(let i of e.children.filter(e=>e instanceof k.W_).map(e=>e))void 0!==i.attribs.qid?n.push(e4(t,i)):n=[...n,...e3(i,t)];return n},e4=(e,t)=>{let n=t.attribs.qid;if(void 0===n)throw console.error("Question id not found for element",t),"Question id not found for element";return{sid:e.sessionId,pid:e.deviceId,qid:n}},e7=e=>{var t,n;let i=e.attribs.instruction,r=null!==(n=null!==(t=e.attribs.question)&&void 0!==t?t:e.attribs.statement)&&void 0!==n?n:e.attribs.prompt,o=e.attribs.explanation,s=(0,S.gx)(e.attribs.pii);return i||r||o||void 0!==s?{instruction:i,question:r,explanation:o,pii:s}:void 0},e6=(e,t)=>{console.debug("Enriching VideoSlide tag as VideoSlide...",e);let n=e.attribs.id,i=e.attribs.videouri,r=e.attribs.posteruri,o=t.role===P._b.Controller,s=t.role===P._b.Controller||t.remoteMedia;return(0,p.jsx)(em,{videoId:n,role:t.role,controls:o,audio:s,videoUri:i,posterUri:r})},e9=(e,t)=>{console.debug("Enriching SummarySlideLayout tag as SummarySlideLayout...",e);let n=e.attribs.title,i=e.attribs.prompt,r=void 0!==e.attribs.chartbackground?(0,S.gx)(e.attribs.chartbackground):void 0,o=e5(e,t);return(0,p.jsx)(ed,{title:n,prompt:i,chartBackground:r,children:o})},e8=(e,t)=>{var n;console.debug("Enriching SliderInput tag as SliderInput...",e);let i=e4(t,e),r=e7(e),o=(0,Y.av)(e.attribs.type),s=o===Z.Q.categorical?(0,Y.kh)(e.attribs.marks):void 0,a=o!==Z.Q.categorical?null===(n=(0,Y.kh)(e.attribs.range))||void 0===n?void 0:n.map(e=>(0,Y.f_)(e.trim())):void 0,l=o!==Z.Q.categorical?(0,Y.f_)(e.attribs.step):void 0;return(0,p.jsx)(Z.Z,{qids:i,role:t.role,type:o,marks:s,numericRange:a,numericStep:l,question:r,onAnswer:t.onAnswer})},te=(e,t)=>{var n;console.debug("Enriching SelectionGraph tag as AnswerGraphMuiChart...",e);let i=e4(t,e),r=e7(e),o=(0,Y.yg)(e.attribs.orientation),s=(0,Y.ot)(e.attribs.type),a=null===(n=(0,Y.kh)(e.attribs.range))||void 0===n?void 0:n.map(e=>g().toNumber(e.trim())),l=(0,Y.tL)((0,Y.kh)(e.attribs.categories));if(i&&void 0!==s)return(0,p.jsx)(eV.Z,{role:t.role,qids:i,question:r,inputType:s,orientation:o,categories:l,range:a?{lo:a[0],hi:a[1],step:a[2]}:void 0});throw console.error("SelectionGraph without qIds, type, or range",e.attribs),"SelectionGraph without qIds, type, or range"},tt=(e,t)=>{console.debug("Enriching UpDownVoteResults tag as UpDownVoteResults...",e);let n=e.attribs.layout,i={};for(let t of e.children)if(t instanceof k.W_&&"result"===t.tagName){let e=t.attribs.qid,n=t.attribs.assertion;void 0!==e&&(i[e]={assertion:n})}return(0,p.jsx)(eC,{questions:i,layout:n})},tn=(e,t)=>{console.debug("Enriching SpeechBubbles tag as SpeechBubbles (with children)...",e);let n=e4(t,e),i=e7(e);return(0,p.jsx)(ee,{qids:n,question:i})},ti=(e,t)=>{var n;let i;console.debug("Enriching TextInput tag as TextInput...",e);let r=e4(t,e),o=e7(e),s=(0,Y.H7)(e.attribs.type),a=e.attribs.label,l=e.attribs.help,c=e.attribs.submittext,d=e.attribs.skiptext,u=g().parseInt(e.attribs.mincheckboxes),h=(0,S.gx)(null!==(n=e.attribs.textrequired)&&void 0!==n?n:"true"),x=[];for(let t of e.childNodes)if(t instanceof k.W_&&"information"===t.tagName&&(i={heading:t.attribs.heading,body:t.children}),t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.text,i=(0,S.gx)(t.attribs.required);x.push({key:e,text:n,initial:!1,required:i,checked:!1})}if(void 0===o||void 0===o.pii)throw"pii not defined for TextInput";return(0,p.jsx)(C.Z,{qids:r,role:t.role,type:s,label:a,help:l,textRequired:h,minCheckboxes:u,information:i,onAnswer:t.onAnswer,checkboxes:x,question:o,submitText:c,skipText:d})},tr=e=>{let t=[];for(let n of e)if(n instanceof k.W_&&"demographicinputtype"===n.tagName){let e=n.attribs.key,i=n.attribs.label,r=n.attribs.layout,o=n.attribs.mode,s=n.attribs.textplaceholder,a=n.attribs.textvalidationregex,l=(0,S.LC)(n.attribs.columns);if(e&&i&&o){let c=to(n.children);t.push({key:e,label:i,layout:r,layoutProps:void 0!==l?{columns:l}:void 0,groups:c,mode:o,textPlaceholder:s,textValidationRegex:a})}else throw console.warn("DemographicInputType without key, label, layout, or mode",n),"DemographicInput child without key, label, layout, or mode"}return t},to=e=>{let t=[];for(let n of e)if(n instanceof k.W_&&"demographicgroup"===n.tagName){let e=n.attribs.label;if(e){let i=ts(n.children);t.push({label:e,choices:i})}else throw console.warn("DemographicGroup without label",n),"DemographicGroup without label"}return t},ts=e=>{let t=[];for(let n of e)if(n instanceof k.W_&&"demographic"===n.tagName){let e=n.attribs.display,i=n.attribs.value;if(e&&i)t.push({display:e,key:i});else throw console.warn("Demographic without display or value",n),"Demographic without display or value"}return t},ta=(e,t)=>{console.debug("Enriching DemographicInput tag as DemographicInput...",e);let n=e4(t,e),i=e7(e),r=(0,S.gx)(e.attribs.showage),o=(0,S.gx)(e.attribs.showgender),s=(0,S.gx)(e.attribs.showethnicity),a=e.attribs.showpostcode,l=tr(e.children);return(0,p.jsx)(O,{role:t.role,qids:n,onAnswer:t.onAnswer,question:i,showAge:r,showGender:o,showEthnicity:s,showPostcode:a,customDemographics:l})},tl=(e,t)=>{console.debug("Enriching UpDownVoteInput tag as UpDownVoteInput...",e);let n=e4(t,e),i=e7(e),r=e.attribs.assertion;return(0,p.jsx)(ek,{qids:n,role:t.role,question:i,assertion:r,onAnswer:t.onAnswer})},tc=(e,t)=>{console.debug("Enriching ClosedChoiceInput tag as ClosedChoiceInput...",e);let n=e4(t,e),i=e7(e),r=parseInt(e.attribs.minselections),o=parseInt(e.attribs.maxselections),s=e.attribs.layout,a=e.attribs.layoutparams,l=a?(0,Y.kh)(a):[],c=[],d=(0,S.gx)(e.attribs.shuffle);for(let t of e.children)if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.value,n=t.attribs.display,i=t.attribs.graphic,r=(0,S.gx)(t.attribs.isalt);e&&n&&c.push({key:e,display:n,graphic:i,isAlt:r})}return(0,p.jsx)(ec,{qids:n,role:t.role,question:i,options:c,shuffle:d,onAnswer:t.onAnswer,layout:s,layoutParams:l,minSelections:r,maxSelections:o,contentStore:t.contentStore})},td=(e,t)=>{console.debug("Enriching PointsAllocationInput tag as PointsAllocationInput...",e);let n=e4(t,e),i=e7(e),r=parseInt(e.attribs.points),o=[];for(let t of e.children)if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.title,n=t.attribs.description,i=t.attribs.key,r=parseInt(t.attribs.min),s=parseInt(t.attribs.max),a=t.attribs.graphic;if(e&&n&&i&&void 0!==r&&void 0!==s)o.push({title:e,description:n,key:i,min:r,max:s,graphic:a});else throw"PointsAllocationInput Option without title, description, key, min, or max"}return(0,p.jsx)(eD,{qids:n,question:i,points:r,options:o,onAnswer:t.onAnswer})},tu=(e,t)=>{console.debug("Enriching MultiSliderInput tag as MultiSliderInput...",e);let n=e4(t,e),i=e7(e),r=parseInt(e.attribs.min),o=parseInt(e.attribs.max),s=[],a=[],l=(0,S.gx)(e.attribs.showdescriptions);for(let t of e.children)if(t instanceof k.W_&&"label"===t.tagName){let e=parseFloat(t.attribs.at),n=t.attribs.text;void 0!==e&&n&&s.push({at:e,text:n})}else if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;e&&n&&a.push({key:e,title:n,description:i})}return(0,p.jsx)(eP,{qids:n,question:i,min:r,max:o,labels:s,options:a,showDescriptions:l,role:t.role,onAnswer:t.onAnswer})},th=(e,t)=>{console.debug("Enriching AcknowledgementInput tag as AcknowledgementInput...",e);let n=e4(t,e),i=e7(e),r=e.attribs.align,o=[];for(let t of e.children)if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.text,n=t.attribs.key,i=t.attribs.variant,r=t.attribs.colour;e&&n&&o.push({text:e,key:n,variant:i,colour:r})}return(0,p.jsx)(eF,{qids:n,question:i,options:o,align:r,onAnswer:t.onAnswer})},tp=(e,t)=>{console.debug("Enriching RankedListInput tag as RankedListInput...",e);let n=e4(t,e),i=e7(e),r=[],o=(0,S.gx)(e.attribs.shuffle),s=0;for(let t of e.children)if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;n&&r.push({key:e,title:n,description:i,startingIndex:s++})}return(0,p.jsx)(eM,{qids:n,question:i,options:r,shuffle:o,onAnswer:t.onAnswer})},tx=(e,t)=>{console.debug("Enriching ConsentInput tag as ConsentInput...",e);let n=e4(t,e),i=e7(e),r=e.attribs.consenttext;return(0,p.jsx)(e0,{qids:n,question:i,consentText:r,onAnswer:t.onAnswer,content:e.children})},tm=(e,t)=>{console.debug("Enriching TopOptions tag as TopOptionsSummary...",e);let n=e4(t,e),i=e7(e),r=parseInt(e.attribs.count),o=[];for(let t of e.children)if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description,r=t.attribs.graphic;e&&n&&i&&o.push({key:e,title:n,description:i,graphic:r})}return(0,p.jsx)(eR,{qids:n,question:i,options:o,displayCount:r})},tf=(e,t)=>{console.debug("Enriching OrderedList tag as OrderedListDisplay...",e);let n=e4(t,e),i=e7(e),r=e.attribs.startcolour,o=e.attribs.endcolour,s=e.attribs.mode,a=[];for(let t of e.children)if(t instanceof k.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;if(e&&n)a.push({key:e,title:n,description:i});else throw console.warn("OrderedList option without key or title",t),"OrderedList option without key or title"}return(0,p.jsx)(eH,{qids:n,question:i,options:a,role:t.role,startColour:r,endColour:o,mode:s})},tg=(e,t)=>{console.debug("Enriching ImageSlide tag as ImageSlide...",e);let n=e.attribs.src,i=(0,Y.Cc)(e.attribs.style);return(0,p.jsx)(L,{style:i,src:n})},ty=(e,t)=>{let n=e5(e,t);console.debug("Enriching InputOrCompletion tag as InputOrCompletion (with children)...",n);let i=e4(t,e);return(0,p.jsx)(G,{qids:i,input:n[0],completion:n[1]})},tv=(e,t)=>{let n=e5(e,t);console.debug("Enriching InputSequence tag as InputSequence (with children)...",n);let i=[];for(let e=0;e<n.length-1;e++)i.push(n[e]);let r=n[n.length-1],o=e7(e),s=(0,S.gx)(e.attribs.showprogress),a=e3(e,t);return(0,p.jsx)(ey,{question:o,showProgress:s,qids:a,inputs:i,completion:r,role:t.role})},tb=(e,t)=>{console.debug("Enriching SideBarLayout tag as SideBarLayout (with children)...",e);let n=e5(e,t),i=(0,Y.if)(e.attribs.sidestyle),r=(0,Y.if)(e.attribs.mainstyle),o=e.attribs.sidebackgroundimage,s=e.attribs.mainbackgroundimage;return(0,p.jsx)(z,{side:n[0],sideSx:i,main:n[1],mainSx:r,sideBackgroundImage:o,mainBackgroundImage:s,contentStore:t.contentStore})},tw=(e,t)=>{console.debug("Enriching FullPageScrollingLayout tag as FullPageScrollingLayout (with children)...",e);let n=(0,Y.if)(e.attribs.sx),i=e5(e,t);return(0,p.jsx)(K,{sx:n,children:i})},tj=(e,t)=>{console.debug("Enriching FullPageCentredLayout tag as FullPageCentredLayout (with children)...",e);let n=(0,Y.if)(e.attribs.sx),i=e5(e,t);return(0,p.jsx)(et,{sx:n,children:i})},tk=(e,t)=>{console.debug("Enriching ColumnLayout tag as ColumnLayout (with children)...",e);let n=(0,Y.if)(e.attribs.sx),i=e5(e,t);return(0,p.jsx)(eY,{sx:n,children:i})},tZ=(e,t)=>{console.debug("Enriching SlideBackgroundImage tag as SlideBackgroundImage (with children)...",e);let n=e5(e,t),i=e.attribs.src,r=(0,Y.if)(e.attribs.sx);return(0,p.jsx)(Q,{src:i,sx:r,children:n})},tS=(e,t)=>{console.debug("Enriching Completion tag as CompletionDisplay (with children)...",e);let n=e.attribs.message,i=e.attribs.factoid,r=(0,Y.if)(e.attribs.sx);return(0,p.jsx)(H,{content:{message:n,factoid:i},sx:r})},tC=(e,t)=>{console.debug("Enriching SectionHeading tag as SectionHeading...",e);let n=(0,eJ.Z)(),i=e7(e),r=[];for(let t of e.children)if(t instanceof k.W_&&"heading"===t.tagName){let e=t.attribs.title,n=t.attribs.description,i=t.attribs.graphic,o=(0,S.gx)(t.attribs.expanded);if(e)r.push({title:e,description:n,graphic:i,expanded:o});else throw console.warn("SectionHeading without title",t),"SectionHeading without title"}return(0,p.jsx)(eK,{question:i,headings:r,uid:n})},tI=(e,t)=>{console.debug("Enriching SlideText tag as SlideText (with children)...",e);let n=e5(e,t),i=(0,Y.if)(e.attribs.sx),r=e.attribs.color,o=e.attribs.align,s=e.attribs.variant;return(0,p.jsx)(J,{variant:s,sx:i,color:r,align:o,children:n})},tE=(e,t)=>{console.debug("Enriching ImageSlide tag as ImageSlide...",e);let n=e.attribs.src,i=(0,Y.Cc)(e.attribs.style);return(0,p.jsx)(X,{src:n,style:i})};(a=h||(h={}))[a.Init=0]="Init",a[a.RetrievingRawSlides=1]="RetrievingRawSlides",a[a.RawSlidesError=2]="RawSlidesError",a[a.EnrichingSlides=3]="EnrichingSlides",a[a.EnrichmentError=4]="EnrichmentError",a[a.InflatingSlides=5]="InflatingSlides",a[a.InflationError=6]="InflationError",a[a.Ready=7]="Ready";let tD=[0,1],tP=[2,4,6],tq=[3,5],tA=(0,x.createContext)({});function t_(e){let{api:t,start:n}=(0,x.useContext)(ex.E),{session:i}=(0,x.useContext)(ep.z),r=(0,x.useContext)(m.rZ),[o,s]=(0,x.useState)(0),[a,l]=(0,x.useState)([]),[c,d]=(0,x.useState)([]),[u,f]=(0,x.useState)(void 0),[g,v]=(0,x.useState)(!0),[b,Z]=(0,x.useState)(!1),[S,C]=(0,x.useState)(!1);(0,x.useEffect)(()=>{switch(console.debug("Static content state",h[o]),o){case 0:s(1);break;case 1:I().then(e=>{l(e),s(3)}).catch(e=>{console.error(e),s(2)});break;case 3:D().then(e=>{d(e),s(5)}).catch(e=>{console.error(e),s(4)});break;case 5:q().then(e=>{f(e),s(7)}).catch(e=>{console.error(e),s(6)})}v(void 0!==tD.find(e=>e===o)),Z(void 0!==tq.find(e=>e===o)),C(void 0!==tP.find(e=>e===o))},[o]);let I=async()=>{let e=[];for(let o of i.sessionPresentationUris||[]){if(!o)throw"Presentation link empty in session data.";let s=new y(t,n,i,r.sessionToken,o,!0);await s.init();let a=o.split("/").pop(),l=await s.getAsEntry(a,void 0),c=await l.content.text();if(!c)throw"No content found in presentation file.";e.push(c)}return e},E=e=>{j.Z.emit({type:j.M.Content_Progress_Update,data:e})},D=async()=>{let o=[];for(let s=0;s<a.length;s++){let l=i.sessionPresentationUris[s],c=a[s];if(!l)throw"Presentation link empty in session data.";let d=new y(t,n,i,r.sessionToken,l,e.refresh);await d.init();let u=new w(c,d,E),h=u.findAllReplacements(void 0,[]);console.debug("".concat(h.length," unique resources to replace"),h);let p=await u.replaceAllReplacements(h),x=u.getAsSectionTags(p,s);if(!x)throw"No sections found in presentation.";o.push(x)}return o},q=async()=>{let o=[];for(let s=0;s<c.length;s++){let a=i.sessionPresentationUris[s],l=c[s];if(!a)throw"Presentation link empty in session data.";if(!l)throw"No content found in presentation xml.";let d=new y(t,n,i,r.sessionToken,a,e.refresh);await d.init();let u={sessionId:i.id,deviceId:r.deviceId,role:r.role,remoteMedia:i.remoteConfiguration!==P.VS.InPerson,remoteCall:i.remoteConfiguration===P.VS.RemoteWithVideoCall,keyPrefix:"module-".concat(s),contentStore:d,onAnswer:A},h=(0,k.ZP)(l,e1(u)),p=(h instanceof Array?h:[h]).map((e,t)=>(0,Y.te)(e,"module-".concat(s))).filter(e=>void 0!==e);o.push(...p)}return o},A=async i=>await n(t.postDeliberationAnswer(e.sid,i,r.sessionToken));return(0,p.jsxs)(p.Fragment,{children:[g&&e.initialising,b&&e.loading,S&&e.error,7===o&&(0,p.jsx)(tA.Provider,{value:{sid:e.sid,presentationXml:c,sourceXml:a,slides:u},children:e.children})]})}},37570:function(e,t,n){n.d(t,{H:function(){return x},Z:function(){return m}});var i,r,o=n(57437),s=n(2265),a=n(5085),l=n(20909),c=n(94547),d=n(1973);(i=r||(r={}))[i.Init=0]="Init",i[i.RetrievingSession=1]="RetrievingSession",i[i.RetrievingGraphic=2]="RetrievingGraphic",i[i.SessionError=3]="SessionError",i[i.Ready=4]="Ready";let u=[3],h=[0],p=[1,2],x=(0,s.createContext)({});function m(e){let{api:t,start:n}=(0,s.useContext)(d.E),i=(0,s.useContext)(a.rZ),[m,f]=(0,s.useState)(0),[g,y]=(0,s.useState)(),[v,b]=(0,s.useState)(),[w,j]=(0,s.useState)(!0),[k,Z]=(0,s.useState)(!1),[S,C]=(0,s.useState)(!1);(0,s.useEffect)(()=>{switch(console.debug("Static data state",r[m]),m){case 0:f(1);break;case 1:I().then(e=>{y(e),f(2)}).catch(e=>{console.error(e),f(3)});break;case 2:E().then(e=>{b(e),f(4)}).catch(e=>{console.error(e),f(3)})}Z(void 0!==p.find(e=>e===m)),C(void 0!==u.find(e=>e===m)),j(void 0!==h.find(e=>e===m))},[m]);let I=async()=>i.role===c._b.Controller?await n(t.getDeliberationSessionAdmin(e.sid,i.user.access_token,void 0)):await n(t.getDeliberationSession(e.sid,void 0)),E=async()=>{let e={workshopDirectory:(0,l.X)(g.sessionPresentationUris[0])};return await n(t.postPublicContentAccessRequest(g.id,e))};return(0,o.jsxs)(o.Fragment,{children:[w&&e.initialising,k&&e.loading,S&&e.error,4===m&&(0,o.jsx)(x.Provider,{value:{sid:g.id,session:g,graphic:v},children:e.children})]})}},83593:function(e,t,n){n.d(t,{M:function(){return r}});var i,r,o=n(37836),s=n.n(o);(i=r||(r={})).Request_SlideRefresh="REQUEST_SLIDE_REFRESH",i.WSS_Update_ConnectionState="WSS_UPDATE_CONNECTION_STATE",i.WSS_Distribute_Message="WSS_DISTRIBUTE_MESSAGE",i.Content_Progress_Update="CONTENT_PROGRESS_UPDATE",i.Media_Playback_Update="MEDIA_PLAYBACK_UPDATE";let a=new(s()),l={on:(e,t)=>a.on(e,t),once:(e,t)=>a.once(e,t),off:(e,t)=>a.off(e,t),emit:e=>a.emit(e.type,e)};Object.freeze(l),t.Z=l},64463:function(e,t,n){n.d(t,{Z:function(){return m}});var i=n(57437),r=n(44228),o=n(42748),s=n(11656),a=n(47905),l=n(86917),c=n(14595),d=n(31193),u=n(60335),h=n(21395),p=n(24072),x=n(76396);function m(e){let t=t=>{e.onVideoPreferenceChange(e.videoEnabled,t)},n=t=>{e.onAudioPreferenceChange(e.audioEnabled,t)},m=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(s.Z,{children:(0,i.jsx)(a.Z,{inset:!0,children:(0,i.jsx)("b",{children:"Video camera inputs"})})},"video-heading"),e.videoDevices.map(n=>{var o;let c=(null===(o=e.videoDevice)||void 0===o?void 0:o.deviceId)===(null==n?void 0:n.deviceId);return(0,i.jsxs)(s.Z,{onClick:()=>t(n),children:[c&&(0,i.jsx)(l.Z,{children:(0,i.jsx)(r.Z,{})}),(0,i.jsx)(a.Z,{inset:!c,children:n.label})]},"menu-item-select-".concat(n.deviceId))})]}),(0,i.jsx)(c.Z,{}),(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(s.Z,{children:(0,i.jsx)(a.Z,{inset:!0,children:(0,i.jsx)("b",{children:"Microphone inputs"})})},"audio-heading"),e.audioDevices.map(t=>{var o;let c=(null===(o=e.audioDevice)||void 0===o?void 0:o.deviceId)===(null==t?void 0:t.deviceId);return(0,i.jsxs)(s.Z,{onClick:()=>n(t),children:[c&&(0,i.jsx)(l.Z,{children:(0,i.jsx)(r.Z,{})}),(0,i.jsx)(a.Z,{inset:!c,children:t.label})]},"menu-item-select-".concat(t.deviceId))})]})]});return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Z,{display:"flex",flexDirection:e.direction,justifyContent:"center",children:[(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":e.audioEnabled?"mute microphone":"enable microphone",onClick:()=>{e.onAudioPreferenceChange(!e.audioEnabled,e.audioDevice)},children:(0,i.jsx)("img",{src:e.audioEnabled?"/icons/av/mic-enabled.svg":"/icons/av/mic-disabled.svg"})}),(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":e.videoEnabled?"disable camera":"enable camera",onClick:()=>{e.onVideoPreferenceChange(!e.videoEnabled,e.videoDevice)},children:(0,i.jsx)("img",{src:e.videoEnabled?"/icons/av/cam-enabled.svg":"/icons/av/cam-disabled.svg"})}),(0,i.jsx)(p.ZP,{variant:"popover",popupId:"audio-popup",children:t=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":"settings",...(0,x.vW)(t),children:(0,i.jsx)("img",{src:"/icons/av/cog-enabled.svg"})}),(0,i.jsx)(h.Z,{...(0,x.wK)(t),children:(0,i.jsx)(m,{})})]})})]})})}},79044:function(e,t,n){n.d(t,{K:function(){return g},Z:function(){return y}});var i,r,o=n(57437),s=n(2265),a=n(24314),l=n(31193),c=n(80511),d=n(66858),u=n(49752);function h(e){let[t,n]=(0,s.useState)(""),[i,r]=(0,s.useState)(!1),a=i&&0===t.trim().length,h=!a&&t.trim().length>0,p=()=>{h&&e.submitName(t)};return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(l.Z,{children:[(0,o.jsx)(c.Z,{variant:"h4",children:"How should we refer to you?"}),(0,o.jsxs)("form",{onSubmit:e=>{e.preventDefault(),p()},children:[(0,o.jsx)(d.Z,{sx:{mb:4,input:{background:"white"}},fullWidth:!0,style:{flexGrow:1},label:"Please enter your name...",variant:"outlined",value:t,autoComplete:"off",autoFocus:!0,helperText:"Your name is purely for use within the session. It will not be saved or stored.",onChange:e=>{n(e.target.value),r(!0)},error:a,color:"buttonStandard"}),(0,o.jsx)(u.Z,{inline:!1,alignment:"left",busy:!1,enabled:h,onSubmit:p,text:"Continue"})]})]})})}var p=n(34360),x=n(43655),m=n(43312),f=n(11144);(i=r||(r={}))[i.InputName=0]="InputName",i[i.Ready=1]="Ready";let g=(0,s.createContext)({});function y(e){let{session:t,graphic:n}=(0,s.useContext)(f.z),[i,r]=(0,s.useState)(0),[l,c]=(0,s.useState)(),d=(0,s.useMemo)(()=>(0,o.jsx)(p.Z,{url:n.posterUrl}),[n.posterUrl]),u=(0,s.useCallback)(e=>{c(e),r(1)},[c,r]);return(0,o.jsxs)(o.Fragment,{children:[1!==i&&(0,o.jsx)(x.Z,{heading:(0,o.jsx)(m.Z,{session:t,layout:"heading",welcome:!0}),main:(0,o.jsx)(o.Fragment,{children:0===i&&(0,o.jsx)(a.Z,{left:(0,o.jsx)(h,{submitName:u}),right:d})})}),1===i&&(0,o.jsx)(g.Provider,{value:{participantName:l},children:e.children})]})}},68276:function(e,t,n){n.d(t,{u:function(){return k},Z:function(){return Z}});var i,r,o=n(57437),s=n(2265),a=n(94547),l=n(31193),c=n(96537),d=n(6820),u=n.n(d),h=n(64463);let p={videoEnabled:!0,audioEnabled:!0,videoDevice:void 0,audioDevice:void 0,blurBackground:!1};function x(e){let[t,n]=s.useState([]),[i,r]=s.useState([]),[a,d]=s.useState(void 0),[p,x]=s.useState(void 0),[m,f]=s.useState(!0),[g,y]=s.useState(!0);(0,s.useEffect)(()=>{void 0!==navigator&&navigator.mediaDevices.enumerateDevices().then(e=>{n(v(e)),r(b(e))})},[]),(0,s.useEffect)(()=>{e.onPreferences({videoEnabled:m,audioEnabled:g,videoDevice:a,audioDevice:p,blurBackground:!1})},[m,g,a,p]);let v=e=>e.filter(e=>{let{kind:t}=e;return"videoinput"===t}),b=e=>e.filter(e=>{let{kind:t}=e;return"audioinput"===t}),w={maxWidth:"100%",maxHeight:"100%",width:"auto"},j={height:320,facingMode:a?void 0:"user",deviceId:null==a?void 0:a.deviceId};return(0,o.jsxs)(l.Z,{display:"flex",flexDirection:"column",flexGrow:1,children:[(0,o.jsx)(()=>(0,o.jsx)(l.Z,{sx:{borderRadius:2,p:1,mb:2,background:"#d9d9d9",display:"flex",flexDirection:"column",alignItems:"center",justifyItems:"stretch"},children:(0,o.jsx)("div",{style:{...w},children:m&&(0,o.jsx)(u(),{mirrored:!0,style:w,videoConstraints:j})})}),{}),(0,o.jsx)(()=>(0,o.jsxs)(l.Z,{display:"flex",flexDirection:"row",justifyContent:"center",gap:2,children:[(0,o.jsx)(h.Z,{direction:"row",videoEnabled:m,audioEnabled:g,videoDevices:t,audioDevices:i,videoDevice:a,audioDevice:p,onVideoPreferenceChange:async(e,t)=>{f(e),d(t)},onAudioPreferenceChange:async(e,t)=>{y(e),x(t)},busy:!1}),e.showJoin&&(0,o.jsx)(c.Z,{variant:"contained",size:"large",sx:{alignSelf:"center"},onClick:e.onJoin,children:"JOIN"}),e.showLeave&&(0,o.jsx)(c.Z,{variant:"outlined",size:"large",sx:{alignSelf:"center"},onClick:e.onLeave,children:"LEAVE"})]}),{})]})}var m=n(27270),f=n(5085),g=n(24314),y=n(34360),v=n(43655),b=n(43312),w=n(79044),j=n(11144);(i=r||(r={}))[i.Init=0]="Init",i[i.PreviewMedia=1]="PreviewMedia",i[i.NoPreview=2]="NoPreview";let k=(0,s.createContext)({});function Z(e){let{session:t,graphic:n}=(0,s.useContext)(j.z),i=(0,s.useContext)(w.K),c=(0,s.useContext)(f.rZ),[d,u]=(0,s.useState)(0),[h,Z]=(0,s.useState)(!1),[S,C]=(0,s.useState)(p),[I,E]=(0,s.useState)({waitingRoom:!1,sessionClosed:!1,sessionOpen:!1,sessionBanned:!1}),[D,P]=(0,s.useState)(!1);(0,s.useEffect)(()=>{switch(console.debug("Media preview state",r[d]),d){case 0:u(t.remoteConfiguration===a.VS.RemoteWithVideoCall?1:2);break;case 2:Z(!0)}},[d]),(0,s.useEffect)(()=>{P((2===d||1===d)&&(t.facilitationState===a._y.Open||c.role===a._b.Controller)&&h)},[h,d,t]),(0,s.useEffect)(()=>{var e,n;E({waitingRoom:t.facilitationState===a._y.Ready,sessionClosed:t.facilitationState===a._y.Closed,sessionOpen:t.facilitationState===a._y.Open,sessionBanned:null!==(n=null===(e=t.deviceIdBanList)||void 0===e?void 0:e.includes(c.deviceId))&&void 0!==n&&n})},[t]);let q=(0,s.useMemo)(()=>(0,o.jsx)(y.Z,{url:n.posterUrl}),[n.posterUrl]),A=()=>(0,o.jsxs)(o.Fragment,{children:[h&&I.waitingRoom&&(0,o.jsx)(m.Z,{severity:"success",children:"Please wait for the workshop to open."}),I.sessionOpen&&(0,o.jsx)(m.Z,{severity:"success",children:"The workshop has started."}),c.role!==a._b.Controller&&I.waitingRoom&&(0,o.jsx)(m.Z,{severity:"info",children:"The workshop will begin at the scheduled time..."}),c.role===a._b.Controller&&!I.sessionOpen&&(0,o.jsx)(m.Z,{severity:"info",children:"You are the facilitator. The session will begin once you open it."}),I.sessionClosed&&(0,o.jsx)(m.Z,{severity:"warning",children:"The workshop has closed."}),I.sessionBanned&&(0,o.jsx)(m.Z,{severity:"error",children:"You have been removed from this session."})]});return(0,o.jsxs)(o.Fragment,{children:[!D&&(0,o.jsxs)(o.Fragment,{children:[1===d&&(0,o.jsx)(v.Z,{heading:(0,o.jsx)(b.Z,{session:t,layout:"heading",welcome:!0}),main:(0,o.jsx)(g.Z,{left:(0,o.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[!h&&c.role!==a._b.Controller&&!I.sessionBanned&&(0,o.jsxs)(m.Z,{severity:"info",children:["Please check your settings and press the ",(0,o.jsx)("b",{children:"join"})," button when ready."]}),(0,o.jsx)(A,{}),!I.sessionClosed&&!I.sessionBanned&&(0,o.jsx)(x,{name:i.participantName,session:t,showJoin:!h,showLeave:h,onJoin:()=>{Z(!0)},onLeave:()=>{Z(!1)},onPreferences:C})]}),right:q})}),2===d&&(0,o.jsx)(v.Z,{heading:(0,o.jsx)(b.Z,{session:t,layout:"heading",welcome:!0}),main:(0,o.jsx)(g.Z,{left:(0,o.jsx)(A,{}),right:q})})]}),D&&!I.sessionBanned&&(0,o.jsx)(k.Provider,{value:{call:S},children:e.children}),D&&I.sessionBanned&&(0,o.jsx)(v.Z,{heading:(0,o.jsx)(b.Z,{session:t,layout:"heading",welcome:!0}),main:(0,o.jsx)(g.Z,{left:(0,o.jsx)(A,{}),right:q})})]})}},43312:function(e,t,n){n.d(t,{Z:function(){return a}});var i=n(57437),r=n(31193),o=n(80511),s=n(96537);function a(e){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.Z,{sx:{mb:2},children:[e.welcome&&(0,i.jsx)(o.Z,{variant:"body1",children:"WELCOME TO"}),(0,i.jsx)(o.Z,{variant:"h3",component:"h2",children:e.session.sessionName})]}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column"===e.layout?"column":"row"},gap:2,children:[(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"column"===e.layout?"start":"center",gap:1},children:[(0,i.jsx)("img",{src:"/icons/session-date.svg"}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column"===e.layout?"column":"row",alignItems:"column"===e.layout?"flex-start":"center",gap:1},children:[(0,i.jsx)(o.Z,{variant:"body2",children:"DATE"}),(0,i.jsx)(o.Z,{variant:"body1",style:{fontWeight:"bold"},children:new Date(e.session.sessionStartTime).toDateString()})]})]}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"column"===e.layout?"start":"center",gap:1},children:[(0,i.jsx)("img",{src:"/icons/session-time.svg"}),(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column"===e.layout?"column":"row",alignItems:"column"===e.layout?"flex-start":"center",gap:1},children:[(0,i.jsx)(o.Z,{variant:"body2",children:"TIME"}),(0,i.jsx)(o.Z,{variant:"body1",style:{fontWeight:"bold"},children:new Date(e.session.sessionStartTime).toLocaleTimeString()})]})]})]}),void 0!==e.onAdvance&&(0,i.jsx)(s.Z,{variant:"contained",color:"primary",onClick:e.onAdvance,sx:{alignSelf:"start"},children:"Next"})]})}},34360:function(e,t,n){n.d(t,{Z:function(){return a}});var i=n(57437),r=n(31193),o=n(48474),s=n(2265);function a(e){var t;let[n,a]=(0,o.q_)(()=>({opacity:0}));return(0,s.useEffect)(()=>{void 0!==e.url&&a.start({to:{opacity:1},config:{duration:2e3}})},[e.url]),(0,i.jsx)(r.Z,{justifySelf:"stretch",flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",sx:{borderRadius:2},children:(0,i.jsx)(o.q.img,{src:e.url,alt:null!==(t=e.alt)&&void 0!==t?t:"Session graphic",style:{minWidth:"100%",minHeight:"100%",flexShrink:0,...e.style,...n}})})}},88620:function(e,t,n){n.d(t,{Z:function(){return u}});var i=n(57437),r=n(83593),o=n(22960),s=n(31193),a=n(34990),l=n(80511),c=n(99128),d=n(2265);function u(e){var t;let[n,u]=(0,d.useState)(),[h,p]=(0,d.useState)({overall:{completed:0,total:100},bars:{}});(0,d.useEffect)(()=>(r.Z.on(r.M.Content_Progress_Update,u),()=>{r.Z.off(r.M.Content_Progress_Update,u)}),[]),(0,d.useEffect)(()=>{void 0!==n&&n.type===r.M.Content_Progress_Update&&p(n.data)},[n]);let x=(0,o.Z)();return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(s.Z,{sx:{alignSelf:"center",display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100%",width:"60%",maxWidth:"480px"},children:(0,i.jsxs)(a.Z,{elevation:1,sx:{p:2,flexGrow:1,textAlign:"start"},children:[(0,i.jsx)(l.Z,{component:"h2",variant:"h5",sx:{mb:2},style:{textAlign:"center"},children:e.title}),(0,i.jsx)(l.Z,{variant:"body1",children:(0,i.jsx)("span",{style:{color:e.isError?x.palette.error.main:"inherit"},children:null!==(t=e.message)&&void 0!==t?t:"Unknown error."})}),e.children&&(0,i.jsx)(s.Z,{sx:{my:1},children:e.children}),e.isBusy&&!e.showProgress&&(0,i.jsx)(c.Z,{sx:{mt:2}}),e.isBusy&&e.showProgress&&(0,i.jsx)(c.Z,{sx:{mt:2},value:h.overall.total>0?100*h.overall.completed/h.overall.total:void 0,variant:h.overall.total>0?"determinate":"indeterminate"}),e.isBusy&&e.showProgress&&Object.keys(h.bars).map((e,t)=>(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(c.Z,{color:"secondary",sx:{mt:1},value:h.bars[e].total>0?100*h.bars[e].completed/h.bars[e].total:0,variant:"determinate"},"loading-progress-bar-".concat(t,"-").concat(e))}))]})})})}},43655:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(57437),r=n(31193),o=n(97340);function s(e){return(0,i.jsxs)(r.Z,{display:"flex",flexDirection:"column",flexGrow:1,children:[(0,i.jsx)(r.Z,{display:"flex",flexDirection:"column",sx:{p:2},children:e.heading}),(0,i.jsx)(r.Z,{display:"flex",flexDirection:"column",flexGrow:1,children:(0,i.jsx)(o.Z,{sx:{flexGrow:1,m:1},children:e.main})})]})}},24314:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(57437),r=n(58433),o=n(31193);function s(e){let{left:t,right:n}=e;return(0,i.jsxs)(r.ZP,{container:!0,flexGrow:1,rowGap:1,children:[(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,flexGrow:1,display:"flex",flexDirection:"column",children:(0,i.jsx)(o.Z,{display:"flex",flexDirection:"column",gap:1,sx:{overflowY:"auto",flexGrow:{xs:void 0,md:1}},children:t})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,flexGrow:1,display:"flex",flexDirection:"column",children:(0,i.jsx)(o.Z,{display:"flex",flexDirection:"column",gap:1,sx:{pl:{xs:void 0,md:2},overflowY:"auto",flexGrow:{xs:void 0,md:1}},children:n})})]})}},98641:function(e,t,n){n.d(t,{Z:function(){return ec}});var i,r,o,s,a,l,c=n(57437),d=n(2265),u=n(37570);function h(){let{session:e}=(0,d.useContext)(u.H);return(0,d.useEffect)(()=>{document.title=e.sessionName},[]),(0,c.jsx)(c.Fragment,{})}function p(){return(0,d.useEffect)(()=>{let e=[/defaultProps/,/of chart should be greater than 0/,/It will be ignored./,/If you accidentally passed it from a parent component, remove it from the DOM element./,/Form submission canceled because the form is not connected/,/Violation/,/Enriching/,/Added non-passive event/,/Form submission canceled/,/\[Violation\]/,/Warning: Invalid DOM/],t=console.error,n=console.warn,i=console.debug;return console.error=function(){for(var n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];"string"==typeof i[0]&&e.some(e=>e.test(i[0]))||t(...i)},console.warn=function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];"string"==typeof i[0]&&e.some(e=>e.test(i[0]))||n(...i)},console.debug=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];"string"==typeof n[0]&&e.some(e=>e.test(n[0]))||i(...n)},()=>{console.error=t,console.warn=n,console.debug=i}},[]),(0,c.jsx)(c.Fragment,{})}var x=n(99128),m=n(27270),f=n(80511),g=n(96537),y=n(69540),v=n(61570),b=n(87913),w=n(8487),j=n(86514),k=n(80438),Z=n(67630),S=n(10745),C=n(44330),I=n(24309),E=n(63858);let D={checking_wake_lock:!1,checking_permissions:!1,explain_request:!1,get_request:!1,get_success:!1,get_fail_system:!1,get_fail_user:!1,get_fail_could_not_start:!1,get_fail_unknown_error:!1};function P(e){let[t,n]=(0,d.useState)({av:!1}),[i,r]=(0,d.useState)(D),[o,a]=(0,d.useState)(!1),[l,u]=(0,d.useState)(0);(0,d.useEffect)(()=>{switch(console.debug("state",s[l]),l){case 0:u(1);break;case 1:r({...D,checking_wake_lock:!0}),a(!0),P().then(()=>{u(2)});break;case 2:r({...D,checking_permissions:!0}),a(!0),h().then(e=>{e?(r({...D,get_success:!0}),u(4)):u(3)});break;case 3:r({...D,explain_request:!0}),a(!1);break;case 4:r({...D,get_request:!0}),a(!1),p().then(e=>{if(!0===e||!1===e)n({av:e}),r({...D,get_success:e,get_fail_unknown_error:!e});else{let{type:t,name:i,message:o}=e;n({av:!1}),console.error("Permission denied: ".concat(i,", ").concat(o)),r({...D,get_success:!1,get_fail_system:t===y.wS.SystemPermissionDenied,get_fail_user:t===y.wS.UserPermissionDenied,get_fail_could_not_start:t===y.wS.CouldNotStartVideoSource,get_fail_unknown_error:null==t||t===y.wS.Generic})}u(5)});break;case 5:a(!1),t.av&&e.onDone(!0)}},[l]),(0,d.useEffect)(()=>{console.info("Media permissions",t)},[t]);let h=async()=>{if(void 0===navigator)return console.warn("Navigator required to check permissions"),!1;try{let e=await navigator.permissions.query({name:"camera"});return"granted"===e.state}catch(e){return console.error("Error checking camera permissions",e),!1}},p=async()=>{try{let e=await (0,y.TD)();if(void 0!==e)return e;throw{type:y.wS.Generic,name:"Unknown",message:"Unknown error"}}catch(e){if(void 0!==e)return e;return{type:y.wS.Generic,name:"Unknown",message:"Unknown error"}}},P=async()=>{void 0!==navigator?void 0!==navigator.permissions?(console.debug("Checking screen wake-lock permission..."),console.info("screen-wake-lock permission",(await navigator.permissions.query({name:"screen-wake-lock"})).state)):console.warn("navigator.permissions is undefined"):console.warn("navigator is undefined")};return(0,c.jsxs)(c.Fragment,{children:[o&&(0,c.jsx)(x.Z,{}),i.checking_permissions&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",children:"We need permission to keep your screen on while you're in the workshop."}),(0,c.jsx)(f.Z,{variant:"h4",component:"h2",children:"Checking for permission"}),(0,c.jsx)(f.Z,{variant:"body1",children:"Please wait while we check for permission to keep your screen on while you're in the workshop..."})]}),i.checking_permissions&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",children:"We need your permission to use your camera and microphone to participate in this workshop."}),(0,c.jsx)(f.Z,{variant:"h4",component:"h2",children:"Checking for permission"}),(0,c.jsx)(f.Z,{variant:"body1",children:"Please wait while we check for permission to use your camera and microphone..."})]}),i.explain_request&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",children:"We need your permission to use your camera and microphone to participate in this workshop."}),(0,c.jsx)(f.Z,{variant:"h4",component:"h2",children:"Permission to join the video call"}),(0,c.jsx)(f.Z,{variant:"body1",children:"If prompted by your browser, please grant access to your camera and microphone."}),(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:()=>{u(4)},children:"Grant permission"})]}),i.get_request&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",children:"We need your permission to use your camera and microphone to participate in this session."}),(0,c.jsx)(f.Z,{variant:"h4",component:"h2",children:"Permission to join the video call"}),(0,c.jsx)(f.Z,{variant:"body1",children:"If prompted by your browser, please grant access to your camera and microphone."})]}),i.get_success&&(0,c.jsx)(m.Z,{severity:"success",children:"Your camera and microphone are ready to go!"}),i.get_fail_system&&(0,c.jsx)(m.Z,{severity:"error",children:"Your browser has denied access to your camera and microphone. Please check your browser settings and reload the page."}),i.get_fail_user&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"warning",children:"You have denied access to your camera and/or microphone."}),(0,c.jsxs)(f.Z,{variant:"h4",component:"h2",children:["What to do next on ",E.KC]}),E.i7&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(v.Z,{fontSize:"inherit"}),children:"If you see a crossed video camera icon at the end of your address bar, click it to change permissions."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(b.Z,{fontSize:"inherit"}),children:"If you don't see a camera icon, click the info icon at the beginning of the address bar for the page settings."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(w.Z,{fontSize:"inherit"}),children:"Grant permission to access camera and microphone from there."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(j.Z,{fontSize:"inherit"}),children:"When done, reload the page."})]}),E.vU&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(v.Z,{fontSize:"inherit"}),children:"If you see a crossed video camera or microphone icon at the start of your address bar, click it to change permissions."}),(0,c.jsxs)(m.Z,{severity:"info",icon:(0,c.jsx)(k.Z,{fontSize:"inherit"}),children:["If you don't see those icons, choose ",(0,c.jsx)("b",{children:"Tools"})," > ",(0,c.jsx)("b",{children:"Page Info"})," from the menu."]}),(0,c.jsxs)(m.Z,{severity:"info",icon:(0,c.jsx)(w.Z,{fontSize:"inherit"}),children:["Grant permission to access camera and microphone from the ",(0,c.jsx)("b",{children:"Permissions"})," tab."]}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(j.Z,{fontSize:"inherit"}),children:"When done, reload the page."}),(0,c.jsx)("img",{src:"/instructions/permissions-dialog-ff.png",style:{width:"80%",alignSelf:"center"}})]}),E.G6&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(m.Z,{severity:"info",icon:(0,c.jsx)(k.Z,{fontSize:"inherit"}),children:["Choose ",(0,c.jsx)("b",{children:"Safari"})," > ",(0,c.jsx)("b",{children:"Settings"})," from the menu, then click ",(0,c.jsx)("b",{children:"Websites"}),"."]}),(0,c.jsxs)(m.Z,{severity:"info",icon:(0,c.jsx)(Z.Z,{fontSize:"inherit"}),children:["Choose the Camera settings, and set this site to ",(0,c.jsx)("b",{children:"Allow"}),"."]}),(0,c.jsxs)(m.Z,{severity:"info",icon:(0,c.jsx)(S.Z,{fontSize:"inherit"}),children:["Choose the Microphone settings, and set this site to ",(0,c.jsx)("b",{children:"Allow"}),"."]}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(C.Z,{fontSize:"inherit"}),children:"When done, reload the page."}),(0,c.jsx)("img",{src:"/instructions/permissions-dialog-sf.png",style:{width:"80%",alignSelf:"center"}})]}),E.un&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(k.Z,{fontSize:"inherit"}),children:"Select Settings and more... and select Settings."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(w.Z,{fontSize:"inherit"}),children:"Select Cookies and Site Permissions on the left side."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(j.Z,{fontSize:"inherit"}),children:"Under Site Permissions, select Camera or Microphone."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(C.Z,{fontSize:"inherit"}),children:"Grant permissions there"}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(I.Z,{fontSize:"inherit"}),children:"When done, reload this page."})]}),!E.i7&&!E.vU&&!E.G6&&!E.un&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(m.Z,{severity:"warning",children:["We don't have instructions for ",E.KC,"."]}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(k.Z,{fontSize:"inherit"}),children:"Please grant camera and microphone permissions for this page."}),(0,c.jsx)(m.Z,{severity:"info",icon:(0,c.jsx)(w.Z,{fontSize:"inherit"}),children:"When done, reload the page."})]})]}),i.get_fail_could_not_start&&(0,c.jsx)(m.Z,{severity:"warning",children:"Your camera and microphone are in use by another application. Please close the other application, refresh this page, and try again."}),i.get_fail_unknown_error&&(0,c.jsx)(m.Z,{severity:"error",children:"An unexpected error has prevented us from checking your camera and microphone. Please reload the page to try again."})]})}(i=s||(s={}))[i.Init=0]="Init",i[i.CheckingWakeLock=1]="CheckingWakeLock",i[i.CheckingPermission=2]="CheckingPermission",i[i.ExplainRequestPermissions=3]="ExplainRequestPermissions",i[i.GetPermission=4]="GetPermission",i[i.Result=5]="Result";var q=n(24314),A=n(34360),_=n(43655),R=n(43312),F=n(31193);function T(e){let[t,n]=(0,d.useState)(0),i=()=>void 0!==window&&void 0!==window.navigator&&void 0!==window.navigator.storage;(0,d.useEffect)(()=>{switch(t){case 0:i()||e.onDone(!1);break;case 1:r().then(t=>{console.debug("storage granted: ".concat(t)),e.onDone(t)})}},[t]);let r=async()=>i()&&void 0!==window.navigator.storage.persist&&await window.navigator.storage.persist();return(0,c.jsxs)(c.Fragment,{children:[0===t&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{variant:"h4",component:"h2",children:"Permission to store workshop content"}),(0,c.jsx)(f.Z,{variant:"body1",children:"We need your permission to store workshop content on this device. This helps save time and data if you reload the page, or restart your device."}),(0,c.jsx)(f.Z,{variant:"body1",children:"It's ok if you'd rather not grant that permission."}),(0,c.jsxs)(F.Z,{sx:{display:"flex",flexDirection:"row",gap:1},children:[(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:()=>{n(1)},children:"Grant permission"}),(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"outlined",color:"primary",onClick:()=>{e.onDone(!1)},children:"No thanks"})]})]}),1===t&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{variant:"h4",component:"h2",children:"Permission to store workshop content"}),(0,c.jsx)(f.Z,{variant:"body1",children:"If you see a prompt from your browser, please grant permission to store data on your device."}),(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"outlined",color:"primary",onClick:()=>e.onDone(!1),children:"Skip"})]})]})}(r=a||(a={}))[r.Describe=0]="Describe",r[r.Request=1]="Request";var B=n(5085),W=n(94547),N=n(22960);function U(e){let t=(0,N.Z)(),n=(0,d.useContext)(B.rZ),[i,r]=(0,d.useState)([]);return(0,d.useEffect)(()=>{let t=["We'll ask you for a name, so we know how to refer to you during the workshop."];e.session.remoteConfiguration===W.VS.RemoteWithVideoCall&&t.push("We'll ask for permission to use your camera and microphone, for the video call."),t.push("We'll ask for permission to keep workshop content on your device. (This is optional.)"),t.push("We'll fetch the workshop content for today, so it's ready for when we start."),r(t)},[]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{variant:"h4",children:"Thank you for joining us"}),e.session.facilitationState===W._y.Closed&&n.role===W._b.Client&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{variant:"h5",children:"Workshop closed"}),(0,c.jsx)(f.Z,{variant:"body1",children:"This workshop has ended. If you believe you're seeing this message in error, please contact your facilitator for more information."}),(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"outlined",color:"buttonStandard",onClick:e.onComplete,children:"Continue"})]}),e.session.facilitationState===W._y.Closed&&n.role===W._b.Controller&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{variant:"h5",children:"Workshop closed"}),(0,c.jsx)(f.Z,{variant:"body1",children:"This workshop has been closed. As a facilitator, you may enter the workshop and open it again."}),(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:e.onComplete,children:"Continue"})]}),e.session.facilitationState!==W._y.Closed&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f.Z,{variant:"h5",children:"Today's session"}),(0,c.jsx)(F.Z,{sx:{border:"solid 2px",borderColor:t.palette.buttonQuiet.main,background:t.palette.buttonQuiet.main,p:2,borderRadius:2},children:(0,c.jsx)(f.Z,{variant:"body1",children:(0,c.jsx)("span",{dangerouslySetInnerHTML:{__html:e.session.sessionDescription}})})}),(0,c.jsx)(f.Z,{variant:"h5",children:"Let's get started"}),(0,c.jsxs)(f.Z,{variant:"body1",component:"div",children:["In order to connect you to the workshop, we'll need a few things:",(0,c.jsx)("ul",{children:i.map((e,t)=>(0,c.jsx)("li",{children:e},"welcome-list-item-".concat(t)))})]}),(0,c.jsx)(g.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:e.onComplete,children:"Continue"})]})]})}var M=n(60335),V=n(69779);function O(e){let t=(0,d.useContext)(B.rZ),n=(0,d.useMemo)(()=>{var t;return(null===(t=e.elementRef)||void 0===t?void 0:t.current)||document.documentElement},[e.elementRef]),[i,r]=(0,d.useState)(),o=async()=>{try{!1!==document.fullscreenEnabled?n.requestFullscreen?await n.requestFullscreen({navigationUI:"hide"}):n.webkitRequestFullscreen?await n.webkitRequestFullscreen():n.webkitEnterFullscreen?await n.webkitEnterFullscreen():n.mozRequestFullScreen?await n.mozRequestFullScreen():n.msRequestFullscreen?await n.msRequestFullscreen():console.warn("No request full screen variants found"):console.warn("Fullscreen not enabled")}catch(e){console.error("Error entering fullscreen",e)}},s=async()=>{try{let e=document;document.fullscreenElement?await document.exitFullscreen():e.webkitFullscreenElement?await e.webkitExitFullscreen():e.mozFullScreenElement?await e.mozCancelFullScreen():e.msFullscreenElement?await e.msExitFullscreen():console.warn("No exit full screen variants found")}catch(e){console.error("Error exiting fullscreen",e)}};(0,d.useEffect)(()=>{document.onfullscreenchange=e=>{document.fullscreenEnabled,r(null!==document.fullscreenElement)}},[]),(0,d.useEffect)(()=>{t.role===W._b.Client&&void 0!==n&&(e.goFullScreen&&!i&&o(),!e.goFullScreen&&i&&s())},[e.goFullScreen,n]);let a=(0,N.Z)();return(0,c.jsx)(c.Fragment,{children:t.role===W._b.Client&&!i&&(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(F.Z,{sx:{position:"absolute",top:"1.5rem",right:"1.5rem",zIndex:10},children:(0,c.jsx)(M.Z,{"aria-label":"full screen",onClick:()=>o(),sx:{border:"2px solid",borderColor:a.palette.promptPanelBackground.main,background:a.palette.slideSectionBackground.main},children:(0,c.jsx)(V.Z,{})})})})})}var L=n(11144);(o=l||(l={}))[o.Welcome=0]="Welcome",o[o.ObtainVideoPermissions=1]="ObtainVideoPermissions",o[o.ObtainStoragePermissions=2]="ObtainStoragePermissions",o[o.Ready=3]="Ready";let z=(0,d.createContext)({});function G(e){let{session:t,graphic:n}=(0,d.useContext)(L.z),[i,r]=(0,d.useState)(0),[o,s]=(0,d.useState)(),[a,l]=(0,d.useState)(),[u,h]=(0,d.useState)(),p=(0,d.useMemo)(()=>(0,c.jsx)(A.Z,{url:n.posterUrl}),[n.posterUrl]),x=(0,d.useCallback)(()=>{r(1),y(!0)},[r]),m=(0,d.useCallback)(e=>{l(e),r(2)},[l,r]),f=(0,d.useCallback)(e=>{h(e),r(3)},[h,r]);(0,d.useEffect)(()=>{1===i&&t.remoteConfiguration!==W.VS.RemoteWithVideoCall&&(l(!1),r(2))},[i]);let[g,y]=(0,d.useState)(!1);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(O,{goFullScreen:g}),3!==i&&(0,c.jsx)(_.Z,{heading:(0,c.jsx)(R.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsxs)(c.Fragment,{children:[0===i&&(0,c.jsx)(q.Z,{left:(0,c.jsx)(U,{session:t,onComplete:x}),right:(0,c.jsx)(A.Z,{url:n.posterUrl})}),1===i&&(0,c.jsx)(q.Z,{left:(0,c.jsx)(P,{onDone:m}),right:p}),2===i&&(0,c.jsx)(q.Z,{left:(0,c.jsx)(T,{onDone:f}),right:p})]})}),3===i&&(0,c.jsx)(z.Provider,{value:{videoPermissionsGranted:a,storagePermissionsGranted:u},children:e.children})]})}var H=n(68276),K=n(67506),J=n(88620),Y=n(64675);function Q(e){let{session:t,graphic:n}=(0,d.useContext)(L.z),i=(0,d.useMemo)(()=>(0,c.jsx)(A.Z,{url:n.posterUrl}),[n.posterUrl]);return(0,c.jsx)(K.Z,{mode:"zg-server-time",loading:(0,c.jsx)(_.Z,{heading:(0,c.jsx)(R.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsx)(q.Z,{left:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!0,title:"Synchronising...",message:"Please wait while we synchronise clocks."}),right:i})}),error:(0,c.jsx)(J.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Synchronising...",message:"We were unable to synchronise clocks with the server."}),children:(0,c.jsx)(Y.Z,{sid:e.sid,refresh:e.refresh,initialising:(0,c.jsx)(_.Z,{heading:(0,c.jsx)(R.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsx)(q.Z,{left:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Preparing...",message:"Please wait while we prepare to download the workshop content."}),right:i})}),loading:(0,c.jsx)(_.Z,{heading:(0,c.jsx)(R.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsx)(q.Z,{left:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!0,title:"Downloading content...",message:"Please wait while we download the workshop content."}),right:i})}),error:(0,c.jsx)(J.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Content error",message:"We were unable to retrieve content for this workshop."}),children:e.children})})}var X=n(37471),$=n(4766),ee=n(70883),et=n(93191);function en(e){let{session:t,graphic:n}=(0,d.useContext)(L.z),i=(0,d.useMemo)(()=>(0,c.jsx)(A.Z,{url:n.posterUrl}),[n.posterUrl]);return(0,c.jsx)(X.C,{sid:e.sid,loading:(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(_.Z,{heading:(0,c.jsx)(R.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsx)(q.Z,{left:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Connecting to live session...",message:"Please wait while we connect you to the workshop."}),right:i})})}),error:(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(J.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Connecting to live session...",message:"We were unable to connect you to the live session."})}),children:(0,c.jsx)($.Z,{children:(0,c.jsx)(et.Z,{keepAwake:!0,refresh:e.refresh,children:(0,c.jsx)(ee.Z,{sid:e.sid,children:e.children})})})})}function ei(e){return(0,c.jsx)(B.ZP,{role:e.role,sid:e.sid,joinCode:e.joinCode,loading:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Checking permissions...",message:"Please wait while we confirm your access to the workshop."}),error:(0,c.jsx)(J.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Checking permissions...",message:"We were unable to confirm access to this workshop."}),children:(0,c.jsx)(u.Z,{sid:e.sid,initialising:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Preparing...",message:"Please wait while we prepare to retrieve the workshop."}),loading:(0,c.jsx)(J.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Retrieving workshop data...",message:"Please wait while we retrieve information about the workshop."}),error:(0,c.jsx)(J.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Content error",message:"We were unable to retrieve this workshop."}),children:e.children})})}var er=n(79044);function eo(e){let{keepAwake:t}=e,[n,i]=(0,d.useState)(),[r,o]=(0,d.useState)();return(0,d.useEffect)(()=>{if(void 0===n&&void 0!==window.navigator){var e;i(null===(e=window.navigator)||void 0===e?void 0:e.wakeLock)}},[]),(0,d.useEffect)(()=>{console.debug("Wake lock: ".concat(void 0===n?"unavailable":"available",", keepAwake: ").concat(t));try{void 0===n||(t&&void 0===r&&n.request("screen").then(e=>{console.debug("Wake lock sentinel acquired"),o(e)}).catch(e=>{console.error("Wake lock exception",e)}),t||(void 0!==r&&console.debug("Releasing wake lock sentinel..."),null==r||r.release().then(()=>{console.debug("Wake lock sentinel released."),o(void 0)})))}catch(e){console.warn("Unable to request screen lock",e)}return()=>{void 0!==r&&console.debug("Relesaing wake lock sentinel..."),null==r||r.release().then(()=>{console.debug("Wake lock sentinel released."),o(void 0)})}},[n,t]),(0,c.jsx)(c.Fragment,{})}var es=n(1973),ea=n(6722),el=n(8963);function ec(e){let[t]=(0,d.useState)(()=>new el.ConsoleLogger("ZgLiveSession",el.LogLevel.OFF));return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(es.Z,{children:[(0,c.jsx)(p,{}),(0,c.jsx)(ei,{sid:e.sid,role:e.role,joinCode:e.joinCode,children:(0,c.jsxs)(L.Z,{children:[(0,c.jsx)(h,{}),(0,c.jsx)(G,{sid:e.sid,refresh:e.refresh,children:(0,c.jsx)(Q,{sid:e.sid,refresh:e.refresh,children:(0,c.jsx)(er.Z,{children:(0,c.jsx)(en,{sid:e.sid,refresh:e.refresh,children:(0,c.jsx)(ea.ikO,{logger:t,children:(0,c.jsx)(ea.lUb,{children:(0,c.jsxs)(H.Z,{children:[(0,c.jsx)(eo,{keepAwake:!0}),e.children]})})})})})})})]})})]})})}},15785:function(e,t,n){var i,r;n.d(t,{I:function(){return o},S:function(){return i}}),(r=i||(i={}))[r.default=0]="default",r[r.deliberation=1]="deliberation";let o={activity:0,recordingId:void 0,index:0,notes:"",qids:[],secs:void 0}},53771:function(e,t,n){n.d(t,{Z:function(){return d}});var i=n(57437),r=n(22960),o=n(31193),s=n(40468),a=n(2057),l=n(2265),c=n(1973);function d(e){let{runningTasks:t,waitingTasks:n,failedTasks:d}=(0,l.useContext)(c.E),u=(0,r.Z)(),h={[a.l.Waiting]:u.palette.taskWaiting.main,[a.l.Ready]:u.palette.taskReady.main,[a.l.Running]:u.palette.taskRunning.main,[a.l.Success]:u.palette.taskSuccess.main,[a.l.Failed]:u.palette.taskFailed.main,[a.l.Cancelled]:u.palette.taskCancelled.main},p=e=>{let{task:t}=e,n=t.initProps.indicator,r=!1;switch(t.state){case a.l.Waiting:n+=" (retry)",r=!0;break;case a.l.Ready:case a.l.Running:n+="...",r=!0}return(0,i.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"row",gap:1,alignItems:"center",borderRadius:1,backgroundColor:"white",border:1,borderColor:h[t.state],borderBottom:4,borderBottomColor:h[t.state],opacity:.75,py:1,px:2},children:[r&&(0,i.jsx)(s.Z,{size:"1rem"}),n]})};return(0,l.useEffect)(()=>{console.debug("Running tasks: ".concat(t.length))},[t]),(0,i.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.showRunning&&t.filter(e=>void 0!==e.initProps.indicator).map(e=>(0,i.jsx)(p,{task:e},"task-vis-".concat(e.id,"-").concat(a.l[e.state]))),n.filter(e=>void 0!==e.initProps.indicator).map(e=>(0,i.jsx)(p,{task:e},"task-vis-".concat(e.id,"-").concat(a.l[e.state])))]})}},28801:function(e,t,n){n.d(t,{Z:function(){return u}});var i=n(57437),r=n(2265),o=n(94547),s=n(70883),a=n(27270),l=n(37471);let c=[o.um.Error,o.um.Disconnected,o.um.Disconnecting,o.um.Offline],d=[o.um.Online,o.um.Connecting,o.um.Connected,o.um.Joining];function u(){let e=(0,r.useContext)(s.l),t=(0,r.useContext)(l.Z),[n,u]=(0,r.useState)(e.thisUser),[h,p]=(0,r.useState)(t.state),[x,m]=(0,r.useState)(c.includes(h)),[f,g]=(0,r.useState)(d.includes(h)),[y,v]=(0,r.useState)("TODO"),[b,w]=(0,r.useState)(0);return(0,r.useEffect)(()=>{u(e.thisUser)},[e]),(0,r.useEffect)(()=>{console.debug("Connection warning, state: ".concat(o.um[t.state])),p(t.state)},[t.state,n]),(0,r.useEffect)(()=>{let e=c.includes(h),t=d.includes(h);e&&v("Disconnected from the workshop server."),t&&v("Please wait, connecting to the workshop server..."),m(e),g(t)},[h]),(0,r.useEffect)(()=>{w(x||f?1:0)},[x,f]),(0,i.jsx)(a.Z,{variant:"filled",severity:x?"warning":"info",sx:{opacity:b},children:y})}},40395:function(e,t,n){n.d(t,{Z:function(){return h}});var i=n(57437),r=n(69065),o=n(66124),s=n(31193),a=n(60335),l=n(80511),c=n(96537),d=n(7630),u=n(2265);function h(e){var t,n,h;let p=()=>{var t;e.setOpen(!1),null===(t=e.onClose)||void 0===t||t.call(e)},x=t=>{var n,i;e.setOpen(!1),null===(n=e.onClose)||void 0===n||n.call(e),null===(i=e.onSelect)||void 0===i||i.call(e,t)},m=(0,u.useId)();return(0,i.jsx)(r.Z,{fullWidth:null===(t=e.fullWidth)||void 0===t||t,maxWidth:null!==(n=e.maxWidth)&&void 0!==n?n:"sm",open:e.open,onClose:p,children:(0,i.jsxs)(o.Z,{children:[(null===(h=e.showCloseButton)||void 0===h||h)&&(0,i.jsx)(s.Z,{style:{position:"absolute",top:0,right:0},children:(0,i.jsx)(a.Z,{"aria-label":"close",onClick:p,children:(0,i.jsx)(d.Z,{})})}),(0,i.jsxs)(s.Z,{sx:{p:2,gap:2,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,i.jsx)(l.Z,{variant:"h4",sx:{width:"75%",mb:2},style:{textAlign:"center"},children:e.prompt}),e.options.map(e=>(0,i.jsx)(c.Z,{sx:{width:"66%"},variant:e.filled?"contained":"outlined",color:"buttonStandard",onClick:()=>x(e.key),children:e.text},"dialog-".concat(m,"-option-").concat(e.key)))]})]})})}},97340:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(57437),r=n(31193),o=n(80511);function s(e){return(0,i.jsxs)(r.Z,{sx:{maxHeight:"100%",maxWidth:"100%",display:"flex",flexDirection:"column",background:"white",borderRadius:2,p:2,...e.sx},children:[(e.title||e.tools)&&(0,i.jsxs)(r.Z,{display:"flex",flexDirection:"row",justifyContent:"space-between",sx:{mb:1},children:[e.title&&(0,i.jsx)(o.Z,{variant:"h6",children:e.title}),e.tools]}),(0,i.jsx)(r.Z,{sx:{height:"100%",maxHeight:"100%",display:"block",overflowY:"hidden"},children:(0,i.jsx)(r.Z,{sx:{width:"100%",maxWwidth:"100%",height:"100%",maxHeight:"100%",overflowY:e.scrolling?"auto":"hidden"},children:e.children})})]})}},49752:function(e,t,n){n.d(t,{Z:function(){return a}});var i=n(57437),r=n(80511),o=n(31193),s=n(42555);function a(e){let t=()=>{var t,n;return(0,i.jsx)(s.Z,{variant:null!==(t=e.variant)&&void 0!==t?t:"contained",type:"submit",size:!0===e.large?"large":"medium",color:"buttonStandard",onClick:e.onSubmit,loading:e.busy,disabled:!e.enabled||e.busy,children:(0,i.jsx)(r.Z,{variant:"submitButton",children:null!==(n=e.text)&&void 0!==n?n:"Submit"})})},n="left"===e.alignment?"flex-start":"right"===e.alignment?"flex-end":"stretch";return(0,i.jsxs)(i.Fragment,{children:[e.inline&&(0,i.jsx)(t,{}),!e.inline&&(0,i.jsx)(o.Z,{sx:e.sx,display:"flex",flexDirection:"row",justifyContent:n,children:(0,i.jsx)(t,{})})]})}},9646:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(57437),r=n(42555),o=n(80511);function s(e){var t,n,s;return(0,i.jsx)(r.Z,{type:"submit",variant:null!==(t=e.variant)&&void 0!==t?t:"contained",size:e.size,color:null!==(n=e.color)&&void 0!==n?n:"buttonStandard",onClick:()=>{e.onClick(e.btnKey)},loading:e.busy,disabled:e.disabled||e.busy,startIcon:e.startIcon,endIcon:e.endIcon,sx:e.sx,children:(0,i.jsx)(o.Z,{variant:"submitButton",children:null!==(s=e.btnText)&&void 0!==s?s:"Submit"})})}},71359:function(e,t,n){n.d(t,{Q:function(){return r},Z:function(){return f}});var i,r,o=n(57437),s=n(2265),a=n(31193),l=n(49752),c=n(22599),d=n.n(c),u=n(48620),h=n(94547),p=n(26049),x=n(45231),m=n(8260);function f(e){var t;let{answers:n}=(0,m.ZP)(e.qids.qid),i=()=>{var t;return(0,m.Zp)(n,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)},[c,f]=(0,s.useState)(i()),[g,y]=(0,s.useState)(i()),[v,b]=(0,s.useState)(!1),[w,j]=(0,s.useState)(e.role===h._b.Client),k=t=>{var n,i;return{answers:[{key:"".concat(t),index:t,description:null!==(i=null===(n=e.marks)||void 0===n?void 0:n[t])&&void 0!==i?i:"".concat(t),numericValue:1}]}};(0,s.useEffect)(()=>{var e;y({...c,jsonValue:null!==(e=c.jsonValue)&&void 0!==e?e:k(Math.floor((S()+C())/2))})},[c]);let Z=async()=>{e.role===h._b.Client?(b(!0),e.onAnswer(g).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)f(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{b(!1)})):console.warn("Only participants can submit answers")},S=()=>{switch(e.type){case 2:return 0;case 0:case 1:return e.numericRange?e.numericRange[0]:0;default:throw"Unsupported SliderInputType ".concat(r[e.type])}},C=()=>{switch(e.type){case 2:return e.marks.length-1;case 0:case 1:return e.numericRange?e.numericRange[1]:10;default:throw"Unsupported SliderInputType ".concat(r[e.type])}},I=()=>{var t,n;switch(e.type){case 2:return 1;case 0:return null!==(t=e.numericStep)&&void 0!==t?t:.01;case 1:return null!==(n=e.numericStep)&&void 0!==n?n:1;default:throw"Unsupported SliderInputType ".concat(r[e.type])}},E=e.marks?100-100/e.marks.length:void 0,D=E?"".concat(E,"%"):void 0;return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(a.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,o.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,alignItems:"center",justifyContent:"center",px:4},children:[(0,o.jsx)(a.Z,{sx:{mb:8},children:e.question&&(0,o.jsx)(u.Z,{content:e.question})}),(0,o.jsx)(a.Z,{sx:{width:null!=D?D:"95%"},children:(0,o.jsx)(p.Z,{onCommit:e=>{y({...g,jsonValue:k(e)})},color:"secondary",sliderDefault:g.jsonValue?d().toNumber(g.jsonValue.answers[0].index):Math.floor((S()+C())/2),marks:null!==(t=(()=>{switch(e.type){case 2:return e.marks.map((e,t)=>({value:t,label:e}));case 0:return;case 1:return d().range(e.numericRange[0],e.numericRange[1]+1,I()).map((e,t)=>({value:e,label:"".concat(e)}))}})())&&void 0!==t&&t,slots:{markLabel:x.A},min:S(),max:C(),step:I(),sliderMode:"solo"})})]}),e.role===h._b.Client&&(0,o.jsx)(a.Z,{sx:{mt:8,mr:8},children:(0,o.jsx)(l.Z,{onSubmit:Z,text:"Submit",busy:v,enabled:w,inline:!1,alignment:"right"})})]})})}(i=r||(r={}))[i.continuous=0]="continuous",i[i.discrete=1]="discrete",i[i.categorical=2]="categorical"},26049:function(e,t,n){n.d(t,{Z:function(){return a}});var i=n(57437),r=n(48024),o=n(43298),s=n(2265);function a(e){var t;let[n,a]=(0,s.useState)(null!==(t=e.sliderDefault)&&void 0!==t?t:0),[l,c]=(0,s.useState)("solo"===e.sliderMode?1:.5),d=(0,s.useMemo)(()=>(0,r.ZP)(o.ZP)({color:"secondary",height:"".concat(.8*l,"em"),"& .MuiSlider-thumb":{height:"".concat(1.6*l,"em"),width:"".concat(1.6*l,"em"),backgroundColor:"secondary",boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset","&::before":{display:"none"}},"& .MuiSlider-rail":{borderRadius:"".concat(.4*l,"em"),boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset"},"& .MuiSlider-track":{borderRadius:"".concat(.4*l,"em"),boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset"},"& .MuiSlider-markLabel":{fontSize:"".concat(1*l,"rem"),marginTop:"".concat(2.5*l,"em")}}),[l]);return(0,i.jsx)(d,{...e,value:n,onChange:(e,t)=>{a(t)},onChangeCommitted:(t,n)=>{let i=n;e.acceptableRange&&i>e.acceptableRange.max&&(i=e.acceptableRange.max),e.acceptableRange&&i<e.acceptableRange.min&&(i=e.acceptableRange.min),a(i),e.onCommit(i)}})}},45231:function(e,t,n){n.d(t,{A:function(){return s}});var i=n(57437),r=n(43298),o=n(80511);let s=e=>{let t=e["data-index"],n=e.ownerState.marks[t],s=e.ownerState.marks.length,a={...e.style,width:"".concat(100/s,"%"),wordWrap:"normal",whiteSpace:"wrap"};return(0,i.jsx)(r.J$,{...e,style:a,children:(0,i.jsx)(o.Z,{variant:"sliderMark",style:{display:"block",wordWrap:"normal",whiteSpace:"wrap"},children:n.label})})}},45080:function(e,t,n){n.d(t,{L:function(){return r},Z:function(){return A}});var i,r,o=n(57437),s=n(2265),a=n(48620),l=n(22960),c=n(31193),d=n(66858),u=n(44908),h=n(65786),p=n(96537),x=n(69065),m=n(66124),f=n(60335),g=n(80511),y=n(49752),v=n(94547),b=n(73391),w=n(60320);let j=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,k=(e,t,n)=>{let i=[],o=null!=t?t:"";switch(e){case r.text:let s=n?o.length>0?null:"Please enter an answer":null;null!==s&&i.push(s);break;case r.email:let a=j.test(o.trim()),l=n?o.trim().length>0&&a?null:"Please enter a valid email address.":0===o.trim().length||a?null:"Please enter a valid email address.";null!==l&&i.push(l);break;default:throw"Unsupported TextInputType"}return i},Z=(e,t)=>{if(console.debug("Validating checkboxes",e),void 0===e)return["Checkbox data undefined."];let n=e.filter(e=>e.checked).length,i=e.map((e,t)=>e.required&&!e.checked?"The ".concat((0,b.q)(t+1)," checkbox is required."):null).filter(e=>null!==e).map(e=>e),r=[];return n<t&&r.push("Please select at least ".concat(t," ").concat(1===t?"checkbox":"checkboxes",".")),[...i,...r]},S=()=>(0,o.jsx)(w.Z,{children:(0,o.jsx)("svg",{focusable:"false","aria-hidden":"true","data-testid":"CheckBoxBlankIcon",children:(0,o.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5",fill:"white"})})});var C=n(49428),I=n(7630),E=n(19309),D=n(8260);(i=r||(r={}))[i.text=0]="text",i[i.email=1]="email";let P=(e,t)=>({...e,jsonValue:{answers:[{key:"text",stringValue:t.answer},...t.checks.map(e=>({key:e.key,stringValue:e.text,booleanValue:e.checked}))]}}),q=(e,t)=>{var n,i;return{answer:null===(i=e.jsonValue)||void 0===i?void 0:null===(n=i.answers.find(e=>"text"===e.key))||void 0===n?void 0:n.stringValue,checks:t.map(t=>{var n,i,r;return{key:t.key,text:t.text,initial:t.initial,checked:null!==(r=null===(i=e.jsonValue)||void 0===i?void 0:null===(n=i.answers.find(e=>e.key===t.key))||void 0===n?void 0:n.booleanValue)&&void 0!==r?r:t.initial,required:t.required}})}};function A(e){let{answers:t}=(0,D.ZP)(e.qids.qid),[n,i]=(0,s.useState)((0,D.Zp)(t,e.qids,e.question.pii)),[r,b]=(0,s.useState)({answer:void 0,checks:[]}),[w,j]=(0,s.useState)(!1),[A,_]=(0,s.useState)(!0),[R,F]=(0,s.useState)(e.role===v._b.Client),[T,B]=(0,s.useState)(!1),[W,N]=(0,s.useState)(!1),[U,M]=(0,s.useState)([]),[V,O]=(0,s.useState)(),[L,z]=(0,s.useState)(!1),G=()=>{z(!1)};(0,s.useEffect)(()=>{b(q(n,e.checkboxes))},[n]);let H=()=>{var t,n;let i=[...Z(r.checks,e.minCheckboxes),...k(e.type,r.answer,e.textRequired)],o=(null!==(n=null===(t=r.answer)||void 0===t?void 0:t.length)&&void 0!==n?n:0)>0;return _(!W||0===i.length&&(o||!e.textRequired)),M(i),0===i.length};(0,s.useEffect)(()=>{W&&H()},[r]);let K=async()=>{if(e.role===v._b.Client&&A){if(N(!0),H()){let t=P(n,r);console.debug("Submitting TextInput",t),j(!0),e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)b(q(t,e.checkboxes));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{j(!1)})}}else console.warn("Only participants can submit answers")},J=async()=>{let t=P(n,{...r,answer:void 0,checks:[]});j(!0),e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)b(q(t,e.checkboxes));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{j(!1)})},Y=(e,t)=>{let n={...r,checks:[...r.checks]};n.checks.find(t=>t.key===e).checked=t,b(n)};return(0,s.useEffect)(()=>{O(U.join(" ")),B(U.length>0)},[U]),(0,l.Z)(),(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(c.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.question&&(0,o.jsx)(c.Z,{sx:{mb:4},children:(0,o.jsx)(a.Z,{content:e.question})}),(0,o.jsx)(d.Z,{label:e.label,variant:"outlined",defaultValue:r.answer,helperText:V,type:1===e.type?"email":"text",onChange:e=>{b({...r,answer:e.target.value})},error:T,color:"buttonStandard",autoComplete:"off",InputProps:{sx:{background:"white",fontSize:"2rem"}},InputLabelProps:{sx:{fontSize:"2rem","&.MuiOutlinedInput-notchedOutline":{fontSize:"2rem"}}},sx:{mb:2}}),r.checks.map((t,n)=>(0,o.jsx)(c.Z,{display:"flex",flexDirection:"row",children:(0,o.jsx)(u.Z,{control:(0,o.jsx)(h.Z,{checked:t.checked,onChange:(e,n)=>Y(t.key,n),icon:e.forceCheckboxesWhite?(0,o.jsx)(S,{}):void 0}),label:t.text})},"checkbox-".concat(e.qids.qid,"-").concat(n,"-").concat(t.key))),e.information&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(p.Z,{variant:"text",fullWidth:!1,color:"buttonStandard",sx:{textDecoration:"underline",alignSelf:"start",mt:2},startIcon:(0,o.jsx)(C.Z,{}),onClick:()=>z(!0),children:e.information.heading}),(0,o.jsx)(x.Z,{fullWidth:!0,maxWidth:"md",open:L,onClose:G,children:(0,o.jsxs)(m.Z,{children:[(0,o.jsx)(c.Z,{style:{position:"absolute",top:0,right:0},children:(0,o.jsx)(f.Z,{"aria-label":"close",onClick:G,children:(0,o.jsx)(I.Z,{})})}),(0,o.jsx)(c.Z,{sx:{p:2},display:"flex",flexDirection:"column",children:e.information.body.map((t,n)=>(0,o.jsx)(g.Z,{variant:"slideInfoText",align:"left",dangerouslySetInnerHTML:{__html:(0,E.Z)(t)}},"".concat(e.qids.qid,"-info-body-").concat(n)))})]})})]}),(0,o.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"row",gap:1,justifyContent:"end",alignItems:"end"},children:[e.skipText&&(0,o.jsx)(y.Z,{inline:!0,busy:w,onSubmit:J,large:!0,variant:"outlined",text:e.skipText,enabled:!0}),(0,o.jsx)(y.Z,{inline:!0,busy:w,onSubmit:K,large:!0,text:e.submitText,enabled:!W||A})]})]})})}},48620:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(57437),r=n(31193),o=n(80511);function s(e){var t,n,s,a,l,c;return(0,i.jsx)(i.Fragment,{children:((null===(t=e.content)||void 0===t?void 0:t.explanation)||(null===(n=e.content)||void 0===n?void 0:n.instruction)||(null===(s=e.content)||void 0===s?void 0:s.question))&&(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch"},children:[e.content.instruction&&(0,i.jsx)(o.Z,{variant:"questionInstruction",align:null!==(a=e.forceAlign)&&void 0!==a?a:"center",component:"div",sx:{alignSelf:"stretch",...e.sx},children:e.content.instruction}),e.content.question&&(0,i.jsx)(o.Z,{variant:"questionPrompt",align:null!==(l=e.forceAlign)&&void 0!==l?l:"center",component:"div",sx:{alignSelf:"stretch",...e.sx},children:e.content.question}),e.content.explanation&&(0,i.jsx)(o.Z,{variant:"questionExplanation",align:null!==(c=e.forceAlign)&&void 0!==c?c:"center",component:"div",sx:{alignSelf:"stretch",...e.sx},children:e.content.explanation})]})})}},2962:function(e,t,n){n.d(t,{J:function(){return r},Z:function(){return v}});var i,r,o=n(57437),s=n(2265),a=n(22960),l=n(24132),c=n(48620),d=n(41506),u=n(28651),h=n(43152),p=n(22599),x=n.n(p),m=n(35231),f=n(97294),g=n(8260),y=n(83593);function v(e){let{answers:t}=(0,g.ZP)(e.qids.qid),[n,i]=(0,s.useState)();(0,s.useEffect)(()=>{switch(e.inputType){case l.rT.categorical:i((0,l.dx)(t,e.categories,e.range));break;case l.rT.numerical:i((0,l.B8)((0,l.tJ)(t,e.range)));break;default:throw"Unsupported GraphInputType"}setTimeout(()=>{y.Z.emit({type:y.M.Request_SlideRefresh})},1e3)},[t,e.categories,e.inputType,e.range]);let r={scaleType:"linear",tickInterval:x().range(0,1e3,1),tickLabelInterval:e=>(0,p.isInteger)(e),valueFormatter:e=>"".concat(e.toFixed(0)),disableLine:!0,disableTicks:!1},v={scaleType:"band",dataKey:"category",disableLine:!1,disableTicks:!1},b=(0,a.Z)();return(0,o.jsxs)(o.Fragment,{children:[e.question&&(0,o.jsx)(c.Z,{content:e.question}),(0,o.jsx)(m.h,{width:"100%",height:"100%",minWidth:50,minHeight:50,children:(0,o.jsx)(d.v,{layout:1===e.orientation?"vertical":"horizontal",margin:{left:150},grid:{horizontal:1===e.orientation,vertical:0===e.orientation},dataset:n,barLabel:"value",sx:{[".".concat(u.Is.root)]:{},".MuiBarElement-series-votes_id":{fill:b.palette.secondary.main},".MuiBarLabel-series-votes_id":{fill:"white",fontWeight:"bolder"},["& .".concat(h.k.line)]:{strokeDasharray:"5 3",strokeWidth:1},[".".concat(f.x.tickContainer)]:{textWrap:"wrap"},[".".concat(f.x.tickLabel)]:{fontSize:"1rem !important"}},slotProps:{bar:{rx:4,ry:4}},xAxis:[1===e.orientation?v:r],yAxis:[1===e.orientation?r:v],series:[{dataKey:"votes",label:void 0,id:"votes_id",valueFormatter:e=>null===e?"No data":1===e?"1 vote":"".concat(e.toFixed(0)," votes")}]})})]})}(i=r||(r={}))[i.horizontal=0]="horizontal",i[i.vertical=1]="vertical"},24132:function(e,t,n){n.d(t,{B8:function(){return f},dx:function(){return u},rT:function(){return s},tJ:function(){return h}});var i,r,o,s,a=n(22599),l=n.n(a);(i=o||(o={}))[i.bar=0]="bar",(r=s||(s={}))[r.categorical=0]="categorical",r[r.numerical=1]="numerical";let c=e=>{var t,n;return l().range(e.lo,e.hi+(null!==(t=e.step)&&void 0!==t?t:1),null!==(n=e.step)&&void 0!==n?n:1)},d=e=>e.replace(/\\n/g,"\n"),u=(e,t,n)=>p(e,t,n).map((t,n)=>({category:d(t),votes:x(e,n)})),h=(e,t)=>c(t).map(t=>({value:t,votes:m(e,t)})),p=(e,t,n)=>{let i=void 0!==t?t:void 0!==n?c(n).map(e=>"".concat(e)):void 0;if(void 0===i)throw"Cannot determine categories";return i.filter(e=>void 0!==e).map(e=>e)},x=(e,t)=>l().sum(e.map(e=>{var n;return l().sum(null===(n=e.jsonValue)||void 0===n?void 0:n.answers.filter(e=>e.index===t).map(e=>{var t;return null!==(t=e.numericValue)&&void 0!==t?t:0}))})),m=(e,t)=>x(e,t),f=e=>e.map(e=>({category:"".concat(e.value),votes:e.votes}))},78364:function(e,t,n){n.d(t,{Z:function(){return d}});var i=n(57437),r=n(2265),o=n(4766),s=n(77412),a=n(5085),l=n(94547),c=n(11144);function d(){let e=(0,r.useContext)(a.rZ),{session:t}=(0,r.useContext)(c.z),n=(0,r.useContext)(o.X),[d]=(0,s.Z)("/sounds/00-ding.mp3",{volume:.5});return(0,r.useEffect)(()=>{(e.role===l._b.Controller||t.remoteConfiguration!==l.VS.InPerson)&&d()},[e.role,t.remoteConfiguration,n.data.index,d]),(0,i.jsx)(i.Fragment,{})}},73391:function(e,t,n){n.d(t,{q:function(){return i}});let i=e=>{let t=e%10,n=e%100;return 1===t&&11!==n?e+"st":2===t&&12!==n?e+"nd":3===t&&13!==n?e+"rd":e+"th"}},20909:function(e,t,n){n.d(t,{X:function(){return i}});let i=e=>e.split("/").at(-2)}}]);