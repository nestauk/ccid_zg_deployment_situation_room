(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[44],{59870:function(e,t,n){Promise.resolve().then(n.bind(n,15990))},15990:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eq}});var i,a,r,o,s,l,c=n(57437),d=n(53622),u=n(94547),x=n(78364),h=n(2265),p=n(31193),f=n(80511),g=n(96537),m=n(22960),v=n(56019),j=n(71733),b=n(79806),y=n(44228),w=n(42748),Z=n(11656),C=n(47905),S=n(86917),k=n(60335),I=n(21395),T=n(24072),E=n(76396);function D(e){let t=t=>{t!==e.state&&e.onFacilitationStateChange(t)},n=()=>(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(w.Z,{children:[(0,c.jsx)(Z.Z,{children:(0,c.jsx)(C.Z,{inset:!0,children:(0,c.jsx)("b",{children:"Workshop facilitation"})})},"action-menu-video-heading"),[u._y.Ready,u._y.Open,u._y.Closed].map(n=>(0,c.jsxs)(Z.Z,{disabled:e.stateBusy,onClick:()=>t(n),children:[e.state===n&&(0,c.jsx)(S.Z,{children:(0,c.jsx)(y.Z,{})}),(0,c.jsx)(C.Z,{inset:e.state!==n,children:u._y[n]})]},"action-menu-item-".concat(u._y[n])))]})});return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(T.ZP,{variant:"popover",popupId:"facilitation-actions-popup",children:e=>(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(k.Z,{"aria-label":"settings",...(0,E.vW)(e),children:(0,c.jsx)("img",{src:"/icons//settings.svg"})}),(0,c.jsx)(I.Z,{...(0,E.wK)(e),children:(0,c.jsx)(n,{})})]})})})}function _(e){let[t,n]=(0,h.useState)(""),i=(0,h.useRef)();(0,h.useEffect)(()=>{if(e.startTime)return i.current=setInterval(a,1e3),()=>{clearInterval(i.current)};i.current&&(clearInterval(i.current),i.current=void 0),n("")},[e.startTime,e.duration_mins]);let a=(0,h.useCallback)(()=>{if(e.startTime){let t=new Date().getTime()-e.startTime.getTime();e.duration_mins&&(t=Math.max(6e4*e.duration_mins-t,0));let i=Math.floor(t/36e5),a=Math.floor((t-=36e5*i)/6e4),r=Math.floor((t-=6e4*a)/1e3);t-=1e3*r,n("".concat(i.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0"),":").concat(r.toString().padStart(2,"0")))}else n("")},[e.startTime,e.duration_mins]);return(0,c.jsxs)(f.Z,{variant:"h5",children:[(0,c.jsx)("img",{src:"/icons/clock.svg",style:{height:26,verticalAlign:"middle",marginRight:12,paddingBottom:4}}),t]})}var F=n(38628),A=n(5085),R=n(58433),U=n(14874),P=n(70883),M=n(11144),O=n(6722),N=n(9646),K=n(79393),V=n(10105);function z(e){let[t,n]=(0,h.useState)(!1),i=()=>{var t;null===(t=navigator)||void 0===t||t.clipboard.writeText((0,V.v)(e.session)),n(!0)};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(N.Z,{sx:{alignSelf:"flex-end"},variant:"outlined",onClick:()=>{i()},btnText:"Copy participant link",btnKey:"copy-participant-link"}),(0,c.jsx)(K.Z,{open:t,autoHideDuration:3e3,onClose:()=>n(!1),message:(0,c.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"row",gap:1,alignItems:"center"},children:[(0,c.jsx)(y.Z,{}),"Copied participant link to clipboard."]})})]})}var H=n(1973),L=n(40395);function W(){let{session:e}=(0,h.useContext)(M.z),{subscriptions:t,thisUser:n}=(0,h.useContext)(P.l),{api:i,start:a}=(0,h.useContext)(H.E),{user:r,sessionToken:o}=(0,h.useContext)(A.rZ),{roster:s}=(0,O.dJs)(),[l,d]=(0,h.useState)([]),[x,g]=(0,h.useState)(!1),m=(0,U.Z)(),v=async()=>{try{g(!0);let t={action:"mute",sessionId:e.id,parameters:{pids:["*"]}};a(i.postFacilitatorAction(r.access_token,o,t,!1))}finally{g(!1)}},j=async(t,n)=>{try{g(!0);let t={action:"mute",sessionId:e.id,parameters:{pids:[n.deviceId]}};a(i.postFacilitatorAction(r.access_token,o,t,!1))}catch(e){console.warn(e)}finally{g(!1)}},b=async(t,n)=>{try{g(!0);let t={action:"kick",sessionId:e.id,parameters:{pid:n.deviceId}};a(i.postFacilitatorAction(r.access_token,o,t,!1))}catch(e){console.warn(e)}finally{g(!1)}},y=t=>{var n,i,a;let{subscription:r}=t,o=s?null===(n=Object.entries(s).find(e=>{let[t,n]=e;return n.externalUserId===r.deviceId}))||void 0===n?void 0:n[1]:void 0,l=V(r),d=null!==(a=null===(i=e.deviceIdBanList)||void 0===i?void 0:i.includes(r.deviceId))&&void 0!==a&&a;return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(p.Z,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"row",gap:1,alignItems:"center",opacity:d?.5:1},children:[(0,c.jsx)(K,{connected:!d&&r.enabled}),(0,c.jsxs)(f.Z,{variant:"h6",component:"span",sx:{flexGrow:1},children:[l,d?" (banned)":void 0]}),o&&!d&&(0,c.jsx)(D,{attendee:o,subscription:r})]})})},D=e=>{let{attendee:t,subscription:i}=e;return(0,c.jsx)(c.Fragment,{children:i.subscriptionId!==(null==n?void 0:n.subscriptionId)&&(0,c.jsx)(_,{attendee:t,subscription:i})})},_=e=>{let{attendee:t,subscription:n}=e;return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(T.ZP,{variant:"popover",popupId:"attendee-controls-menu-items-".concat(n.subscriptionId),children:e=>(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(k.Z,{"aria-label":"settings",...(0,E.vW)(e),children:(0,c.jsx)("img",{src:"/icons/triple-dots-vertical.svg"})}),(0,c.jsx)(I.Z,{...(0,E.wK)(e),children:(0,c.jsx)(F,{attendee:t,subscription:n,requestClose:e.close})})]})})})},F=e=>{let{attendee:t,subscription:n,requestClose:i}=e,[a,r]=(0,h.useState)(!1),o=(0,O.ZzJ)(t.chimeAttendeeId).muted;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(w.Z,{children:[(0,c.jsx)(Z.Z,{children:(0,c.jsx)(C.Z,{children:(0,c.jsx)("b",{children:n.participantName})})},"attendee-control-menu-header-".concat(n.subscriptionId)),(0,c.jsxs)(Z.Z,{disabled:x||o,onClick:o?void 0:()=>{i(),j(t,n)},children:[(0,c.jsx)(S.Z,{children:o?(0,c.jsx)("img",{src:"/icons/controls/participant-muted.svg"}):(0,c.jsx)("img",{src:"/icons/controls/mute-participant.svg"})}),(0,c.jsx)(C.Z,{inset:!1,children:o?"Participant muted":"Mute participant"})]},"attendee-control-menu-item-".concat(n.subscriptionId,"-mute")),(0,c.jsxs)(Z.Z,{disabled:x,onClick:()=>{r(!0)},children:[(0,c.jsx)(S.Z,{children:(0,c.jsx)("img",{src:"/icons/controls/remove-participant.svg"})}),(0,c.jsx)(C.Z,{inset:!1,children:"Remove participant"})]},"attendee-control-menu-item-".concat(n.subscriptionId,"-kick"))]}),(0,c.jsx)(L.Z,{prompt:"Remove the participant from the call?",options:[{key:"kick",text:"Remove participant",filled:!0},{key:"cancel",text:"Cancel",filled:!1}],onSelect:e=>{"kick"===e&&b(t,n)},open:a,setOpen:r,onClose:i})]})},K=e=>{let{connected:t}=e;return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(p.Z,{sx:{p:1,borderRadius:4,height:42,background:t?m.palette.connected.main:m.palette.disconnected.main},children:(0,c.jsx)("img",{style:{height:26,margin:0,padding:0},src:t?"/icons/device-connected.svg":"/icons/device-disconnected.svg"})})})},V=e=>{let t=e.subscriptionId===(null==n?void 0:n.subscriptionId)?"(You) ":"",i=e.participantName&&e.participantName.length>0?e.participantName:"Unknown";return"".concat(t).concat(i)};return(0,h.useEffect)(()=>{d(t.toSorted((e,t)=>e.role===u._b.Controller?-1:t.role===u._b.Controller?1:e.participantName.localeCompare(t.participantName)))},[t]),(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:4},children:[(0,c.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"row",gap:1,justifyContent:"flex-end"},children:[e.remoteConfiguration===u.VS.RemoteWithVideoCall&&(0,c.jsx)(N.Z,{variant:"outlined",startIcon:(0,c.jsx)("img",{src:"/icons/controls/participant-muted.svg"}),btnKey:"mute-all",btnText:"Mute all",sx:{alignSelf:"flex-end"},busy:x,onClick:e=>{v()}}),(0,c.jsx)(z,{session:e})]}),(0,c.jsx)(R.ZP,{container:!0,spacing:2,children:l.map(e=>(0,c.jsx)(R.ZP,{item:!0,xs:6,children:(0,c.jsx)(y,{subscription:e})},"participant-subscription-indicator-".concat(e.subscriptionId)))})]})})}var B=n(18502),G=n(83040);function q(e){let t=(0,h.useId)();return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(T.ZP,{variant:"popover",popupId:t,children:t=>{var n,i,a;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(g.Z,{startIcon:e.startIcon,endIcon:null!==(n=e.endIcon)&&void 0!==n?n:(0,c.jsx)(G.Z,{color:"action"}),variant:"text",color:"buttonStandard","aria-label":e.ariaLabel,sx:e.sx,...(0,E.LI)(t),children:e.text}),(0,c.jsx)(B.ZP,{...(0,E.ZW)(t),anchorOrigin:null!==(i=e.anchorOrigin)&&void 0!==i?i:{vertical:"bottom",horizontal:"center"},transformOrigin:null!==(a=e.transformOrigin)&&void 0!==a?a:{vertical:"top",horizontal:"center"},children:(0,c.jsx)(p.Z,{sx:{p:4},children:e.children})})]})}})})}function J(){let{subscriptions:e,thisUser:t}=(0,h.useContext)(P.l);return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(q,{startIcon:(0,c.jsx)("img",{src:"/icons/session-participants.svg"}),text:"".concat(e.filter(e=>e.deviceId!==(null==t?void 0:t.deviceId)).length," participants"),children:(0,c.jsx)(p.Z,{sx:{width:"55vw"},children:(0,c.jsx)(W,{})})})})}var X=n(65301);(i=o||(o={}))[i.Ready=0]="Ready",i[i.InitError=1]="InitError",i[i.Recording=2]="Recording",i[i.Saving=3]="Saving",i[i.UploadSuccess=4]="UploadSuccess",i[i.UploadError=5]="UploadError";var Y=n(4766),$=n(63375),Q=n(15785),ee=n(60658);let et=e=>{var t;return"".concat(null!==(t=e.recordingId)&&void 0!==t?t:"slide-"+"".concat(e.index).padStart(3,"0"))};function en(e){let{api:t,start:n}=(0,h.useContext)(H.E),{session:i}=(0,h.useContext)(M.z),a=(0,h.useContext)(A.rZ),r=(0,h.useContext)(Y.X),[o,s]=(0,h.useState)(et(r.data)),[l,d]=(0,h.useState)(!1),[u,x]=(0,h.useState)(!1),[v,j]=(0,h.useState)(!1),{record:b,stop:y,isRecording:w,recordingTime:Z,audioBlob:C,filenamePart:S,filenameSuffix:k,clearRecording:I}=function(){let[e,t]=(0,h.useState)(0),[n,i]=(0,h.useState)(void 0),[a,r]=(0,h.useState)(),{startRecording:o,stopRecording:s,togglePauseResume:l,recordingBlob:c,isRecording:d,isPaused:u,recordingTime:x,mediaRecorder:p}=(0,X.I)({noiseSuppression:!0,autoGainControl:!0},e=>{t(1)},{mimeType:"audio/webm"}),f=e=>"audio-recording-".concat(e);return(0,h.useEffect)(()=>{t(d?2:0)},[d]),(0,h.useEffect)(()=>{void 0!==c&&i(c)},[c]),{record:e=>{r(f(e)),o()},stop:()=>{s()},state:e,audioBlob:n,recordingTime:x,isRecording:d,filenamePart:a,filenameSuffix:"webm",clearRecording:()=>{i(void 0),r(void 0)}}}();(0,h.useEffect)(()=>{w&&(console.debug("Stopping recording due to slide change."),y());let e=et(r.data);console.debug("New slide id: ".concat(e)),s(e)},[r.data.index]),(0,h.useEffect)(()=>{d(w),w&&j(!1)},[w]),(0,h.useEffect)(()=>{w||void 0===C||void 0===S||T()},[C]);let T=()=>{if(void 0===C||void 0===S){console.debug("Audio blob or filename part empty. Skipping upload.");return}if(0===C.size){console.debug("Audio recording is empty. Skipping upload.");return}console.debug("Initiating upload for recording: <guid>-".concat(S,"-<guid>.").concat(k)),j(!1),x(!0),E(C,S,k).then(()=>{console.debug("Upload complete"),j(!1),I()}).catch(e=>{console.error("Upload failed",e),j(!0)}).finally(()=>{x(!1)})},E=async(e,r,o)=>{console.debug("Retrieving recording upload info...");let s=await n(t.getMediaUploadUrl(i.id,a.sessionToken,a.user.access_token,"deliberation",r,o));console.debug("Uploading recording...",s),await n((0,ee.P)(e,s.uploadUrl,!0,"uploading recording")),console.debug("Upload recording complete.")},D=()=>{if(void 0===C||0===C.size){console.debug("Audio blob empty. Skipping download.");return}let e="recording-".concat(null!=S?S:"unknown",".").concat(k);console.debug("Downloading audio recording..."),function(e,t){let n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=t;try{document.body.appendChild(i),i.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}catch(e){console.error("Error downloading blob",e)}finally{document.body.removeChild(i)}}(C,e)},_=(0,m.Z)();return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(q,{startIcon:(0,c.jsx)($.Z,{htmlColor:l?_.palette.recordingEnabled.main:u?_.palette.recordingUploading.main:v?_.palette.recordingFailed.main:_.palette.recordingDisabled.main}),endIcon:(0,c.jsx)(G.Z,{color:"action"}),sx:{opacity:e.enableHint?1:.3},text:"Recording: ".concat(l?"Active":u?"Uploading...":v?"Upload error":"Inactive"),ariaLabel:"Recording information",children:(0,c.jsxs)(p.Z,{sx:{p:1,display:"flex",flexDirection:"column",gap:1},children:[!w&&(0,c.jsx)(g.Z,{variant:e.enableHint?"contained":"outlined",color:e.enableHint?"primary":"buttonStandard",onClick:()=>b(o),children:"Start Recording"}),w&&(0,c.jsx)(g.Z,{variant:"outlined",color:"buttonStandard",onClick:()=>y(),children:"Stop Recording"}),(0,c.jsxs)(f.Z,{variant:"body2",children:["Slide activity: ",Q.S[r.data.activity]]}),r.data.recordingId&&(0,c.jsxs)(f.Z,{variant:"body2",children:["Deliberation id: ",o,(0,c.jsx)("br",{})]}),w&&(0,c.jsxs)(f.Z,{variant:"body2",sx:{fontSize:"0.5rem"},children:["Recording: ",Z]}),v&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"row",gap:1,alignItems:"center"},children:[(0,c.jsx)($.Z,{htmlColor:_.palette.recordingFailed.main}),(0,c.jsx)(f.Z,{variant:"body1",children:"Recording upload failed"})]}),(0,c.jsx)(f.Z,{variant:"body2",children:"The recording could not be uploaded."}),C&&S&&k&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(g.Z,{variant:"outlined",color:"buttonStandard",onClick:()=>T(),children:"Retry upload"}),(0,c.jsx)(g.Z,{variant:"outlined",color:"buttonStandard",onClick:()=>D(),children:"Download audio"})]})]})]})})})}function ei(e){let{api:t,start:n}=(0,h.useContext)(H.E),{session:i}=(0,h.useContext)(M.z),a=(0,h.useContext)(A.rZ),r=(0,h.useContext)(Y.X),o=(0,m.Z)(),[s,l]=(0,h.useState)(i.facilitationState===u._y.Open),[d,x]=(0,h.useState)(!1),[g,y]=(0,h.useState)(!1),[w,Z]=(0,h.useState)(!1),[C,S]=(0,h.useState)(!1);(0,h.useEffect)(()=>{l(i.facilitationState===u._y.Open)},[i.facilitationState]),(0,h.useEffect)(()=>{Z(i.facilitationState===u._y.Open&&i.remoteConfiguration===u.VS.InPerson&&r.data.activity===Q.S.deliberation),S(i.facilitationState===u._y.Open&&i.remoteConfiguration===u.VS.InPerson&&(r.data.activity===Q.S.deliberation||void 0!==r.data.recordingId))},[r.data.activity,i.facilitationState,i.remoteConfiguration]);let k=async e=>{try{y(!0),await n((0,F.v5)(t,a.user.access_token,a.sessionToken,i.id,e))}catch(e){console.error(e)}finally{y(!1)}},I=async e=>{try{switch(x(!0),e){case u._y.Ready:await n((0,F.T2)(t,a.user.access_token,a.sessionToken,i.id,"reset"));break;case u._y.Open:await n((0,F.T2)(t,a.user.access_token,a.sessionToken,i.id,"open"));break;case u._y.Closed:await n((0,F.T2)(t,a.user.access_token,a.sessionToken,i.id,"close"));break;default:console.warn("Unexpected facilitation switch from menu.")}}catch(e){console.error(e)}finally{x(!1)}};return(0,c.jsx)(j.Z,{position:"static",elevation:0,children:(0,c.jsx)(b.Z,{sx:{bgcolor:o.palette.headerBarBackground.main,color:"black"},children:(0,c.jsxs)(p.Z,{display:"flex",flexDirection:"row",justifyContent:"space-between",style:{width:"100%"},children:[(0,c.jsxs)(p.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",children:[(0,c.jsx)("img",{src:"/icons/home.svg",style:{height:26,verticalAlign:"middle",marginRight:12,paddingBottom:4}}),(0,c.jsx)(v.Z,{color:"primary",badgeContent:u._y[i.facilitationState],anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,c.jsx)(f.Z,{variant:"h5",children:i.sessionName})})]}),s&&(0,c.jsx)(p.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",children:(0,c.jsx)(_,{startTime:function(e){if(e)return new Date(e)}(i.sessionStartedAt),duration_mins:i.sessionDurationMins})}),(0,c.jsx)(p.Z,{display:"flex",flexDirection:"row",children:(0,c.jsx)(en,{enableHint:w,autoRecord:C})}),(0,c.jsxs)(p.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",children:[(0,c.jsx)(J,{}),(0,c.jsx)(D,{state:i.facilitationState,fullscreen:i.fullScreen,onFacilitationStateChange:I,onFullScreenChange:k,stateBusy:d,fullscreenBusy:g})]})]})})})}var ea=n(93191);function er(e){let{notes:t}=e;return(0,c.jsx)("span",{dangerouslySetInnerHTML:{__html:t}})}var eo=n(79617),es=n(51847),el=n(33578),ec=n(35231),ed=n(50467),eu=n(2842),ex=n(9542),eh=n(13971);function ep(e){let{colours:t,data:n}=e,i=e=>{let t={true:{l:!0,r:!1},false:{l:!1,r:!0}};return 0===e.true&&(t.false.l=!0),0===e.false&&(t.true.r=!0),t},[a,r]=(0,h.useState)(i(n));(0,h.useEffect)(()=>{r(i(n))},[n]);let o=e=>[e.l?16:0,e.r?16:0,e.r?16:0,e.l?16:0];return(0,c.jsx)(ec.h,{width:"100%",height:40,children:(0,c.jsxs)(ed.v,{layout:"vertical",margin:{left:0,right:0},height:40,data:[{name:"completion",complete:n.true,incomplete:n.false}],children:[(0,c.jsx)(eu.K,{hide:!0,type:"number",max:n.true+n.false}),(0,c.jsx)(ex.B,{hide:!0,dataKey:"name",type:"category"}),(0,c.jsx)(eh.$,{dataKey:"complete",stackId:"completion",fill:t[0],radius:o(a.true)}),(0,c.jsx)(eh.$,{dataKey:"incomplete",stackId:"completion",fill:t[1],radius:o(a.false)})]})})}var ef=n(37552),eg=n(8260);(a=s||(s={}))[a.NotAnswered=0]="NotAnswered",a[a.Answered=1]="Answered";let em=(e,t)=>{var n;let i=null!==(n=ev(e))&&void 0!==n?n:[],a=i.length,r=t.filter(e=>e.enabled&&e.role===u._b.Client),o=r.filter(e=>!i.find(t=>t.participantId===e.deviceId));return{allAnswers:i,relevantParticipants:r,answeredCount:a,participantsWithoutAnswers:o,maxAnswers:i.length+o.length}},ev=e=>null==e?void 0:e.sort((e,t)=>new Date(e.created).getTime()-new Date(t.created).getTime()),ej=(e,t)=>{var n;return[...e.allAnswers.map((e,n)=>({description:eb(e,t),answered:1})),...null!==(n=e.participantsWithoutAnswers.map(e=>({description:ey(e),answered:0})))&&void 0!==n?n:[]]},eb=(e,t)=>ey(t.find(t=>t.deviceId===e.participantId)),ey=e=>{var t,n;return null!==(n=null!==(t=null==e?void 0:e.participantName)&&void 0!==t?t:null==e?void 0:e.deviceName)&&void 0!==n?n:"Unknown"};function ew(e){let{answers:t}=(0,eg.ZP)(e.qid),n=(0,h.useContext)(P.l),[i,a]=(0,h.useState)(n.subscriptions),[r,o]=(0,h.useState)(em(t,i)),[s,l]=(0,h.useState)([]);(0,h.useEffect)(()=>{a(n.subscriptions)},[n]),(0,h.useEffect)(()=>{o(em(t,i))},[t,i]),(0,h.useEffect)(()=>{l(ej(r,i))},[r,i]);let d=e=>(0,c.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderRadius:2,background:"white",border:"1px solid #EFEFEF",p:2},children:[(0,c.jsx)(f.Z,{variant:"body1",sx:{borderRight:"1px solid black",overflowX:"scroll",textWrap:"nowrap",flexGrow:1,mr:.5,pr:.5},children:e.description}),1===e.answered&&(0,c.jsx)("img",{src:"/icons/checkbox-filled.svg"}),1!==e.answered&&(0,c.jsx)("img",{src:"/icons/checkbox.svg"})]}),u=(0,U.Z)();return(0,c.jsx)("div",{children:e.qid&&(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(eo.Z,{sx:{background:"transparent"},elevation:0,children:[(0,c.jsx)(es.Z,{expandIcon:(0,c.jsx)(ef.Z,{}),sx:{p:0},children:(0,c.jsx)(ep,{colours:[u.palette.primary.main,"#ededff"],data:{true:r.answeredCount,false:r.participantsWithoutAnswers.length}})}),(0,c.jsxs)(el.Z,{sx:{p:0},children:[(0,c.jsxs)(f.Z,{variant:"body1",sx:{ml:1,mb:1},children:[(0,c.jsx)("img",{src:"/icons/busts.svg",style:{height:26,verticalAlign:"middle",marginRight:12,paddingBottom:4}}),"".concat(r.answeredCount," of ").concat(r.maxAnswers," ")," ",1!==r.answeredCount?"have":"has"," voted"]}),(0,c.jsx)(R.ZP,{container:!0,spacing:2,children:s.map((t,n)=>(0,c.jsx)(R.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,c.jsx)(d,{description:t.description,answered:t.answered})},"answer-indicator-grid-item-".concat(e.qid,"-").concat(n)))})]})]})})})}var eZ=n(11707);function eC(e){let{orientation:t,showLabels:n}=e,{muted:i,toggleMute:a}=(0,O.HI)(),{tileId:r,isVideoEnabled:o,hasReachedVideoLimit:s,toggleVideo:l}=(0,O.Onx)(),d=(0,O.fjl)();i?(0,c.jsx)(O.PjE,{muted:!0}):(0,c.jsx)(O.PjE,{}),()=>a();let u={icon:o?(0,c.jsx)(O.V1s,{}):(0,c.jsx)(O.V1s,{disabled:!0}),onClick:()=>l(),label:"Camera"};return O.LPZ,(0,c.jsx)(eZ.f6,{theme:O.Wbj,children:(0,c.jsxs)(O.VSr,{showLabels:n,layout:"horizontal"===t?"undocked-horizontal":"undocked-vertical",style:{boxShadow:"none"},children:[(0,c.jsx)(O._nn,{}),(0,c.jsx)(O.B8T,{...u})]})})}var eS=n(8963),ek=n(40468);n(84075);var eI=e=>{let{tiles:t}=(0,O.akC)(),{tileId:n}=(0,O.tt7)(),{tileId:i}=(0,O.EJc)(),{isVideoEnabled:a}=(0,O.Onx)(),r="featured"===e.layout&&!!n||!!i,o=t.length+(i?1:0),s=o>1&&a?o+1:o;return(0,c.jsxs)(O.P2B,{size:s,layout:r?"featured":null,style:e.gridStyle,children:[(0,c.jsx)(O.Fxf,{css:"grid-area: ft;"}),"featured"===e.layout?(0,c.jsx)(O.mXs,{}):(0,c.jsx)(O.P$F,{}),(0,c.jsx)(O.OuP,{nameplate:"Me",css:s>1?"\n  height: 100%;\n  width: 100%;\n":"\n  display: flex;\n  position: absolute;\n  bottom: 1rem;\n  right: 1rem;\n  width: 20vw;\n  max-height: 30vh;\n  height: auto;\n\n  video {\n    position: static;\n  }\n"}),0===o&&e.noRemoteVideoView]})};(r=l||(l={}))[r.Init=0]="Init",r[r.FetchingAttendeeData=1]="FetchingAttendeeData",r[r.AttendeeDataRetrieved=2]="AttendeeDataRetrieved",r[r.AttendeeDataError=3]="AttendeeDataError",r[r.MeetingConnecting=4]="MeetingConnecting",r[r.MeetingConnected=5]="MeetingConnected",r[r.MeetingStarting=6]="MeetingStarting",r[r.MeetingStarted=7]="MeetingStarted",r[r.MeetingLeft=8]="MeetingLeft",r[r.MeetingUnavailable=9]="MeetingUnavailable",r[r.ChimeError=10]="ChimeError",r[r.ConnectedOnAnotherDevice=11]="ConnectedOnAnotherDevice";let eT={unexpected:!1,anotherDevice:!1,unavailable:!1,left:!1},eE={deviceLabels:O.C$T.AudioAndVideo};function eD(e){let[t,n]=(0,h.useState)(0),[i,a]=(0,h.useState)(),[r,o]=(0,h.useState)(),[s,d]=(0,h.useState)(),[x,f]=(0,h.useState)(eT),m=(0,O.fjl)(),{isVideoEnabled:v,toggleVideo:j}=(0,O.Onx)(),b=(0,O.HI)(),{api:y,start:w}=(0,h.useContext)(H.E),Z=(0,h.useContext)(P.l),[C,S]=(0,h.useState)(Z.subscriptions);(0,h.useEffect)(()=>{S(Z.subscriptions)},[Z]),(0,h.useEffect)(()=>{var t,n;console.debug("initial call prefrerences",e.initialCallPreferences),(null===(t=e.initialCallPreferences)||void 0===t?void 0:t.videoDevice)!==void 0&&m.startVideoInputDevice(e.initialCallPreferences.videoDevice.deviceId),(null===(n=e.initialCallPreferences)||void 0===n?void 0:n.audioDevice)!==void 0&&m.startAudioInputDevice(e.initialCallPreferences.audioDevice.deviceId)},[]);let k=(0,h.useMemo)(()=>async(e,t)=>{void 0===t&&console.warn("Undefined pid passed from chime.");var n,i=C.find(e=>e.deviceId===t);return void 0===i&&console.warn("No subscription found for pid: ".concat(t),C),{name:null!==(n=null==i?void 0:i.participantName)&&void 0!==n?n:"Unknown"}},[C]);(0,h.useEffect)(()=>{m.getAttendee=k,m.updateDeviceLists()},[C]),(0,h.useEffect)(()=>(m.subscribeToMeetingStatus(I),()=>{console.log("Unmounting ZeitgeistMeeting..."),m.getAttendee=void 0,m.leave(),m.unsubscribeFromMeetingStatus(I)}),[]);let I=e=>{console.debug("Meeting status change detected: ".concat(O.ytK[e])),d(e)},T=e.role===u._b.Controller||e.facilitationState===u._y.Open;(0,h.useEffect)(()=>{console.debug("Facilitation state changed to: ".concat(u._y[e.facilitationState])),T&&0!==t&&1!==t&&n(1),T||(console.debug("disconnecting..."),o(null))},[e.facilitationState]),(0,h.useEffect)(()=>{switch(console.debug("ZeitgeistMeeting view state: ".concat(l[t])),t){case 0:T&&n(1);break;case 1:f(eT),E().then(e=>{(null==e?void 0:e.chimeMeetingId)!==(null==i?void 0:i.chimeMeetingId)&&a(e),e?n(2):n(3)}).catch(e=>{console.error(e)});break;case 2:f(eT),n(4);break;case 3:case 10:f({...eT,unexpected:!0});break;case 4:f(eT);let c=D();(null==r?void 0:r.meetingId)!==c.meetingId||s!==O.ytK.Succeeded?o(c):n(5);break;case 5:f(eT),n(6);break;case 6:f(eT),_();break;case 7:f(eT);break;case 9:e.role===u._b.Controller?(f(eT),n(1)):f({...eT,unavailable:!0});break;case 8:f({...eT,left:!0});break;case 11:f({...eT,anotherDevice:!0})}},[t,e.facilitationState]);let E=async()=>{var t;let n=await w(y.postMeetingJoinRequest(e.sid,e.sessionToken,e.participantId,null!==(t=e.participantName)&&void 0!==t?t:"unknown",e.accessToken));return console.debug("Retrieved attendee data",n),n},D=()=>new eS.MeetingSessionConfiguration({MeetingId:i.chimeMeetingId,MediaPlacement:{AudioHostUrl:i.audioHostUrl,SignalingUrl:i.signalingUrl,TurnControlUrl:i.turnControlUrl,AudioFallbackUrl:i.audioFallbackUrl,EventIngestionUrl:i.eventIngestionUrl,ScreenDataUrl:i.screenDataUrl,ScreenViewingUrl:i.screenViewingUrl}},{ExternalUserId:i.chimeAttendeeExternalId,AttendeeId:i.chimeAttendeeId,JoinToken:i.chimeJoinToken});(0,h.useEffect)(()=>{console.debug("Config change"),null!=r?m.join(r,eE).then(()=>{n(5)}):m.leave()},[r]),(0,h.useEffect)(()=>{switch(console.debug("Acting on meeting status: ".concat(void 0!==s?O.ytK[s]:"undefined")),s){case O.ytK.Loading:break;case O.ytK.Succeeded:n(7);break;case O.ytK.Reconnecting:n(4);break;case O.ytK.Left:n(8);break;case O.ytK.Failed:n(10);break;case O.ytK.Ended:n(9);break;case O.ytK.TerminalFailure:n(10);break;case O.ytK.JoinedFromAnotherDevice:n(11)}},[s]);let _=async()=>{console.debug("Starting the meeting from state: ".concat(void 0!==s?O.ytK[s]:"undefined"));try{await m.start(),n(7)}catch(e){console.error(e),n(10)}};return(0,h.useEffect)(()=>{s!==O.ytK.Succeeded||(console.debug("Configuring meeting with initial prefererences",e.initialCallPreferences),e.initialCallPreferences?(e.initialCallPreferences.videoEnabled!==v&&j(),e.initialCallPreferences.audioEnabled===b.muted&&b.toggleMute()):v||j())},[s]),e.role,u._b.Controller,e.role,u._b.Client,(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"column",...e.sx},children:[x.unexpected&&(0,c.jsx)("p",{children:"An unexpected error prevented us from connecting you to the video call. Please refresh the page."}),x.anotherDevice&&(0,c.jsx)("p",{children:"You are already connected in another tab. Please close any other browser tabs connected to this workshop."}),x.unavailable&&(0,c.jsx)("p",{children:"The video call is not available at this time. Please try again later."}),x.left&&(0,c.jsx)("p",{children:"You have left the video call."}),11===t&&(0,c.jsx)(g.Z,{variant:"outlined",onClick:()=>n(1),children:"Try again"}),3===t&&(0,c.jsx)(g.Z,{variant:"outlined",onClick:()=>n(1),children:"Try again"}),9===t&&(0,c.jsx)(g.Z,{variant:"outlined",onClick:()=>n(1),children:"Try again"}),8===t&&(0,c.jsx)(g.Z,{variant:"outlined",onClick:()=>n(1),children:"Rejoin"}),10===t&&(0,c.jsx)(g.Z,{variant:"outlined",onClick:()=>n(4),children:"Try again"}),0>[7,8,9,10,11].indexOf(t)&&(0,c.jsx)(p.Z,{display:"flex",flexGrow:1,justifyContent:"center",alignItems:"center",children:(0,c.jsx)(ek.Z,{})}),s===O.ytK.Succeeded&&(0,c.jsx)(eZ.f6,{theme:O.Wbj,children:(0,c.jsx)(p.Z,{sx:{width:"100%",height:"100%",flexGrow:1,display:"flex",flexDirection:"row"},children:(0,c.jsx)(eI,{layout:"standard",noRemoteVideoView:(0,c.jsx)(c.Fragment,{}),gridStyle:{gap:"0.5rem"}})})})]})})}var e_=n(68276),eF=n(97340),eA=n(28801);let eR=e=>{void 0!==window&&void 0!==window.localStorage&&window.localStorage.setItem("SlideTimers",JSON.stringify(e))},eU=()=>{if(void 0===window||void 0===window.localStorage)return{};{let e=window.localStorage.getItem("SlideTimers");return null!==e?JSON.parse(e):{}}},eP=e=>{let t=e%60;return"".concat(Math.floor(e/60)," mins, ").concat(t<10?"0":"").concat(t," secs")};function eM(e){let{session:t}=(0,h.useContext)(M.z),n=(0,h.useContext)(Y.X),[i,a]=(0,h.useState)(),[r,o]=(0,h.useState)(),s=(0,h.useRef)();(0,h.useEffect)(()=>{a(eU())},[]),(0,h.useEffect)(()=>{void 0!==i&&eR(i)},[i]),(0,h.useEffect)(()=>{if(n.data&&n.data.secs){if(i){if(void 0===i[n.data.index]){console.debug("timer not found");let e={running:t.facilitationState===u._y.Open,startTime:n.data.secs,currentTime:n.data.secs,index:n.data.index};a({...i,[n.data.index]:e}),o(e)}else(void 0===r||r.index!==n.data.index)&&o(i[n.data.index])}}else o(void 0)},[n.data,i]),(0,h.useEffect)(()=>{void 0!==r&&(void 0!==s.current&&clearTimeout(s.current),s.current=setTimeout(l,1e3))},[r]);let l=(0,h.useCallback)(()=>{if(void 0!==s.current&&(clearTimeout(s.current),s.current=void 0),void 0!==r&&r.running&&r.currentTime>0){let e={...r,currentTime:r.currentTime-1};o(e),a({...i,[n.data.index]:e}),s.current=setTimeout(l,1e3)}},[r]);(0,h.useEffect)(()=>{t.facilitationState===u._y.Open?void 0===r||r.running||d():void 0!==r&&r.running&&x()},[t.facilitationState]);let d=()=>{if(void 0!==r){let e={...r,running:!0};o(e),a({...i,[n.data.index]:e}),void 0!==s.current&&clearTimeout(s.current),s.current=setTimeout(l,1e3)}},x=()=>{if(void 0!==r){let e={...r,running:!1};o(e),a({...i,[n.data.index]:e})}},m=()=>{if(void 0!==r){let e={...r,running:!1,currentTime:r.startTime};o(e),a({...i,[n.data.index]:e})}},v=e=>{if(void 0!==r){let t={...r,currentTime:r.currentTime+e};o(t),a({...i,[n.data.index]:t})}},j=r&&!r.running&&r.currentTime>0,b=r&&r.running&&r.currentTime>0;return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(p.Z,{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",children:[(0,c.jsxs)(p.Z,{display:"flex",flexDirection:"row",justifyContent:"start",alignItems:"center",children:[(0,c.jsx)("img",{src:"/icons/session-time.svg"}),void 0!==r&&(0,c.jsx)(f.Z,{variant:"h6",sx:{ml:1},children:eP(r.currentTime)})]}),(0,c.jsxs)(p.Z,{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"center",gap:1,children:[(0,c.jsx)(g.Z,{variant:"outlined",color:"buttonStandard",disabled:!j,onClick:()=>{d()},children:"Start"}),(0,c.jsx)(g.Z,{variant:"outlined",color:"buttonStandard",disabled:!b,onClick:()=>{x()},children:"Pause"}),(0,c.jsx)(g.Z,{variant:"outlined",color:"buttonStandard",onClick:()=>{v(60)},children:"+1 min"}),(0,c.jsx)(g.Z,{variant:"outlined",color:"buttonStandard",onClick:()=>{m()},children:"Reset"})]})]})})}var eO=n(69065),eN=n(80824),eK=n(66124),eV=n(7630);function ez(e){let{session:t}=(0,h.useContext)(M.z),[n,i]=(0,h.useState)(!1),[a,r]=(0,h.useState)(!1),[o,s]=(0,h.useState)(!1);return(0,h.useEffect)(()=>{r(t.facilitationState===u._y.Open)},[t.facilitationState]),(0,h.useEffect)(()=>{s(t.remoteConfiguration===u.VS.InPerson)},[t.remoteConfiguration]),(0,h.useEffect)(()=>{i(a&&o)},[a,o]),(0,c.jsxs)(eO.Z,{fullWidth:!0,maxWidth:"sm",open:n,onClose:()=>i(!1),children:[(0,c.jsxs)(eN.Z,{children:["The workshop is now open",(0,c.jsx)(p.Z,{style:{position:"absolute",top:0,right:0},children:(0,c.jsx)(k.Z,{"aria-label":"close",onClick:()=>i(!1),children:(0,c.jsx)(eV.Z,{})})})]}),(0,c.jsx)(eK.Z,{children:(0,c.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,c.jsxs)("ul",{children:[a&&(0,c.jsx)("li",{children:"Participants will now be able to enter the session"}),o&&(0,c.jsxs)("li",{children:["A test of the audio recording capability is available, but relevant sections will ",(0,c.jsx)("u",{children:"not"})," be automatically recorded"]})]}),(0,c.jsx)(g.Z,{variant:"contained",sx:{alignSelf:"center",textTransform:"uppercase"},onClick:()=>i(!1),children:"Continue"})]})})]})}var eH=n(53771);function eL(){var e,t,n;let{api:i,start:a}=(0,h.useContext)(H.E),{session:r}=(0,h.useContext)(M.z),o=(0,h.useContext)(A.rZ);(0,h.useContext)(d.p);let s=(0,h.useContext)(Y.X),l=(0,h.useContext)(ea.N),x=(0,h.useContext)(P.l),m=(0,h.useContext)(e_.u),[v,j]=(0,h.useState)(void 0),[b,y]=(0,h.useState)(!1),w=async e=>{try{y(!0);let t=(0,F.T2)(i,o.user.access_token,o.sessionToken,r.id,e);await a(t)}catch(e){console.error(e)}finally{y(!1)}};(0,h.useEffect)(()=>{r.facilitationState===u._y.Ready?j((0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,c.jsx)("img",{src:"/icons/session-participants.svg"}),(0,c.jsxs)(f.Z,{variant:"body1",sx:{ml:1},children:[x.subscriptions.filter(e=>e.deviceId!==o.deviceId).length," waiting"]})]}),(0,c.jsx)(g.Z,{variant:"contained",color:"primary",onClick:()=>w("open"),disabled:b,children:"Open workshop"})]})):r.facilitationState===u._y.Open?j((0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,c.jsx)("img",{src:"/icons/session-participants.svg"}),(0,c.jsxs)(f.Z,{variant:"body1",sx:{ml:1},children:[x.subscriptions.filter(e=>e.deviceId!==o.deviceId).length," participants"]})]}),(0,c.jsx)(g.Z,{variant:"outlined",color:"buttonStandard",onClick:()=>w("close"),disabled:b,children:"Close workshop"})]})):r.facilitationState===u._y.Closed&&j((0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,c.jsx)("img",{src:"/icons/session-participants.svg"}),(0,c.jsx)(f.Z,{variant:"body1",sx:{ml:1},children:"closed"})]}),(0,c.jsx)(g.Z,{variant:"outlined",color:"primary",onClick:()=>w("reset"),disabled:b,children:"Open waiting room"})]}))},[r.facilitationState,x,b]);let Z=r.remoteConfiguration===u.VS.RemoteWithVideoCall;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"flex-start",gap:1,p:1,width:"100vw",height:"100vh",maxWidth:"100vw",maxHeight:"100vh",overflowX:"hidden",overflowY:"hidden"},children:[(0,c.jsx)(ez,{}),(0,c.jsx)(ei,{}),(0,c.jsxs)(p.Z,{sx:{flexGrow:1,flexBasis:"100%",maxHeight:"100%",overflowY:"hidden",display:"flex",flexDirection:"row",gap:1},children:[(0,c.jsx)(p.Z,{sx:{width:"50%",height:"100%",maxHeight:"100%",display:"flex",flexDirection:"column"},children:(0,c.jsx)(eF.Z,{title:"Participant view",tools:v,sx:{flexGrow:1},children:l.presentation})}),(0,c.jsx)(p.Z,{sx:{width:"50%",display:"block",overflow:"hidden"},children:(0,c.jsxs)(p.Z,{sx:{maxHeight:"100%",height:"100%",width:"100%",maxWidth:"100%",display:"flex",flexDirection:"column",gap:1},children:[Z&&(0,c.jsx)(eF.Z,{sx:{minHeight:"40vh",flexGrow:1},children:(0,c.jsxs)(p.Z,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"row"},children:[(0,c.jsx)(eC,{orientation:"vertical",showLabels:!1}),(0,c.jsx)(eD,{role:o.role,facilitationState:r.facilitationState,sid:r.id,sessionToken:o.sessionToken,accessToken:o.user.access_token,participantId:o.deviceId,participantName:null===(e=x.thisUser)||void 0===e?void 0:e.participantName,initialCallPreferences:m.call,sx:{flexGrow:1}})]})}),(null==s?void 0:null===(t=s.data.qids)||void 0===t?void 0:t.length)>0&&(0,c.jsx)(eF.Z,{title:"Votes",scrolling:!1,children:(0,c.jsx)(p.Z,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:null===(n=s.data.qids)||void 0===n?void 0:n.map(e=>(0,c.jsx)(p.Z,{sx:{width:s.data.qids.length>1?"50%":"100%"},children:(0,c.jsx)(ew,{sid:r.id,qid:e})},"slide-".concat(s.data.index,"-answer-monitor-").concat(e)))})}),(null==s?void 0:s.data.secs)!==void 0&&s.data.secs>0&&(0,c.jsx)(eF.Z,{scrolling:!1,children:(0,c.jsx)(eM,{data:s.data})}),(0,c.jsx)(eF.Z,{title:"Notes",scrolling:!0,sx:{flexGrow:Z?void 0:1,minHeight:"25vh"},children:(0,c.jsx)(er,{notes:s.data.notes})})]})})]})]}),(0,c.jsx)(p.Z,{sx:{position:"fixed",left:4,bottom:4},children:(0,c.jsx)(eA.Z,{})}),(0,c.jsx)(p.Z,{sx:{position:"fixed",right:4,bottom:4},children:(0,c.jsx)(eH.Z,{})})]})}var eW=n(98641);function eB(e){return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(eW.Z,{sid:e.sid,joinCode:e.joinCode,refresh:e.refresh,role:u._b.Controller,children:[(0,c.jsx)(x.Z,{}),(0,c.jsx)(eL,{})]})})}var eG=n(16463);function eq(){let e=(0,eG.useSearchParams)(),t=e.get("sid"),n=e.get("code"),i="true"===e.get("refresh");return null===t||null===n?(0,c.jsx)("p",{children:"Missing session id or join code"}):(0,c.jsx)(d.Z,{searchParams:e,children:(0,c.jsx)(eB,{sid:t,joinCode:n,refresh:i})})}},10105:function(e,t,n){"use strict";n.d(t,{k:function(){return a},v:function(){return i}});let i=e=>"".concat(window.location.href.split("/")[0],"//").concat(window.location.href.split("/")[2],"/participant/session?sid=").concat(e.id,"&code=").concat(e.joinCode),a=e=>"".concat(window.location.href.split("/")[0],"//").concat(window.location.href.split("/")[2],"/facilitator/session?sid=").concat(e.id,"&code=").concat(e.joinCode)},84075:function(){}},function(e){e.O(0,[49,908,444,866,221,732,887,403,328,602,810,375,553,69,26,418,973,463,971,23,744],function(){return e(e.s=59870)}),_N_E=e.O()}]);