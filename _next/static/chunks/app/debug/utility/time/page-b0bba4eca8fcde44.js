(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8421],{50003:function(e,t,r){Promise.resolve().then(r.bind(r,81436))},81436:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var n=r(57437),s=r(67506),o=r(23447),i=r(48801),a=r(2265);function c(){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(i.Z,{children:(0,n.jsx)(o.Z,{children:(0,n.jsx)(s.Z,{mode:"zg-server-time",loading:(0,n.jsx)("p",{children:"Synchronising..."}),error:(0,n.jsx)("p",{children:"Synchronisation error"}),children:(0,n.jsx)(()=>{var e=(0,a.useContext)(s.G);let[t,r]=(0,a.useState)(0);return(0,a.useEffect)(()=>{let t=()=>{r(e.toServerTime(Date.now()))},n=setInterval(()=>t(),0);return()=>{clearInterval(n)}},[e]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h1",{children:new Date(t).toISOString()}),(0,n.jsxs)("p",{children:["offset: ",e.offset]}),(0,n.jsxs)("p",{children:["rtt: ",e.rtt]}),(0,n.jsxs)("p",{children:["source: ",(0,n.jsx)("code",{children:JSON.stringify(e.source)})]}),(0,n.jsx)("p",{children:(0,n.jsx)("span",{style:{fontSize:256},children:new Date(t).getSeconds()})})]})},{})})})})})}},67506:function(e,t,r){"use strict";r.d(t,{G:function(){return u},Z:function(){return d}});var n,s,o=r(57437),i=r(80237),a=r(2265),c=r(83593),l=r(23447);let u=(0,a.createContext)({});function d(e){var t;let{api:r,start:n}=(0,a.useContext)(l.E),[d,f]=(0,a.useState)(0),[S,m]=(0,a.useState)(),[h,_]=(0,a.useState)(null!==(t=e.checks)&&void 0!==t?t:3);(0,a.useEffect)(()=>{switch(console.debug("ZgServerTimeProvider state",s[d]),d){case 0:c.Z.emit({type:c.M.Content_Progress_Update,data:{overall:{completed:0,total:h},bars:{}}}),f(1);break;case 1:v().then(e=>{m(e),f(3)}).catch(e=>{console.error(e),f(2)})}},[d]);let v=async()=>{switch(e.mode){case"server-date-lib":return g();case"zg-server-time":return p();default:throw Error("Unsupported time sync mode")}},p=async()=>{let e;console.debug("zg-server-time warmup",await n(r.getServerTime()));let t=Number.MAX_SAFE_INTEGER,s=0;for(let o=0;o<h;o++){let i=Date.now(),a=await n(r.getServerTime()),l=Date.now();console.debug("zg-server-time response",a);let u=l-i,d=(i+l)/2,f=a.timestamp-d;u<t&&(t=u,s=f,e=a),c.Z.emit({type:c.M.Content_Progress_Update,data:{overall:{completed:o+1,total:h},bars:{}}}),await new Promise(e=>setTimeout(e,1e3))}let o={offset:s,rtt:t,source:e,toServerTime:e=>Math.round(e+s),fromServerTime:e=>Math.round(e-s)};return console.debug("zg-server-time result",o),o},g=async()=>{let e;console.warn("ServerDateLib is only accurate to the second.");for(let t=0;t<h;t++){await new Promise(e=>setTimeout(e,1e3));let r=await (0,i.a)();(void 0===e||Math.abs(r.uncertainty)<Math.abs(e.uncertainty))&&(e=r),c.Z.emit({type:c.M.Content_Progress_Update,data:{overall:{completed:t+1,total:h},bars:{}}})}let t={offset:e.offset,source:e,rtt:e.uncertainty,toServerTime:t=>t+e.offset,fromServerTime:t=>t-e.offset};return console.debug("server-date result",e),t};return(0,o.jsxs)(o.Fragment,{children:[(0===d||1===d)&&e.loading,2===d&&e.error,3===d&&(0,o.jsx)(u.Provider,{value:S,children:e.children})]})}(n=s||(s={}))[n.Init=0]="Init",n[n.Synchronising=1]="Synchronising",n[n.Error=2]="Error",n[n.Complete=3]="Complete"},83593:function(e,t,r){"use strict";r.d(t,{M:function(){return s}});var n,s,o=r(37836),i=r.n(o);(n=s||(s={})).Request_SlideRefresh="REQUEST_SLIDE_REFRESH",n.WSS_Update_ConnectionState="WSS_UPDATE_CONNECTION_STATE",n.WSS_Distribute_Message="WSS_DISTRIBUTE_MESSAGE",n.Content_Progress_Update="CONTENT_PROGRESS_UPDATE",n.Media_Playback_Update="MEDIA_PLAYBACK_UPDATE";let a=new(i()),c={on:(e,t)=>a.on(e,t),once:(e,t)=>a.once(e,t),off:(e,t)=>a.off(e,t),emit:e=>a.emit(e.type,e)};Object.freeze(c),t.Z=c}},function(e){e.O(0,[3732,3887,3231,3447,2971,7023,1744],function(){return e(e.s=50003)}),_N_E=e.O()}]);