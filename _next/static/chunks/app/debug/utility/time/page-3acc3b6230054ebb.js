(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8421],{50003:function(e,t,r){Promise.resolve().then(r.bind(r,81436))},81436:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var n=r(57437),s=r(67506),o=r(23447),a=r(48801),i=r(2265);function c(){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(a.Z,{children:(0,n.jsx)(o.Z,{children:(0,n.jsx)(s.Z,{mode:"zg-server-time",load:(0,n.jsx)("p",{children:"Synchronising..."}),error:(0,n.jsx)("p",{children:"Synchronisation error"}),children:(0,n.jsx)(()=>{var e=(0,i.useContext)(s.G);let[t,r]=(0,i.useState)(0);return(0,i.useEffect)(()=>{let t=()=>{r(e.toServerTime(Date.now()))},n=setInterval(()=>t(),0);return()=>{clearInterval(n)}},[e]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h1",{children:new Date(t).toISOString()}),(0,n.jsxs)("p",{children:["offset: ",e.offset]}),(0,n.jsxs)("p",{children:["rtt: ",e.rtt]}),(0,n.jsxs)("p",{children:["source: ",(0,n.jsx)("code",{children:JSON.stringify(e.source)})]}),(0,n.jsx)("p",{children:(0,n.jsx)("span",{style:{fontSize:256},children:new Date(t).getSeconds()})})]})},{})})})})})}},67506:function(e,t,r){"use strict";r.d(t,{G:function(){return u},Z:function(){return S}});var n,s,o=r(57437),a=r(80237),i=r(2265),c=r(83593),l=r(23447);let u=(0,i.createContext)({});function S(e){var t;let{api:r,start:n}=(0,i.useContext)(l.E),[s,S]=(0,i.useState)(0),[d,f]=(0,i.useState)(),[_,h]=(0,i.useState)(null!==(t=e.checks)&&void 0!==t?t:3);(0,i.useEffect)(()=>{switch(s){case 0:c.Z.emit({type:c.M.Content_Progress_Update,data:{overall:{completed:0,total:_},bars:{}}}),S(1);break;case 1:m().then(e=>{f(e),S(3)}).catch(e=>{console.error(e),S(2)})}},[s]);let m=async()=>{switch(e.mode){case"server-date-lib":return p();case"zg-server-time":return E();default:throw Error("Unsupported time sync mode")}},E=async()=>{let e;await n(r.getServerTime());let t=Number.MAX_SAFE_INTEGER,s=0;for(let o=0;o<_;o++){let a=Date.now(),i=await n(r.getServerTime()),l=Date.now(),u=l-a,S=(a+l)/2,d=i.timestamp-S;u<t&&(t=u,s=d,e=i),c.Z.emit({type:c.M.Content_Progress_Update,data:{overall:{completed:o+1,total:_},bars:{}}}),await new Promise(e=>setTimeout(e,1e3))}return{offset:s,rtt:t,source:e,toServerTime:e=>Math.round(e+s),fromServerTime:e=>Math.round(e-s)}},p=async()=>{let e;console.warn("ServerDateLib is only accurate to the second.");for(let t=0;t<_;t++){await new Promise(e=>setTimeout(e,1e3));let r=await (0,a.a)();(void 0===e||Math.abs(r.uncertainty)<Math.abs(e.uncertainty))&&(e=r),c.Z.emit({type:c.M.Content_Progress_Update,data:{overall:{completed:t+1,total:_},bars:{}}})}return{offset:e.offset,source:e,rtt:e.uncertainty,toServerTime:t=>t+e.offset,fromServerTime:t=>t-e.offset}};return(0,o.jsxs)(o.Fragment,{children:[(0===s||1===s)&&e.load,2===s&&e.error,3===s&&(0,o.jsx)(u.Provider,{value:d,children:e.children})]})}(n=s||(s={}))[n.Init=0]="Init",n[n.Synchronising=1]="Synchronising",n[n.Error=2]="Error",n[n.Complete=3]="Complete"},83593:function(e,t,r){"use strict";r.d(t,{M:function(){return s}});var n,s,o=r(37836),a=r.n(o);(n=s||(s={})).Request_SlideRefresh="REQUEST_SLIDE_REFRESH",n.WSS_Update_ConnectionState="WSS_UPDATE_CONNECTION_STATE",n.WSS_Distribute_Message="WSS_DISTRIBUTE_MESSAGE",n.Content_Progress_Update="CONTENT_PROGRESS_UPDATE",n.Media_Playback_Update="MEDIA_PLAYBACK_UPDATE",n.WSS_Refresh_Session="WSS_REFRESH_SESSION",n.WSS_Request_Reconnect="WSS_REQUEST_RECONNECT";let i=new(a()),c={on:(e,t)=>i.on(e,t),once:(e,t)=>i.once(e,t),off:(e,t)=>i.off(e,t),emit:e=>i.emit(e.type,e)};Object.freeze(c),t.Z=c}},function(e){e.O(0,[3732,7761,3231,3447,2971,7023,1744],function(){return e(e.s=50003)}),_N_E=e.O()}]);