"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6413],{30089:function(e,t,n){n.d(t,{Cc:function(){return h},H7:function(){return v},av:function(){return m},f_:function(){return g},if:function(){return u},kh:function(){return p},ot:function(){return f},pC:function(){return b},tL:function(){return x},te:function(){return d},yg:function(){return y}});var i=n(6121),r=n(20920),s=n(15785),o=n(71359),a=n(45080),l=n(12569),c=n(24132);let d=(e,t)=>{if(void 0!==e){let i=(0,r.Z)();if(void 0!==e.key&&null!==e.key){var n;return{...e,key:"".concat(t,"-").concat(null!==(n=e.key)&&void 0!==n?n:"undefined","+").concat(i)}}}},u=e=>e?Object.fromEntries(e.split(";").map(e=>e.trim().split(":").map(e=>e.trim()))):{},h=e=>e?Object.fromEntries(e.split(";").map(e=>e.trim().split(":").map(e=>e.trim()))):{},p=e=>{if(null!=e&&0!==e.length)return(0,i.Q)(e,{columns:!1,skip_empty_lines:!0,trim:!0})[0]},x=e=>null==e?void 0:e.map((e,t)=>""===e?" ".repeat(t):e),g=e=>{let t=parseFloat(null!=e?e:"");return isNaN(t)?void 0:t},m=e=>{let t=null==e?void 0:e.toLowerCase(),n=o.Q[t];if(void 0===n)throw console.error("Unknown slider input type: ".concat(e)),"Unknown slider input type: ".concat(e);return n},f=e=>{let t=null==e?void 0:e.toLowerCase(),n=c.rT[t];if(void 0===n)throw console.error("Unknown graph input type: ".concat(e)),"Unknown graph input type: ".concat(e);return n},y=e=>{let t=null==e?void 0:e.toLowerCase(),n=l.J[t];if(void 0===n)throw console.error("Unknown graph orientation: ".concat(e)),"Unknown graph orientation: ".concat(e);return n},v=e=>{let t=null==e?void 0:e.toLowerCase(),n=a.L[t];if(void 0===n)throw console.error("Unknown text input type: ".concat(e)),"Unknown text input type: ".concat(e);return n},b=e=>{let t=null==e?void 0:e.toLowerCase(),n=s.S[t];if(void 0===n)throw console.error("Unknown slide activity: ".concat(e)),"Unknown slide activity: ".concat(e);return n}},8260:function(e,t,n){n.d(t,{S9:function(){return c},UJ:function(){return l},ZP:function(){return d},Zp:function(){return a}});var i=n(2265),r=n(11144);let s=(e,t)=>{let{sid:n,pid:i,qid:r}=e;return{id:void 0,created:void 0,questionId:r,participantId:i,jsonValue:void 0,mimeType:void 0,pII:t}},o=e=>{let t={};return e.forEach(e=>{var n;t[e.questionId]=[...null!==(n=t[e.questionId])&&void 0!==n?n:[],e]}),t},a=(e,t,n)=>{var i;return null!==(i=l(e,t))&&void 0!==i?i:s(t,null!=n&&n)},l=(e,t)=>null==e?void 0:e.find(e=>e.questionId===t.qid&&e.participantId===t.pid),c=e=>(null==e?void 0:e.jsonValue)!==void 0;function d(e){var t;let{session:n}=(0,i.useContext)(r.z),[s,a]=(0,i.useState)(null!==(t=n.answers)&&void 0!==t?t:[]),[l,c]=(0,i.useState)(o(n.answers));return(0,i.useEffect)(()=>{var t;a(void 0!==e?n.answers.filter(t=>t.questionId===e):[]),c(null!==(t=o(n.answers))&&void 0!==t?t:{})},[n.answers]),{answers:s,allAnswers:l}}},67506:function(e,t,n){n.d(t,{G:function(){return d},Z:function(){return u}});var i,r,s=n(57437),o=n(80237),a=n(2265),l=n(83593),c=n(23447);let d=(0,a.createContext)({});function u(e){var t;let{api:n,start:i}=(0,a.useContext)(c.E),[u,h]=(0,a.useState)(0),[p,x]=(0,a.useState)(),[g,m]=(0,a.useState)(null!==(t=e.checks)&&void 0!==t?t:3);(0,a.useEffect)(()=>{switch(console.debug("ZgServerTimeProvider state",r[u]),u){case 0:l.Z.emit({type:l.M.Content_Progress_Update,data:{overall:{completed:0,total:g},bars:{}}}),h(1);break;case 1:f().then(e=>{x(e),h(3)}).catch(e=>{console.error(e),h(2)})}},[u]);let f=async()=>{switch(e.mode){case"server-date-lib":return v();case"zg-server-time":return y();default:throw Error("Unsupported time sync mode")}},y=async()=>{let e;console.debug("zg-server-time warmup",await i(n.getServerTime()));let t=Number.MAX_SAFE_INTEGER,r=0;for(let s=0;s<g;s++){let o=Date.now(),a=await i(n.getServerTime()),c=Date.now();console.debug("zg-server-time response",a);let d=c-o,u=(o+c)/2,h=a.timestamp-u;d<t&&(t=d,r=h,e=a),l.Z.emit({type:l.M.Content_Progress_Update,data:{overall:{completed:s+1,total:g},bars:{}}}),await new Promise(e=>setTimeout(e,1e3))}let s={offset:r,rtt:t,source:e,toServerTime:e=>Math.round(e+r),fromServerTime:e=>Math.round(e-r)};return console.debug("zg-server-time result",s),s},v=async()=>{let e;console.warn("ServerDateLib is only accurate to the second.");for(let t=0;t<g;t++){await new Promise(e=>setTimeout(e,1e3));let n=await (0,o.a)();(void 0===e||Math.abs(n.uncertainty)<Math.abs(e.uncertainty))&&(e=n),l.Z.emit({type:l.M.Content_Progress_Update,data:{overall:{completed:t+1,total:g},bars:{}}})}let t={offset:e.offset,source:e,rtt:e.uncertainty,toServerTime:t=>t+e.offset,fromServerTime:t=>t-e.offset};return console.debug("server-date result",e),t};return(0,s.jsxs)(s.Fragment,{children:[(0===u||1===u)&&e.loading,2===u&&e.error,3===u&&(0,s.jsx)(d.Provider,{value:p,children:e.children})]})}(i=r||(r={}))[i.Init=0]="Init",i[i.Synchronising=1]="Synchronising",i[i.Error=2]="Error",i[i.Complete=3]="Complete"},53622:function(e,t,n){n.d(t,{Z:function(){return o}});var i=n(57437),r=n(2265);let s=(0,r.createContext)({});function o(e){let[t,n]=(0,r.useState)({});return(0,i.jsx)(s.Provider,{value:t,children:e.children})}},4766:function(e,t,n){n.d(t,{X:function(){return d},Z:function(){return u}});var i=n(57437),r=n(2265),s=n(94547),o=n(15785),a=n(11144),l=n(5085),c=n(23447);let d=(0,r.createContext)({});function u(e){let{role:t}=(0,r.useContext)(l.rZ),{session:n}=(0,r.useContext)(a.z),{user:u,sessionToken:h,deviceId:p}=(0,r.useContext)(l.rZ),[x,g]=(0,r.useState)(o.I),[m,f]=(0,r.useState)(),y=(0,r.useRef)(Number.MIN_SAFE_INTEGER),{start:v,api:b}=(0,r.useContext)(c.E);(0,r.useEffect)(()=>{t===s._b.Controller&&w()},[]),(0,r.useEffect)(()=>{console.debug("LiveExperienceState change...",n.liveExperienceState),n.liveExperienceState.sequence>y.current&&n.liveExperienceState.originator!==p&&(f(n.liveExperienceState.slideX),y.current=n.liveExperienceState.sequence)},[n.liveExperienceState]),(0,r.useEffect)(()=>{console.debug("SlideIndex change...",m),void 0!==m&&(t===s._b.Controller&&k(m),t===s._b.Controller&&j(m))},[m]);let w=()=>{let e=window.localStorage.getItem("RevealState-".concat(n.id));e&&f(JSON.parse(e).index)},j=e=>{if(t===s._b.Controller){let t=JSON.stringify({index:e});window.localStorage.setItem("RevealState-".concat(n.id),t)}},k=async e=>{if(void 0===u)return;let t={action:"set-slide-position",sessionId:n.id,parameters:{indexh:e,originator:p}};await v(b.postFacilitatorAction(u.access_token,h,t))};return(0,i.jsx)(d.Provider,{value:{slideData:x,setSlideData:g,slideIndex:m,setSlideIndex:f},children:e.children})}},93191:function(e,t,n){n.d(t,{N:function(){return l},Z:function(){return c}});var i=n(57437),r=n(57818),s=n(2265),o=n(5085),a=n(96544);let l=(0,s.createContext)({});function c(e){let t=(0,s.useContext)(a.F),[c,d]=(0,s.useState)(),{role:u}=(0,s.useContext)(o.rZ);return(0,s.useEffect)(()=>{let s=(0,r.default)(()=>Promise.all([n.e(6885),n.e(9589),n.e(441)]).then(n.bind(n,50441)),{loadableGenerated:{webpack:()=>[50441]},ssr:!1}),o=(0,r.default)(()=>Promise.all([n.e(1518),n.e(8218),n.e(9589),n.e(9974),n.e(567)]).then(n.bind(n,90567)),{loadableGenerated:{webpack:()=>[90567]},ssr:!1});d({presentation:(0,i.jsx)(s,{sid:t.sid,role:u,slides:t.slides,sourcePresentationXml:t.sourceXml.join("\n"),embedded:!0,showBorder:!1,regenerateThumbnails:e.refresh}),previews:e.previews?(0,i.jsx)(o,{sid:t.sid,slides:t.slides,sourcePresentationXml:t.sourceXml.join("\n"),regenerateThumbnails:e.refresh}):void 0})},[]),(0,i.jsx)(i.Fragment,{children:c&&(0,i.jsx)(l.Provider,{value:c,children:e.children})})}},96544:function(e,t,n){n.d(t,{F:function(){return tq},Z:function(){return tA}});var i,r,s,o,a,l,c,d,u=n(57437),h=n(53463),p=n(2265),x=n(22599),g=n.n(x),m=n(20920),f=n(79418),y=n(94547),v=n(8260),b=n(5085),w=n(31193),j=n(96537),k=n(48620);function Z(e){var t;let n=(0,p.useContext)(b.rZ),{answers:i}=(0,v.ZP)(e.qids.qid),[r,s]=(0,p.useState)((0,v.Zp)(i,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[o,a]=(0,p.useState)(r),[l,c]=(0,p.useState)(n.role!==y._b.Controller),[d,h]=(0,p.useState)(!1);(0,p.useEffect)(()=>{a(r)},[r]);let x=t=>{if(!l)return;h(!0);let n={...o,jsonValue:{answers:[{key:t,booleanValue:!0}]}};e.onAnswer(n).then(e=>{if(e)s(e);else throw"No response from submission"}).catch(e=>{console.error(e)}).finally(()=>{h(!1)})};return(0,u.jsxs)(u.Fragment,{children:[e.question&&(0,u.jsx)(k.Z,{content:e.question}),(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"row",gap:1,justifyContent:e.align},children:e.options.map((t,n)=>{var i;return(0,u.jsx)(j.Z,{variant:(null!==(i=t.variant)&&void 0!==i?i:0===n)?"contained":"outlined",color:t.colour,onClick:()=>x(t.key),disabled:!l||d,children:t.text},"ack-".concat(e.qids.qid,"-option-").concat(t.key))})})]})}var S=n(22960),C=n(58433),I=n(80511),D=n(33351),E=n(49752);function P(e){let t=e.layoutParams.length>0?parseInt(e.layoutParams[0]):6,n=(0,S.Z)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(D.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,u.jsx)(D.Z,{sx:{mb:4,mx:8},children:e.question&&(0,u.jsx)(k.Z,{content:e.question})}),(0,u.jsx)(C.ZP,{container:!0,spacing:1,children:e.displayOptions.map((i,r)=>{let s=e.currentlySelectedKeys.find(e=>e===i.key);return(0,u.jsx)(C.ZP,{item:!0,xs:t,display:"flex",flexDirection:"column",alignContent:"stretch",children:(0,u.jsx)(j.Z,{variant:"contained",style:{display:"flex",flexDirection:"column",justifyContent:"center",border:"solid 4px",background:s?n.palette.optionButtonSelected.main:n.palette.optionButtonUnselected.main,borderColor:s?n.palette.optionButtonSelectedBorder.main:"transparent",color:"black"},onClick:()=>e.onSelectionClick(i.key),children:(0,u.jsx)(I.Z,{variant:"submitButton",children:i.display})})},"answer-".concat(e.qid,"-").concat(i.key))})}),e.showSubmit&&(0,u.jsx)(D.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end",sx:{mt:4},children:(0,u.jsx)(E.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}function q(e){let t=(0,S.Z)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(D.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,u.jsx)(D.Z,{sx:{mb:4,mx:8},children:e.question&&(0,u.jsx)(k.Z,{content:e.question})}),(0,u.jsx)(D.Z,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",gap:1},children:e.displayOptions.map((n,i)=>{let r=e.currentlySelectedKeys.find(e=>e===n.key);return(0,u.jsx)(j.Z,{variant:"contained",style:{display:"flex",flexDirection:"column",justifyContent:"center",border:"solid 4px",background:r?t.palette.optionButtonSelected.main:t.palette.optionButtonUnselected.main,borderColor:r?t.palette.optionButtonSelectedBorder.main:"transparent",color:"black"},onClick:()=>e.onSelectionClick(n.key),children:(0,u.jsx)(I.Z,{variant:"submitButton",children:n.display})},"answer-".concat(e.qid,"-").concat(n.key))})}),e.showSubmit&&(0,u.jsx)(D.Z,{display:"flex",flexDirection:"row",justifyContent:"flex-end",sx:{mt:4},children:(0,u.jsx)(E.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}function A(e){let t=(0,S.Z)(),n=90-90/e.sourceOptions.filter(e=>!e.isAlt).length;return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,u.jsx)(w.Z,{sx:{mb:4,mx:8},children:e.question&&(0,u.jsx)(k.Z,{content:e.question})}),(0,u.jsx)(w.Z,{display:"flex",flexDirection:"row",justifyContent:"center",sx:{gap:1,width:"".concat(n,"%")},children:e.displayOptions.filter(e=>!e.isAlt).map((n,i)=>{let r=e.currentlySelectedKeys.find(e=>e===n.key);return(0,u.jsxs)(w.Z,{sx:{borderRadius:4,px:1,flexGrow:1,flexBasis:0},style:{minHeight:200,border:"solid 4px",background:r?t.palette.optionButtonSelected.main:t.palette.optionButtonUnselected.main,borderColor:r?t.palette.optionButtonSelectedBorder.main:"transparent",cursor:"pointer"},display:"flex",flexDirection:"column",justifyContent:"center",onClick:()=>e.onSelectionClick(n.key),children:[!!n.graphic&&(0,u.jsx)("img",{src:n.graphic,style:{alignSelf:"center",width:"40%"},alt:"".concat(n.display)}),(0,u.jsx)(I.Z,{variant:"yesNoUnsureButton",sx:{textWrap:"pretty"},children:n.display})]},"option-".concat(n.key,"-").concat(e.qid))})}),(0,u.jsx)(w.Z,{display:"flex",flexDirection:"column",alignItems:"center",sx:{mt:2},children:e.sourceOptions.filter(e=>e.isAlt).map((n,i)=>{let r=e.currentlySelectedKeys.find(e=>e===n.key);return(0,u.jsx)(w.Z,{sx:{p:2,borderRadius:4},style:{background:r?t.palette.optionButtonSelected.main:"transparent",border:"solid 4px transparent",borderColor:r?t.palette.optionButtonSelectedBorder.main:"transparent",cursor:"pointer"},onClick:()=>e.onSelectionClick(n.key),display:"flex",flexDirection:"column",justifyContent:"center",children:(0,u.jsx)(I.Z,{variant:"yesNoUnsureButton",style:{borderBottom:"solid 1px black"},children:n.display})},"option-".concat(n.key,"-").concat(e.qid))})}),e.showSubmit&&(0,u.jsx)(w.Z,{display:"flex",flexDirection:"row",justifyContent:"center",sx:{mt:4},children:(0,u.jsx)(E.Z,{busy:e.busy,inline:!1,enabled:e.enableSubmit,onSubmit:e.onSubmit})})]})})}let _=(e,t)=>t.filter(t=>!!e.find(e=>e===t.key)),F=e=>[...e].sort(()=>Math.random()-.5);function B(e){var t;let[n,i]=(0,p.useState)(e.shuffle?F(e.options):e.options),{answers:r}=(0,v.ZP)(e.qids.qid),[s,o]=(0,p.useState)((0,v.Zp)(r,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[a,l]=(0,p.useState)([]);(0,p.useEffect)(()=>{var t,n;l(_(null!==(n=null===(t=s.jsonValue)||void 0===t?void 0:t.answers.filter(e=>!0===e.booleanValue).map(e=>e.key))&&void 0!==n?n:[],e.options))},[s]);let[c,d]=(0,p.useState)(!1),h=e.role===y._b.Client,x=()=>a.length>=e.minSelections&&a.length<=e.maxSelections,g=async()=>{if(x())try{d(!0);var t={...s,jsonValue:{answers:a.map(t=>({key:t.key,booleanValue:!0,numericValue:1,index:e.options.findIndex(e=>e.key===t.key)}))}},n=await e.onAnswer(t);if(console.debug("Answer submitted ".concat(n?"ok":"error")),console.debug("Received answer response",n),n)o(n);else throw"No response received"}catch(e){console.error("Error submitting answer",e)}finally{d(!1)}},m=t=>{console.debug("Selection clicked: "+t);let n=e.options.find(e=>e.key===t);if(void 0===n)throw"Cannot identify this option from props.options";if(a.find(e=>e.key===t))l(a.filter(e=>e.key!==t));else if(a.length>=e.maxSelections){let e=a.find(e=>e.key!==t);l([...a.filter(t=>t!==e),n])}else l([...a,n])},f=()=>({onSubmit:g,onSelectionClick:m,qid:e.qids.qid,question:e.question,sourceOptions:e.options,displayOptions:n,busy:c,showSubmit:h,enableSubmit:x(),minSelections:e.minSelections,maxSelections:e.maxSelections,currentlySelectedKeys:a.map(e=>e.key),layoutParams:e.layoutParams}),[b,j]=(0,p.useState)(f());return(0,p.useEffect)(()=>{j(f())},[c,a]),(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:(0,u.jsxs)(w.Z,{sx:{flexGrow:1,display:"block"},children:["yes-no-unsure"===e.layout&&(0,u.jsx)(A,{...b}),"button-grid"===e.layout&&(0,u.jsx)(P,{...b}),"buttons-inline"===e.layout&&(0,u.jsx)(q,{...b})]})})})}var T=n(44908),R=n(65786),M=n(19309);function U(e){return(0,u.jsxs)(w.Z,{sx:{width:"100%",height:"100%",className:"stretch",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,u.jsx)(w.Z,{sx:{display:"block",flexGrow:1,overflowY:"auto",overflowX:"hidden"},children:e.children}),(e.startBar||e.endBar)&&(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,u.jsx)(w.Z,{children:e.startBar}),e.endBar&&(0,u.jsx)(w.Z,{children:e.endBar})]})]})}var V=n(9646);function N(e){var t;let n=(0,p.useContext)(b.rZ),{answers:i}=(0,v.ZP)(e.qids.qid),[r,s]=(0,p.useState)((0,v.Zp)(i,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[o,a]=(0,p.useState)(!1),[l,c]=(0,p.useState)(!1),[d,h]=(0,p.useState)(!1);(0,p.useEffect)(()=>{var e,t,n;a(null!==(n=null===(t=r.jsonValue)||void 0===t?void 0:null===(e=t.answers.find(e=>"consent"===e.key))||void 0===e?void 0:e.booleanValue)&&void 0!==n&&n)},[r]),(0,p.useEffect)(()=>{c(o&&n.role===y._b.Client)},[o]);let x=t=>{if(!l){console.warn("Only participants can submit answers");return}h(!0);let n={...r,jsonValue:{answers:[{key:"consent",booleanValue:o},{key:"consentText",stringValue:e.consentText}]}};e.onAnswer(n).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),null!==e)s(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{h(!1)})};return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(U,{startBar:(0,u.jsx)(()=>(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(T.Z,{control:(0,u.jsx)(R.Z,{checked:o,onChange:(e,t)=>a(t)}),label:(0,u.jsx)("span",{style:{fontWeight:"bold",fontSize:"1.25rem"},children:e.consentText})})}),{}),endBar:(0,u.jsx)(()=>(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(V.Z,{btnKey:"submit",btnText:"Submit",onClick:x,disabled:!l,busy:d})}),{}),children:[e.question&&(0,u.jsx)(k.Z,{content:e.question,forceAlign:"left",sx:{fontWeight:"bold"}}),e.content.map((t,n)=>(0,u.jsx)(I.Z,{variant:"consentBody",align:"left",dangerouslySetInnerHTML:{__html:(0,M.Z)(t)}},"".concat(e.qids.qid,"-consent-body-").concat(n)))]})})}let W={gbr:{key:"postcode",label:"Postcode (first half)",mode:"text",layout:"column",textPlaceholder:"What is the first half of your postcode?",textValidationRegex:"^[a-zA-Z]{1,2}[0-9][0-9a-zA-Z]?$",textCapitalisation:!0,textValidationMessage:"Please enter a valid UK postcode",groups:[]}},L={key:"gender",label:"Gender",mode:"select",layout:"column",groups:[{label:"Gender",choices:[{display:"Female",key:"f"},{display:"Male",key:"m"},{display:"Non-binary",key:"nb"},{display:"I would rather not say",key:"prefer-not-to-say"}]}]},O={key:"age",label:"Age range",mode:"select",layout:"grid",layoutProps:{columns:2},groups:[{label:"Age",choices:[{display:"14 - 17",key:"14-17"},{display:"18 - 25",key:"18-25"},{display:"26 - 35",key:"26-35"},{display:"36 - 45",key:"36-45"},{display:"46 - 55",key:"46-55"},{display:"56 - 65",key:"56-65"},{display:"66 - 75",key:"66-75"},{display:"76+",key:"76+"},{display:"I would rather not say",key:"prefer-not-to-say"}]}]},z={key:"ethnicity",label:"Ethnicity",mode:"select",layout:"row",groups:[{label:"Asian or Asian British",choices:[{display:"Indian",key:"Indian"},{display:"Pakistani",key:"Pakistani"},{display:"Bangladeshi",key:"Bangladeshi"},{display:"Chinese",key:"Chinese"},{display:"Any other Asian background",key:"Any other Asian background"}]},{label:"Black, Black British, Caribbean or African",choices:[{display:"Caribbean",key:"Caribbean"},{display:"African",key:"African"},{display:"Any other Black, Black British, or Caribbean background",key:"Any other Black, Black British, or Caribbean background"}]},{label:"Mixed or multiple ethnic groups",choices:[{display:"White and Black Caribbean",key:"White and Black Caribbean"},{display:"White and Black African",key:"White and Black African"},{display:"White and Asian",key:"White and Asian"},{display:"Any other Mixed or multiple ethnic background",key:"Any other Mixed or multiple ethnic background"}]},{label:"White",choices:[{display:"English, Welsh, Scottish, Northern Irish or British",key:"English, Welsh, Scottish, Northern Irish or British"},{display:"Irish",key:"Irish"},{display:"Gypsy or Irish Traveller",key:"Gypsy or Irish Traveller"},{display:"Roma",key:"Roma"},{display:"Any other White background",key:"Any other White background"}]},{label:"Other ethnic group",choices:[{display:"Arab",key:"Arab"},{display:"Any other ethnic group",key:"Any other ethnic group"}]},{label:"Unavailable",choices:[{display:"I would rather not say",key:"prefer-not-to-say"}]}]};function G(e){let t=e.demographic.groups.length>1;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[(0,u.jsx)(j.Z,{color:"buttonStandard",variant:"text",onClick:()=>e.onBack(),children:(0,u.jsx)("img",{src:"/icons/arrow-left.svg",alt:"Back"})}),(0,u.jsx)(I.Z,{variant:"slideSubHeading",align:"left",children:e.demographic.label})]}),(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch",gap:4,mb:4},children:e.demographic.groups.map(n=>(0,u.jsxs)(w.Z,{display:"flex",flexDirection:"column",alignContent:"start",children:[t&&(0,u.jsx)(I.Z,{variant:"demographicGroupHeading",align:"left",sx:{mb:.8},children:n.label}),("row"===e.layout||"column"===e.layout)&&(0,u.jsx)(w.Z,{display:"flex",flexDirection:e.layout,gap:1,flexWrap:"row"===e.layout?"wrap":void 0,alignItems:"column"===e.layout?"start":void 0,children:n.choices.map(t=>{var i;return(0,u.jsx)(j.Z,{variant:"contained",color:(null===(i=e.currentSelection)||void 0===i?void 0:i.key)===t.key?"buttonStandard":"buttonQuiet",onClick:()=>{e.onSelection(t)},children:(0,u.jsx)(I.Z,{variant:"submitButton",children:t.display})},"".concat(e.demographic.label,"-section-").concat(n.label,"-value-").concat(t.key))})}),"grid"===e.layout&&(0,u.jsx)(C.ZP,{container:!0,sx:{width:e.layoutProps.columns<3?"66%":"100%"},rowGap:1,children:n.choices.map(t=>{var i;return(0,u.jsx)(C.ZP,{item:!0,xs:12/e.layoutProps.columns,sx:{px:1},children:(0,u.jsx)(j.Z,{variant:"contained",fullWidth:!0,color:(null===(i=e.currentSelection)||void 0===i?void 0:i.key)===t.key?"buttonStandard":"buttonQuiet",onClick:()=>{e.onSelection(t)},children:(0,u.jsx)(I.Z,{variant:"submitButton",sx:{py:1},children:t.display})})},"".concat(e.demographic.label,"-section-").concat(n.label,"-value-").concat(t.key))})})]},"".concat(e.demographic.label,"-section-").concat(n.label)))})]})}var K=n(66858);function H(e){var t,n,i;let r=()=>{var t;return null!==(t=e.skipOption)&&void 0!==t?t:{key:"prefer-not-to-say",display:"I would rather not say"}},[s,o]=(0,p.useState)((null===(t=e.currentSelection)||void 0===t?void 0:t.key)!==r().key&&null!==(i=null===(n=e.currentSelection)||void 0===n?void 0:n.display)&&void 0!==i?i:""),[a,l]=(0,p.useState)(""),[c,d]=(0,p.useState)(!1),[h,x]=(0,p.useState)(!0),[g,m]=(0,p.useState)(!1),f=t=>{var n,i;return(m(!0),e.demographic.textMaxLength&&t.length>e.demographic.textMaxLength)?(l(null!==(n=e.demographic.textValidationMessage)&&void 0!==n?n:"Maximum length: ".concat(e.demographic.textMaxLength," characters")),d(!0),x(!1),!1):e.demographic.textValidationRegex&&!new RegExp(e.demographic.textValidationRegex).test(t)?(o(t),l(null!==(i=e.demographic.textValidationMessage)&&void 0!==i?i:"Please enter a valid value for ".concat(e.demographic.label,".")),d(!0),x(!1),!1):(o(t),l(""),d(!1),x(!0),!0)};return(0,p.useEffect)(()=>{g&&x(!c)},[g,c]),(0,u.jsx)(U,{endBar:(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",gap:1},children:[e.skipPermitted&&(0,u.jsx)(V.Z,{btnKey:"skip",btnText:"I would rather not say",variant:"outlined",onClick:t=>{e.onSelection(r())}}),(0,u.jsx)(V.Z,{btnKey:"submit",btnText:"Submit",variant:"contained",disabled:!h,onClick:t=>{f(s)&&e.onSelection({key:s,display:s})}})]}),children:(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[(0,u.jsx)(j.Z,{color:"buttonStandard",variant:"text",onClick:()=>e.onBack(),children:(0,u.jsx)("img",{src:"/icons/arrow-left.svg",alt:"Back"})}),(0,u.jsx)(I.Z,{variant:"slideSubHeading",align:"left",children:e.demographic.label})]}),(0,u.jsx)(K.Z,{label:e.demographic.textPlaceholder,variant:"outlined",defaultValue:s,onChange:e=>{let t=e.target.value.trim();g?f(t):o(t)},helperText:a,error:c,autoComplete:"off",color:"buttonStandard",inputProps:{style:{textTransform:e.demographic.textCapitalisation?"uppercase":void 0}},InputProps:{sx:{background:"white",fontSize:"2rem"}},InputLabelProps:{sx:{fontSize:"2rem","&.MuiOutlinedInput-notchedOutline":{fontSize:"2rem"}}}})]})})}function Y(e){var t,n,i,r;let s;let{answers:o}=(0,v.ZP)(e.qids.qid),[a,l]=(0,p.useState)((0,v.Zp)(o,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[c,d]=(0,p.useState)(!1),[h,x]=(0,p.useState)(!1),[m,f]=(0,p.useState)((s=[],(null===(n=e.showGender)||void 0===n||n)&&s.push(L),(null===(i=e.showAge)||void 0===i||i)&&s.push(O),(null===(r=e.showEthnicity)||void 0===r||r)&&s.push(z),void 0!==e.showPostcode&&s.push(W[e.showPostcode]),[...s,...e.customDemographics])),[b,Z]=(0,p.useState)(),[S,C]=(0,p.useState)({});(0,p.useEffect)(()=>{let e={};(null==a?void 0:a.jsonValue)&&a.jsonValue.answers.forEach(t=>{e[t.key]={key:t.optionKey,display:t.stringValue}}),C(e)},[a]),(0,p.useEffect)(()=>{let t=g().every(m,e=>S.hasOwnProperty(e.key));x(e.role===y._b.Client&&t)},[S]);let D=async()=>{if(e.role!==y._b.Client)console.warn("Only participants can submit answers");else{let t={...a,jsonValue:{answers:Object.entries(S).map(e=>({key:e[0],optionKey:e[1].key,stringValue:e[1].display}))}};d(!0),e.onAnswer(t).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)l(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{d(!1)})}},E=!1===e.opaqueInputBox?void 0:{background:"white"},P=e=>{var t;return(0,u.jsx)(j.Z,{color:"buttonStandard",variant:"outlined",sx:{alignSelf:"stretch",py:0,...e.inputBoxSx},onClick:()=>e.onClick(),children:(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:0},children:[void 0!==e.display&&(0,u.jsx)(I.Z,{variant:"selectTiny",children:e.label}),(0,u.jsx)(I.Z,{variant:"selectLarge",component:"div",children:null!==(t=e.display)&&void 0!==t?t:e.label})]}),(0,u.jsx)("img",{src:"/icons/select-down.svg"})]})})};return(0,u.jsxs)(u.Fragment,{children:[void 0===b&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(U,{endBar:(0,u.jsx)(V.Z,{btnKey:"submit",btnText:"Submit",onClick:()=>{D()},disabled:!h,busy:c}),children:(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,u.jsx)(w.Z,{sx:{mb:4,mx:8},children:e.question&&(0,u.jsx)(k.Z,{content:e.question})}),m.map(e=>(0,u.jsx)(P,{label:e.label,display:S.hasOwnProperty(e.key)?S[e.key].display:void 0,onClick:()=>{Z(e)},inputBoxSx:E},"overview-demographic-".concat(e.key)))]})})}),void 0!==b&&"select"===b.mode&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(G,{demographic:b,currentSelection:S[b.key],onBack:()=>{Z(void 0)},onSelection:e=>{C({...S,[b.key]:e}),Z(void 0)},layout:b.layout,layoutProps:b.layoutProps})}),void 0!==b&&"text"===b.mode&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(H,{demographic:b,skipPermitted:!0,currentSelection:S[b.key],onBack:()=>{Z(void 0)},onSelection:e=>{C({...S,[b.key]:e}),Z(void 0)}})})]})}var Q=n(83593);function X(e){let{answers:t}=(0,v.ZP)(e.qids.qid),n=()=>(0,v.UJ)(t,e.qids),[i,r]=(0,p.useState)(n()),[s,o]=(0,p.useState)((0,v.S9)(i)?1:0);return(0,p.useEffect)(()=>{r(n())},[t]),(0,p.useEffect)(()=>{o((0,v.S9)(i)?1:0)},[i]),(0,p.useEffect)(()=>{Q.Z.emit({type:Q.M.Request_SlideRefresh})},[s]),(0,u.jsxs)(u.Fragment,{children:[0===s&&e.input,1===s&&e.completion]})}(i=a||(a={}))[i.Input=0]="Input",i[i.Completion=1]="Completion";var J=n(40772),$=n(14874);function ee(e){let{allAnswers:t}=(0,v.ZP)(),n=()=>{for(let n of e.qids)if(!(0,v.S9)((0,v.UJ)(t[n.qid],n)))return e.qids.indexOf(n)},[i,r]=(0,p.useState)(n());(0,p.useEffect)(()=>{let e=n();i!==e&&r(e)},[t]);let s=(0,$.Z)(),o=[.2,.25],[a]=(0,J.u)({duration:500});return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{ref:a,className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"stretch",p:2,gap:2,boxSizing:"border-box"},children:[void 0!==i&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(k.Z,{content:e.question}),(0,u.jsx)(w.Z,{sx:{flexGrow:1,boxSizing:"border-box",overflowY:"auto",overflowX:"hidden",display:"block"},children:e.inputs[i]},"input-sequence-element-".concat(e.qids[i].qid))]}),void 0===i&&(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"block"},children:e.completion}),void 0!==i&&e.showProgress&&(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:g().range(0,e.inputs.length).map((t,n)=>(0,u.jsx)(w.Z,{sx:{background:t===i?s.palette.progressBlipSelected.main:s.palette.progressBlipUnselected.main,width:"".concat(o[t===i?1:0],"em"),height:"".concat(o[t===i?1:0],"em"),borderRadius:"".concat(o[t===i?1:0]/2,"em")}},"sequence-blip-".concat(t,"-").concat(e.qids[t].qid)))})]})})}var et=n(26049);function en(e){let{answers:t}=(0,v.ZP)(e.qids.qid),n=()=>{var n;return(0,v.Zp)(t,e.qids,null===(n=e.question)||void 0===n?void 0:n.pii)},[i,r]=(0,p.useState)(n()),[s,o]=(0,p.useState)(n()),[a,l]=(0,p.useState)(!1),[c,d]=(0,p.useState)(e.role===y._b.Client),[h,x]=(0,p.useState)({});(0,p.useEffect)(()=>{let t={...h};e.options.forEach(n=>{var r,s,o;t[n.key]=null!==(o=null===(s=i.jsonValue)||void 0===s?void 0:null===(r=s.answers.find(e=>e.key===n.key))||void 0===r?void 0:r.numericValue)&&void 0!==o?o:Math.floor((e.min+e.max)/2)}),x(t),o({...i,jsonValue:{answers:e.options.map(n=>{var i,r;return{key:n.key,numericValue:null!==(i=t[n.key])&&void 0!==i?i:Math.floor((e.min+e.max)/2),description:n.description,index:null!==(r=t[n.key])&&void 0!==r?r:Math.floor((e.min+e.max)/2)}})}})},[i]);let g=t=>h.hasOwnProperty(t)?h[t]:Math.floor((e.min+e.max)/2),m=(t,n)=>{var i,r,a;let l=null!==(r=s.jsonValue)&&void 0!==r?r:{answers:[]};l.answers=l.answers.filter(e=>e.key!==t),l.answers.push({key:t,numericValue:n,description:null!==(a=null===(i=e.options.find(e=>e.key===t))||void 0===i?void 0:i.description)&&void 0!==a?a:"".concat(n),index:n}),o({...s,jsonValue:l})},f=async()=>{e.role!==y._b.Controller&&(l(!0),e.onAnswer(s).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)r(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{l(!1)}))};return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1,px:8},children:[(0,u.jsxs)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1,overflowX:"hidden",overflowY:"auto",justifyContent:"center",px:0},children:[(0,u.jsx)(w.Z,{sx:{mb:8},children:e.question&&(0,u.jsx)(k.Z,{content:e.question})}),(0,u.jsxs)(C.ZP,{container:!0,sx:{alignItems:"center"},children:[(0,u.jsx)(C.ZP,{item:!0,xs:3}),(0,u.jsx)(C.ZP,{item:!0,xs:9,style:{textAlign:"left"},sx:{pr:3},children:e.labels.map((t,n)=>{let i=e.max-e.min,r=t.at-e.min,s=t.at===e.min,o=t.at===e.max;return(0,u.jsx)(w.Z,{style:{position:"relative",left:"".concat(r/i*100,"%")},children:(0,u.jsx)(w.Z,{style:{position:"absolute",transform:s?"translate(0, -0.5em)":o?"translate(-100%, -0.5em)":"translate(-50%, -0.5em)",maxWidth:"".concat(100/e.labels.length,"%")},children:(0,u.jsx)(I.Z,{variant:"body1",component:"div",sx:{fontWeight:"bold"},children:t.text})})},"".concat(e.qids.qid,"-label-").concat(n,"-at-").concat(t.at))})}),e.options.map((t,n)=>(0,u.jsxs)(p.Fragment,{children:[(0,u.jsxs)(C.ZP,{item:!0,xs:3,children:[(0,u.jsx)(I.Z,{variant:"body1",align:"left",component:"div",sx:{pr:6},children:t.title}),e.showDescriptions&&!1]}),(0,u.jsx)(C.ZP,{item:!0,xs:9,sx:{pr:3},children:(0,u.jsx)(et.Z,{onCommit:e=>{m(t.key,e)},color:"secondary",sliderDefault:g(t.key),marks:!0,min:e.min,max:e.max,step:1,sliderMode:"multi",sx:{mt:1}})})]},"".concat(e.qids.qid,"-option-").concat(t.key)))]})]}),e.role===y._b.Client&&(0,u.jsx)(w.Z,{children:(0,u.jsx)(E.Z,{onSubmit:f,text:"Submit",busy:a,enabled:c,inline:!1,alignment:"right"})})]})})}var ei=n(45231);function er(e){let t=(0,p.useContext)(b.rZ),{answers:n}=(0,v.ZP)(e.qids.qid),i=()=>{var t;return(0,v.Zp)(n,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)},[r,s]=(0,p.useState)(i()),[o,a]=(0,p.useState)(i()),[l,c]=(0,p.useState)(!1),[d,h]=(0,p.useState)(!1),[x,m]=(0,p.useState)(e.points),[f,j]=(0,p.useState)(e.options.map(e=>({min:0,max:e.max}))),[Z,C]=(0,p.useState)(e.options.map(()=>0)),D=(e,t)=>{C(Z.map((n,i)=>i===t?e:n))};(0,p.useEffect)(()=>{let n=e.points-g().sum(Z);m(n);for(let t=0;t<e.options.length;t++)j(f.map((e,t)=>({min:0,max:Z[t]+n})));let i={answers:[]};for(let t=0;t<e.options.length;t++)i.answers.push({key:e.options[t].key,description:e.options[t].title,numericValue:Z[t]});a({...o,jsonValue:i}),h(0===n&&t.role!==y._b.Controller)},[Z,e.options,e.points,t.role]);let P=async()=>{c(!0),e.onAnswer(o).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)s(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{c(!1)})},q=(e,t)=>g().range(e,t+1,1).map((e,t)=>({value:e,label:"".concat(e)})),A=(0,S.Z)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"row",gap:1,mb:2},children:e.question&&(0,u.jsx)(k.Z,{content:e.question})}),(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:1,flexGrow:1,overflowX:"hidden",overflowY:"auto",px:1},children:e.options.map((e,n)=>(0,u.jsxs)(w.Z,{sx:{background:"#f0f0f0",p:2,borderRadius:4,display:"flex",flexDirection:"row",alignItems:"stretch",gap:2},children:[e.graphic&&(0,u.jsx)(w.Z,{sx:{width:"20%",backgroundSize:"cover",backgroundPosition:"center",backgroundImage:"url(".concat(e.graphic,")"),borderRadius:2}}),(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:1,width:"80%"},children:[(0,u.jsx)(I.Z,{variant:"pointsAllocationCategoryTitle",align:"left",children:e.title}),(0,u.jsx)(I.Z,{variant:"pointsAllocationCategoryDescription",align:"left",children:e.description}),(0,u.jsx)(w.Z,{sx:{px:2},children:(0,u.jsx)(et.Z,{onCommit:e=>{D(e,n)},color:"secondary",sliderDefault:Z[n],marks:q(e.min,e.max),slots:{markLabel:ei.A},min:e.min,max:e.max,step:1,sliderMode:"multi",acceptableRange:{min:f[n].min,max:f[n].max},disabled:t.role===y._b.Controller})})]})]},"points-allocation-option-".concat(n)))}),(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"end",gap:1,mx:1},children:[(0,u.jsxs)(I.Z,{variant:"pointsAllocationCategoryTitle",align:"left",color:A.palette.secondary.main,children:[x," points remaining"]}),(0,u.jsx)(E.Z,{enabled:d,inline:!0,busy:l,onSubmit:()=>P()})]})]})})}var es=n(11020),eo=n(84479);let ea=(e,t,n)=>{if(void 0===e.jsonValue||0===e.jsonValue.answers.length)return ec(t,n);let i=[];return e.jsonValue.answers.forEach(e=>{let n=t.find(t=>t.key===e.key);n&&(i[e.index]=n)}),i},el=(e,t)=>{let n={answers:[]};return t.forEach((e,t)=>{n.answers.push({key:e.key,index:t,numericValue:t,description:e.title})}),{...e,jsonValue:n}},ec=(e,t)=>t?[...e].sort(()=>Math.random()-.5):e.sort((e,t)=>e.startingIndex-t.startingIndex);function ed(e){var t;let n=(0,p.useContext)(b.rZ),{answers:i}=(0,v.ZP)(e.qids.qid),[r,s]=(0,p.useState)((0,v.Zp)(i,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[o,a]=(0,p.useState)(n.role!==y._b.Controller),[l,c]=(0,p.useState)(!1),[d,h]=(0,p.useState)(ec(e.options,e.shuffle));(0,p.useEffect)(()=>{h(ea(r,e.options,e.shuffle))},[r,e.options,e.shuffle]);let x=e=>{let t=d.findIndex(t=>t.key===e.key);if(t>0){let n=[...d];n.splice(t,1),n.splice(t-1,0,e),h(n)}},g=e=>{let t=d.findIndex(t=>t.key===e.key);if(t<d.length-1){let n=[...d];n.splice(t,1),n.splice(t+1,0,e),h(n)}},m=async()=>{if(n.role===y._b.Client&&o){c(!0);let t=el(r,d);e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)h(ea(t,e.options,e.shuffle));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{c(!1)})}else console.warn("Only participants can submit answers")},f=(0,S.Z)(),[j]=(0,J.u)({duration:500});return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(U,{endBar:(0,u.jsx)(V.Z,{btnKey:"submit",onClick:e=>{m()},disabled:!o,busy:l,variant:"contained",color:"buttonStandard",btnText:"Submit"}),children:[e.question&&(0,u.jsx)(w.Z,{sx:{mb:2},children:(0,u.jsx)(k.Z,{content:e.question})}),(0,u.jsx)(w.Z,{ref:j,sx:{display:"flex",flexDirection:"column"},children:d.map((t,n)=>(0,u.jsxs)(w.Z,{sx:{border:"solid 1px black",borderRadius:2,p:1.5,display:"flex",flexDirection:"row",gap:1,alignContent:"center",alignItems:"center",background:"white",mb:1,boxSizing:"border-box"},children:[(0,u.jsxs)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pr:2},children:[t.title&&(0,u.jsx)(I.Z,{variant:"rankedListItemTitle",align:"left",children:t.title}),t.description&&(0,u.jsx)(I.Z,{variant:"rankedListItemDescription",align:"left",children:t.description})]}),(0,u.jsx)(w.Z,{onClick:()=>{x(t)},sx:{display:"flex",flexDirection:"column",background:f.palette.updinkBackground.main,color:f.palette.updinkText.main,p:.5,borderRadius:2,cursor:0===n?void 0:"pointer",opacity:0===n?0:1},children:(0,u.jsx)(eo.Z,{sx:{fontSize:"2rem"}})}),(0,u.jsx)(w.Z,{onClick:()=>{g(t)},sx:{display:"flex",flexDirection:"column",background:f.palette.downdinkBackground.main,color:f.palette.downdinkText.main,p:.5,borderRadius:2,cursor:n===d.length-1?void 0:"pointer",opacity:n===d.length-1?0:1},children:(0,u.jsx)(es.Z,{sx:{fontSize:"2rem"}})})]},"ranked-list-".concat(e.qids.qid,"-option-").concat(t.key)))})]})})}var eu=n(71359),eh=n(45080),ep=n(34990),ex=n(60335);(r=l||(l={}))[r.Yes=0]="Yes",r[r.No=1]="No",r[r.Unsure=2]="Unsure";let eg=e=>0===e?1:1===e?-1:0,em=e=>1===e?0:-1===e?1:2;function ef(e){var t;let{answers:n}=(0,v.ZP)(e.qids.qid),[i,r]=(0,p.useState)((0,v.Zp)(n,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)),[s,o]=(0,p.useState)(i),[a,c]=(0,p.useState)(!1),d=e.role===y._b.Client;(0,p.useEffect)(()=>{o({...i})},[i]);let h=async e=>{if(d&&!a){let t={...s,jsonValue:{answers:[{key:"vote",stringValue:l[e],numericValue:eg(e)}]}};await x(t)}},x=async t=>{try{c(!0);let n=await e.onAnswer(t);if(null!==n)r(n);else throw"Failed to submit answer"}catch(e){console.error(e)}finally{c(!1)}},g=(0,$.Z)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[(0,u.jsx)(k.Z,{content:e.question}),(0,u.jsxs)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,u.jsxs)(ep.Z,{elevation:0,sx:{p:4,mb:2,width:"60%",height:"70%",alignSelf:"center",minHeight:200,borderRadius:4,background:g.palette.promptPanelBackground.main,display:"flex",flexDirection:"row",alignContent:"center",justifyContent:"stretch"},children:[(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,u.jsx)("div",{style:{position:"absolute",width:"15%",height:"20%",padding:0,margin:0},children:(0,u.jsx)(ex.Z,{sx:{position:"relative",left:"-100%",top:0,width:"100%",height:"100%",m:0,p:0},onClick:()=>h(1),disabled:!d||a,style:{opacity:d&&!a?1:.5},children:(0,u.jsx)("img",{src:"/icons/updown/cross.svg",alt:"False button icon"})})})}),(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center",p:2},children:(0,u.jsx)(I.Z,{variant:"upDownQuestion",sx:{textAlign:"center",alignSelf:"center"},children:e.assertion})}),(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,u.jsx)("div",{style:{position:"absolute",width:"15%",height:"20%",padding:0,margin:0},children:(0,u.jsx)(ex.Z,{sx:{position:"relative",right:0,top:0,width:"100%",height:"100%",m:0,p:0},style:{opacity:d&&!a?1:.5},onClick:()=>h(0),disabled:!d||a,children:(0,u.jsx)("img",{src:"/icons/updown/check.svg",alt:"True button icon"})})})})]}),(0,u.jsx)(w.Z,{sx:{p:2,borderRadius:4,cursor:"pointer",opacity:d&&!a?1:.5,alignSelf:"center"},onClick:()=>h(2),display:"flex",flexDirection:"column",justifyContent:"center",children:(0,u.jsx)(I.Z,{variant:"submitButton",style:{borderBottom:"solid 1px black"},children:"Unsure"})})]})]})})}function ey(e){return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:2,...e.sx},children:e.children})})}function ev(e){let{sx:t,children:n}=e;return(0,u.jsx)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",...t},children:(0,u.jsx)(w.Z,{alignSelf:"center",display:"inline-block",textAlign:"center",children:n})})}function eb(e){let{sx:t,children:n}=e;return(0,u.jsx)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",overflowY:"auto",overflowX:"hidden",display:"block",...t},children:n})}function ew(e){return(0,u.jsx)("img",{className:"stretch",alt:e.alt,style:{width:"100%",height:"100%",...e.style},src:e.src})}function ej(e){let[t,n]=(0,p.useState)(e.sideSx),[i,r]=(0,p.useState)(e.mainSx);return(0,p.useEffect)(()=>{void 0!==e.sideBackgroundImage&&n({backgroundImage:"url(".concat(e.sideBackgroundImage,")"),...e.sideSx}),void 0!==e.mainBackgroundImage&&r({backgroundImage:"url(".concat(e.mainBackgroundImage,")"),...e.mainSx})},[e.sideBackgroundImage,e.mainBackgroundImage,e.sideSx,e.mainSx]),(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"row"},children:[(0,u.jsx)(w.Z,{sx:{width:"35%",display:"block",...e.sideSx},children:e.side}),(0,u.jsx)(w.Z,{sx:{px:2,alignSelf:"stretch",display:"block",overflowY:"auto",width:"60%",...e.mainSx},children:e.main})]})})}var ek=n(11144),eZ=n(67506),eS=n(23447),eC=n(99128),eI=n(96044);function eD(e){let{toServerTime:t,fromServerTime:n}=(0,p.useContext)(eZ.G),{sid:i}=(0,p.useContext)(tq),{api:r,start:s}=(0,p.useContext)(eS.E),{user:o,sessionToken:a,role:l}=(0,p.useContext)(b.rZ),{session:d}=(0,p.useContext)(ek.z),h=(0,p.useRef)(null),{ref:x,inView:g}=(0,eI.YD)({threshold:0}),[m,f]=(0,p.useState)(0),[v,j]=(0,p.useState)(!1),[k,Z]=(0,p.useState)(!1),[S,C]=(0,p.useState)(y.tB.NotStarted),I=(0,p.useRef)(),[D,E]=(0,p.useState)(0),[P,q]=(0,p.useState)(),[A,_]=(0,p.useState)(),[F,B]=(0,p.useState)(-1);(0,p.useEffect)(()=>{null!==h.current&&(h.current.addEventListener("play",e=>{C(y.tB.Playing)}),h.current.addEventListener("pause",e=>{C(y.tB.Paused)}),h.current.addEventListener("ended",e=>{C(y.tB.Ended)}),document.addEventListener("visibilitychange",()=>Z("visible"===document.visibilityState)),Z("visible"===document.visibilityState))},[h]),(0,p.useEffect)(()=>{g?(f(1),T().then(()=>{f(2)}).catch(e=>{console.error(e),f(3)})):R().then(()=>{f(0)}).catch(e=>{console.error(e),f(3)})},[g]),(0,p.useEffect)(()=>{console.debug("Video state: ".concat(c[m])),2===m&&A&&N(A)},[m]);let T=async()=>{if(null===h.current)throw Error("Player not ready");console.debug("Loading video"),h.current.setAttribute("src",e.videoUri),h.current.load()},R=async()=>{if(null===h.current)throw Error("Player not ready");console.debug("Unloading video"),h.current.removeAttribute("src"),h.current.load()};(0,p.useEffect)(()=>{k&&g&&A&&N(A)},[k]);let M=async(n,l)=>{if(null===h.current)throw Error("Player not ready");try{j(!0);let c=h.current.currentTime,d={videoId:e.videoId,modeChange:n,modeChangePosition_s:c,modeChangeServerTime_ms:t(null!=l?l:Date.now())},u=await s(r.postFacilitatorAction(o.access_token,a,{action:"set-video-sync",sessionId:i,parameters:d},!1));console.debug("sync result",u)}catch(e){console.error("sync error",e)}finally{j(!1)}},U=e=>{switch(e){case"restart":h.current.currentTime=0,h.current.pause(),M(y.tB.Paused),L();break;case"back":h.current.currentTime-=15,h.current.pause(),M(y.tB.Paused),L();break;case"play-pause":S===y.tB.Playing?M(y.tB.Paused):M(y.tB.Playing,Date.now()+2e3);break;case"fwd":h.current.currentTime+=15,h.current.pause(),M(y.tB.Paused),L()}};(0,p.useEffect)(()=>{d.liveExperienceState.sequence>F&&(B(d.liveExperienceState.sequence),_(d.liveExperienceState.videoSync.find(t=>t.videoId===e.videoId)))},[d.liveExperienceState]),(0,p.useEffect)(()=>{A&&N(A)},[A]);let N=e=>{if(null===h.current)return;if(void 0!==P&&(clearTimeout(P),q(void 0)),e.modeChange!==y.tB.Playing){W(e);return}let t=n(e.modeChangeServerTime_ms)-Date.now();console.debug("Video sync scheduled for "+t+"ms");let i=t<0?Math.abs(t/1e3):0,r={...e,modeChangePosition_s:e.modeChangePosition_s+i},s=setTimeout(()=>{q(void 0),W(r)},Math.max(0,t));q(s)},W=e=>{if(null===h.current)return;console.debug("Video sync enaction: ".concat(y.tB[e.modeChange]," at ").concat(e.modeChangePosition_s,"s"));let t=Math.min(Math.round((e.modeChangePosition_s+Number.EPSILON)*1e3)/1e3,isFinite(h.current.duration)?h.current.duration:0);console.debug("newPosition",t),console.debug("duration",h.current.duration),h.current.currentTime=t,e.modeChange===y.tB.Playing&&h.current.currentTime<h.current.duration?h.current.play():h.current.pause()};(0,p.useEffect)(()=>{let t={type:Q.M.Media_Playback_Update,data:{videoId:e.videoId,isPlaying:S===y.tB.Playing}};Q.Z.emit(t),L(),void 0!==I.current&&(clearInterval(I.current),I.current=void 0),S===y.tB.Playing&&void 0===I.current&&(I.current=setInterval(()=>{L()},100))},[S,e.videoId]);let L=()=>{null!==h.current&&E(h.current.currentTime/h.current.duration*100)};return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",ref:x,sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"stretch",gap:1,p:0},children:[3!==m&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},children:(0,u.jsxs)(w.Z,{sx:{position:"relative",flexGrow:1},children:[(0,u.jsx)("video",{ref:h,style:{width:"100%",height:"100%",borderRadius:"0.5rem",overflow:"hidden",objectFit:"contain",backgroundColor:"rgba(0,0,0,0.5)"},poster:e.posterUri,preload:"auto",loop:!1,autoPlay:!1,controls:!1,muted:!e.audio,crossOrigin:"anonymous",className:"shadow",playsInline:!0,"webkit-playsinline":"true"}),e.controls&&null!==h.current&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{sx:{position:"absolute",left:"50%",bottom:0},children:(0,u.jsxs)(w.Z,{sx:{position:"relative",left:"-50%",bottom:0,p:1,background:"rgba(255,255,255,0.75)",borderRadius:"0.5rem",alignSelf:"center",display:"flex",flexDirection:"column",gap:1},children:[(0,u.jsx)(eC.Z,{variant:1===m?"indeterminate":"determinate",value:D,color:1===m?"primary":"error"}),(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignSelf:"stretch",justifyContent:"center",gap:1},children:[(0,u.jsx)(V.Z,{variant:"outlined",disabled:2!==m||v,btnKey:"restart",btnText:"Restart",onClick:U}),(0,u.jsx)(V.Z,{variant:"outlined",disabled:2!==m||v,btnKey:"back",btnText:"-15s",onClick:U}),(0,u.jsx)(V.Z,{disabled:2!==m||v,btnKey:"play-pause",variant:S===y.tB.Playing?"outlined":"contained",busy:void 0!==P,btnText:S===y.tB.Playing?"Pause":"Play",onClick:U}),(0,u.jsx)(V.Z,{variant:"outlined",disabled:2!==m||v,btnKey:"fwd",btnText:"+15s",onClick:U})]})]})})})]})})}),3===m&&(0,u.jsx)("p",{children:"Failed to initialise video."})]})})}function eE(e){let t={backgroundImage:"url('".concat(e.src,"')")};return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"block",...t,...e.sx},children:e.children})})}function eP(e){let t={...e.sx,color:e.color};return(0,u.jsx)(I.Z,{variant:e.variant,component:"div",sx:t,align:e.align,children:e.children})}function eq(e){let t=(0,S.Z)(),n=void 0===e.chartBackground||e.chartBackground;return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1,overflowY:"hidden"},children:[e.title&&(0,u.jsx)(eP,{variant:"summaryTitle",sx:{p:0,px:1},align:"left",children:e.title}),e.prompt&&(0,u.jsx)(eP,{variant:"summaryPrompt",sx:{p:0,px:1},align:"left",children:e.prompt}),(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",gap:1,alignItems:"stretch",overflowY:"hidden"},children:e.children.map((e,i)=>(0,u.jsx)(w.Z,{sx:{background:n?t.palette.summaryChartBackground.main:void 0,borderRadius:n?4:void 0,flexGrow:1,flexBasis:0,p:2,display:"block",overflow:"auto"},children:e},"summary-slide-child-".concat(i)))})]})})}function eA(e){return(0,u.jsx)("img",{src:e.src,style:e.style,alt:e.alt})}function e_(e){var t;let{content:n,sx:i}=e;return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",...i},children:[(0,u.jsx)(I.Z,{variant:"slideHeading",children:null!==(t=n.message)&&void 0!==t?t:"Thanks!"}),n.factoid&&(0,u.jsx)(I.Z,{variant:"slideBody",sx:{mt:8},children:n.factoid})]})})}(s=c||(c={}))[s.Unloaded=0]="Unloaded",s[s.Loading=1]="Loading",s[s.Ready=2]="Ready",s[s.Error=3]="Error";var eF=n(12569);let eB=e=>{let t=parseInt(e.replace("#",""),16);return[t>>16&255,t>>8&255,255&t]},eT=(e,t,n,i)=>{let r=eB(n),s=eB(i),o=Math.round(r[0]+(s[0]-r[0])*e/t),a=Math.round(r[1]+(s[1]-r[1])*e/t),l=Math.round(r[2]+(s[2]-r[2])*e/t);return"rgb(".concat(o,",").concat(a,",").concat(l,")")},eR=e=>{let t={};return e.forEach(e=>{var n;null===(n=e.jsonValue)||void 0===n||n.answers.forEach(e=>{var n;let i=e.key,r=null!==(n=e.numericValue)&&void 0!==n?n:0;t.hasOwnProperty(i)||(t[i]=0),t[i]+=r})}),t},eM=(e,t)=>Object.entries(eR(e)).map(e=>{var n,i,r;return{key:e[0],title:null!==(r=null===(n=t.find(t=>t.key===e[0]))||void 0===n?void 0:n.title)&&void 0!==r?r:"",description:null===(i=t.find(t=>t.key===e[0]))||void 0===i?void 0:i.description,value:e[1]}});function eU(e){let{answers:t}=(0,v.ZP)(e.qids.qid),[n,i]=(0,p.useState)([]),[r,s]=(0,p.useState)([]),[o,a]=(0,p.useState)([]),l=(0,S.Z)();return(0,p.useEffect)(()=>{i(null!=t?t:[])},[t]),(0,p.useEffect)(()=>{s(eM(n,e.options))},[n,e.options]),(0,p.useEffect)(()=>{var t;let n=l.palette.secondary.main,i=null!==(t=e.mode)&&void 0!==t?t:"normal",s=r.sort((e,t)=>e.value-t.value);"normal"===i&&(s=s.reverse()),a([...s.map((t,i)=>{var s,o;return{backgroundColor:eT(i,r.length,null!==(s=e.startColour)&&void 0!==s?s:n,null!==(o=e.endColour)&&void 0!==o?o:"#FFFFFF"),textColor:"#000000",option:t}})])},[r,e.startColour,e.endColour,l.palette.secondary.main,e.mode]),(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",flexDirection:"column",display:"flex",gap:1},children:[e.question&&(0,u.jsx)(k.Z,{content:e.question}),(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1,justifyContent:"start"},children:o.map((t,n)=>(0,u.jsx)(w.Z,{sx:{backgroundColor:t.backgroundColor,color:t.textColor,borderRadius:2,display:"flex",flexDirection:"column",p:2},children:(0,u.jsxs)(I.Z,{variant:"orderedListItemTitle",align:"left",children:[n+1,". ",t.option.title]})},"ordered-display-".concat(e.qids.qid,"-option-").concat(t.option.key,"-").concat(n)))})]})})}function eV(e){let t=(0,S.Z)(),n=1===e.headings.filter(e=>e.expanded).length;return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[e.question&&(0,u.jsx)(k.Z,{content:e.question,forceAlign:"left"}),e.headings.map((i,r)=>(0,u.jsxs)(w.Z,{sx:{flexGrow:i.expanded?1:void 0,flexBasis:i.expanded?0:void 0,display:"flex",flexDirection:"row",gap:2,p:2,alignItems:"stretch",backgroundColor:t.palette.summaryChartBackground.main,borderRadius:4},children:[i.expanded&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(w.Z,{sx:{display:"inline-block",borderRadius:2,flexGrow:0,flexShrink:0,flexBasis:n?"50%":"20%",backgroundImage:"url(".concat(i.graphic,")"),backgroundSize:"cover",backgroundPosition:"center",mr:2}}),(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"column",gap:2,alignSelf:"center"},children:[(0,u.jsx)(I.Z,{variant:"sectionHeadingTitle",align:"left",children:i.title}),i.description&&(0,u.jsx)(I.Z,{variant:"sectionHeadingDescription",align:"left",children:i.description})]})]}),!i.expanded&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(I.Z,{variant:"sectionHeadingTitleQuiet",align:"left",children:i.title})})]},"section-heading-".concat(e.uid,"-").concat(r)))]})})}function eN(e){let{answers:t}=(0,v.ZP)(e.qids.qid),n=(0,S.Z)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",overflowX:"hidden",overflowY:"auto"},children:[e.question&&(0,u.jsx)(k.Z,{content:e.question}),(0,u.jsx)(w.Z,{display:"flex",flexDirection:"column",alignItems:"center",children:t.map((t,i)=>{var r;return(0,u.jsx)(u.Fragment,{children:null===(r=t.jsonValue)||void 0===r?void 0:r.answers.map(t=>(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{sx:{mb:4,px:2,mx:8},className:"shadow",style:{background:"white",border:"solid 2px",borderColor:i%2==0?n.palette.primary.main:n.palette.secondary.main,borderRadius:12,transform:"rotate(".concat(i%2==0?1.5:-1.5,"deg)")},children:(0,u.jsx)(I.Z,{variant:"slideBody",children:t.stringValue})},"speech-bubble-".concat(e.qids.qid,"-").concat(t.key))}))})})})]})})}var eW=n(73391);let eL=(e,t)=>{if(!e||0===e.length)return[];let n=new Map;return e.forEach(e=>{var t;null===(t=e.jsonValue)||void 0===t||t.answers.forEach(e=>{var t;let i=e.key,r=null!==(t=e.numericValue)&&void 0!==t?t:0;n.has(i)||n.set(i,0),n.set(i,n.get(i)+r)})}),Array.from(n.entries()).sort((e,t)=>e[1]-t[1]).reverse().slice(0,t).map(e=>({key:e[0],count:e[1]}))},eO=(e,t)=>e&&0!==e.length?t&&0!==t.length?e.map(n=>{let i=t.find(e=>e.key===n.key);if(!i){console.warn("No description found for option: ".concat(n.key),e,t);return}return{key:n.key,title:i.title,description:i.description,graphic:i.graphic,count:n.count}}).filter(e=>!!e).map(e=>e):(console.warn("No described options available"),[]):[];function ez(e){let{answers:t}=(0,v.ZP)(e.qids.qid),[n,i]=(0,p.useState)([]),[r,s]=(0,p.useState)([]);(0,p.useEffect)(()=>{i(eL(t,e.displayCount))},[t,e.displayCount]),(0,p.useEffect)(()=>{s(eO(n,e.options))},[n,e.options]);let o=(0,S.Z)();return(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[e.question&&(0,u.jsx)(k.Z,{content:e.question}),(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"row",alignItems:"stretch",justifyContent:"stretch",gap:1},children:r.map((t,n)=>(0,u.jsxs)(w.Z,{sx:{flexGrow:1,flexBasis:0,p:2,borderRadius:2,background:o.palette.summaryChartBackground.main,display:"flex",flexDirection:"column",gap:1,mt:2*n},children:[(0,u.jsx)(I.Z,{variant:"topOptionsOptionRank",align:"left",children:(0,eW.q)(n+1)}),(0,u.jsxs)(I.Z,{variant:"topOptionsOptionPoints",align:"left",children:["Total points: ",t.count]}),(0,u.jsx)(w.Z,{sx:{width:"10%",height:0,border:"4px solid black",borderRadius:"4px",mt:1,mb:3}}),(0,u.jsx)(I.Z,{variant:"topOptionsOptionTitle",align:"left",children:t.title}),void 0!==t.graphic&&(0,u.jsx)(w.Z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"end"},children:(0,u.jsx)(w.Z,{sx:{maxHeight:"20vh",height:"20vh",backgroundImage:"url(".concat(t.graphic,")"),backgroundSize:"cover",backgroundPosition:"center",borderRadius:2}})},"".concat(e.qids.qid,"-top-option-").concat(n,"-graphic-").concat(t.key))]},"".concat(e.qids.qid,"-top-option-").concat(n,"-description-").concat(t.key)))})]})}function eG(e){let t=(0,S.Z)();return(0,u.jsxs)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,u.jsxs)(w.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2,gap:1},children:[(0,u.jsx)("img",{src:"/icons/updown/qmark.svg",alt:"Disagree icon",style:{width:"auto",height:"2rem"}}),(0,u.jsx)(eP,{variant:"upDownCategory",children:"These statements split the room..."})]}),e.mostDivisive.map((e,n)=>(0,u.jsx)(eP,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDivided.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]}),(0,u.jsxs)(w.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2,gap:1},children:[(0,u.jsx)("img",{src:"/icons/updown/check.svg",alt:"Disagree icon",style:{width:"auto",height:"2rem"}}),(0,u.jsx)(eP,{variant:"upDownCategory",children:"Most people agreed with..."})]}),e.mostlySupported.map((e,n)=>(0,u.jsx)(eP,{variant:"upDownQuestion",sx:{background:t.palette.backgroundAgree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]}),(0,u.jsxs)(w.Z,{sx:{background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2,gap:1},children:[(0,u.jsx)("img",{src:"/icons/updown/cross.svg",alt:"Disagree icon",style:{width:"auto",height:"2rem"}}),(0,u.jsx)(eP,{variant:"upDownCategory",children:"Most people disagreed with..."})]}),e.mostlyOpposed.map((e,n)=>(0,u.jsx)(eP,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDisagree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})]})}function eK(e){let t=(0,S.Z)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(w.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:(0,u.jsxs)(C.ZP,{container:!0,flexGrow:1,children:[(0,u.jsx)(C.ZP,{item:!0,xs:12,sx:{pb:1},children:(0,u.jsxs)(w.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2,gap:1},children:[(0,u.jsx)("img",{src:"/icons/updown/qmark.svg",alt:"Disagree icon",style:{width:"auto",height:"2rem"}}),(0,u.jsx)(eP,{variant:"upDownCategory",children:"These statements split the room..."})]}),e.mostDivisive.map((e,n)=>(0,u.jsx)(eP,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDivided.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})}),(0,u.jsx)(C.ZP,{item:!0,xs:6,sx:{pr:1},children:(0,u.jsxs)(w.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2,gap:1},children:[(0,u.jsx)("img",{src:"/icons/updown/check.svg",alt:"Disagree icon",style:{width:"auto",height:"2rem"}}),(0,u.jsx)(eP,{variant:"upDownCategory",children:"Most people agreed with..."})]}),e.mostlySupported.map((e,n)=>(0,u.jsx)(eP,{variant:"upDownQuestion",sx:{background:t.palette.backgroundAgree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})}),(0,u.jsx)(C.ZP,{item:!0,xs:6,sx:{p:0},children:(0,u.jsxs)(w.Z,{sx:{height:"100%",width:"100%",background:t.palette.summaryChartBackground.main,borderRadius:4,display:"flex",flexDirection:"column",alignItems:"stretch",overflowX:"hidden",overflowY:"auto"},children:[(0,u.jsxs)(w.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mx:2,gap:1},children:[(0,u.jsx)("img",{src:"/icons/updown/cross.svg",alt:"Disagree icon",style:{width:"auto",height:"2rem"}}),(0,u.jsx)(eP,{variant:"upDownCategory",children:"Most people disagreed with..."})]}),e.mostlyOpposed.map((e,n)=>(0,u.jsx)(eP,{variant:"upDownQuestion",sx:{background:t.palette.backgroundDisagree.main,borderRadius:2,mx:2,p:2,mb:1,textAlign:"start"},children:e.assertion},"summary-updown-supported-".concat(n,"-qid-").concat(e.qid,"-entry")))]})})]})})})}function eH(e){let{allAnswers:t}=(0,v.ZP)(),[n,i]=(0,p.useState)([]),[r,s]=(0,p.useState)([]),[o,a]=(0,p.useState)([]),[c,d]=(0,p.useState)([]);return(0,p.useEffect)(()=>{let n=[],r=[],o=[],c=[];Object.entries(t).forEach(t=>{let[i,s]=t;if(void 0!==Object.keys(e.questions).find(e=>e===i)){let t=s.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&em(e.jsonValue.answers[0].numericValue)===l.Yes}).length,a=s.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&em(e.jsonValue.answers[0].numericValue)===l.No}).length,d=s.filter(e=>{var t,n;return(null===(n=e.jsonValue)||void 0===n?void 0:null===(t=n.answers[0])||void 0===t?void 0:t.numericValue)!==void 0&&em(e.jsonValue.answers[0].numericValue)===l.Unsure}).length,u=e.questions[i].assertion,h={qid:i,assertion:u,yes:t,no:a,unsure:d},p=t+a;p>0?t>=2*p/3?n=[...n,h]:a>=2*p/3?r=[...r,h]:o=[...o,h]:c=[...c,h]}}),s(n),a(r),i(o),d(c)},[t,e.questions]),(0,u.jsxs)(u.Fragment,{children:["tshape"===e.layout&&(0,u.jsx)(eK,{mostDivisive:n,mostlySupported:r,mostlyOpposed:o,unanswered:c}),"column"===e.layout&&(0,u.jsx)(eG,{mostDivisive:n,mostlySupported:r,mostlyOpposed:o,unanswered:c})]})}var eY=n(30089);let eQ=e=>({replace:(t,n)=>eX(t,e)}),eX=(e,t)=>{if(e instanceof h.W_&&e.attribs){var n;let i;switch(e.tagName.toLowerCase()){case"sidebarlayout":i=tg(e,t);break;case"fullpagescrollinglayout":i=tm(e,t);break;case"fullpagecentredlayout":i=tf(e,t);break;case"columnlayout":i=ty(e,t);break;case"slidebackgroundimage":i=tv(e,t);break;case"imageslide":i=th(e,t);break;case"videoslide":i=e2(e,t);break;case"summaryslidelayout":i=e5(e,t);break;case"sectionheading":i=tw(e,t);break;case"slidetext":i=tj(e,t);break;case"slideimage":case"img":i=tk(e,t);break;case"inputorcompletion":i=tp(e,t);break;case"inputsequence":i=tx(e,t);break;case"sliderinput":i=e4(e,t);break;case"textinput":i=e7(e,t);break;case"demographicinput":i=tn(e,t);break;case"updownvoteinput":i=ti(e,t);break;case"closedchoiceinput":i=tr(e,t);break;case"pointsallocationinput":i=ts(e,t);break;case"multisliderinput":i=to(e,t);break;case"acknowledgementinput":i=ta(e,t);break;case"rankedlistinput":i=tl(e,t);break;case"consentinput":i=tc(e,t);break;case"completion":i=tb(e,t);break;case"speechbubbles":i=e9(e,t);break;case"selectiongraph":i=e3(e,t);break;case"updownvoteresults":i=e6(e,t);break;case"topoptions":i=td(e,t);break;case"orderedlist":i=tu(e,t);break;default:return e}return null!==(n=(0,eY.te)(i,t.keyPrefix))&&void 0!==n?n:i}},eJ=(e,t)=>{let n=e.children.map((e,n)=>eQ(t).replace(e,n)).filter(e=>null!=e&&!1!==e).map(e=>e instanceof h.W_?(0,h.du)([e],eQ(t)):e);return p.Children.toArray(n)},e$=(e,t)=>{let n=[];for(let i of e.children.filter(e=>e instanceof h.W_).map(e=>e))void 0!==i.attribs.qid?n.push(e0(t,i)):n=[...n,...e$(i,t)];return n},e0=(e,t)=>{let n=t.attribs.qid;if(void 0===n)throw console.error("Question id not found for element",t),"Question id not found for element";return{sid:e.sessionId,pid:e.deviceId,qid:n}},e1=e=>{var t,n;let i=e.attribs.instruction,r=null!==(n=null!==(t=e.attribs.question)&&void 0!==t?t:e.attribs.statement)&&void 0!==n?n:e.attribs.prompt,s=e.attribs.explanation,o=(0,f.gx)(e.attribs.pii);return i||r||s||void 0!==o?{instruction:i,question:r,explanation:s,pii:o}:void 0},e2=(e,t)=>{console.debug("Enriching VideoSlide tag as VideoSlide...",e);let n=e.attribs.id,i=e.attribs.videouri,r=e.attribs.posteruri,s=t.role===y._b.Controller,o=t.role===y._b.Controller||t.remoteMedia;return(0,u.jsx)(eD,{videoId:n,controls:s,audio:o,videoUri:i,posterUri:r})},e5=(e,t)=>{console.debug("Enriching SummarySlideLayout tag as SummarySlideLayout...",e);let n=e.attribs.title,i=e.attribs.prompt,r=void 0!==e.attribs.chartbackground?(0,f.gx)(e.attribs.chartbackground):void 0,s=eJ(e,t);return(0,u.jsx)(eq,{title:n,prompt:i,chartBackground:r,children:s})},e4=(e,t)=>{var n;console.debug("Enriching SliderInput tag as SliderInput...",e);let i=e0(t,e),r=e1(e),s=(0,eY.av)(e.attribs.type),o=s===eu.Q.categorical?(0,eY.kh)(e.attribs.marks):void 0,a=s!==eu.Q.categorical?null===(n=(0,eY.kh)(e.attribs.range))||void 0===n?void 0:n.map(e=>(0,eY.f_)(e.trim())):void 0,l=s!==eu.Q.categorical?(0,eY.f_)(e.attribs.step):void 0;return(0,u.jsx)(eu.Z,{qids:i,role:t.role,type:s,marks:o,numericRange:a,numericStep:l,question:r,onAnswer:t.onAnswer})},e3=(e,t)=>{var n;console.debug("Enriching SelectionGraph tag as AnswerGraphMuiChart...",e);let i=e0(t,e),r=e1(e),s=(0,eY.yg)(e.attribs.orientation),o=(0,eY.ot)(e.attribs.type),a=null===(n=(0,eY.kh)(e.attribs.range))||void 0===n?void 0:n.map(e=>g().toNumber(e.trim())),l=(0,eY.tL)((0,eY.kh)(e.attribs.categories));if(i&&void 0!==o)return(0,u.jsx)(eF.Z,{role:t.role,qids:i,question:r,inputType:o,orientation:s,categories:l,range:a?{lo:a[0],hi:a[1],step:a[2]}:void 0});throw console.error("SelectionGraph without qIds, type, or range",e.attribs),"SelectionGraph without qIds, type, or range"},e6=(e,t)=>{console.debug("Enriching UpDownVoteResults tag as UpDownVoteResults...",e);let n=e.attribs.layout,i={};for(let t of e.children)if(t instanceof h.W_&&"result"===t.tagName){let e=t.attribs.qid,n=t.attribs.assertion;void 0!==e&&(i[e]={assertion:n})}return(0,u.jsx)(eH,{questions:i,layout:n})},e9=(e,t)=>{console.debug("Enriching SpeechBubbles tag as SpeechBubbles (with children)...",e);let n=e0(t,e),i=e1(e);return(0,u.jsx)(eN,{qids:n,question:i})},e7=(e,t)=>{var n;let i;console.debug("Enriching TextInput tag as TextInput...",e);let r=e0(t,e),s=e1(e),o=(0,eY.H7)(e.attribs.type),a=e.attribs.label,l=e.attribs.help,c=e.attribs.submittext,d=e.attribs.skiptext,p=g().parseInt(e.attribs.mincheckboxes),x=(0,f.gx)(null!==(n=e.attribs.textrequired)&&void 0!==n?n:"true"),m=[];for(let t of e.childNodes)if(t instanceof h.W_&&"information"===t.tagName&&(i={heading:t.attribs.heading,body:t.children}),t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.text,i=(0,f.gx)(t.attribs.required);m.push({key:e,text:n,initial:!1,required:i,checked:!1})}if(void 0===s||void 0===s.pii)throw"pii not defined for TextInput";return(0,u.jsx)(eh.Z,{qids:r,role:t.role,type:o,label:a,help:l,textRequired:x,minCheckboxes:p,information:i,onAnswer:t.onAnswer,checkboxes:m,question:s,submitText:c,skipText:d})},e8=e=>{let t=[];for(let n of e)if(n instanceof h.W_&&"demographicinputtype"===n.tagName){let e=n.attribs.key,i=n.attribs.label,r=n.attribs.layout,s=n.attribs.mode,o=n.attribs.textplaceholder,a=n.attribs.textvalidationregex,l=(0,f.LC)(n.attribs.columns);if(e&&i&&s){let c=te(n.children);t.push({key:e,label:i,layout:r,layoutProps:void 0!==l?{columns:l}:void 0,groups:c,mode:s,textPlaceholder:o,textValidationRegex:a})}else throw console.warn("DemographicInputType without key, label, layout, or mode",n),"DemographicInput child without key, label, layout, or mode"}return t},te=e=>{let t=[];for(let n of e)if(n instanceof h.W_&&"demographicgroup"===n.tagName){let e=n.attribs.label;if(e){let i=tt(n.children);t.push({label:e,choices:i})}else throw console.warn("DemographicGroup without label",n),"DemographicGroup without label"}return t},tt=e=>{let t=[];for(let n of e)if(n instanceof h.W_&&"demographic"===n.tagName){let e=n.attribs.display,i=n.attribs.value;if(e&&i)t.push({display:e,key:i});else throw console.warn("Demographic without display or value",n),"Demographic without display or value"}return t},tn=(e,t)=>{console.debug("Enriching DemographicInput tag as DemographicInput...",e);let n=e0(t,e),i=e1(e),r=(0,f.gx)(e.attribs.showage),s=(0,f.gx)(e.attribs.showgender),o=(0,f.gx)(e.attribs.showethnicity),a=e.attribs.showpostcode,l=e8(e.children);return(0,u.jsx)(Y,{role:t.role,qids:n,onAnswer:t.onAnswer,question:i,showAge:r,showGender:s,showEthnicity:o,showPostcode:a,customDemographics:l})},ti=(e,t)=>{console.debug("Enriching UpDownVoteInput tag as UpDownVoteInput...",e);let n=e0(t,e),i=e1(e),r=e.attribs.assertion;return(0,u.jsx)(ef,{qids:n,role:t.role,question:i,assertion:r,onAnswer:t.onAnswer})},tr=(e,t)=>{console.debug("Enriching ClosedChoiceInput tag as ClosedChoiceInput...",e);let n=e0(t,e),i=e1(e),r=parseInt(e.attribs.minselections),s=parseInt(e.attribs.maxselections),o=e.attribs.layout,a=e.attribs.layoutparams,l=a?(0,eY.kh)(a):[],c=[],d=(0,f.gx)(e.attribs.shuffle);for(let t of e.children)if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.value,n=t.attribs.display,i=t.attribs.graphic,r=(0,f.gx)(t.attribs.isalt);e&&n&&c.push({key:e,display:n,graphic:i,isAlt:r})}return(0,u.jsx)(B,{qids:n,role:t.role,question:i,options:c,shuffle:d,onAnswer:t.onAnswer,layout:o,layoutParams:l,minSelections:r,maxSelections:s,contentStore:t.contentStore})},ts=(e,t)=>{console.debug("Enriching PointsAllocationInput tag as PointsAllocationInput...",e);let n=e0(t,e),i=e1(e),r=parseInt(e.attribs.points),s=[];for(let t of e.children)if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.title,n=t.attribs.description,i=t.attribs.key,r=parseInt(t.attribs.min),o=parseInt(t.attribs.max),a=t.attribs.graphic;if(e&&n&&i&&void 0!==r&&void 0!==o)s.push({title:e,description:n,key:i,min:r,max:o,graphic:a});else throw"PointsAllocationInput Option without title, description, key, min, or max"}return(0,u.jsx)(er,{qids:n,question:i,points:r,options:s,onAnswer:t.onAnswer})},to=(e,t)=>{console.debug("Enriching MultiSliderInput tag as MultiSliderInput...",e);let n=e0(t,e),i=e1(e),r=parseInt(e.attribs.min),s=parseInt(e.attribs.max),o=[],a=[],l=(0,f.gx)(e.attribs.showdescriptions);for(let t of e.children)if(t instanceof h.W_&&"label"===t.tagName){let e=parseFloat(t.attribs.at),n=t.attribs.text;void 0!==e&&n&&o.push({at:e,text:n})}else if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;e&&n&&a.push({key:e,title:n,description:i})}return(0,u.jsx)(en,{qids:n,question:i,min:r,max:s,labels:o,options:a,showDescriptions:l,role:t.role,onAnswer:t.onAnswer})},ta=(e,t)=>{console.debug("Enriching AcknowledgementInput tag as AcknowledgementInput...",e);let n=e0(t,e),i=e1(e),r=e.attribs.align,s=[];for(let t of e.children)if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.text,n=t.attribs.key,i=t.attribs.variant,r=t.attribs.colour;e&&n&&s.push({text:e,key:n,variant:i,colour:r})}return(0,u.jsx)(Z,{qids:n,question:i,options:s,align:r,onAnswer:t.onAnswer})},tl=(e,t)=>{console.debug("Enriching RankedListInput tag as RankedListInput...",e);let n=e0(t,e),i=e1(e),r=[],s=(0,f.gx)(e.attribs.shuffle),o=0;for(let t of e.children)if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;n&&r.push({key:e,title:n,description:i,startingIndex:o++})}return(0,u.jsx)(ed,{qids:n,question:i,options:r,shuffle:s,onAnswer:t.onAnswer})},tc=(e,t)=>{console.debug("Enriching ConsentInput tag as ConsentInput...",e);let n=e0(t,e),i=e1(e),r=e.attribs.consenttext;return(0,u.jsx)(N,{qids:n,question:i,consentText:r,onAnswer:t.onAnswer,content:e.children})},td=(e,t)=>{console.debug("Enriching TopOptions tag as TopOptionsSummary...",e);let n=e0(t,e),i=e1(e),r=parseInt(e.attribs.count),s=[];for(let t of e.children)if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description,r=t.attribs.graphic;e&&n&&i&&s.push({key:e,title:n,description:i,graphic:r})}return(0,u.jsx)(ez,{qids:n,question:i,options:s,displayCount:r})},tu=(e,t)=>{console.debug("Enriching OrderedList tag as OrderedListDisplay...",e);let n=e0(t,e),i=e1(e),r=e.attribs.startcolour,s=e.attribs.endcolour,o=e.attribs.mode,a=[];for(let t of e.children)if(t instanceof h.W_&&"option"===t.tagName){let e=t.attribs.key,n=t.attribs.title,i=t.attribs.description;if(e&&n)a.push({key:e,title:n,description:i});else throw console.warn("OrderedList option without key or title",t),"OrderedList option without key or title"}return(0,u.jsx)(eU,{qids:n,question:i,options:a,role:t.role,startColour:r,endColour:s,mode:o})},th=(e,t)=>{console.debug("Enriching ImageSlide tag as ImageSlide...",e);let n=e.attribs.src,i=(0,eY.Cc)(e.attribs.style);return(0,u.jsx)(ew,{style:i,src:n})},tp=(e,t)=>{let n=eJ(e,t);console.debug("Enriching InputOrCompletion tag as InputOrCompletion (with children)...",n);let i=e0(t,e);return(0,u.jsx)(X,{qids:i,input:n[0],completion:n[1]})},tx=(e,t)=>{let n=eJ(e,t);console.debug("Enriching InputSequence tag as InputSequence (with children)...",n);let i=[];for(let e=0;e<n.length-1;e++)i.push(n[e]);let r=n[n.length-1],s=e1(e),o=(0,f.gx)(e.attribs.showprogress),a=e$(e,t);return(0,u.jsx)(ee,{question:s,showProgress:o,qids:a,inputs:i,completion:r,role:t.role})},tg=(e,t)=>{console.debug("Enriching SideBarLayout tag as SideBarLayout (with children)...",e);let n=eJ(e,t),i=(0,eY.if)(e.attribs.sidestyle),r=(0,eY.if)(e.attribs.mainstyle),s=e.attribs.sidebackgroundimage,o=e.attribs.mainbackgroundimage;return(0,u.jsx)(ej,{side:n[0],sideSx:i,main:n[1],mainSx:r,sideBackgroundImage:s,mainBackgroundImage:o,contentStore:t.contentStore})},tm=(e,t)=>{console.debug("Enriching FullPageScrollingLayout tag as FullPageScrollingLayout (with children)...",e);let n=(0,eY.if)(e.attribs.sx),i=eJ(e,t);return(0,u.jsx)(eb,{sx:n,children:i})},tf=(e,t)=>{console.debug("Enriching FullPageCentredLayout tag as FullPageCentredLayout (with children)...",e);let n=(0,eY.if)(e.attribs.sx),i=eJ(e,t);return(0,u.jsx)(ev,{sx:n,children:i})},ty=(e,t)=>{console.debug("Enriching ColumnLayout tag as ColumnLayout (with children)...",e);let n=(0,eY.if)(e.attribs.sx),i=eJ(e,t);return(0,u.jsx)(ey,{sx:n,children:i})},tv=(e,t)=>{console.debug("Enriching SlideBackgroundImage tag as SlideBackgroundImage (with children)...",e);let n=eJ(e,t),i=e.attribs.src,r=(0,eY.if)(e.attribs.sx);return(0,u.jsx)(eE,{src:i,sx:r,children:n})},tb=(e,t)=>{console.debug("Enriching Completion tag as CompletionDisplay (with children)...",e);let n=e.attribs.message,i=e.attribs.factoid,r=(0,eY.if)(e.attribs.sx);return(0,u.jsx)(e_,{content:{message:n,factoid:i},sx:r})},tw=(e,t)=>{console.debug("Enriching SectionHeading tag as SectionHeading...",e);let n=(0,m.Z)(),i=e1(e),r=[];for(let t of e.children)if(t instanceof h.W_&&"heading"===t.tagName){let e=t.attribs.title,n=t.attribs.description,i=t.attribs.graphic,s=(0,f.gx)(t.attribs.expanded);if(e)r.push({title:e,description:n,graphic:i,expanded:s});else throw console.warn("SectionHeading without title",t),"SectionHeading without title"}return(0,u.jsx)(eV,{question:i,headings:r,uid:n})},tj=(e,t)=>{console.debug("Enriching SlideText tag as SlideText (with children)...",e);let n=eJ(e,t),i=(0,eY.if)(e.attribs.sx),r=e.attribs.color,s=e.attribs.align,o=e.attribs.variant;return(0,u.jsx)(eP,{variant:o,sx:i,color:r,align:s,children:n})},tk=(e,t)=>{console.debug("Enriching ImageSlide tag as ImageSlide...",e);let n=e.attribs.src,i=(0,eY.Cc)(e.attribs.style);return(0,u.jsx)(eA,{src:n,style:i})},tZ=["src","graphic","videoUri","posterUri","sideBackgroundImage","mainBackgroundImage","data-background-image"],tS=["style","sideStyle","mainStyle"];class tC{getAsSectionTags(e,t){let n=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("section"),i=[];console.debug("Module ".concat(t," contains ").concat(n.length," sections."));for(let e=0;e<n.length;e++){let r=n.item(e);r&&r.setAttribute("key","module-".concat(t,"-section-").concat(e));let s=new XMLSerializer().serializeToString(r);i.push(s)}return g().join(i,"\n")}reset(){this.progressData={overall:{completed:0,total:0},bars:{}},this.sendUpdate()}updateProgress(e,t,n){this.progressData.bars[e]={completed:t,total:n},this.progressData.overall.completed=g().sum(Object.entries(this.progressData.bars).map(e=>e[1].completed)),this.progressData.overall.total=g().sum(Object.entries(this.progressData.bars).map(e=>e[1].total)),this.sendUpdate()}sendUpdate(){var e;null===(e=this.onUpdate)||void 0===e||e.call(this,{overall:this.progressData.overall,bars:{}})}findAllReplacements(e,t){void 0===e&&(e=this.dom.documentElement),t=this.appendNodeReplacements(e,t);for(let n=0;n<e.childNodes.length;n++)t=this.findAllReplacements(e.childNodes[n],t);return t}appendNodeReplacements(e,t){let n=[...t];if(e.nodeType===Node.ELEMENT_NODE){for(let t of tZ)if(e.hasAttribute(t)){let i=e.getAttribute(t);if(void 0===n.find(e=>e.key===i)){let e=async()=>{try{return await this.zcs.getAsUrl(i,(e,t,n)=>{this.updateProgress(e,t,n)})}catch(e){throw console.error("Error fetching ".concat(t,": ").concat(i),e),e}},r={key:i,getUrlPromise:e,targets:[],attempts:0};n.push(r)}n.find(e=>e.key===i).targets.push({element:e,attribute:t})}for(let t of tS)if(e.hasAttribute(t)){let i=e.getAttribute(t);if(i.includes("url(")){let r=i.match(/url\(([^)]+)\)/)[1];if(r=g().trim(r,"\"' ()"),void 0===n.find(e=>e.key===r)){let e=async()=>{try{return await this.zcs.getAsUrl(r,(e,t,n)=>{this.updateProgress(e,t,n)})}catch(e){throw console.error("Error fetching ".concat(t,": ").concat(r),e),e}},i={key:r,getUrlPromise:e,targets:[],attempts:0};n.push(i)}n.find(e=>e.key===r).targets.push({element:e,attribute:t})}}}return n}async replaceAllReplacements(e){do{let t=e.filter(e=>this.shouldTryAgain(e)),n=await Promise.all(t.map(e=>this.replace(e)));if(n.some(e=>!e.succeeded)){let e=n.filter(e=>!1===e.succeeded);console.warn("".concat(e.length," failed replacements"),e),await new Promise(e=>setTimeout(e,1e3))}}while(e.some(e=>this.shouldTryAgain(e)));if(e.some(e=>!1===e.succeeded)){let t=e.filter(e=>!1===e.succeeded);console.error("".concat(t.length," replacements failed"),t)}return new XMLSerializer().serializeToString(this.dom)}async replace(e){try{e.attempts++;let t=await e.getUrlPromise();for(let n of e.targets){let i=n.element.getAttribute(n.attribute),r=null==i?void 0:i.replace(e.key,t);n.element.setAttribute(n.attribute,r)}e.succeeded=!0}catch(t){console.warn("Error fetching ".concat(e.key),t),e.succeeded=!1,e.error=t}finally{return e}}shouldTryAgain(e){return!0!==e.succeeded&&e.attempts<3}constructor(e,t,n){this.source=e,this.zcs=t,this.onUpdate=n,this.progressData={overall:{completed:0,total:0},bars:{}},this.dom=new DOMParser().parseFromString(e,"text/xml"),this.reset()}}class tI{async init(){if(this.initialised)return;this.storageAvailable=void 0!==window&&void 0!==window.navigator&&void 0!==window.navigator.storage,this.persistAvailable=this.storageAvailable&&void 0!==window.navigator.storage.persist,this.mayPersist=this.storageAvailable&&void 0!==window.navigator.storage.persist&&await window.navigator.storage.persist(),this.retrieveAvailable=this.storageAvailable&&void 0!==window.navigator.storage.getDirectory,this.estimateAvailable=this.storageAvailable&&void 0!==window.navigator.storage.estimate;let e=[["Workshop dir",this.workshopDir],["Storage Available",this.storageAvailable],["Persist Available",this.persistAvailable],["Retrieve available",this.retrieveAvailable],["Estimate available",this.estimateAvailable],["May Persist",this.mayPersist]];if(this.estimateAvailable){let t=await navigator.storage.estimate();e.push(["Quota",t.quota]),e.push(["Usage",t.usage])}else e.push(["Quota","N/K"]),e.push(["Usage","N/K"]);console.table(e),this.initialised=!0}async getAsUrl(e,t){if(!this.initialised)throw"Not initialised";if(e.startsWith("blob:"))return console.debug("getAsUrl","blob: url requested - passing back the same url."),e;let n=await this.getAsEntry(e,t);try{return URL.createObjectURL(n.content)}catch(t){return console.warn("getAsUrl","Unable to create blob URL for: ".concat(e),t),n.sourceUrl}}async getAsEntry(e,t){if(!this.initialised)throw"Not initialised";if(e.startsWith("blob:")){let n=e.substring(5);return await this.getAsEntry(n,t)}let n=this.forceFetch?null:await this.getCacheData(e);if(this.forceFetch&&console.debug("getAsEntry","cache skip for: ".concat(e)),null!==n&&(void 0===n.content||0===n.content.size)&&(n=null),console.debug("getAsEntry","Cache ".concat(null===n?"miss for":"hit for",": ").concat(e)),null===n){try{n=await this.fetchContent({key:e},t)}catch(t){throw console.error("getAsEntry","Unable to fetch data for: ".concat(e),t),t}try{void 0!==n.content&&n.content.size>0?(console.debug("getAsEntry","Cacheing ".concat(n.content.size," bytes of data for: ").concat(e),n),await this.storeCacheData(n)):(void 0===n.content&&console.warn("getAsEntry","Content for ".concat(e," is undefined.")),void 0!==n.content&&0===n.content.size&&console.warn("getAsEntry","Content for ".concat(e," has 0 bytes.")))}catch(t){console.warn("getAsEntry","Unable to cache the data for: ".concat(e),t)}}return n}async storeCacheData(e){if(this.persistAvailable){var t;let n=e.key.split("/").slice(-1)[0],i=new Date;e.created=null!==(t=e.created)&&void 0!==t?t:i,e.updated=i;let r=await window.navigator.storage.getDirectory(),s=await r.getDirectoryHandle("workshops",{create:!0}),o=await s.getDirectoryHandle(this.workshopDir,{create:!0}),a=await o.getDirectoryHandle("content",{create:!0}),l=await a.getFileHandle(n,{create:!0}),c=await l.createWritable();try{await c.write(e.content)}catch(e){throw console.warn("storeCacheData","error writing to cache",e),e}finally{await c.close(),console.debug("storeCacheData","content stored",e.key)}}}async getCacheData(e){if(!this.retrieveAvailable)return null;try{let t=e.split("/").slice(-1)[0],n=await window.navigator.storage.getDirectory(),i=await n.getDirectoryHandle("workshops",{create:!0}),r=await i.getDirectoryHandle(this.workshopDir,{create:!0}),s=await r.getDirectoryHandle("content",{create:!0}),o=await s.getFileHandle(t),a=await o.getFile();return{key:e,content:a}}catch(e){return console.warn("getCacheData - error encountered, this is a cache miss",e),null}}async fetchContent(e,t){return(await this.fetchContents([e],t))[0]}async fetchContents(e,t){let n=await this.getAccessUrls(e.map(e=>this.fixKeyForS3(e.key))),i=e.map(e=>({key:e.key,url:n.objectKeysToAccessUrls[this.fixKeyForS3(e.key)]}));console.debug("fetchContents","Fetched keysToUrls",i);let r=i.map(e=>this.download(e,t));console.debug("fetchContents","Fetching ".concat(r.length," content items..."));let s=await Promise.all(r);return console.debug("fetchContents","fetch contents complete",s),s}async download(e,t){let n=0;do{try{var i;let n=await fetch(e.url);if(null===n.body)throw"No content found in response for: ".concat(e.key,", at: ").concat(e.url);let r=n.headers.get("Content-Length");if(null===r)throw"Content-Length not found in response for: ".concat(e.key,", at: ").concat(e.url);let s=null!==(i=n.headers.get("Content-Type"))&&void 0!==i?i:void 0;if(void 0===s)throw"Content-Type not found in response for: ".concat(e.key,", at: ").concat(e.url);console.debug("download","".concat(e.key," content-type: ").concat(s));let o=n.body.getReader(),a=Number.parseInt(r);void 0!==t&&t(e.key,0,a);let l=[],c=0;for(;;){let{done:n,value:i}=await o.read();if(n)break;l.push(i),c+=i.length,void 0!==t&&t(e.key,c,a)}let d=new Uint8Array(c),u=0;for(let e of l)d.set(e,u),u+=e.length;return{content:new Blob(l,{type:s}),sourceUrl:e.url,key:e.key}}catch(t){console.warn("download","Error fetching: ".concat(e.key,", attempt: ").concat(n),t),await new Promise(e=>setTimeout(e,1e3))}n++}while(n<3);throw"Failed to fetch: ".concat(e.key)}async getAccessUrls(e){let t={objectKeys:e.filter(e=>this.isKeyForS3(e))},n=e.filter(e=>!this.isKeyForS3(e));console.debug("getAccessUrls","requests to s3 for:",t);let i=await this.start(this.api.postWorkshopContentAccessRequest(this.session.id,this.sessionToken,t));return n.forEach(e=>i.objectKeysToAccessUrls[e]=e),i}fixKeyForS3(e){if(this.isKeyForS3(e)){e=g().trim(e,"/");let t="workshops/".concat(this.workshopDir,"/");e.startsWith(t)||(e="".concat(t).concat(e))}return e}isKeyForS3(e){return!e.startsWith("https://")&&!e.startsWith("http://")}constructor(e,t,n,i,r,s){this.api=e,this.start=t,this.session=n,this.sessionToken=i;let o=r.split("/").slice(-2)[0];this.workshopDir=o,this.forceFetch=s,this.initialised=!1,this.storageAvailable=!1,this.persistAvailable=!1,this.mayPersist=!1,this.retrieveAvailable=!1,this.estimateAvailable=!1}}(o=d||(d={}))[o.Init=0]="Init",o[o.RetrievingRawSlides=1]="RetrievingRawSlides",o[o.RawSlidesError=2]="RawSlidesError",o[o.EnrichingSlides=3]="EnrichingSlides",o[o.EnrichmentError=4]="EnrichmentError",o[o.InflatingSlides=5]="InflatingSlides",o[o.InflationError=6]="InflationError",o[o.Ready=7]="Ready";let tD=[0,1],tE=[2,4,6],tP=[3,5],tq=(0,p.createContext)({});function tA(e){let{api:t,start:n}=(0,p.useContext)(eS.E),{session:i}=(0,p.useContext)(ek.z),r=(0,p.useContext)(b.rZ),[s,o]=(0,p.useState)(0),[a,l]=(0,p.useState)([]),[c,x]=(0,p.useState)([]),[g,m]=(0,p.useState)(void 0),[f,v]=(0,p.useState)(!0),[w,j]=(0,p.useState)(!1),[k,Z]=(0,p.useState)(!1);(0,p.useEffect)(()=>{switch(console.debug("Static content state",d[s]),s){case 0:o(1);break;case 1:S().then(e=>{l(e),o(3)}).catch(e=>{console.error(e),o(2)});break;case 3:I().then(e=>{x(e),o(5)}).catch(e=>{console.error(e),o(4)});break;case 5:D().then(e=>{m(e),o(7)}).catch(e=>{console.error(e),o(6)})}v(void 0!==tD.find(e=>e===s)),j(void 0!==tP.find(e=>e===s)),Z(void 0!==tE.find(e=>e===s))},[s]);let S=async()=>{let e=[];for(let s of i.sessionPresentationUris||[]){if(!s)throw"Presentation link empty in session data.";let o=new tI(t,n,i,r.sessionToken,s,!0);await o.init();let a=s.split("/").pop(),l=await o.getAsEntry(a,void 0),c=await l.content.text();if(!c)throw"No content found in presentation file.";e.push(c)}return e},C=e=>{Q.Z.emit({type:Q.M.Content_Progress_Update,data:e})},I=async()=>{let s=[];for(let o=0;o<a.length;o++){let l=i.sessionPresentationUris[o],c=a[o];if(!l)throw"Presentation link empty in session data.";let d=new tI(t,n,i,r.sessionToken,l,e.refresh);await d.init();let u=new tC(c,d,C),h=u.findAllReplacements(void 0,[]);console.debug("".concat(h.length," unique resources to replace"),h);let p=await u.replaceAllReplacements(h),x=u.getAsSectionTags(p,o);if(!x)throw"No sections found in presentation.";s.push(x)}return s},D=async()=>{let s=[];for(let o=0;o<c.length;o++){let a=i.sessionPresentationUris[o],l=c[o];if(!a)throw"Presentation link empty in session data.";if(!l)throw"No content found in presentation xml.";let d=new tI(t,n,i,r.sessionToken,a,e.refresh);await d.init();let u={sessionId:i.id,deviceId:r.deviceId,role:r.role,remoteMedia:i.remoteConfiguration!==y.VS.InPerson,remoteCall:i.remoteConfiguration===y.VS.RemoteWithVideoCall,keyPrefix:"module-".concat(o),contentStore:d,onAnswer:E},p=(0,h.ZP)(l,eQ(u)),x=(p instanceof Array?p:[p]).map((e,t)=>(0,eY.te)(e,"module-".concat(o))).filter(e=>void 0!==e);s.push(...x)}return s},E=async i=>await n(t.postDeliberationAnswer(e.sid,i,r.sessionToken));return(0,u.jsxs)(u.Fragment,{children:[f&&e.initialising,w&&e.loading,k&&e.error,7===s&&(0,u.jsx)(tq.Provider,{value:{sid:e.sid,presentationXml:c,sourceXml:a,slides:g},children:e.children})]})}},64363:function(e,t,n){n.d(t,{Z:function(){return g}});var i=n(57437),r=n(44228),s=n(42748),o=n(11656),a=n(47905),l=n(86917),c=n(14595),d=n(31193),u=n(60335),h=n(21395),p=n(24072),x=n(76396);function g(e){let t=t=>{e.onVideoPreferenceChange(e.videoEnabled,t)},n=t=>{e.onAudioPreferenceChange(e.audioEnabled,t)},g=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(o.Z,{children:(0,i.jsx)(a.Z,{inset:!0,children:(0,i.jsx)("b",{children:"Video camera inputs"})})},"video-heading"),e.videoDevices.map(n=>{var s;let c=(null===(s=e.videoDevice)||void 0===s?void 0:s.deviceId)===(null==n?void 0:n.deviceId);return(0,i.jsxs)(o.Z,{onClick:()=>t(n),children:[c&&(0,i.jsx)(l.Z,{children:(0,i.jsx)(r.Z,{})}),(0,i.jsx)(a.Z,{inset:!c,children:n.label})]},"menu-item-select-".concat(n.deviceId))})]}),(0,i.jsx)(c.Z,{}),(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(o.Z,{children:(0,i.jsx)(a.Z,{inset:!0,children:(0,i.jsx)("b",{children:"Microphone inputs"})})},"audio-heading"),e.audioDevices.map(t=>{var s;let c=(null===(s=e.audioDevice)||void 0===s?void 0:s.deviceId)===(null==t?void 0:t.deviceId);return(0,i.jsxs)(o.Z,{onClick:()=>n(t),children:[c&&(0,i.jsx)(l.Z,{children:(0,i.jsx)(r.Z,{})}),(0,i.jsx)(a.Z,{inset:!c,children:t.label})]},"menu-item-select-".concat(t.deviceId))})]})]});return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Z,{display:"flex",flexDirection:e.direction,justifyContent:"center",children:[(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":e.audioEnabled?"mute microphone":"enable microphone",onClick:()=>{e.onAudioPreferenceChange(!e.audioEnabled,e.audioDevice)},children:(0,i.jsx)("img",{src:e.audioEnabled?"/icons/av/mic-enabled.svg":"/icons/av/mic-disabled.svg"})}),(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":e.videoEnabled?"disable camera":"enable camera",onClick:()=>{e.onVideoPreferenceChange(!e.videoEnabled,e.videoDevice)},children:(0,i.jsx)("img",{src:e.videoEnabled?"/icons/av/cam-enabled.svg":"/icons/av/cam-disabled.svg"})}),(0,i.jsx)(p.ZP,{variant:"popover",popupId:"audio-popup",children:t=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Z,{disabled:e.busy,"aria-label":"settings",...(0,x.vW)(t),children:(0,i.jsx)("img",{src:"/icons/av/cog-enabled.svg"})}),(0,i.jsx)(h.Z,{...(0,x.wK)(t),children:(0,i.jsx)(g,{})})]})})]})})}},17882:function(e,t,n){n.d(t,{Z:function(){return l}});var i=n(57437),r=n(6722),s=n(8963),o=n(2265),a=n(64363);function l(e){let t=(0,r.HI)(),n=(0,r.Onx)(),l=(0,r.ULf)(),c=(0,r.m6Y)(),d=(0,r.fjl)(),[u,h]=(0,o.useState)(n.isVideoEnabled),[p,x]=(0,o.useState)(!t.muted),[g,m]=(0,o.useState)(void 0),[f,y]=(0,o.useState)(void 0),[v,b]=(0,o.useState)([]),[w,j]=(0,o.useState)([]),[k,Z]=(0,o.useState)(!1);(0,o.useEffect)(()=>{d.subscribeToMeetingStatus(e=>{if(e===r.ytK.Succeeded){var i,s;null===(i=d.audioVideo)||void 0===i||i.listVideoInputDevices().then(e=>{b(e),m(e.find(e=>e.deviceId===d.selectedVideoInputDevice))}),null===(s=d.audioVideo)||void 0===s||s.listAudioInputDevices().then(e=>{j(e),y(e.find(e=>e.deviceId===d.selectedAudioInputDevice))}),h(n.isVideoEnabled),x(!t.muted),d.subscribeToSelectedAudioInputDevice(S),d.subscribeToSelectedVideoInputDevice(C)}})},[]);let S=e=>{(0,r.Zws)(e).then(e=>{y(w.find(t=>t.deviceId===e))})},C=e=>{(0,r.Zws)(e).then(e=>{m(v.find(t=>t.deviceId===e))})};(0,o.useEffect)(()=>{h(n.isVideoEnabled)},[n.isVideoEnabled]),(0,o.useEffect)(()=>{x(!t.muted)},[t.muted]);let I=async(e,t)=>{try{var i;let o=null!==(i=null==t?void 0:t.deviceId)&&void 0!==i?i:await (0,r.Zws)(l.selectedDevice);if((0,s.isVideoTransformDevice)(l.selectedDevice)){if(Z(!0),"chooseNewInnerDevice"in l.selectedDevice)o=selectedDevice.chooseNewInnerDevice(deviceId);else throw"Transform device cannot choose new inner device"}n.isVideoEnabled?await d.startVideoInputDevice(o):d.selectVideoInputDevice(o),e!==n.isVideoEnabled&&n.toggleVideo()}catch(e){console.error("Failed to select video input device")}finally{Z(!1)}},D=async(e,n)=>{var i;let s=await (0,r.Zws)(c.selectedDevice),o=null!==(i=null==n?void 0:n.deviceId)&&void 0!==i?i:s;o!==s&&await d.startAudioInputDevice(o),t.muted===e&&t.toggleMute()};return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(a.Z,{direction:e.orientation,videoEnabled:u,audioEnabled:p,videoDevice:g,audioDevice:f,videoDevices:v,audioDevices:w,onVideoPreferenceChange:I,onAudioPreferenceChange:D,busy:k})})}},43670:function(e,t,n){n.d(t,{Z:function(){return w}});var i,r,s=n(57437),o=n(11144),a=n(70883),l=n(5085),c=n(23447),d=n(94547),u=n(83593),h=n(31193),p=n(96537),x=n(40468),g=n(6722),m=n(8963),f=n(2265),y=n(11707);(i=r||(r={}))[i.Init=0]="Init",i[i.FetchingAttendeeData=1]="FetchingAttendeeData",i[i.AttendeeDataRetrieved=2]="AttendeeDataRetrieved",i[i.AttendeeDataError=3]="AttendeeDataError",i[i.MeetingConnecting=4]="MeetingConnecting",i[i.MeetingConnected=5]="MeetingConnected",i[i.MeetingStarting=6]="MeetingStarting",i[i.MeetingStarted=7]="MeetingStarted",i[i.MeetingLeft=8]="MeetingLeft",i[i.MeetingUnavailable=9]="MeetingUnavailable",i[i.ChimeError=10]="ChimeError",i[i.ConnectedOnAnotherDevice=11]="ConnectedOnAnotherDevice";let v={unexpected:!1,anotherDevice:!1,unavailable:!1,left:!1},b={deviceLabels:g.C$T.AudioAndVideo};function w(e){let[t,n]=(0,f.useState)(0),[i,w]=(0,f.useState)(),[j,k]=(0,f.useState)(),[Z,S]=(0,f.useState)(),[C,I]=(0,f.useState)(v),{session:D}=(0,f.useContext)(o.z),{deviceId:E,role:P,sessionToken:q,user:A}=(0,f.useContext)(l.rZ),_=(0,g.fjl)(),{isVideoEnabled:F,toggleVideo:B}=(0,g.Onx)(),{muted:T,toggleMute:R}=(0,g.HI)(),{api:M,start:U}=(0,f.useContext)(c.E),{subscriptions:V,thisUser:N}=(0,f.useContext)(a.l),[W,L]=(0,f.useState)({}),[O,z]=(0,f.useState)(!1),[G,K]=(0,f.useState)(),[H,Y]=(0,f.useState)();(0,f.useEffect)(()=>(u.Z.on(u.M.WSS_Distribute_Message,Y),u.Z.on(u.M.Media_Playback_Update,Y),()=>{u.Z.off(u.M.WSS_Distribute_Message,Y),u.Z.off(u.M.Media_Playback_Update,Y)}),[]),(0,f.useEffect)(()=>{if(void 0!==H)switch(H.type){case u.M.WSS_Distribute_Message:X(H.data);break;case u.M.Media_Playback_Update:Q(H.data)}},[H]);let Q=e=>{L({...W,[e.videoId]:{update:e}})};(0,f.useEffect)(()=>{z(Object.entries(W).some(e=>e[1].update.isPlaying))},[W]),(0,f.useEffect)(()=>{O&&(K(T),T||R()),O||void 0===G||T===G||R()},[O]);let X=e=>{"mute-update"===e.type&&J(e.data.pids)},J=e=>{!T&&(e.some(e=>e===(null==N?void 0:N.deviceId))||e.some(e=>"*"===e))&&R()};(0,f.useEffect)(()=>{var t,n;(null===(t=e.initialCallPreferences)||void 0===t?void 0:t.videoDevice)!==void 0&&_.startVideoInputDevice(e.initialCallPreferences.videoDevice.deviceId),(null===(n=e.initialCallPreferences)||void 0===n?void 0:n.audioDevice)!==void 0&&_.startAudioInputDevice(e.initialCallPreferences.audioDevice.deviceId)},[]);let $=(0,f.useCallback)(async(e,t)=>{void 0===t&&console.warn("Undefined pid passed from chime.");var n,i=V.find(e=>e.deviceId===t);return void 0===i&&console.warn("No subscription found for pid: ".concat(t),V),{name:null!==(n=null==i?void 0:i.participantName)&&void 0!==n?n:"Unknown"}},[V]);(0,f.useEffect)(()=>{_.getAttendee=$,_.updateDeviceLists()},[V]),(0,f.useEffect)(()=>(_.subscribeToMeetingStatus(ee),()=>{console.log("FLICKER Unmounting ZeitgeistMeeting..."),_.getAttendee=void 0,_.leave(),_.unsubscribeFromMeetingStatus(ee)}),[]);let ee=e=>{console.debug("Meeting status: ".concat(g.ytK[e])),S(e)},et=P===d._b.Controller||D.facilitationState===d._y.Open;(0,f.useEffect)(()=>{et&&0!==t&&1!==t&&n(1),et||(console.debug("Disconnecting..."),k(null))},[D.facilitationState]),(0,f.useEffect)(()=>{switch(console.debug("ZgMeeting view state: ".concat(r[t])),t){case 0:et&&n(1);break;case 1:I(v),en().then(e=>{(null==e?void 0:e.chimeMeetingId)!==(null==i?void 0:i.chimeMeetingId)&&w(e),e?n(2):n(3)}).catch(e=>{console.error(e)});break;case 2:I(v),n(4);break;case 3:case 10:I({...v,unexpected:!0});break;case 4:I(v);let e=ei();(null==j?void 0:j.meetingId)!==e.meetingId||Z!==g.ytK.Succeeded?k(e):n(5);break;case 5:I(v),n(6);break;case 6:I(v),er();break;case 7:I(v);break;case 9:P===d._b.Controller?(I(v),n(1)):I({...v,unavailable:!0});break;case 8:I({...v,left:!0});break;case 11:I({...v,anotherDevice:!0})}},[t,D.facilitationState]);let en=async()=>{var e;return await U(M.postMeetingJoinRequest(D.id,q,E,null!==(e=null==N?void 0:N.participantName)&&void 0!==e?e:"unknown",null==A?void 0:A.access_token))},ei=()=>new m.MeetingSessionConfiguration({MeetingId:i.chimeMeetingId,MediaPlacement:{AudioHostUrl:i.audioHostUrl,SignalingUrl:i.signalingUrl,TurnControlUrl:i.turnControlUrl,AudioFallbackUrl:i.audioFallbackUrl,EventIngestionUrl:i.eventIngestionUrl,ScreenDataUrl:i.screenDataUrl,ScreenViewingUrl:i.screenViewingUrl}},{ExternalUserId:i.chimeAttendeeExternalId,AttendeeId:i.chimeAttendeeId,JoinToken:i.chimeJoinToken});(0,f.useEffect)(()=>{null!=j?_.join(j,b).then(()=>{n(5)}):_.leave()},[null==j?void 0:j.meetingId]),(0,f.useEffect)(()=>{switch(Z){case g.ytK.Loading:break;case g.ytK.Succeeded:n(7);break;case g.ytK.Reconnecting:n(4);break;case g.ytK.Left:n(8);break;case g.ytK.Failed:n(10);break;case g.ytK.Ended:n(9);break;case g.ytK.TerminalFailure:n(10);break;case g.ytK.JoinedFromAnotherDevice:n(11)}},[Z]);let er=async()=>{console.debug("Starting the meeting from state: ".concat(void 0!==Z?g.ytK[Z]:"undefined"));try{await _.start(),n(7)}catch(e){console.error(e),n(10)}};return(0,f.useEffect)(()=>{Z!==g.ytK.Succeeded||(e.initialCallPreferences?(e.initialCallPreferences.videoEnabled!==F&&B(),e.initialCallPreferences.audioEnabled===T&&R()):F||B())},[Z]),console.debug("FLICKER ZgParticipantMeeting rerender"),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(h.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",...e.sx},children:[C.unexpected&&(0,s.jsx)("p",{children:"An unexpected error prevented us from connecting you to the video call. Please refresh the page."}),C.anotherDevice&&(0,s.jsx)("p",{children:"You are already connected in another tab. Please close any other browser tabs connected to this workshop."}),C.unavailable&&(0,s.jsx)("p",{children:"The video call is not available at this time. Please try again later."}),C.left&&(0,s.jsx)("p",{children:"You have left the video call."}),11===t&&(0,s.jsx)(p.Z,{variant:"outlined",onClick:()=>n(1),children:"Try again"}),3===t&&(0,s.jsx)(p.Z,{variant:"outlined",onClick:()=>n(1),children:"Try again"}),9===t&&(0,s.jsx)(p.Z,{variant:"outlined",onClick:()=>n(1),children:"Try again"}),8===t&&(0,s.jsx)(p.Z,{variant:"outlined",onClick:()=>n(1),children:"Rejoin"}),10===t&&(0,s.jsx)(p.Z,{variant:"outlined",onClick:()=>n(4),children:"Try again"}),0>[7,8,9,10,11].indexOf(t)&&(0,s.jsx)(h.Z,{alignSelf:"stretch",display:"flex",flexGrow:1,justifyContent:"center",alignItems:"center",children:(0,s.jsx)(x.Z,{})}),Z===g.ytK.Succeeded&&(0,s.jsx)(y.f6,{theme:g.Wbj,children:(0,s.jsx)(h.Z,{sx:{alignSelf:"stretch",flexGrow:1},children:e.children})})]})})}},68276:function(e,t,n){n.d(t,{u:function(){return k},Z:function(){return Z}});var i,r,s=n(57437),o=n(27270),a=n(31193),l=n(2265),c=n(11144),d=n(5085),u=n(94547),h=n(43312),p=n(34360),x=n(64363),g=n(96537),m=n(6820),f=n.n(m);let y={videoEnabled:!0,audioEnabled:!0,videoDevice:void 0,audioDevice:void 0,blurBackground:!1};function v(e){let[t,n]=l.useState([]),[i,r]=l.useState([]),[o,c]=l.useState(void 0),[d,u]=l.useState(void 0),[h,p]=l.useState(!0),[m,y]=l.useState(!0);(0,l.useEffect)(()=>{void 0!==navigator&&navigator.mediaDevices.enumerateDevices().then(e=>{n(v(e)),r(b(e))})},[]),(0,l.useEffect)(()=>{e.onPreferences({videoEnabled:h,audioEnabled:m,videoDevice:o,audioDevice:d,blurBackground:!1})},[h,m,o,d]);let v=e=>e.filter(e=>{let{kind:t}=e;return"videoinput"===t}),b=e=>e.filter(e=>{let{kind:t}=e;return"audioinput"===t}),w={maxWidth:"100%",maxHeight:"100%",width:"auto"},j={height:320,facingMode:o?void 0:"user",deviceId:null==o?void 0:o.deviceId};return(0,s.jsxs)(a.Z,{display:"flex",flexDirection:"column",flexGrow:1,children:[(0,s.jsx)(()=>(0,s.jsx)(a.Z,{sx:{borderRadius:2,p:1,mb:2,background:"#d9d9d9",display:"flex",flexDirection:"column",alignItems:"center",justifyItems:"stretch"},children:(0,s.jsx)("div",{style:{...w},children:h&&(0,s.jsx)(f(),{mirrored:!0,style:w,videoConstraints:j})})}),{}),(0,s.jsx)(()=>(0,s.jsxs)(a.Z,{display:"flex",flexDirection:"row",justifyContent:"center",gap:2,children:[(0,s.jsx)(x.Z,{direction:"row",videoEnabled:h,audioEnabled:m,videoDevices:t,audioDevices:i,videoDevice:o,audioDevice:d,onVideoPreferenceChange:async(e,t)=>{p(e),c(t)},onAudioPreferenceChange:async(e,t)=>{y(e),u(t)},busy:!1}),e.showJoin&&(0,s.jsx)(g.Z,{variant:"contained",size:"large",sx:{alignSelf:"center"},onClick:e.onJoin,children:"JOIN"}),e.showLeave&&(0,s.jsx)(g.Z,{variant:"outlined",size:"large",sx:{alignSelf:"center"},onClick:e.onLeave,children:"LEAVE"})]}),{})]})}var b=n(43655),w=n(24314),j=n(79044);(i=r||(r={}))[i.Init=0]="Init",i[i.PreviewMedia=1]="PreviewMedia",i[i.NoPreview=2]="NoPreview";let k=(0,l.createContext)({});function Z(e){let{session:t,graphic:n}=(0,l.useContext)(c.z),i=(0,l.useContext)(j.K),x=(0,l.useContext)(d.rZ),[g,m]=(0,l.useState)(0),[f,Z]=(0,l.useState)(!1),[S,C]=(0,l.useState)(y),[I,D]=(0,l.useState)({waitingRoom:!1,sessionClosed:!1,sessionOpen:!1,sessionBanned:!1}),[E,P]=(0,l.useState)(!1);(0,l.useEffect)(()=>{switch(console.debug("Media preview state",r[g]),g){case 0:m(t.remoteConfiguration===u.VS.RemoteWithVideoCall?1:2);break;case 2:Z(!0)}},[g]),(0,l.useEffect)(()=>{P((2===g||1===g)&&(t.facilitationState===u._y.Open||x.role===u._b.Controller)&&f)},[f,g,t]),(0,l.useEffect)(()=>{var e,n;D({waitingRoom:t.facilitationState===u._y.Ready,sessionClosed:t.facilitationState===u._y.Closed,sessionOpen:t.facilitationState===u._y.Open,sessionBanned:null!==(n=null===(e=t.deviceIdBanList)||void 0===e?void 0:e.includes(x.deviceId))&&void 0!==n&&n})},[t]);let q=(0,l.useMemo)(()=>(0,s.jsx)(p.Z,{url:n.posterUrl}),[n.posterUrl]),A=()=>(0,s.jsxs)(s.Fragment,{children:[f&&I.waitingRoom&&(0,s.jsx)(o.Z,{severity:"success",children:"Please wait for the workshop to open."}),I.sessionOpen&&(0,s.jsx)(o.Z,{severity:"success",children:"The workshop has started."}),x.role!==u._b.Controller&&I.waitingRoom&&(0,s.jsx)(o.Z,{severity:"info",children:"The workshop will begin at the scheduled time..."}),x.role===u._b.Controller&&!I.sessionOpen&&(0,s.jsx)(o.Z,{severity:"info",children:"You are the facilitator. The session will begin once you open it."}),I.sessionClosed&&(0,s.jsx)(o.Z,{severity:"warning",children:"The workshop has closed."}),I.sessionBanned&&(0,s.jsx)(o.Z,{severity:"error",children:"You have been removed from this session."})]});return(0,s.jsxs)(s.Fragment,{children:[!E&&(0,s.jsxs)(s.Fragment,{children:[1===g&&(0,s.jsx)(b.Z,{heading:(0,s.jsx)(h.Z,{session:t,layout:"heading",welcome:!0}),main:(0,s.jsx)(w.Z,{left:(0,s.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[!f&&x.role!==u._b.Controller&&!I.sessionBanned&&(0,s.jsxs)(o.Z,{severity:"info",children:["Please check your settings and press the ",(0,s.jsx)("b",{children:"join"})," button when ready."]}),(0,s.jsx)(A,{}),!I.sessionClosed&&!I.sessionBanned&&(0,s.jsx)(v,{name:i.participantName,session:t,showJoin:!f,showLeave:f,onJoin:()=>{Z(!0)},onLeave:()=>{Z(!1)},onPreferences:C})]}),right:q})}),2===g&&(0,s.jsx)(b.Z,{heading:(0,s.jsx)(h.Z,{session:t,layout:"heading",welcome:!0}),main:(0,s.jsx)(w.Z,{left:(0,s.jsx)(A,{}),right:q})})]}),E&&!I.sessionBanned&&(0,s.jsx)(k.Provider,{value:{call:S},children:e.children}),E&&I.sessionBanned&&(0,s.jsx)(b.Z,{heading:(0,s.jsx)(h.Z,{session:t,layout:"heading",welcome:!0}),main:(0,s.jsx)(w.Z,{left:(0,s.jsx)(A,{}),right:q})})]})}},88620:function(e,t,n){n.d(t,{Z:function(){return u}});var i=n(57437),r=n(83593),s=n(22960),o=n(31193),a=n(34990),l=n(80511),c=n(99128),d=n(2265);function u(e){var t;let[n,u]=(0,d.useState)(),[h,p]=(0,d.useState)({overall:{completed:0,total:100},bars:{}});(0,d.useEffect)(()=>(r.Z.on(r.M.Content_Progress_Update,u),()=>{r.Z.off(r.M.Content_Progress_Update,u)}),[]),(0,d.useEffect)(()=>{void 0!==n&&n.type===r.M.Content_Progress_Update&&p(n.data)},[n]);let x=(0,s.Z)();return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(o.Z,{sx:{alignSelf:"center",display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100%",width:"60%",maxWidth:"480px"},children:(0,i.jsxs)(a.Z,{elevation:1,sx:{p:2,flexGrow:1,textAlign:"start"},children:[(0,i.jsx)(l.Z,{component:"h2",variant:"h5",sx:{mb:2},style:{textAlign:"center"},children:e.title}),(0,i.jsx)(l.Z,{variant:"body1",children:(0,i.jsx)("span",{style:{color:e.isError?x.palette.error.main:"inherit"},children:null!==(t=e.message)&&void 0!==t?t:"Unknown error."})}),e.children&&(0,i.jsx)(o.Z,{sx:{my:1},children:e.children}),e.isBusy&&!e.showProgress&&(0,i.jsx)(c.Z,{sx:{mt:2}}),e.isBusy&&e.showProgress&&(0,i.jsx)(c.Z,{sx:{mt:2},value:h.overall.total>0?100*h.overall.completed/h.overall.total:void 0,variant:h.overall.total>0?"determinate":"indeterminate"}),e.isBusy&&e.showProgress&&Object.keys(h.bars).map((e,t)=>(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(c.Z,{color:"secondary",sx:{mt:1},value:h.bars[e].total>0?100*h.bars[e].completed/h.bars[e].total:0,variant:"determinate"},"loading-progress-bar-".concat(t,"-").concat(e))}))]})})})}},98641:function(e,t,n){n.d(t,{Z:function(){return ec}});var i,r,s,o,a,l,c=n(57437),d=n(68276),u=n(2265);function h(){return(0,u.useEffect)(()=>{let e=[/defaultProps/,/of chart should be greater than 0/,/It will be ignored./,/If you accidentally passed it from a parent component, remove it from the DOM element./,/Form submission canceled because the form is not connected/,/Violation/,/Enriching/,/Added non-passive event/,/Form submission canceled/,/\[Violation\]/,/Warning: Invalid DOM/],t=console.error,n=console.warn,i=console.debug;return console.error=function(){for(var n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];"string"==typeof i[0]&&e.some(e=>e.test(i[0]))||t(...i)},console.warn=function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];"string"==typeof i[0]&&e.some(e=>e.test(i[0]))||n(...i)},console.debug=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];"string"==typeof n[0]&&e.some(e=>e.test(n[0]))||i(...n)},()=>{console.error=t,console.warn=n,console.debug=i}},[]),(0,c.jsx)(c.Fragment,{})}var p=n(6722),x=n(8963),g=n(11144),m=n(23447),f=n(94547),y=n(69779),v=n(22960),b=n(31193),w=n(60335),j=n(5085);function k(e){let t=(0,u.useContext)(j.rZ),n=(0,u.useMemo)(()=>{var t;return(null===(t=e.elementRef)||void 0===t?void 0:t.current)||document.documentElement},[e.elementRef]),[i,r]=(0,u.useState)(),s=async()=>{try{!1!==document.fullscreenEnabled?n.requestFullscreen?await n.requestFullscreen({navigationUI:"hide"}):n.webkitRequestFullscreen?await n.webkitRequestFullscreen():n.webkitEnterFullscreen?await n.webkitEnterFullscreen():n.mozRequestFullScreen?await n.mozRequestFullScreen():n.msRequestFullscreen?await n.msRequestFullscreen():console.warn("No request full screen variants found"):console.warn("Fullscreen not enabled")}catch(e){console.error("Error entering fullscreen",e)}},o=async()=>{try{let e=document;document.fullscreenElement?await document.exitFullscreen():e.webkitFullscreenElement?await e.webkitExitFullscreen():e.mozFullScreenElement?await e.mozCancelFullScreen():e.msFullscreenElement?await e.msExitFullscreen():console.warn("No exit full screen variants found")}catch(e){console.error("Error exiting fullscreen",e)}};(0,u.useEffect)(()=>{document.onfullscreenchange=e=>{document.fullscreenEnabled,r(null!==document.fullscreenElement)}},[]),(0,u.useEffect)(()=>{t.role===f._b.Client&&void 0!==n&&(e.goFullScreen&&!i&&s(),!e.goFullScreen&&i&&o())},[e.goFullScreen,n]);let a=(0,v.Z)();return(0,c.jsx)(c.Fragment,{children:t.role===f._b.Client&&!i&&(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(b.Z,{sx:{position:"absolute",top:"1.5rem",right:"1.5rem",zIndex:10},children:(0,c.jsx)(w.Z,{"aria-label":"full screen",onClick:()=>s(),sx:{border:"2px solid",borderColor:a.palette.promptPanelBackground.main,background:a.palette.slideSectionBackground.main},children:(0,c.jsx)(y.Z,{})})})})})}var Z=n(43312),S=n(34360),C=n(61570),I=n(87913),D=n(8487),E=n(86514),P=n(80438),q=n(67630),A=n(10745),_=n(44330),F=n(24309),B=n(99128),T=n(27270),R=n(80511),M=n(96537),U=n(69540),V=n(63858);let N={checking_wake_lock:!1,checking_permissions:!1,explain_request:!1,get_request:!1,get_success:!1,get_fail_system:!1,get_fail_user:!1,get_fail_could_not_start:!1,get_fail_unknown_error:!1};function W(e){let[t,n]=(0,u.useState)({av:!1}),[i,r]=(0,u.useState)(N),[s,a]=(0,u.useState)(!1),[l,d]=(0,u.useState)(0);(0,u.useEffect)(()=>{switch(console.debug("state",o[l]),l){case 0:d(1);break;case 1:r({...N,checking_wake_lock:!0}),a(!0),x().then(()=>{d(2)});break;case 2:r({...N,checking_permissions:!0}),a(!0),h().then(e=>{e?(r({...N,get_success:!0}),d(4)):d(3)});break;case 3:r({...N,explain_request:!0}),a(!1);break;case 4:r({...N,get_request:!0}),a(!1),p().then(e=>{if(!0===e||!1===e)n({av:e}),r({...N,get_success:e,get_fail_unknown_error:!e});else{let{type:t,name:i,message:s}=e;n({av:!1}),console.error("Permission denied: ".concat(i,", ").concat(s)),r({...N,get_success:!1,get_fail_system:t===U.wS.SystemPermissionDenied,get_fail_user:t===U.wS.UserPermissionDenied,get_fail_could_not_start:t===U.wS.CouldNotStartVideoSource,get_fail_unknown_error:null==t||t===U.wS.Generic})}d(5)});break;case 5:a(!1),t.av&&e.onDone(!0)}},[l]),(0,u.useEffect)(()=>{console.info("Media permissions",t)},[t]);let h=async()=>{if(void 0===navigator)return console.warn("Navigator required to check permissions"),!1;try{let e=await navigator.permissions.query({name:"camera"});return"granted"===e.state}catch(e){return console.error("Error checking camera permissions",e),!1}},p=async()=>{try{let e=await (0,U.TD)();if(void 0!==e)return e;throw{type:U.wS.Generic,name:"Unknown",message:"Unknown error"}}catch(e){if(void 0!==e)return e;return{type:U.wS.Generic,name:"Unknown",message:"Unknown error"}}},x=async()=>{void 0!==navigator?void 0!==navigator.permissions?(console.debug("Checking screen wake-lock permission..."),console.info("screen-wake-lock permission",(await navigator.permissions.query({name:"screen-wake-lock"})).state)):console.warn("navigator.permissions is undefined"):console.warn("navigator is undefined")};return(0,c.jsxs)(c.Fragment,{children:[s&&(0,c.jsx)(B.Z,{}),i.checking_permissions&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(T.Z,{severity:"info",children:"We need permission to keep your screen on while you're in the workshop."}),(0,c.jsx)(R.Z,{variant:"h4",component:"h2",children:"Checking for permission"}),(0,c.jsx)(R.Z,{variant:"body1",children:"Please wait while we check for permission to keep your screen on while you're in the workshop..."})]}),i.checking_permissions&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(T.Z,{severity:"info",children:"We need your permission to use your camera and microphone to participate in this workshop."}),(0,c.jsx)(R.Z,{variant:"h4",component:"h2",children:"Checking for permission"}),(0,c.jsx)(R.Z,{variant:"body1",children:"Please wait while we check for permission to use your camera and microphone..."})]}),i.explain_request&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(T.Z,{severity:"info",children:"We need your permission to use your camera and microphone to participate in this workshop."}),(0,c.jsx)(R.Z,{variant:"h4",component:"h2",children:"Permission to join the video call"}),(0,c.jsx)(R.Z,{variant:"body1",children:"If prompted by your browser, please grant access to your camera and microphone."}),(0,c.jsx)(M.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:()=>{d(4)},children:"Grant permission"})]}),i.get_request&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(T.Z,{severity:"info",children:"We need your permission to use your camera and microphone to participate in this session."}),(0,c.jsx)(R.Z,{variant:"h4",component:"h2",children:"Permission to join the video call"}),(0,c.jsx)(R.Z,{variant:"body1",children:"If prompted by your browser, please grant access to your camera and microphone."})]}),i.get_success&&(0,c.jsx)(T.Z,{severity:"success",children:"Your camera and microphone are ready to go!"}),i.get_fail_system&&(0,c.jsx)(T.Z,{severity:"error",children:"Your browser has denied access to your camera and microphone. Please check your browser settings and reload the page."}),i.get_fail_user&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(T.Z,{severity:"warning",children:"You have denied access to your camera and/or microphone."}),(0,c.jsxs)(R.Z,{variant:"h4",component:"h2",children:["What to do next on ",V.KC]}),V.i7&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(C.Z,{fontSize:"inherit"}),children:"If you see a crossed video camera icon at the end of your address bar, click it to change permissions."}),(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(I.Z,{fontSize:"inherit"}),children:"If you don't see a camera icon, click the info icon at the beginning of the address bar for the page settings."}),(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(D.Z,{fontSize:"inherit"}),children:"Grant permission to access camera and microphone from there."}),(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(E.Z,{fontSize:"inherit"}),children:"When done, reload the page."})]}),V.vU&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(C.Z,{fontSize:"inherit"}),children:"If you see a crossed video camera or microphone icon at the start of your address bar, click it to change permissions."}),(0,c.jsxs)(T.Z,{severity:"info",icon:(0,c.jsx)(P.Z,{fontSize:"inherit"}),children:["If you don't see those icons, choose ",(0,c.jsx)("b",{children:"Tools"})," > ",(0,c.jsx)("b",{children:"Page Info"})," from the menu."]}),(0,c.jsxs)(T.Z,{severity:"info",icon:(0,c.jsx)(D.Z,{fontSize:"inherit"}),children:["Grant permission to access camera and microphone from the ",(0,c.jsx)("b",{children:"Permissions"})," tab."]}),(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(E.Z,{fontSize:"inherit"}),children:"When done, reload the page."}),(0,c.jsx)("img",{src:"/instructions/permissions-dialog-ff.png",style:{width:"80%",alignSelf:"center"}})]}),V.G6&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(T.Z,{severity:"info",icon:(0,c.jsx)(P.Z,{fontSize:"inherit"}),children:["Choose ",(0,c.jsx)("b",{children:"Safari"})," > ",(0,c.jsx)("b",{children:"Settings"})," from the menu, then click ",(0,c.jsx)("b",{children:"Websites"}),"."]}),(0,c.jsxs)(T.Z,{severity:"info",icon:(0,c.jsx)(q.Z,{fontSize:"inherit"}),children:["Choose the Camera settings, and set this site to ",(0,c.jsx)("b",{children:"Allow"}),"."]}),(0,c.jsxs)(T.Z,{severity:"info",icon:(0,c.jsx)(A.Z,{fontSize:"inherit"}),children:["Choose the Microphone settings, and set this site to ",(0,c.jsx)("b",{children:"Allow"}),"."]}),(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(_.Z,{fontSize:"inherit"}),children:"When done, reload the page."}),(0,c.jsx)("img",{src:"/instructions/permissions-dialog-sf.png",style:{width:"80%",alignSelf:"center"}})]}),V.un&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(P.Z,{fontSize:"inherit"}),children:"Select Settings and more... and select Settings."}),(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(D.Z,{fontSize:"inherit"}),children:"Select Cookies and Site Permissions on the left side."}),(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(E.Z,{fontSize:"inherit"}),children:"Under Site Permissions, select Camera or Microphone."}),(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(_.Z,{fontSize:"inherit"}),children:"Grant permissions there"}),(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(F.Z,{fontSize:"inherit"}),children:"When done, reload this page."})]}),!V.i7&&!V.vU&&!V.G6&&!V.un&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(T.Z,{severity:"warning",children:["We don't have instructions for ",V.KC,"."]}),(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(P.Z,{fontSize:"inherit"}),children:"Please grant camera and microphone permissions for this page."}),(0,c.jsx)(T.Z,{severity:"info",icon:(0,c.jsx)(D.Z,{fontSize:"inherit"}),children:"When done, reload the page."})]})]}),i.get_fail_could_not_start&&(0,c.jsx)(T.Z,{severity:"warning",children:"Your camera and microphone are in use by another application. Please close the other application, refresh this page, and try again."}),i.get_fail_unknown_error&&(0,c.jsx)(T.Z,{severity:"error",children:"An unexpected error has prevented us from checking your camera and microphone. Please reload the page to try again."})]})}function L(e){let[t,n]=(0,u.useState)(0),i=()=>void 0!==window&&void 0!==window.navigator&&void 0!==window.navigator.storage;(0,u.useEffect)(()=>{switch(t){case 0:i()||e.onDone(!1);break;case 1:r().then(t=>{console.debug("storage granted: ".concat(t)),e.onDone(t)})}},[t]);let r=async()=>i()&&void 0!==window.navigator.storage.persist&&await window.navigator.storage.persist();return(0,c.jsxs)(c.Fragment,{children:[0===t&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(R.Z,{variant:"h4",component:"h2",children:"Permission to store workshop content"}),(0,c.jsx)(R.Z,{variant:"body1",children:"We need your permission to store workshop content on this device. This helps save time and data if you reload the page, or restart your device."}),(0,c.jsx)(R.Z,{variant:"body1",children:"It's ok if you'd rather not grant that permission."}),(0,c.jsxs)(b.Z,{sx:{display:"flex",flexDirection:"row",gap:1},children:[(0,c.jsx)(M.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:()=>{n(1)},children:"Grant permission"}),(0,c.jsx)(M.Z,{sx:{alignSelf:"start"},variant:"outlined",color:"primary",onClick:()=>{e.onDone(!1)},children:"No thanks"})]})]}),1===t&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(R.Z,{variant:"h4",component:"h2",children:"Permission to store workshop content"}),(0,c.jsx)(R.Z,{variant:"body1",children:"If you see a prompt from your browser, please grant permission to store data on your device."}),(0,c.jsx)(M.Z,{sx:{alignSelf:"start"},variant:"outlined",color:"primary",onClick:()=>e.onDone(!1),children:"Skip"})]})]})}function O(e){let t=(0,v.Z)(),n=(0,u.useContext)(j.rZ),[i,r]=(0,u.useState)([]);return(0,u.useEffect)(()=>{let t=["We'll ask you for a name, so we know how to refer to you during the workshop."];e.session.remoteConfiguration===f.VS.RemoteWithVideoCall&&t.push("We'll ask for permission to use your camera and microphone, for the video call."),t.push("We'll ask for permission to keep workshop content on your device. (This is optional.)"),t.push("We'll fetch the workshop content for today, so it's ready for when we start."),r(t)},[]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(R.Z,{variant:"h4",children:"Thank you for joining us"}),e.session.facilitationState===f._y.Closed&&n.role===f._b.Client&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(R.Z,{variant:"h5",children:"Workshop closed"}),(0,c.jsx)(R.Z,{variant:"body1",children:"This workshop has ended. If you believe you're seeing this message in error, please contact your facilitator for more information."}),(0,c.jsx)(M.Z,{sx:{alignSelf:"start"},variant:"outlined",color:"buttonStandard",onClick:e.onComplete,children:"Continue"})]}),e.session.facilitationState===f._y.Closed&&n.role===f._b.Controller&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(R.Z,{variant:"h5",children:"Workshop closed"}),(0,c.jsx)(R.Z,{variant:"body1",children:"This workshop has been closed. As a facilitator, you may enter the workshop and open it again."}),(0,c.jsx)(M.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:e.onComplete,children:"Continue"})]}),e.session.facilitationState!==f._y.Closed&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(R.Z,{variant:"h5",children:"Today's session"}),(0,c.jsx)(b.Z,{sx:{border:"solid 2px",borderColor:t.palette.buttonQuiet.main,background:t.palette.buttonQuiet.main,p:2,borderRadius:2},children:(0,c.jsx)(R.Z,{variant:"body1",children:(0,c.jsx)("span",{dangerouslySetInnerHTML:{__html:e.session.sessionDescription}})})}),(0,c.jsx)(R.Z,{variant:"h5",children:"Let's get started"}),(0,c.jsxs)(R.Z,{variant:"body1",component:"div",children:["In order to connect you to the workshop, we'll need a few things:",(0,c.jsx)("ul",{children:i.map((e,t)=>(0,c.jsx)("li",{children:e},"welcome-list-item-".concat(t)))})]}),(0,c.jsx)(M.Z,{sx:{alignSelf:"start"},variant:"contained",color:"primary",onClick:e.onComplete,children:"Continue"})]})]})}(i=o||(o={}))[i.Init=0]="Init",i[i.CheckingWakeLock=1]="CheckingWakeLock",i[i.CheckingPermission=2]="CheckingPermission",i[i.ExplainRequestPermissions=3]="ExplainRequestPermissions",i[i.GetPermission=4]="GetPermission",i[i.Result=5]="Result",(r=a||(a={}))[r.Describe=0]="Describe",r[r.Request=1]="Request";var z=n(43655),G=n(24314);(s=l||(l={}))[s.Welcome=0]="Welcome",s[s.ObtainVideoPermissions=1]="ObtainVideoPermissions",s[s.ObtainStoragePermissions=2]="ObtainStoragePermissions",s[s.Ready=3]="Ready";let K=(0,u.createContext)({});function H(e){let{session:t,graphic:n}=(0,u.useContext)(g.z),[i,r]=(0,u.useState)(0),[s,o]=(0,u.useState)(),[a,l]=(0,u.useState)(),[d,h]=(0,u.useState)(),p=(0,u.useMemo)(()=>(0,c.jsx)(S.Z,{url:n.posterUrl}),[n.posterUrl]),x=(0,u.useCallback)(()=>{r(1),b(!0)},[r]),m=(0,u.useCallback)(e=>{l(e),r(2)},[l,r]),y=(0,u.useCallback)(e=>{h(e),r(3)},[h,r]);(0,u.useEffect)(()=>{1===i&&t.remoteConfiguration!==f.VS.RemoteWithVideoCall&&(l(!1),r(2))},[i]);let[v,b]=(0,u.useState)(!1);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(k,{goFullScreen:v}),3!==i&&(0,c.jsx)(z.Z,{heading:(0,c.jsx)(Z.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsxs)(c.Fragment,{children:[0===i&&(0,c.jsx)(G.Z,{left:(0,c.jsx)(O,{session:t,onComplete:x}),right:(0,c.jsx)(S.Z,{url:n.posterUrl})}),1===i&&(0,c.jsx)(G.Z,{left:(0,c.jsx)(W,{onDone:m}),right:p}),2===i&&(0,c.jsx)(G.Z,{left:(0,c.jsx)(L,{onDone:y}),right:p})]})}),3===i&&(0,c.jsx)(K.Provider,{value:{videoPermissionsGranted:a,storagePermissionsGranted:d},children:e.children})]})}var Y=n(67506),Q=n(96544),X=n(88620);function J(e){let{session:t,graphic:n}=(0,u.useContext)(g.z),i=(0,u.useMemo)(()=>(0,c.jsx)(S.Z,{url:n.posterUrl}),[n.posterUrl]);return(0,c.jsx)(Y.Z,{mode:"zg-server-time",loading:(0,c.jsx)(z.Z,{heading:(0,c.jsx)(Z.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsx)(G.Z,{left:(0,c.jsx)(X.Z,{isError:!1,isBusy:!0,showProgress:!0,title:"Synchronising...",message:"Please wait while we synchronise clocks."}),right:i})}),error:(0,c.jsx)(X.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Synchronising...",message:"We were unable to synchronise clocks with the server."}),children:(0,c.jsx)(Q.Z,{sid:e.sid,refresh:e.refresh,initialising:(0,c.jsx)(z.Z,{heading:(0,c.jsx)(Z.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsx)(G.Z,{left:(0,c.jsx)(X.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Preparing...",message:"Please wait while we prepare to download the workshop content."}),right:i})}),loading:(0,c.jsx)(z.Z,{heading:(0,c.jsx)(Z.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsx)(G.Z,{left:(0,c.jsx)(X.Z,{isError:!1,isBusy:!0,showProgress:!0,title:"Downloading content...",message:"Please wait while we download the workshop content."}),right:i})}),error:(0,c.jsx)(X.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Content error",message:"We were unable to retrieve content for this workshop."}),children:e.children})})}var $=n(37471),ee=n(70883),et=n(4766),en=n(93191);function ei(e){let{session:t,graphic:n}=(0,u.useContext)(g.z),i=(0,u.useMemo)(()=>(0,c.jsx)(S.Z,{url:n.posterUrl}),[n.posterUrl]);return(0,c.jsx)($.C,{sid:e.sid,loading:(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(z.Z,{heading:(0,c.jsx)(Z.Z,{session:t,layout:"heading",welcome:!0}),main:(0,c.jsx)(G.Z,{left:(0,c.jsx)(X.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Connecting to live session...",message:"Please wait while we connect you to the workshop."}),right:i})})}),error:(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(X.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Connecting to live session...",message:"We were unable to connect you to the live session."})}),children:(0,c.jsx)(et.Z,{children:(0,c.jsx)(en.Z,{refresh:e.refresh,previews:e.role===f._b.Controller,storeState:e.role===f._b.Controller,children:(0,c.jsx)(ee.Z,{sid:e.sid,children:e.children})})})})}var er=n(37570);function es(e){return(0,c.jsx)(j.ZP,{role:e.role,sid:e.sid,joinCode:e.joinCode,loading:(0,c.jsx)(X.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Checking permissions...",message:"Please wait while we confirm your access to the workshop."}),error:(0,c.jsx)(X.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Checking permissions...",message:"We were unable to confirm access to this workshop."}),children:(0,c.jsx)(er.Z,{sid:e.sid,initialising:(0,c.jsx)(X.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Preparing...",message:"Please wait while we prepare to retrieve the workshop."}),loading:(0,c.jsx)(X.Z,{isError:!1,isBusy:!0,showProgress:!1,title:"Retrieving workshop data...",message:"Please wait while we retrieve information about the workshop."}),error:(0,c.jsx)(X.Z,{isError:!0,isBusy:!1,showProgress:!1,title:"Content error",message:"We were unable to retrieve this workshop."}),children:e.children})})}var eo=n(79044);function ea(e){let{keepAwake:t}=e,[n,i]=(0,u.useState)(),[r,s]=(0,u.useState)();return(0,u.useEffect)(()=>{if(void 0===n&&void 0!==window.navigator){var e;i(null===(e=window.navigator)||void 0===e?void 0:e.wakeLock)}},[]),(0,u.useEffect)(()=>{console.debug("Wake lock: ".concat(void 0===n?"unavailable":"available",", keepAwake: ").concat(t));try{void 0===n||(t&&void 0===r&&n.request("screen").then(e=>{console.debug("Wake lock sentinel acquired"),s(e)}).catch(e=>{console.error("Wake lock exception",e)}),t||(void 0!==r&&console.debug("Releasing wake lock sentinel..."),null==r||r.release().then(()=>{console.debug("Wake lock sentinel released."),s(void 0)})))}catch(e){console.warn("Unable to request screen lock",e)}return()=>{void 0!==r&&console.debug("Relesaing wake lock sentinel..."),null==r||r.release().then(()=>{console.debug("Wake lock sentinel released."),s(void 0)})}},[n,t]),(0,c.jsx)(c.Fragment,{})}function el(){let{session:e}=(0,u.useContext)(er.H);return(0,u.useEffect)(()=>{document.title=e.sessionName},[]),(0,c.jsx)(c.Fragment,{})}function ec(e){let[t]=(0,u.useState)(()=>new x.ConsoleLogger("ZgLiveSession",x.LogLevel.OFF));return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(m.Z,{children:[(0,c.jsx)(h,{}),(0,c.jsx)(es,{sid:e.sid,role:e.role,joinCode:e.joinCode,children:(0,c.jsxs)(g.Z,{children:[(0,c.jsx)(el,{}),(0,c.jsx)(H,{sid:e.sid,refresh:e.refresh,children:(0,c.jsx)(J,{sid:e.sid,refresh:e.refresh,children:(0,c.jsx)(eo.Z,{children:(0,c.jsx)(ei,{sid:e.sid,refresh:e.refresh,role:e.role,children:(0,c.jsx)(p.ikO,{logger:t,children:(0,c.jsx)(p.lUb,{children:(0,c.jsxs)(d.Z,{children:[(0,c.jsx)(ea,{keepAwake:!0}),e.children]})})})})})})})]})})]})})}},40395:function(e,t,n){n.d(t,{Z:function(){return h}});var i=n(57437),r=n(7630),s=n(69065),o=n(66124),a=n(31193),l=n(60335),c=n(80511),d=n(96537),u=n(2265);function h(e){var t,n,h;let p=()=>{var t;e.setOpen(!1),null===(t=e.onClose)||void 0===t||t.call(e)},x=t=>{var n,i;e.setOpen(!1),null===(n=e.onClose)||void 0===n||n.call(e),null===(i=e.onSelect)||void 0===i||i.call(e,t)},g=(0,u.useId)();return(0,i.jsx)(s.Z,{fullWidth:null===(t=e.fullWidth)||void 0===t||t,maxWidth:null!==(n=e.maxWidth)&&void 0!==n?n:"sm",open:e.open,onClose:p,children:(0,i.jsxs)(o.Z,{children:[(null===(h=e.showCloseButton)||void 0===h||h)&&(0,i.jsx)(a.Z,{style:{position:"absolute",top:0,right:0},children:(0,i.jsx)(l.Z,{"aria-label":"close",onClick:p,children:(0,i.jsx)(r.Z,{})})}),(0,i.jsxs)(a.Z,{sx:{p:2,gap:2,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,i.jsx)(c.Z,{variant:"h4",sx:{width:"75%",mb:2},style:{textAlign:"center"},children:e.prompt}),e.options.map(e=>(0,i.jsx)(d.Z,{sx:{width:"66%"},variant:e.filled?"contained":"outlined",color:"buttonStandard",onClick:()=>x(e.key),children:e.text},"dialog-".concat(g,"-option-").concat(e.key)))]})]})})}},9646:function(e,t,n){n.d(t,{Z:function(){return o}});var i=n(57437),r=n(42555),s=n(80511);function o(e){var t,n,o;return(0,i.jsx)(r.Z,{type:"submit",variant:null!==(t=e.variant)&&void 0!==t?t:"contained",size:e.size,color:null!==(n=e.color)&&void 0!==n?n:"buttonStandard",onClick:()=>{e.onClick(e.btnKey)},loading:e.busy,disabled:e.disabled||e.busy,startIcon:e.startIcon,endIcon:e.endIcon,sx:e.sx,children:(0,i.jsx)(s.Z,{variant:"submitButton",children:null!==(o=e.btnText)&&void 0!==o?o:"Submit"})})}},71359:function(e,t,n){n.d(t,{Q:function(){return r},Z:function(){return m}});var i,r,s=n(57437),o=n(8260),a=n(94547),l=n(31193),c=n(22599),d=n.n(c),u=n(2265),h=n(48620),p=n(49752),x=n(26049),g=n(45231);function m(e){var t;let{answers:n}=(0,o.ZP)(e.qids.qid),i=()=>{var t;return(0,o.Zp)(n,e.qids,null===(t=e.question)||void 0===t?void 0:t.pii)},[c,m]=(0,u.useState)(i()),[f,y]=(0,u.useState)(i()),[v,b]=(0,u.useState)(!1),[w,j]=(0,u.useState)(e.role===a._b.Client),k=t=>{var n,i;return{answers:[{key:"".concat(t),index:t,description:null!==(i=null===(n=e.marks)||void 0===n?void 0:n[t])&&void 0!==i?i:"".concat(t),numericValue:1}]}};(0,u.useEffect)(()=>{var e;y({...c,jsonValue:null!==(e=c.jsonValue)&&void 0!==e?e:k(Math.floor((S()+C())/2))})},[c]);let Z=async()=>{e.role===a._b.Client?(b(!0),e.onAnswer(f).then(e=>{if(console.debug("Answer submitted ".concat(e?"ok":"error")),console.debug("Received answer response",e),e)m(e);else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{b(!1)})):console.warn("Only participants can submit answers")},S=()=>{switch(e.type){case 2:return 0;case 0:case 1:return e.numericRange?e.numericRange[0]:0;default:throw"Unsupported SliderInputType ".concat(r[e.type])}},C=()=>{switch(e.type){case 2:return e.marks.length-1;case 0:case 1:return e.numericRange?e.numericRange[1]:10;default:throw"Unsupported SliderInputType ".concat(r[e.type])}},I=()=>{var t,n;switch(e.type){case 2:return 1;case 0:return null!==(t=e.numericStep)&&void 0!==t?t:.01;case 1:return null!==(n=e.numericStep)&&void 0!==n?n:1;default:throw"Unsupported SliderInputType ".concat(r[e.type])}},D=e.marks?100-100/e.marks.length:void 0,E=D?"".concat(D,"%"):void 0;return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(l.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:1},children:[(0,s.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,alignItems:"center",justifyContent:"center",px:4},children:[(0,s.jsx)(l.Z,{sx:{mb:8},children:e.question&&(0,s.jsx)(h.Z,{content:e.question})}),(0,s.jsx)(l.Z,{sx:{width:null!=E?E:"95%"},children:(0,s.jsx)(x.Z,{onCommit:e=>{y({...f,jsonValue:k(e)})},color:"secondary",sliderDefault:f.jsonValue?d().toNumber(f.jsonValue.answers[0].index):Math.floor((S()+C())/2),marks:null!==(t=(()=>{switch(e.type){case 2:return e.marks.map((e,t)=>({value:t,label:e}));case 0:return;case 1:return d().range(e.numericRange[0],e.numericRange[1]+1,I()).map((e,t)=>({value:e,label:"".concat(e)}))}})())&&void 0!==t&&t,slots:{markLabel:g.A},min:S(),max:C(),step:I(),sliderMode:"solo"})})]}),e.role===a._b.Client&&(0,s.jsx)(l.Z,{sx:{mt:8,mr:8},children:(0,s.jsx)(p.Z,{onSubmit:Z,text:"Submit",busy:v,enabled:w,inline:!1,alignment:"right"})})]})})}(i=r||(r={}))[i.continuous=0]="continuous",i[i.discrete=1]="discrete",i[i.categorical=2]="categorical"},26049:function(e,t,n){n.d(t,{Z:function(){return a}});var i=n(57437),r=n(48024),s=n(43298),o=n(2265);function a(e){var t;let[n,a]=(0,o.useState)(null!==(t=e.sliderDefault)&&void 0!==t?t:0),[l,c]=(0,o.useState)("solo"===e.sliderMode?1:.5),d=(0,o.useMemo)(()=>(0,r.ZP)(s.ZP)({color:"secondary",height:"".concat(.8*l,"em"),"& .MuiSlider-thumb":{height:"".concat(1.6*l,"em"),width:"".concat(1.6*l,"em"),backgroundColor:"secondary",boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset","&::before":{display:"none"}},"& .MuiSlider-rail":{borderRadius:"".concat(.4*l,"em"),boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset"},"& .MuiSlider-track":{borderRadius:"".concat(.4*l,"em"),boxShadow:"0px 4px 10px 0px rgba(0, 0, 0, 0.25) inset"},"& .MuiSlider-markLabel":{fontSize:"".concat(1*l,"rem"),marginTop:"".concat(2.5*l,"em")}}),[l]);return(0,i.jsx)(d,{...e,value:n,onChange:(e,t)=>{a(t)},onChangeCommitted:(t,n)=>{let i=n;e.acceptableRange&&i>e.acceptableRange.max&&(i=e.acceptableRange.max),e.acceptableRange&&i<e.acceptableRange.min&&(i=e.acceptableRange.min),a(i),e.onCommit(i)}})}},45231:function(e,t,n){n.d(t,{A:function(){return o}});var i=n(57437),r=n(43298),s=n(80511);let o=e=>{let t=e["data-index"],n=e.ownerState.marks[t],o=e.ownerState.marks.length,a={...e.style,width:"".concat(100/o,"%"),wordWrap:"normal",whiteSpace:"wrap"};return(0,i.jsx)(r.J$,{...e,style:a,children:(0,i.jsx)(s.Z,{variant:"sliderMark",style:{display:"block",wordWrap:"normal",whiteSpace:"wrap"},children:n.label})})}},45080:function(e,t,n){n.d(t,{L:function(){return r},Z:function(){return A}});var i,r,s=n(57437),o=n(8260),a=n(94547),l=n(7630),c=n(49428),d=n(22960),u=n(31193),h=n(66858),p=n(44908),x=n(65786),g=n(96537),m=n(69065),f=n(66124),y=n(60335),v=n(80511),b=n(19309),w=n(2265),j=n(48620),k=n(49752),Z=n(73391),S=n(60320);let C=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,I=(e,t,n)=>{let i=[],s=null!=t?t:"";switch(e){case r.text:let o=n?s.length>0?null:"Please enter an answer":null;null!==o&&i.push(o);break;case r.email:let a=C.test(s.trim()),l=n?s.trim().length>0&&a?null:"Please enter a valid email address.":0===s.trim().length||a?null:"Please enter a valid email address.";null!==l&&i.push(l);break;default:throw"Unsupported TextInputType"}return i},D=(e,t)=>{if(console.debug("Validating checkboxes",e),void 0===e)return["Checkbox data undefined."];let n=e.filter(e=>e.checked).length,i=e.map((e,t)=>e.required&&!e.checked?"The ".concat((0,Z.q)(t+1)," checkbox is required."):null).filter(e=>null!==e).map(e=>e),r=[];return n<t&&r.push("Please select at least ".concat(t," ").concat(1===t?"checkbox":"checkboxes",".")),[...i,...r]},E=()=>(0,s.jsx)(S.Z,{children:(0,s.jsx)("svg",{focusable:"false","aria-hidden":"true","data-testid":"CheckBoxBlankIcon",children:(0,s.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5",fill:"white"})})});(i=r||(r={}))[i.text=0]="text",i[i.email=1]="email";let P=(e,t)=>({...e,jsonValue:{answers:[{key:"text",stringValue:t.answer},...t.checks.map(e=>({key:e.key,stringValue:e.text,booleanValue:e.checked}))]}}),q=(e,t)=>{var n,i;return{answer:null===(i=e.jsonValue)||void 0===i?void 0:null===(n=i.answers.find(e=>"text"===e.key))||void 0===n?void 0:n.stringValue,checks:t.map(t=>{var n,i,r;return{key:t.key,text:t.text,initial:t.initial,checked:null!==(r=null===(i=e.jsonValue)||void 0===i?void 0:null===(n=i.answers.find(e=>e.key===t.key))||void 0===n?void 0:n.booleanValue)&&void 0!==r?r:t.initial,required:t.required}})}};function A(e){let{answers:t}=(0,o.ZP)(e.qids.qid),[n,i]=(0,w.useState)((0,o.Zp)(t,e.qids,e.question.pii)),[r,Z]=(0,w.useState)({answer:void 0,checks:[]}),[S,C]=(0,w.useState)(!1),[A,_]=(0,w.useState)(!0),[F,B]=(0,w.useState)(e.role===a._b.Client),[T,R]=(0,w.useState)(!1),[M,U]=(0,w.useState)(!1),[V,N]=(0,w.useState)([]),[W,L]=(0,w.useState)(),[O,z]=(0,w.useState)(!1),G=()=>{z(!1)};(0,w.useEffect)(()=>{Z(q(n,e.checkboxes))},[n,e.checkboxes]);let K=()=>{var t,n;let i=[...D(r.checks,e.minCheckboxes),...I(e.type,r.answer,e.textRequired)],s=(null!==(n=null===(t=r.answer)||void 0===t?void 0:t.length)&&void 0!==n?n:0)>0;return _(!M||0===i.length&&(s||!e.textRequired)),N(i),0===i.length};(0,w.useEffect)(()=>{M&&K()},[r]);let H=async()=>{if(e.role===a._b.Client&&A){if(U(!0),K()){let t=P(n,r);console.debug("Submitting TextInput",t),C(!0),e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)Z(q(t,e.checkboxes));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{C(!1)})}}else console.warn("Only participants can submit answers")},Y=async()=>{let t=P(n,{...r,answer:void 0,checks:[]});C(!0),e.onAnswer(t).then(t=>{if(console.debug("Answer submitted ".concat(t?"ok":"error")),console.debug("Received answer response",t),null!==t)Z(q(t,e.checkboxes));else throw"No response received"}).catch(e=>{console.error(e)}).finally(()=>{C(!1)})},Q=(e,t)=>{let n={...r,checks:[...r.checks]};n.checks.find(t=>t.key===e).checked=t,Z(n)};return(0,w.useEffect)(()=>{L(V.join(" ")),R(V.length>0)},[V]),(0,d.Z)(),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(u.Z,{className:"stretch",sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.question&&(0,s.jsx)(u.Z,{sx:{mb:4},children:(0,s.jsx)(j.Z,{content:e.question})}),(0,s.jsx)(h.Z,{label:e.label,variant:"outlined",defaultValue:r.answer,helperText:W,type:1===e.type?"email":"text",onChange:e=>{Z({...r,answer:e.target.value})},error:T,color:"buttonStandard",autoComplete:"off",InputProps:{sx:{background:"white",fontSize:"2rem"}},InputLabelProps:{sx:{fontSize:"2rem","&.MuiOutlinedInput-notchedOutline":{fontSize:"2rem"}}},sx:{mb:2}}),r.checks.map((t,n)=>(0,s.jsx)(u.Z,{display:"flex",flexDirection:"row",children:(0,s.jsx)(p.Z,{control:(0,s.jsx)(x.Z,{checked:t.checked,onChange:(e,n)=>Q(t.key,n),icon:e.forceCheckboxesWhite?(0,s.jsx)(E,{}):void 0}),label:t.text})},"checkbox-".concat(e.qids.qid,"-").concat(n,"-").concat(t.key))),e.information&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Z,{variant:"text",fullWidth:!1,color:"buttonStandard",sx:{textDecoration:"underline",alignSelf:"start",mt:2},startIcon:(0,s.jsx)(c.Z,{}),onClick:()=>z(!0),children:e.information.heading}),(0,s.jsx)(m.Z,{fullWidth:!0,maxWidth:"md",open:O,onClose:G,children:(0,s.jsxs)(f.Z,{children:[(0,s.jsx)(u.Z,{style:{position:"absolute",top:0,right:0},children:(0,s.jsx)(y.Z,{"aria-label":"close",onClick:G,children:(0,s.jsx)(l.Z,{})})}),(0,s.jsx)(u.Z,{sx:{p:2},display:"flex",flexDirection:"column",children:e.information.body.map((t,n)=>(0,s.jsx)(v.Z,{variant:"slideInfoText",align:"left",dangerouslySetInnerHTML:{__html:(0,b.Z)(t)}},"".concat(e.qids.qid,"-info-body-").concat(n)))})]})})]}),(0,s.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"row",gap:1,justifyContent:"end",alignItems:"end"},children:[e.skipText&&(0,s.jsx)(k.Z,{inline:!0,busy:S,onSubmit:Y,large:!0,variant:"outlined",text:e.skipText,enabled:!0}),(0,s.jsx)(k.Z,{inline:!0,busy:S,onSubmit:H,large:!0,text:e.submitText,enabled:!M||A})]})]})})}},48620:function(e,t,n){n.d(t,{Z:function(){return o}});var i=n(57437),r=n(31193),s=n(80511);function o(e){var t,n,o,a,l,c;return(0,i.jsx)(i.Fragment,{children:((null===(t=e.content)||void 0===t?void 0:t.explanation)||(null===(n=e.content)||void 0===n?void 0:n.instruction)||(null===(o=e.content)||void 0===o?void 0:o.question))&&(0,i.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch"},children:[e.content.instruction&&(0,i.jsx)(s.Z,{variant:"questionInstruction",align:null!==(a=e.forceAlign)&&void 0!==a?a:"center",component:"div",sx:{alignSelf:"stretch",...e.sx},children:e.content.instruction}),e.content.question&&(0,i.jsx)(s.Z,{variant:"questionPrompt",align:null!==(l=e.forceAlign)&&void 0!==l?l:"center",component:"div",sx:{alignSelf:"stretch",...e.sx},children:e.content.question}),e.content.explanation&&(0,i.jsx)(s.Z,{variant:"questionExplanation",align:null!==(c=e.forceAlign)&&void 0!==c?c:"center",component:"div",sx:{alignSelf:"stretch",...e.sx},children:e.content.explanation})]})})}},12569:function(e,t,n){n.d(t,{J:function(){return r},Z:function(){return v}});var i,r,s=n(57437),o=n(8260),a=n(83593),l=n(22960),c=n(41506),d=n(28651),u=n(97294),h=n(43152),p=n(22599),x=n.n(p),g=n(2265),m=n(35231),f=n(48620),y=n(24132);function v(e){let{answers:t}=(0,o.ZP)(e.qids.qid),[n,i]=(0,g.useState)();(0,g.useEffect)(()=>{switch(e.inputType){case y.rT.categorical:i((0,y.dx)(t,e.categories,e.range));break;case y.rT.numerical:i((0,y.B8)((0,y.tJ)(t,e.range)));break;default:throw"Unsupported GraphInputType"}setTimeout(()=>{a.Z.emit({type:a.M.Request_SlideRefresh})},1e3)},[t,e.categories,e.inputType,e.range]);let r={scaleType:"linear",tickInterval:x().range(0,1e3,1),tickLabelInterval:e=>(0,p.isInteger)(e),valueFormatter:e=>"".concat(e.toFixed(0)),disableLine:!0,disableTicks:!1},v={scaleType:"band",dataKey:"category",disableLine:!1,disableTicks:!1},b=(0,l.Z)();return(0,s.jsxs)(s.Fragment,{children:[e.question&&(0,s.jsx)(f.Z,{content:e.question}),(0,s.jsx)(m.h,{width:"100%",height:"100%",minWidth:50,minHeight:50,children:(0,s.jsx)(c.v,{layout:1===e.orientation?"vertical":"horizontal",margin:{left:150},grid:{horizontal:1===e.orientation,vertical:0===e.orientation},dataset:n,barLabel:"value",sx:{[".".concat(d.Is.root)]:{},".MuiBarElement-series-votes_id":{fill:b.palette.secondary.main},".MuiBarLabel-series-votes_id":{fill:"white",fontWeight:"bolder"},["& .".concat(h.k.line)]:{strokeDasharray:"5 3",strokeWidth:1},[".".concat(u.x.tickContainer)]:{textWrap:"wrap"},[".".concat(u.x.tickLabel)]:{fontSize:"1rem !important"}},slotProps:{bar:{rx:4,ry:4}},xAxis:[1===e.orientation?v:r],yAxis:[1===e.orientation?r:v],series:[{dataKey:"votes",label:void 0,id:"votes_id",valueFormatter:e=>null===e?"No data":1===e?"1 vote":"".concat(e.toFixed(0)," votes")}]})})]})}(i=r||(r={}))[i.horizontal=0]="horizontal",i[i.vertical=1]="vertical"},24132:function(e,t,n){n.d(t,{B8:function(){return m},dx:function(){return u},rT:function(){return o},tJ:function(){return h}});var i,r,s,o,a=n(22599),l=n.n(a);(i=s||(s={}))[i.bar=0]="bar",(r=o||(o={}))[r.categorical=0]="categorical",r[r.numerical=1]="numerical";let c=e=>{var t,n;return l().range(e.lo,e.hi+(null!==(t=e.step)&&void 0!==t?t:1),null!==(n=e.step)&&void 0!==n?n:1)},d=e=>e.replace(/\\n/g,"\n"),u=(e,t,n)=>p(e,t,n).map((t,n)=>({category:d(t),votes:x(e,n)})),h=(e,t)=>c(t).map(t=>({value:t,votes:g(e,t)})),p=(e,t,n)=>{let i=void 0!==t?t:void 0!==n?c(n).map(e=>"".concat(e)):void 0;if(void 0===i)throw"Cannot determine categories";return i.filter(e=>void 0!==e).map(e=>e)},x=(e,t)=>l().sum(e.map(e=>{var n;return l().sum(null===(n=e.jsonValue)||void 0===n?void 0:n.answers.filter(e=>e.index===t).map(e=>{var t;return null!==(t=e.numericValue)&&void 0!==t?t:0}))})),g=(e,t)=>x(e,t),m=e=>e.map(e=>({category:"".concat(e.value),votes:e.votes}))},78364:function(e,t,n){n.d(t,{Z:function(){return d}});var i=n(57437),r=n(2265),s=n(77412),o=n(11144),a=n(4766),l=n(5085),c=n(94547);function d(){let e=(0,r.useContext)(l.rZ),{session:t}=(0,r.useContext)(o.z),{slideIndex:n}=(0,r.useContext)(a.X),[d]=(0,s.Z)("/sounds/00-ding.mp3",{volume:.5});return(0,r.useEffect)(()=>{(e.role===c._b.Controller||t.remoteConfiguration!==c.VS.InPerson)&&d()},[e.role,t.remoteConfiguration,n,d]),(0,i.jsx)(i.Fragment,{})}},73391:function(e,t,n){n.d(t,{q:function(){return i}});let i=e=>{let t=e%10,n=e%100;return 1===t&&11!==n?e+"st":2===t&&12!==n?e+"nd":3===t&&13!==n?e+"rd":e+"th"}}}]);